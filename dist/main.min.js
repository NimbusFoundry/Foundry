function b64ToUint6(nChr){return nChr>64&&nChr<91?nChr-65:nChr>96&&nChr<123?nChr-71:nChr>47&&nChr<58?nChr+4:nChr===43?62:nChr===47?63:0}function base64DecToArr(sBase64,nBlocksSize){var sB64Enc=sBase64.replace(/[^A-Za-z0-9\+\/]/g,""),nInLen=sB64Enc.length,nOutLen=nBlocksSize?Math.ceil((nInLen*3+1>>2)/nBlocksSize)*nBlocksSize:nInLen*3+1>>2,taBytes=new Uint8Array(nOutLen);for(var nMod3,nMod4,nUint24=0,nOutIdx=0,nInIdx=0;nInIdx<nInLen;nInIdx++){nMod4=nInIdx&3;nUint24|=b64ToUint6(sB64Enc.charCodeAt(nInIdx))<<18-6*nMod4;if(nMod4===3||nInLen-nInIdx===1){for(nMod3=0;nMod3<3&&nOutIdx<nOutLen;nMod3++,nOutIdx++){taBytes[nOutIdx]=nUint24>>>(16>>>nMod3&24)&255}nUint24=0}}return taBytes}function uint6ToB64(nUint6){return nUint6<26?nUint6+65:nUint6<52?nUint6+71:nUint6<62?nUint6-4:nUint6===62?43:nUint6===63?47:65}function base64EncArr(aBytes){var nMod3=2,sB64Enc="";for(var nLen=aBytes.length,nUint24=0,nIdx=0;nIdx<nLen;nIdx++){nMod3=nIdx%3;if(nIdx>0&&nIdx*4/3%76===0){sB64Enc+="\r\n"}nUint24|=aBytes[nIdx]<<(16>>>nMod3&24);if(nMod3===2||aBytes.length-nIdx===1){sB64Enc+=String.fromCharCode(uint6ToB64(nUint24>>>18&63),uint6ToB64(nUint24>>>12&63),uint6ToB64(nUint24>>>6&63),uint6ToB64(nUint24&63));nUint24=0}}return sB64Enc.substr(0,sB64Enc.length-2+nMod3)+(nMod3===2?"":nMod3===1?"=":"==")}function UTF8ArrToStr(aBytes){var sView="";for(var nPart,nLen=aBytes.length,nIdx=0;nIdx<nLen;nIdx++){nPart=aBytes[nIdx];sView+=String.fromCharCode(nPart>251&&nPart<254&&nIdx+5<nLen?(nPart-252)*1073741824+(aBytes[++nIdx]-128<<24)+(aBytes[++nIdx]-128<<18)+(aBytes[++nIdx]-128<<12)+(aBytes[++nIdx]-128<<6)+aBytes[++nIdx]-128:nPart>247&&nPart<252&&nIdx+4<nLen?(nPart-248<<24)+(aBytes[++nIdx]-128<<18)+(aBytes[++nIdx]-128<<12)+(aBytes[++nIdx]-128<<6)+aBytes[++nIdx]-128:nPart>239&&nPart<248&&nIdx+3<nLen?(nPart-240<<18)+(aBytes[++nIdx]-128<<12)+(aBytes[++nIdx]-128<<6)+aBytes[++nIdx]-128:nPart>223&&nPart<240&&nIdx+2<nLen?(nPart-224<<12)+(aBytes[++nIdx]-128<<6)+aBytes[++nIdx]-128:nPart>191&&nPart<224&&nIdx+1<nLen?(nPart-192<<6)+aBytes[++nIdx]-128:nPart)}return sView}function strToUTF8Arr(sDOMStr){var aBytes,nChr,nStrLen=sDOMStr.length,nArrLen=0;for(var nMapIdx=0;nMapIdx<nStrLen;nMapIdx++){nChr=sDOMStr.charCodeAt(nMapIdx);nArrLen+=nChr<128?1:nChr<2048?2:nChr<65536?3:nChr<2097152?4:nChr<67108864?5:6}aBytes=new Uint8Array(nArrLen);for(var nIdx=0,nChrIdx=0;nIdx<nArrLen;nChrIdx++){nChr=sDOMStr.charCodeAt(nChrIdx);if(nChr<128){aBytes[nIdx++]=nChr}else if(nChr<2048){aBytes[nIdx++]=192+(nChr>>>6);aBytes[nIdx++]=128+(nChr&63)}else if(nChr<65536){aBytes[nIdx++]=224+(nChr>>>12);aBytes[nIdx++]=128+(nChr>>>6&63);aBytes[nIdx++]=128+(nChr&63)}else if(nChr<2097152){aBytes[nIdx++]=240+(nChr>>>18);aBytes[nIdx++]=128+(nChr>>>12&63);aBytes[nIdx++]=128+(nChr>>>6&63);aBytes[nIdx++]=128+(nChr&63)}else if(nChr<67108864){aBytes[nIdx++]=248+(nChr>>>24);aBytes[nIdx++]=128+(nChr>>>18&63);aBytes[nIdx++]=128+(nChr>>>12&63);aBytes[nIdx++]=128+(nChr>>>6&63);aBytes[nIdx++]=128+(nChr&63)}else{aBytes[nIdx++]=252+nChr/1073741824;aBytes[nIdx++]=128+(nChr>>>24&63);aBytes[nIdx++]=128+(nChr>>>18&63);aBytes[nIdx++]=128+(nChr>>>12&63);aBytes[nIdx++]=128+(nChr>>>6&63);aBytes[nIdx++]=128+(nChr&63)}}return aBytes}(function(e,t){var n,r,i=typeof t,o=e.location,a=e.document,s=a.documentElement,l=e.jQuery,u=e.$,c={},p=[],f="1.10.2",d=p.concat,h=p.push,g=p.slice,m=p.indexOf,y=c.toString,v=c.hasOwnProperty,b=f.trim,x=function(e,t){return new x.fn.init(e,t,r)},w=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,T=/\S+/g,C=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,N=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,k=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,E=/^[\],:{}\s]*$/,S=/(?:^|:|,)(?:\s*\[)+/g,A=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,j=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,D=/^-ms-/,L=/-([\da-z])/gi,H=function(e,t){return t.toUpperCase()},q=function(e){(a.addEventListener||"load"===e.type||"complete"===a.readyState)&&(_(),x.ready())},_=function(){a.addEventListener?(a.removeEventListener("DOMContentLoaded",q,!1),e.removeEventListener("load",q,!1)):(a.detachEvent("onreadystatechange",q),e.detachEvent("onload",q))};x.fn=x.prototype={jquery:f,constructor:x,init:function(e,n,r){var i,o;if(!e)return this;if("string"==typeof e){if(i="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:N.exec(e),!i||!i[1]&&n)return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e);if(i[1]){if(n=n instanceof x?n[0]:n,x.merge(this,x.parseHTML(i[1],n&&n.nodeType?n.ownerDocument||n:a,!0)),k.test(i[1])&&x.isPlainObject(n))for(i in n)x.isFunction(this[i])?this[i](n[i]):this.attr(i,n[i]);return this}if(o=a.getElementById(i[2]),o&&o.parentNode){if(o.id!==i[2])return r.find(e);this.length=1,this[0]=o}return this.context=a,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):x.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),x.makeArray(e,this))},selector:"",length:0,toArray:function(){return g.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=x.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return x.each(this,e,t)},ready:function(e){return x.ready.promise().done(e),this},slice:function(){return this.pushStack(g.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},map:function(e){return this.pushStack(x.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:h,sort:[].sort,splice:[].splice},x.fn.init.prototype=x.fn,x.extend=x.fn.extend=function(){var e,n,r,i,o,a,s=arguments[0]||{},l=1,u=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[1]||{},l=2),"object"==typeof s||x.isFunction(s)||(s={}),u===l&&(s=this,--l);u>l;l++)if(null!=(o=arguments[l]))for(i in o)e=s[i],r=o[i],s!==r&&(c&&r&&(x.isPlainObject(r)||(n=x.isArray(r)))?(n?(n=!1,a=e&&x.isArray(e)?e:[]):a=e&&x.isPlainObject(e)?e:{},s[i]=x.extend(c,a,r)):r!==t&&(s[i]=r));return s},x.extend({expando:"jQuery"+(f+Math.random()).replace(/\D/g,""),noConflict:function(t){return e.$===x&&(e.$=u),t&&e.jQuery===x&&(e.jQuery=l),x},isReady:!1,readyWait:1,holdReady:function(e){e?x.readyWait++:x.ready(!0)},ready:function(e){if(e===!0?!--x.readyWait:!x.isReady){if(!a.body)return setTimeout(x.ready);x.isReady=!0,e!==!0&&--x.readyWait>0||(n.resolveWith(a,[x]),x.fn.trigger&&x(a).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===x.type(e)},isArray:Array.isArray||function(e){return"array"===x.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?c[y.call(e)]||"object":typeof e},isPlainObject:function(e){var n;if(!e||"object"!==x.type(e)||e.nodeType||x.isWindow(e))return!1;try{if(e.constructor&&!v.call(e,"constructor")&&!v.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(r){return!1}if(x.support.ownLast)for(n in e)return v.call(e,n);for(n in e);return n===t||v.call(e,n)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||a;var r=k.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=x.buildFragment([e],t,i),i&&x(i).remove(),x.merge([],r.childNodes))},parseJSON:function(n){return e.JSON&&e.JSON.parse?e.JSON.parse(n):null===n?n:"string"==typeof n&&(n=x.trim(n),n&&E.test(n.replace(A,"@").replace(j,"]").replace(S,"")))?Function("return "+n)():(x.error("Invalid JSON: "+n),t)},parseXML:function(n){var r,i;if(!n||"string"!=typeof n)return null;try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(o){r=t}return r&&r.documentElement&&!r.getElementsByTagName("parsererror").length||x.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&x.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(D,"ms-").replace(L,H)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,o=e.length,a=M(e);if(n){if(a){for(;o>i;i++)if(r=t.apply(e[i],n),r===!1)break}else for(i in e)if(r=t.apply(e[i],n),r===!1)break}else if(a){for(;o>i;i++)if(r=t.call(e[i],i,e[i]),r===!1)break}else for(i in e)if(r=t.call(e[i],i,e[i]),r===!1)break;return e},trim:b&&!b.call("﻿ ")?function(e){return null==e?"":b.call(e)}:function(e){return null==e?"":(e+"").replace(C,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(M(Object(e))?x.merge(n,"string"==typeof e?[e]:e):h.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(m)return m.call(t,e,n);for(r=t.length,n=n?0>n?Math.max(0,r+n):n:0;r>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=n.length,i=e.length,o=0;if("number"==typeof r)for(;r>o;o++)e[i++]=n[o];else while(n[o]!==t)e[i++]=n[o++];return e.length=i,e},grep:function(e,t,n){var r,i=[],o=0,a=e.length;for(n=!!n;a>o;o++)r=!!t(e[o],o),n!==r&&i.push(e[o]);return i},map:function(e,t,n){var r,i=0,o=e.length,a=M(e),s=[];if(a)for(;o>i;i++)r=t(e[i],i,n),null!=r&&(s[s.length]=r);else for(i in e)r=t(e[i],i,n),null!=r&&(s[s.length]=r);return d.apply([],s)},guid:1,proxy:function(e,n){var r,i,o;return"string"==typeof n&&(o=e[n],n=e,e=o),x.isFunction(e)?(r=g.call(arguments,2),i=function(){return e.apply(n||this,r.concat(g.call(arguments)))},i.guid=e.guid=e.guid||x.guid++,i):t},access:function(e,n,r,i,o,a,s){var l=0,u=e.length,c=null==r;if("object"===x.type(r)){o=!0;for(l in r)x.access(e,n,l,r[l],!0,a,s)}else if(i!==t&&(o=!0,x.isFunction(i)||(s=!0),c&&(s?(n.call(e,i),n=null):(c=n,n=function(e,t,n){return c.call(x(e),n)})),n))for(;u>l;l++)n(e[l],r,s?i:i.call(e[l],l,n(e[l],r)));return o?e:c?n.call(e):u?n(e[0],r):a},now:function(){return(new Date).getTime()},swap:function(e,t,n,r){var i,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];i=n.apply(e,r||[]);for(o in t)e.style[o]=a[o];return i}}),x.ready.promise=function(t){if(!n)if(n=x.Deferred(),"complete"===a.readyState)setTimeout(x.ready);else if(a.addEventListener)a.addEventListener("DOMContentLoaded",q,!1),e.addEventListener("load",q,!1);else{a.attachEvent("onreadystatechange",q),e.attachEvent("onload",q);var r=!1;try{r=null==e.frameElement&&a.documentElement}catch(i){}r&&r.doScroll&&function o(){if(!x.isReady){try{r.doScroll("left")}catch(e){return setTimeout(o,50)}_(),x.ready()}}()}return n.promise(t)},x.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){c["[object "+t+"]"]=t.toLowerCase()});function M(e){var t=e.length,n=x.type(e);return x.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)}r=x(a),function(e,t){var n,r,i,o,a,s,l,u,c,p,f,d,h,g,m,y,v,b="sizzle"+-new Date,w=e.document,T=0,C=0,N=st(),k=st(),E=st(),S=!1,A=function(e,t){return e===t?(S=!0,0):0},j=typeof t,D=1<<31,L={}.hasOwnProperty,H=[],q=H.pop,_=H.push,M=H.push,O=H.slice,F=H.indexOf||function(e){var t=0,n=this.length;for(;n>t;t++)if(this[t]===e)return t;return-1},B="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",P="[\\x20\\t\\r\\n\\f]",R="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",W=R.replace("w","w#"),$="\\["+P+"*("+R+")"+P+"*(?:([*^$|!~]?=)"+P+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+W+")|)|)"+P+"*\\]",I=":("+R+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+$.replace(3,8)+")*)|.*)\\)|)",z=RegExp("^"+P+"+|((?:^|[^\\\\])(?:\\\\.)*)"+P+"+$","g"),X=RegExp("^"+P+"*,"+P+"*"),U=RegExp("^"+P+"*([>+~]|"+P+")"+P+"*"),V=RegExp(P+"*[+~]"),Y=RegExp("="+P+"*([^\\]'\"]*)"+P+"*\\]","g"),J=RegExp(I),G=RegExp("^"+W+"$"),Q={ID:RegExp("^#("+R+")"),CLASS:RegExp("^\\.("+R+")"),TAG:RegExp("^("+R.replace("w","w*")+")"),ATTR:RegExp("^"+$),PSEUDO:RegExp("^"+I),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+P+"*(even|odd|(([+-]|)(\\d*)n|)"+P+"*(?:([+-]|)"+P+"*(\\d+)|))"+P+"*\\)|)","i"),bool:RegExp("^(?:"+B+")$","i"),needsContext:RegExp("^"+P+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+P+"*((?:-\\d)?\\d*)"+P+"*\\)|)(?=[^-]|$)","i")},K=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,et=/^(?:input|select|textarea|button)$/i,tt=/^h\d$/i,nt=/'|\\/g,rt=RegExp("\\\\([\\da-f]{1,6}"+P+"?|("+P+")|.)","ig"),it=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:0>r?String.fromCharCode(r+65536):String.fromCharCode(55296|r>>10,56320|1023&r)};try{M.apply(H=O.call(w.childNodes),w.childNodes),H[w.childNodes.length].nodeType}catch(ot){M={apply:H.length?function(e,t){_.apply(e,O.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}function at(e,t,n,i){var o,a,s,l,u,c,d,m,y,x;if((t?t.ownerDocument||t:w)!==f&&p(t),t=t||f,n=n||[],!e||"string"!=typeof e)return n;if(1!==(l=t.nodeType)&&9!==l)return[];if(h&&!i){if(o=Z.exec(e))if(s=o[1]){if(9===l){if(a=t.getElementById(s),!a||!a.parentNode)return n;if(a.id===s)return n.push(a),n}else if(t.ownerDocument&&(a=t.ownerDocument.getElementById(s))&&v(t,a)&&a.id===s)return n.push(a),n}else{if(o[2])return M.apply(n,t.getElementsByTagName(e)),n;if((s=o[3])&&r.getElementsByClassName&&t.getElementsByClassName)return M.apply(n,t.getElementsByClassName(s)),n}if(r.qsa&&(!g||!g.test(e))){if(m=d=b,y=t,x=9===l&&e,1===l&&"object"!==t.nodeName.toLowerCase()){c=mt(e),(d=t.getAttribute("id"))?m=d.replace(nt,"\\$&"):t.setAttribute("id",m),m="[id='"+m+"'] ",u=c.length;while(u--)c[u]=m+yt(c[u]);y=V.test(e)&&t.parentNode||t,x=c.join(",")}if(x)try{return M.apply(n,y.querySelectorAll(x)),n}catch(T){}finally{d||t.removeAttribute("id")}}}return kt(e.replace(z,"$1"),t,n,i)}function st(){var e=[];function t(n,r){return e.push(n+=" ")>o.cacheLength&&delete t[e.shift()],t[n]=r}return t}function lt(e){return e[b]=!0,e}function ut(e){var t=f.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ct(e,t){var n=e.split("|"),r=e.length;while(r--)o.attrHandle[n[r]]=t}function pt(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||D)-(~e.sourceIndex||D);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function ft(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function dt(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function ht(e){return lt(function(t){return t=+t,lt(function(n,r){var i,o=e([],n.length,t),a=o.length;while(a--)n[i=o[a]]&&(n[i]=!(r[i]=n[i]))})})}s=at.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},r=at.support={},p=at.setDocument=function(e){var n=e?e.ownerDocument||e:w,i=n.defaultView;return n!==f&&9===n.nodeType&&n.documentElement?(f=n,d=n.documentElement,h=!s(n),i&&i.attachEvent&&i!==i.top&&i.attachEvent("onbeforeunload",function(){p()}),r.attributes=ut(function(e){return e.className="i",!e.getAttribute("className")}),r.getElementsByTagName=ut(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),r.getElementsByClassName=ut(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",2===e.getElementsByClassName("i").length}),r.getById=ut(function(e){return d.appendChild(e).id=b,!n.getElementsByName||!n.getElementsByName(b).length}),r.getById?(o.find.ID=function(e,t){if(typeof t.getElementById!==j&&h){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},o.filter.ID=function(e){var t=e.replace(rt,it);return function(e){return e.getAttribute("id")===t}}):(delete o.find.ID,o.filter.ID=function(e){var t=e.replace(rt,it);return function(e){var n=typeof e.getAttributeNode!==j&&e.getAttributeNode("id");return n&&n.value===t}}),o.find.TAG=r.getElementsByTagName?function(e,n){return typeof n.getElementsByTagName!==j?n.getElementsByTagName(e):t}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++])1===n.nodeType&&r.push(n);return r}return o},o.find.CLASS=r.getElementsByClassName&&function(e,n){return typeof n.getElementsByClassName!==j&&h?n.getElementsByClassName(e):t},m=[],g=[],(r.qsa=K.test(n.querySelectorAll))&&(ut(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||g.push("\\["+P+"*(?:value|"+B+")"),e.querySelectorAll(":checked").length||g.push(":checked")}),ut(function(e){var t=n.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("t",""),e.querySelectorAll("[t^='']").length&&g.push("[*^$]="+P+"*(?:''|\"\")"),e.querySelectorAll(":enabled").length||g.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),g.push(",.*:")})),(r.matchesSelector=K.test(y=d.webkitMatchesSelector||d.mozMatchesSelector||d.oMatchesSelector||d.msMatchesSelector))&&ut(function(e){r.disconnectedMatch=y.call(e,"div"),y.call(e,"[s!='']:x"),m.push("!=",I)}),g=g.length&&RegExp(g.join("|")),m=m.length&&RegExp(m.join("|")),v=K.test(d.contains)||d.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},A=d.compareDocumentPosition?function(e,t){if(e===t)return S=!0,0;var i=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t);return i?1&i||!r.sortDetached&&t.compareDocumentPosition(e)===i?e===n||v(w,e)?-1:t===n||v(w,t)?1:c?F.call(c,e)-F.call(c,t):0:4&i?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var r,i=0,o=e.parentNode,a=t.parentNode,s=[e],l=[t];if(e===t)return S=!0,0;if(!o||!a)return e===n?-1:t===n?1:o?-1:a?1:c?F.call(c,e)-F.call(c,t):0;if(o===a)return pt(e,t);r=e;while(r=r.parentNode)s.unshift(r);r=t;while(r=r.parentNode)l.unshift(r);while(s[i]===l[i])i++;return i?pt(s[i],l[i]):s[i]===w?-1:l[i]===w?1:0},n):f},at.matches=function(e,t){return at(e,null,null,t)},at.matchesSelector=function(e,t){if((e.ownerDocument||e)!==f&&p(e),t=t.replace(Y,"='$1']"),!(!r.matchesSelector||!h||m&&m.test(t)||g&&g.test(t)))try{var n=y.call(e,t);if(n||r.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(i){}return at(t,f,null,[e]).length>0},at.contains=function(e,t){return(e.ownerDocument||e)!==f&&p(e),v(e,t)},at.attr=function(e,n){(e.ownerDocument||e)!==f&&p(e);var i=o.attrHandle[n.toLowerCase()],a=i&&L.call(o.attrHandle,n.toLowerCase())?i(e,n,!h):t;return a===t?r.attributes||!h?e.getAttribute(n):(a=e.getAttributeNode(n))&&a.specified?a.value:null:a},at.error=function(e){throw Error("Syntax error, unrecognized expression: "+e)},at.uniqueSort=function(e){var t,n=[],i=0,o=0;if(S=!r.detectDuplicates,c=!r.sortStable&&e.slice(0),e.sort(A),S){while(t=e[o++])t===e[o]&&(i=n.push(o));while(i--)e.splice(n[i],1)}return e},a=at.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=a(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r];r++)n+=a(t);return n},o=at.selectors={cacheLength:50,createPseudo:lt,match:Q,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(rt,it),e[3]=(e[4]||e[5]||"").replace(rt,it),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||at.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&at.error(e[0]),e},PSEUDO:function(e){var n,r=!e[5]&&e[2];return Q.CHILD.test(e[0])?null:(e[3]&&e[4]!==t?e[2]=e[4]:r&&J.test(r)&&(n=mt(r,!0))&&(n=r.indexOf(")",r.length-n)-r.length)&&(e[0]=e[0].slice(0,n),e[2]=r.slice(0,n)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(rt,it).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=N[e+" "];return t||(t=RegExp("(^|"+P+")"+e+"("+P+"|$)"))&&N(e,function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==j&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=at.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,l){var u,c,p,f,d,h,g=o!==a?"nextSibling":"previousSibling",m=t.parentNode,y=s&&t.nodeName.toLowerCase(),v=!l&&!s;if(m){if(o){while(g){p=t;while(p=p[g])if(s?p.nodeName.toLowerCase()===y:1===p.nodeType)return!1;h=g="only"===e&&!h&&"nextSibling"}return!0}if(h=[a?m.firstChild:m.lastChild],a&&v){c=m[b]||(m[b]={}),u=c[e]||[],d=u[0]===T&&u[1],f=u[0]===T&&u[2],p=d&&m.childNodes[d];while(p=++d&&p&&p[g]||(f=d=0)||h.pop())if(1===p.nodeType&&++f&&p===t){c[e]=[T,d,f];break}}else if(v&&(u=(t[b]||(t[b]={}))[e])&&u[0]===T)f=u[1];else while(p=++d&&p&&p[g]||(f=d=0)||h.pop())if((s?p.nodeName.toLowerCase()===y:1===p.nodeType)&&++f&&(v&&((p[b]||(p[b]={}))[e]=[T,f]),p===t))break;return f-=i,f===r||0===f%r&&f/r>=0}}},PSEUDO:function(e,t){var n,r=o.pseudos[e]||o.setFilters[e.toLowerCase()]||at.error("unsupported pseudo: "+e);return r[b]?r(t):r.length>1?(n=[e,e,"",t],o.setFilters.hasOwnProperty(e.toLowerCase())?lt(function(e,n){var i,o=r(e,t),a=o.length;while(a--)i=F.call(e,o[a]),e[i]=!(n[i]=o[a])}):function(e){return r(e,0,n)}):r}},pseudos:{not:lt(function(e){var t=[],n=[],r=l(e.replace(z,"$1"));return r[b]?lt(function(e,t,n,i){var o,a=r(e,null,i,[]),s=e.length;while(s--)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,i,o){return t[0]=e,r(t,null,o,n),!n.pop()}}),has:lt(function(e){return function(t){return at(e,t).length>0}}),contains:lt(function(e){return function(t){return(t.textContent||t.innerText||a(t)).indexOf(e)>-1}}),lang:lt(function(e){return G.test(e||"")||at.error("unsupported lang: "+e),e=e.replace(rt,it).toLowerCase(),function(t){var n;do if(n=h?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===d},focus:function(e){return e===f.activeElement&&(!f.hasFocus||f.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!o.pseudos.empty(e)},header:function(e){return tt.test(e.nodeName)},input:function(e){return et.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:ht(function(){return[0]}),last:ht(function(e,t){return[t-1]}),eq:ht(function(e,t,n){return[0>n?n+t:n]}),even:ht(function(e,t){var n=0;for(;t>n;n+=2)e.push(n);return e}),odd:ht(function(e,t){var n=1;for(;t>n;n+=2)e.push(n);return e}),lt:ht(function(e,t,n){var r=0>n?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:ht(function(e,t,n){var r=0>n?n+t:n;for(;t>++r;)e.push(r);return e})}},o.pseudos.nth=o.pseudos.eq;for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})o.pseudos[n]=ft(n);for(n in{submit:!0,reset:!0})o.pseudos[n]=dt(n);function gt(){}gt.prototype=o.filters=o.pseudos,o.setFilters=new gt;function mt(e,t){var n,r,i,a,s,l,u,c=k[e+" "];if(c)return t?0:c.slice(0);s=e,l=[],u=o.preFilter;while(s){(!n||(r=X.exec(s)))&&(r&&(s=s.slice(r[0].length)||s),l.push(i=[])),n=!1,(r=U.exec(s))&&(n=r.shift(),i.push({value:n,type:r[0].replace(z," ")}),s=s.slice(n.length));for(a in o.filter)!(r=Q[a].exec(s))||u[a]&&!(r=u[a](r))||(n=r.shift(),i.push({value:n,type:a,matches:r}),s=s.slice(n.length));if(!n)break}return t?s.length:s?at.error(e):k(e,l).slice(0)}function yt(e){var t=0,n=e.length,r="";for(;n>t;t++)r+=e[t].value;return r}function vt(e,t,n){var r=t.dir,o=n&&"parentNode"===r,a=C++;return t.first?function(t,n,i){while(t=t[r])if(1===t.nodeType||o)return e(t,n,i)}:function(t,n,s){var l,u,c,p=T+" "+a;if(s){while(t=t[r])if((1===t.nodeType||o)&&e(t,n,s))return!0}else while(t=t[r])if(1===t.nodeType||o)if(c=t[b]||(t[b]={}),(u=c[r])&&u[0]===p){if((l=u[1])===!0||l===i)return l===!0}else if(u=c[r]=[p],u[1]=e(t,n,s)||i,u[1]===!0)return!0}}function bt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function xt(e,t,n,r,i){var o,a=[],s=0,l=e.length,u=null!=t;for(;l>s;s++)(o=e[s])&&(!n||n(o,r,i))&&(a.push(o),u&&t.push(s));return a}function wt(e,t,n,r,i,o){return r&&!r[b]&&(r=wt(r)),i&&!i[b]&&(i=wt(i,o)),lt(function(o,a,s,l){var u,c,p,f=[],d=[],h=a.length,g=o||Nt(t||"*",s.nodeType?[s]:s,[]),m=!e||!o&&t?g:xt(g,f,e,s,l),y=n?i||(o?e:h||r)?[]:a:m;if(n&&n(m,y,s,l),r){u=xt(y,d),r(u,[],s,l),c=u.length;while(c--)(p=u[c])&&(y[d[c]]=!(m[d[c]]=p))}if(o){if(i||e){if(i){u=[],c=y.length;while(c--)(p=y[c])&&u.push(m[c]=p);i(null,y=[],u,l)}c=y.length;while(c--)(p=y[c])&&(u=i?F.call(o,p):f[c])>-1&&(o[u]=!(a[u]=p))}}else y=xt(y===a?y.splice(h,y.length):y),i?i(null,a,y,l):M.apply(a,y)})}function Tt(e){var t,n,r,i=e.length,a=o.relative[e[0].type],s=a||o.relative[" "],l=a?1:0,c=vt(function(e){return e===t},s,!0),p=vt(function(e){return F.call(t,e)>-1},s,!0),f=[function(e,n,r){return!a&&(r||n!==u)||((t=n).nodeType?c(e,n,r):p(e,n,r))}];for(;i>l;l++)if(n=o.relative[e[l].type])f=[vt(bt(f),n)];else{if(n=o.filter[e[l].type].apply(null,e[l].matches),n[b]){for(r=++l;i>r;r++)if(o.relative[e[r].type])break;return wt(l>1&&bt(f),l>1&&yt(e.slice(0,l-1).concat({value:" "===e[l-2].type?"*":""})).replace(z,"$1"),n,r>l&&Tt(e.slice(l,r)),i>r&&Tt(e=e.slice(r)),i>r&&yt(e))}f.push(n)}return bt(f)}function Ct(e,t){var n=0,r=t.length>0,a=e.length>0,s=function(s,l,c,p,d){var h,g,m,y=[],v=0,b="0",x=s&&[],w=null!=d,C=u,N=s||a&&o.find.TAG("*",d&&l.parentNode||l),k=T+=null==C?1:Math.random()||.1;for(w&&(u=l!==f&&l,i=n);null!=(h=N[b]);b++){if(a&&h){g=0;while(m=e[g++])if(m(h,l,c)){p.push(h);break}w&&(T=k,i=++n)}r&&((h=!m&&h)&&v--,s&&x.push(h))}if(v+=b,r&&b!==v){g=0;while(m=t[g++])m(x,y,l,c);if(s){if(v>0)while(b--)x[b]||y[b]||(y[b]=q.call(p));y=xt(y)}M.apply(p,y),w&&!s&&y.length>0&&v+t.length>1&&at.uniqueSort(p)}return w&&(T=k,u=C),x};return r?lt(s):s}l=at.compile=function(e,t){var n,r=[],i=[],o=E[e+" "];if(!o){t||(t=mt(e)),n=t.length;while(n--)o=Tt(t[n]),o[b]?r.push(o):i.push(o);o=E(e,Ct(i,r))}return o};function Nt(e,t,n){var r=0,i=t.length;for(;i>r;r++)at(e,t[r],n);return n}function kt(e,t,n,i){var a,s,u,c,p,f=mt(e);if(!i&&1===f.length){if(s=f[0]=f[0].slice(0),s.length>2&&"ID"===(u=s[0]).type&&r.getById&&9===t.nodeType&&h&&o.relative[s[1].type]){if(t=(o.find.ID(u.matches[0].replace(rt,it),t)||[])[0],!t)return n;e=e.slice(s.shift().value.length)}a=Q.needsContext.test(e)?0:s.length;while(a--){if(u=s[a],o.relative[c=u.type])break;if((p=o.find[c])&&(i=p(u.matches[0].replace(rt,it),V.test(s[0].type)&&t.parentNode||t))){if(s.splice(a,1),e=i.length&&yt(s),!e)return M.apply(n,i),n;break}}}return l(e,f)(i,t,!h,n,V.test(e)),n}r.sortStable=b.split("").sort(A).join("")===b,r.detectDuplicates=S,p(),r.sortDetached=ut(function(e){return 1&e.compareDocumentPosition(f.createElement("div"))}),ut(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||ct("type|href|height|width",function(e,n,r){return r?t:e.getAttribute(n,"type"===n.toLowerCase()?1:2)}),r.attributes&&ut(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||ct("value",function(e,n,r){return r||"input"!==e.nodeName.toLowerCase()?t:e.defaultValue}),ut(function(e){return null==e.getAttribute("disabled")})||ct(B,function(e,n,r){var i;return r?t:(i=e.getAttributeNode(n))&&i.specified?i.value:e[n]===!0?n.toLowerCase():null}),x.find=at,x.expr=at.selectors,x.expr[":"]=x.expr.pseudos,x.unique=at.uniqueSort,x.text=at.getText,x.isXMLDoc=at.isXML,x.contains=at.contains}(e);var O={};function F(e){var t=O[e]={};return x.each(e.match(T)||[],function(e,n){t[n]=!0}),t}x.Callbacks=function(e){e="string"==typeof e?O[e]||F(e):x.extend({},e);var n,r,i,o,a,s,l=[],u=!e.once&&[],c=function(t){for(r=e.memory&&t,i=!0,a=s||0,s=0,o=l.length,n=!0;l&&o>a;a++)if(l[a].apply(t[0],t[1])===!1&&e.stopOnFalse){r=!1;break}n=!1,l&&(u?u.length&&c(u.shift()):r?l=[]:p.disable())},p={add:function(){if(l){var t=l.length;(function i(t){x.each(t,function(t,n){var r=x.type(n);"function"===r?e.unique&&p.has(n)||l.push(n):n&&n.length&&"string"!==r&&i(n)})})(arguments),n?o=l.length:r&&(s=t,c(r))}return this},remove:function(){return l&&x.each(arguments,function(e,t){var r;while((r=x.inArray(t,l,r))>-1)l.splice(r,1),n&&(o>=r&&o--,a>=r&&a--)}),this},has:function(e){return e?x.inArray(e,l)>-1:!(!l||!l.length)},empty:function(){return l=[],o=0,this},disable:function(){return l=u=r=t,this},disabled:function(){return!l},lock:function(){return u=t,r||p.disable(),this},locked:function(){return!u},fireWith:function(e,t){return!l||i&&!u||(t=t||[],t=[e,t.slice?t.slice():t],n?u.push(t):c(t)),this},fire:function(){return p.fireWith(this,arguments),this},fired:function(){return!!i}};return p},x.extend({Deferred:function(e){var t=[["resolve","done",x.Callbacks("once memory"),"resolved"],["reject","fail",x.Callbacks("once memory"),"rejected"],["notify","progress",x.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return x.Deferred(function(n){x.each(t,function(t,o){var a=o[0],s=x.isFunction(e[t])&&e[t];i[o[1]](function(){var e=s&&s.apply(this,arguments);e&&x.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[a+"With"](this===r?n.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?x.extend(e,r):r}},i={};return r.pipe=r.then,x.each(t,function(e,o){var a=o[2],s=o[3];r[o[1]]=a.add,s&&a.add(function(){n=s},t[1^e][2].disable,t[2][2].lock),i[o[0]]=function(){return i[o[0]+"With"](this===i?r:this,arguments),this},i[o[0]+"With"]=a.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=g.call(arguments),r=n.length,i=1!==r||e&&x.isFunction(e.promise)?r:0,o=1===i?e:x.Deferred(),a=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?g.call(arguments):r,n===s?o.notifyWith(t,n):--i||o.resolveWith(t,n)}},s,l,u;if(r>1)for(s=Array(r),l=Array(r),u=Array(r);r>t;t++)n[t]&&x.isFunction(n[t].promise)?n[t].promise().done(a(t,u,n)).fail(o.reject).progress(a(t,l,s)):--i;return i||o.resolveWith(u,n),o.promise()}}),x.support=function(t){var n,r,o,s,l,u,c,p,f,d=a.createElement("div");if(d.setAttribute("className","t"),d.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=d.getElementsByTagName("*")||[],r=d.getElementsByTagName("a")[0],!r||!r.style||!n.length)return t;s=a.createElement("select"),u=s.appendChild(a.createElement("option")),o=d.getElementsByTagName("input")[0],r.style.cssText="top:1px;float:left;opacity:.5",t.getSetAttribute="t"!==d.className,t.leadingWhitespace=3===d.firstChild.nodeType,t.tbody=!d.getElementsByTagName("tbody").length,t.htmlSerialize=!!d.getElementsByTagName("link").length,t.style=/top/.test(r.getAttribute("style")),t.hrefNormalized="/a"===r.getAttribute("href"),t.opacity=/^0.5/.test(r.style.opacity),t.cssFloat=!!r.style.cssFloat,t.checkOn=!!o.value,t.optSelected=u.selected,t.enctype=!!a.createElement("form").enctype,t.html5Clone="<:nav></:nav>"!==a.createElement("nav").cloneNode(!0).outerHTML,t.inlineBlockNeedsLayout=!1,t.shrinkWrapBlocks=!1,t.pixelPosition=!1,t.deleteExpando=!0,t.noCloneEvent=!0,t.reliableMarginRight=!0,t.boxSizingReliable=!0,o.checked=!0,t.noCloneChecked=o.cloneNode(!0).checked,s.disabled=!0,t.optDisabled=!u.disabled;
try{delete d.test}catch(h){t.deleteExpando=!1}o=a.createElement("input"),o.setAttribute("value",""),t.input=""===o.getAttribute("value"),o.value="t",o.setAttribute("type","radio"),t.radioValue="t"===o.value,o.setAttribute("checked","t"),o.setAttribute("name","t"),l=a.createDocumentFragment(),l.appendChild(o),t.appendChecked=o.checked,t.checkClone=l.cloneNode(!0).cloneNode(!0).lastChild.checked,d.attachEvent&&(d.attachEvent("onclick",function(){t.noCloneEvent=!1}),d.cloneNode(!0).click());for(f in{submit:!0,change:!0,focusin:!0})d.setAttribute(c="on"+f,"t"),t[f+"Bubbles"]=c in e||d.attributes[c].expando===!1;d.style.backgroundClip="content-box",d.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===d.style.backgroundClip;for(f in x(t))break;return t.ownLast="0"!==f,x(function(){var n,r,o,s="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",l=a.getElementsByTagName("body")[0];l&&(n=a.createElement("div"),n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",l.appendChild(n).appendChild(d),d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",o=d.getElementsByTagName("td"),o[0].style.cssText="padding:0;margin:0;border:0;display:none",p=0===o[0].offsetHeight,o[0].style.display="",o[1].style.display="none",t.reliableHiddenOffsets=p&&0===o[0].offsetHeight,d.innerHTML="",d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",x.swap(l,null!=l.style.zoom?{zoom:1}:{},function(){t.boxSizing=4===d.offsetWidth}),e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(d,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(d,null)||{width:"4px"}).width,r=d.appendChild(a.createElement("div")),r.style.cssText=d.style.cssText=s,r.style.marginRight=r.style.width="0",d.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(r,null)||{}).marginRight)),typeof d.style.zoom!==i&&(d.innerHTML="",d.style.cssText=s+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=3===d.offsetWidth,d.style.display="block",d.innerHTML="<div></div>",d.firstChild.style.width="5px",t.shrinkWrapBlocks=3!==d.offsetWidth,t.inlineBlockNeedsLayout&&(l.style.zoom=1)),l.removeChild(n),n=d=o=r=null)}),n=s=l=u=r=o=null,t}({});var B=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,P=/([A-Z])/g;function R(e,n,r,i){if(x.acceptData(e)){var o,a,s=x.expando,l=e.nodeType,u=l?x.cache:e,c=l?e[s]:e[s]&&s;if(c&&u[c]&&(i||u[c].data)||r!==t||"string"!=typeof n)return c||(c=l?e[s]=p.pop()||x.guid++:s),u[c]||(u[c]=l?{}:{toJSON:x.noop}),("object"==typeof n||"function"==typeof n)&&(i?u[c]=x.extend(u[c],n):u[c].data=x.extend(u[c].data,n)),a=u[c],i||(a.data||(a.data={}),a=a.data),r!==t&&(a[x.camelCase(n)]=r),"string"==typeof n?(o=a[n],null==o&&(o=a[x.camelCase(n)])):o=a,o}}function W(e,t,n){if(x.acceptData(e)){var r,i,o=e.nodeType,a=o?x.cache:e,s=o?e[x.expando]:x.expando;if(a[s]){if(t&&(r=n?a[s]:a[s].data)){x.isArray(t)?t=t.concat(x.map(t,x.camelCase)):t in r?t=[t]:(t=x.camelCase(t),t=t in r?[t]:t.split(" ")),i=t.length;while(i--)delete r[t[i]];if(n?!I(r):!x.isEmptyObject(r))return}(n||(delete a[s].data,I(a[s])))&&(o?x.cleanData([e],!0):x.support.deleteExpando||a!=a.window?delete a[s]:a[s]=null)}}}x.extend({cache:{},noData:{applet:!0,embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(e){return e=e.nodeType?x.cache[e[x.expando]]:e[x.expando],!!e&&!I(e)},data:function(e,t,n){return R(e,t,n)},removeData:function(e,t){return W(e,t)},_data:function(e,t,n){return R(e,t,n,!0)},_removeData:function(e,t){return W(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType)return!1;var t=e.nodeName&&x.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),x.fn.extend({data:function(e,n){var r,i,o=null,a=0,s=this[0];if(e===t){if(this.length&&(o=x.data(s),1===s.nodeType&&!x._data(s,"parsedAttrs"))){for(r=s.attributes;r.length>a;a++)i=r[a].name,0===i.indexOf("data-")&&(i=x.camelCase(i.slice(5)),$(s,i,o[i]));x._data(s,"parsedAttrs",!0)}return o}return"object"==typeof e?this.each(function(){x.data(this,e)}):arguments.length>1?this.each(function(){x.data(this,e,n)}):s?$(s,e,x.data(s,e)):null},removeData:function(e){return this.each(function(){x.removeData(this,e)})}});function $(e,n,r){if(r===t&&1===e.nodeType){var i="data-"+n.replace(P,"-$1").toLowerCase();if(r=e.getAttribute(i),"string"==typeof r){try{r="true"===r?!0:"false"===r?!1:"null"===r?null:+r+""===r?+r:B.test(r)?x.parseJSON(r):r}catch(o){}x.data(e,n,r)}else r=t}return r}function I(e){var t;for(t in e)if(("data"!==t||!x.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}x.extend({queue:function(e,n,r){var i;return e?(n=(n||"fx")+"queue",i=x._data(e,n),r&&(!i||x.isArray(r)?i=x._data(e,n,x.makeArray(r)):i.push(r)),i||[]):t},dequeue:function(e,t){t=t||"fx";var n=x.queue(e,t),r=n.length,i=n.shift(),o=x._queueHooks(e,t),a=function(){x.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,a,o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return x._data(e,n)||x._data(e,n,{empty:x.Callbacks("once memory").add(function(){x._removeData(e,t+"queue"),x._removeData(e,n)})})}}),x.fn.extend({queue:function(e,n){var r=2;return"string"!=typeof e&&(n=e,e="fx",r--),r>arguments.length?x.queue(this[0],e):n===t?this:this.each(function(){var t=x.queue(this,e,n);x._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&x.dequeue(this,e)})},dequeue:function(e){return this.each(function(){x.dequeue(this,e)})},delay:function(e,t){return e=x.fx?x.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,o=x.Deferred(),a=this,s=this.length,l=function(){--i||o.resolveWith(a,[a])};"string"!=typeof e&&(n=e,e=t),e=e||"fx";while(s--)r=x._data(a[s],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(l));return l(),o.promise(n)}});var z,X,U=/[\t\r\n\f]/g,V=/\r/g,Y=/^(?:input|select|textarea|button|object)$/i,J=/^(?:a|area)$/i,G=/^(?:checked|selected)$/i,Q=x.support.getSetAttribute,K=x.support.input;x.fn.extend({attr:function(e,t){return x.access(this,x.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){x.removeAttr(this,e)})},prop:function(e,t){return x.access(this,x.prop,e,t,arguments.length>1)},removeProp:function(e){return e=x.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,o,a=0,s=this.length,l="string"==typeof e&&e;if(x.isFunction(e))return this.each(function(t){x(this).addClass(e.call(this,t,this.className))});if(l)for(t=(e||"").match(T)||[];s>a;a++)if(n=this[a],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(U," "):" ")){o=0;while(i=t[o++])0>r.indexOf(" "+i+" ")&&(r+=i+" ");n.className=x.trim(r)}return this},removeClass:function(e){var t,n,r,i,o,a=0,s=this.length,l=0===arguments.length||"string"==typeof e&&e;if(x.isFunction(e))return this.each(function(t){x(this).removeClass(e.call(this,t,this.className))});if(l)for(t=(e||"").match(T)||[];s>a;a++)if(n=this[a],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(U," "):"")){o=0;while(i=t[o++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");n.className=e?x.trim(r):""}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):x.isFunction(e)?this.each(function(n){x(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n){var t,r=0,o=x(this),a=e.match(T)||[];while(t=a[r++])o.hasClass(t)?o.removeClass(t):o.addClass(t)}else(n===i||"boolean"===n)&&(this.className&&x._data(this,"__className__",this.className),this.className=this.className||e===!1?"":x._data(this,"__className__")||"")})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(U," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,r,i,o=this[0];{if(arguments.length)return i=x.isFunction(e),this.each(function(n){var o;1===this.nodeType&&(o=i?e.call(this,n,x(this).val()):e,null==o?o="":"number"==typeof o?o+="":x.isArray(o)&&(o=x.map(o,function(e){return null==e?"":e+""})),r=x.valHooks[this.type]||x.valHooks[this.nodeName.toLowerCase()],r&&"set"in r&&r.set(this,o,"value")!==t||(this.value=o))});if(o)return r=x.valHooks[o.type]||x.valHooks[o.nodeName.toLowerCase()],r&&"get"in r&&(n=r.get(o,"value"))!==t?n:(n=o.value,"string"==typeof n?n.replace(V,""):null==n?"":n)}}}),x.extend({valHooks:{option:{get:function(e){var t=x.find.attr(e,"value");return null!=t?t:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,o="select-one"===e.type||0>i,a=o?null:[],s=o?i+1:r.length,l=0>i?s:o?i:0;for(;s>l;l++)if(n=r[l],!(!n.selected&&l!==i||(x.support.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&x.nodeName(n.parentNode,"optgroup"))){if(t=x(n).val(),o)return t;a.push(t)}return a},set:function(e,t){var n,r,i=e.options,o=x.makeArray(t),a=i.length;while(a--)r=i[a],(r.selected=x.inArray(x(r).val(),o)>=0)&&(n=!0);return n||(e.selectedIndex=-1),o}}},attr:function(e,n,r){var o,a,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return typeof e.getAttribute===i?x.prop(e,n,r):(1===s&&x.isXMLDoc(e)||(n=n.toLowerCase(),o=x.attrHooks[n]||(x.expr.match.bool.test(n)?X:z)),r===t?o&&"get"in o&&null!==(a=o.get(e,n))?a:(a=x.find.attr(e,n),null==a?t:a):null!==r?o&&"set"in o&&(a=o.set(e,r,n))!==t?a:(e.setAttribute(n,r+""),r):(x.removeAttr(e,n),t))},removeAttr:function(e,t){var n,r,i=0,o=t&&t.match(T);if(o&&1===e.nodeType)while(n=o[i++])r=x.propFix[n]||n,x.expr.match.bool.test(n)?K&&Q||!G.test(n)?e[r]=!1:e[x.camelCase("default-"+n)]=e[r]=!1:x.attr(e,n,""),e.removeAttribute(Q?n:r)},attrHooks:{type:{set:function(e,t){if(!x.support.radioValue&&"radio"===t&&x.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(e,n,r){var i,o,a,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return a=1!==s||!x.isXMLDoc(e),a&&(n=x.propFix[n]||n,o=x.propHooks[n]),r!==t?o&&"set"in o&&(i=o.set(e,r,n))!==t?i:e[n]=r:o&&"get"in o&&null!==(i=o.get(e,n))?i:e[n]},propHooks:{tabIndex:{get:function(e){var t=x.find.attr(e,"tabindex");return t?parseInt(t,10):Y.test(e.nodeName)||J.test(e.nodeName)&&e.href?0:-1}}}}),X={set:function(e,t,n){return t===!1?x.removeAttr(e,n):K&&Q||!G.test(n)?e.setAttribute(!Q&&x.propFix[n]||n,n):e[x.camelCase("default-"+n)]=e[n]=!0,n}},x.each(x.expr.match.bool.source.match(/\w+/g),function(e,n){var r=x.expr.attrHandle[n]||x.find.attr;x.expr.attrHandle[n]=K&&Q||!G.test(n)?function(e,n,i){var o=x.expr.attrHandle[n],a=i?t:(x.expr.attrHandle[n]=t)!=r(e,n,i)?n.toLowerCase():null;return x.expr.attrHandle[n]=o,a}:function(e,n,r){return r?t:e[x.camelCase("default-"+n)]?n.toLowerCase():null}}),K&&Q||(x.attrHooks.value={set:function(e,n,r){return x.nodeName(e,"input")?(e.defaultValue=n,t):z&&z.set(e,n,r)}}),Q||(z={set:function(e,n,r){var i=e.getAttributeNode(r);return i||e.setAttributeNode(i=e.ownerDocument.createAttribute(r)),i.value=n+="","value"===r||n===e.getAttribute(r)?n:t}},x.expr.attrHandle.id=x.expr.attrHandle.name=x.expr.attrHandle.coords=function(e,n,r){var i;return r?t:(i=e.getAttributeNode(n))&&""!==i.value?i.value:null},x.valHooks.button={get:function(e,n){var r=e.getAttributeNode(n);return r&&r.specified?r.value:t},set:z.set},x.attrHooks.contenteditable={set:function(e,t,n){z.set(e,""===t?!1:t,n)}},x.each(["width","height"],function(e,n){x.attrHooks[n]={set:function(e,r){return""===r?(e.setAttribute(n,"auto"),r):t}}})),x.support.hrefNormalized||x.each(["href","src"],function(e,t){x.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}}),x.support.style||(x.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}}),x.support.optSelected||(x.propHooks.selected={get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}}),x.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){x.propFix[this.toLowerCase()]=this}),x.support.enctype||(x.propFix.enctype="encoding"),x.each(["radio","checkbox"],function(){x.valHooks[this]={set:function(e,n){return x.isArray(n)?e.checked=x.inArray(x(e).val(),n)>=0:t}},x.support.checkOn||(x.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var Z=/^(?:input|select|textarea)$/i,et=/^key/,tt=/^(?:mouse|contextmenu)|click/,nt=/^(?:focusinfocus|focusoutblur)$/,rt=/^([^.]*)(?:\.(.+)|)$/;function it(){return!0}function ot(){return!1}function at(){try{return a.activeElement}catch(e){}}x.event={global:{},add:function(e,n,r,o,a){var s,l,u,c,p,f,d,h,g,m,y,v=x._data(e);if(v){r.handler&&(c=r,r=c.handler,a=c.selector),r.guid||(r.guid=x.guid++),(l=v.events)||(l=v.events={}),(f=v.handle)||(f=v.handle=function(e){return typeof x===i||e&&x.event.triggered===e.type?t:x.event.dispatch.apply(f.elem,arguments)},f.elem=e),n=(n||"").match(T)||[""],u=n.length;while(u--)s=rt.exec(n[u])||[],g=y=s[1],m=(s[2]||"").split(".").sort(),g&&(p=x.event.special[g]||{},g=(a?p.delegateType:p.bindType)||g,p=x.event.special[g]||{},d=x.extend({type:g,origType:y,data:o,handler:r,guid:r.guid,selector:a,needsContext:a&&x.expr.match.needsContext.test(a),namespace:m.join(".")},c),(h=l[g])||(h=l[g]=[],h.delegateCount=0,p.setup&&p.setup.call(e,o,m,f)!==!1||(e.addEventListener?e.addEventListener(g,f,!1):e.attachEvent&&e.attachEvent("on"+g,f))),p.add&&(p.add.call(e,d),d.handler.guid||(d.handler.guid=r.guid)),a?h.splice(h.delegateCount++,0,d):h.push(d),x.event.global[g]=!0);e=null}},remove:function(e,t,n,r,i){var o,a,s,l,u,c,p,f,d,h,g,m=x.hasData(e)&&x._data(e);if(m&&(c=m.events)){t=(t||"").match(T)||[""],u=t.length;while(u--)if(s=rt.exec(t[u])||[],d=g=s[1],h=(s[2]||"").split(".").sort(),d){p=x.event.special[d]||{},d=(r?p.delegateType:p.bindType)||d,f=c[d]||[],s=s[2]&&RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),l=o=f.length;while(o--)a=f[o],!i&&g!==a.origType||n&&n.guid!==a.guid||s&&!s.test(a.namespace)||r&&r!==a.selector&&("**"!==r||!a.selector)||(f.splice(o,1),a.selector&&f.delegateCount--,p.remove&&p.remove.call(e,a));l&&!f.length&&(p.teardown&&p.teardown.call(e,h,m.handle)!==!1||x.removeEvent(e,d,m.handle),delete c[d])}else for(d in c)x.event.remove(e,d+t[u],n,r,!0);x.isEmptyObject(c)&&(delete m.handle,x._removeData(e,"events"))}},trigger:function(n,r,i,o){var s,l,u,c,p,f,d,h=[i||a],g=v.call(n,"type")?n.type:n,m=v.call(n,"namespace")?n.namespace.split("."):[];if(u=f=i=i||a,3!==i.nodeType&&8!==i.nodeType&&!nt.test(g+x.event.triggered)&&(g.indexOf(".")>=0&&(m=g.split("."),g=m.shift(),m.sort()),l=0>g.indexOf(":")&&"on"+g,n=n[x.expando]?n:new x.Event(g,"object"==typeof n&&n),n.isTrigger=o?2:3,n.namespace=m.join("."),n.namespace_re=n.namespace?RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=t,n.target||(n.target=i),r=null==r?[n]:x.makeArray(r,[n]),p=x.event.special[g]||{},o||!p.trigger||p.trigger.apply(i,r)!==!1)){if(!o&&!p.noBubble&&!x.isWindow(i)){for(c=p.delegateType||g,nt.test(c+g)||(u=u.parentNode);u;u=u.parentNode)h.push(u),f=u;f===(i.ownerDocument||a)&&h.push(f.defaultView||f.parentWindow||e)}d=0;while((u=h[d++])&&!n.isPropagationStopped())n.type=d>1?c:p.bindType||g,s=(x._data(u,"events")||{})[n.type]&&x._data(u,"handle"),s&&s.apply(u,r),s=l&&u[l],s&&x.acceptData(u)&&s.apply&&s.apply(u,r)===!1&&n.preventDefault();if(n.type=g,!o&&!n.isDefaultPrevented()&&(!p._default||p._default.apply(h.pop(),r)===!1)&&x.acceptData(i)&&l&&i[g]&&!x.isWindow(i)){f=i[l],f&&(i[l]=null),x.event.triggered=g;try{i[g]()}catch(y){}x.event.triggered=t,f&&(i[l]=f)}return n.result}},dispatch:function(e){e=x.event.fix(e);var n,r,i,o,a,s=[],l=g.call(arguments),u=(x._data(this,"events")||{})[e.type]||[],c=x.event.special[e.type]||{};if(l[0]=e,e.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,e)!==!1){s=x.event.handlers.call(this,e,u),n=0;while((o=s[n++])&&!e.isPropagationStopped()){e.currentTarget=o.elem,a=0;while((i=o.handlers[a++])&&!e.isImmediatePropagationStopped())(!e.namespace_re||e.namespace_re.test(i.namespace))&&(e.handleObj=i,e.data=i.data,r=((x.event.special[i.origType]||{}).handle||i.handler).apply(o.elem,l),r!==t&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,e),e.result}},handlers:function(e,n){var r,i,o,a,s=[],l=n.delegateCount,u=e.target;if(l&&u.nodeType&&(!e.button||"click"!==e.type))for(;u!=this;u=u.parentNode||this)if(1===u.nodeType&&(u.disabled!==!0||"click"!==e.type)){for(o=[],a=0;l>a;a++)i=n[a],r=i.selector+" ",o[r]===t&&(o[r]=i.needsContext?x(r,this).index(u)>=0:x.find(r,this,null,[u]).length),o[r]&&o.push(i);o.length&&s.push({elem:u,handlers:o})}return n.length>l&&s.push({elem:this,handlers:n.slice(l)}),s},fix:function(e){if(e[x.expando])return e;var t,n,r,i=e.type,o=e,s=this.fixHooks[i];s||(this.fixHooks[i]=s=tt.test(i)?this.mouseHooks:et.test(i)?this.keyHooks:{}),r=s.props?this.props.concat(s.props):this.props,e=new x.Event(o),t=r.length;while(t--)n=r[t],e[n]=o[n];return e.target||(e.target=o.srcElement||a),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,o):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,i,o,s=n.button,l=n.fromElement;return null==e.pageX&&null!=n.clientX&&(i=e.target.ownerDocument||a,o=i.documentElement,r=i.body,e.pageX=n.clientX+(o&&o.scrollLeft||r&&r.scrollLeft||0)-(o&&o.clientLeft||r&&r.clientLeft||0),e.pageY=n.clientY+(o&&o.scrollTop||r&&r.scrollTop||0)-(o&&o.clientTop||r&&r.clientTop||0)),!e.relatedTarget&&l&&(e.relatedTarget=l===e.target?n.toElement:l),e.which||s===t||(e.which=1&s?1:2&s?3:4&s?2:0),e}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==at()&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===at()&&this.blur?(this.blur(),!1):t},delegateType:"focusout"},click:{trigger:function(){return x.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):t},_default:function(e){return x.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=x.extend(new x.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?x.event.trigger(i,null,t):x.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},x.removeEvent=a.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]===i&&(e[r]=null),e.detachEvent(r,n))},x.Event=function(e,n){return this instanceof x.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?it:ot):this.type=e,n&&x.extend(this,n),this.timeStamp=e&&e.timeStamp||x.now(),this[x.expando]=!0,t):new x.Event(e,n)},x.Event.prototype={isDefaultPrevented:ot,isPropagationStopped:ot,isImmediatePropagationStopped:ot,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=it,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=it,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=it,this.stopPropagation()}},x.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){x.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,o=e.handleObj;return(!i||i!==r&&!x.contains(r,i))&&(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}}),x.support.submitBubbles||(x.event.special.submit={setup:function(){return x.nodeName(this,"form")?!1:(x.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=x.nodeName(n,"input")||x.nodeName(n,"button")?n.form:t;r&&!x._data(r,"submitBubbles")&&(x.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),x._data(r,"submitBubbles",!0))}),t)},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&x.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return x.nodeName(this,"form")?!1:(x.event.remove(this,"._submit"),t)}}),x.support.changeBubbles||(x.event.special.change={setup:function(){return Z.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(x.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),x.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),x.event.simulate("change",this,e,!0)})),!1):(x.event.add(this,"beforeactivate._change",function(e){var t=e.target;Z.test(t.nodeName)&&!x._data(t,"changeBubbles")&&(x.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||x.event.simulate("change",this.parentNode,e,!0)}),x._data(t,"changeBubbles",!0))}),t)},handle:function(e){var n=e.target;return this!==n||e.isSimulated||e.isTrigger||"radio"!==n.type&&"checkbox"!==n.type?e.handleObj.handler.apply(this,arguments):t},teardown:function(){return x.event.remove(this,"._change"),!Z.test(this.nodeName)}}),x.support.focusinBubbles||x.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){x.event.simulate(t,e.target,x.event.fix(e),!0)};x.event.special[t]={setup:function(){0===n++&&a.addEventListener(e,r,!0)},teardown:function(){0===--n&&a.removeEventListener(e,r,!0)}}}),x.fn.extend({on:function(e,n,r,i,o){var a,s;if("object"==typeof e){"string"!=typeof n&&(r=r||n,n=t);for(a in e)this.on(a,n,r,e[a],o);return this}if(null==r&&null==i?(i=n,r=n=t):null==i&&("string"==typeof n?(i=r,r=t):(i=r,r=n,n=t)),i===!1)i=ot;else if(!i)return this;return 1===o&&(s=i,i=function(e){return x().off(e),s.apply(this,arguments)},i.guid=s.guid||(s.guid=x.guid++)),this.each(function(){x.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,o;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,x(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(o in e)this.off(o,n,e[o]);return this}return(n===!1||"function"==typeof n)&&(r=n,n=t),r===!1&&(r=ot),this.each(function(){x.event.remove(this,e,r,n)})},trigger:function(e,t){return this.each(function(){x.event.trigger(e,t,this)})},triggerHandler:function(e,n){var r=this[0];return r?x.event.trigger(e,n,r,!0):t}});var st=/^.[^:#\[\.,]*$/,lt=/^(?:parents|prev(?:Until|All))/,ut=x.expr.match.needsContext,ct={children:!0,contents:!0,next:!0,prev:!0};x.fn.extend({find:function(e){var t,n=[],r=this,i=r.length;if("string"!=typeof e)return this.pushStack(x(e).filter(function(){for(t=0;i>t;t++)if(x.contains(r[t],this))return!0}));for(t=0;i>t;t++)x.find(e,r[t],n);return n=this.pushStack(i>1?x.unique(n):n),n.selector=this.selector?this.selector+" "+e:e,n},has:function(e){var t,n=x(e,this),r=n.length;return this.filter(function(){for(t=0;r>t;t++)if(x.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(ft(this,e||[],!0))},filter:function(e){return this.pushStack(ft(this,e||[],!1))},is:function(e){return!!ft(this,"string"==typeof e&&ut.test(e)?x(e):e||[],!1).length},closest:function(e,t){var n,r=0,i=this.length,o=[],a=ut.test(e)||"string"!=typeof e?x(e,t||this.context):0;for(;i>r;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(11>n.nodeType&&(a?a.index(n)>-1:1===n.nodeType&&x.find.matchesSelector(n,e))){n=o.push(n);break}return this.pushStack(o.length>1?x.unique(o):o)},index:function(e){return e?"string"==typeof e?x.inArray(this[0],x(e)):x.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?x(e,t):x.makeArray(e&&e.nodeType?[e]:e),r=x.merge(this.get(),n);return this.pushStack(x.unique(r))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}});function pt(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}x.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return x.dir(e,"parentNode")},parentsUntil:function(e,t,n){return x.dir(e,"parentNode",n)},next:function(e){return pt(e,"nextSibling")},prev:function(e){return pt(e,"previousSibling")},nextAll:function(e){return x.dir(e,"nextSibling")},prevAll:function(e){return x.dir(e,"previousSibling")},nextUntil:function(e,t,n){return x.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return x.dir(e,"previousSibling",n)},siblings:function(e){return x.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return x.sibling(e.firstChild)},contents:function(e){return x.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:x.merge([],e.childNodes)}},function(e,t){x.fn[e]=function(n,r){var i=x.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=x.filter(r,i)),this.length>1&&(ct[e]||(i=x.unique(i)),lt.test(e)&&(i=i.reverse())),this.pushStack(i)}}),x.extend({filter:function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?x.find.matchesSelector(r,e)?[r]:[]:x.find.matches(e,x.grep(t,function(e){return 1===e.nodeType}))},dir:function(e,n,r){var i=[],o=e[n];while(o&&9!==o.nodeType&&(r===t||1!==o.nodeType||!x(o).is(r)))1===o.nodeType&&i.push(o),o=o[n];return i},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}});function ft(e,t,n){if(x.isFunction(t))return x.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return x.grep(e,function(e){return e===t!==n});if("string"==typeof t){if(st.test(t))return x.filter(t,e,n);t=x.filter(t,e)}return x.grep(e,function(e){return x.inArray(e,t)>=0!==n})}function dt(e){var t=ht.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}var ht="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",gt=/ jQuery\d+="(?:null|\d+)"/g,mt=RegExp("<(?:"+ht+")[\\s/>]","i"),yt=/^\s+/,vt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bt=/<([\w:]+)/,xt=/<tbody/i,wt=/<|&#?\w+;/,Tt=/<(?:script|style|link)/i,Ct=/^(?:checkbox|radio)$/i,Nt=/checked\s*(?:[^=]|=\s*.checked.)/i,kt=/^$|\/(?:java|ecma)script/i,Et=/^true\/(.*)/,St=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,At={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:x.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},jt=dt(a),Dt=jt.appendChild(a.createElement("div"));At.optgroup=At.option,At.tbody=At.tfoot=At.colgroup=At.caption=At.thead,At.th=At.td,x.fn.extend({text:function(e){return x.access(this,function(e){return e===t?x.text(this):this.empty().append((this[0]&&this[0].ownerDocument||a).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Lt(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Lt(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=e?x.filter(e,this):this,i=0;for(;null!=(n=r[i]);i++)t||1!==n.nodeType||x.cleanData(Ft(n)),n.parentNode&&(t&&x.contains(n.ownerDocument,n)&&_t(Ft(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){var e,t=0;for(;null!=(e=this[t]);t++){1===e.nodeType&&x.cleanData(Ft(e,!1));while(e.firstChild)e.removeChild(e.firstChild);e.options&&x.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return x.clone(this,e,t)})},html:function(e){return x.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return 1===n.nodeType?n.innerHTML.replace(gt,""):t;if(!("string"!=typeof e||Tt.test(e)||!x.support.htmlSerialize&&mt.test(e)||!x.support.leadingWhitespace&&yt.test(e)||At[(bt.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(vt,"<$1></$2>");try{for(;i>r;r++)n=this[r]||{},1===n.nodeType&&(x.cleanData(Ft(n,!1)),n.innerHTML=e);n=0}catch(o){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=x.map(this,function(e){return[e.nextSibling,e.parentNode]}),t=0;return this.domManip(arguments,function(n){var r=e[t++],i=e[t++];i&&(r&&r.parentNode!==i&&(r=this.nextSibling),x(this).remove(),i.insertBefore(n,r))},!0),t?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t,n){e=d.apply([],e);var r,i,o,a,s,l,u=0,c=this.length,p=this,f=c-1,h=e[0],g=x.isFunction(h);if(g||!(1>=c||"string"!=typeof h||x.support.checkClone)&&Nt.test(h))return this.each(function(r){var i=p.eq(r);g&&(e[0]=h.call(this,r,i.html())),i.domManip(e,t,n)});if(c&&(l=x.buildFragment(e,this[0].ownerDocument,!1,!n&&this),r=l.firstChild,1===l.childNodes.length&&(l=r),r)){for(a=x.map(Ft(l,"script"),Ht),o=a.length;c>u;u++)i=l,u!==f&&(i=x.clone(i,!0,!0),o&&x.merge(a,Ft(i,"script"))),t.call(this[u],i,u);if(o)for(s=a[a.length-1].ownerDocument,x.map(a,qt),u=0;o>u;u++)i=a[u],kt.test(i.type||"")&&!x._data(i,"globalEval")&&x.contains(s,i)&&(i.src?x._evalUrl(i.src):x.globalEval((i.text||i.textContent||i.innerHTML||"").replace(St,"")));l=r=null}return this}});function Lt(e,t){return x.nodeName(e,"table")&&x.nodeName(1===t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function Ht(e){return e.type=(null!==x.find.attr(e,"type"))+"/"+e.type,e}function qt(e){var t=Et.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function _t(e,t){var n,r=0;for(;null!=(n=e[r]);r++)x._data(n,"globalEval",!t||x._data(t[r],"globalEval"))}function Mt(e,t){if(1===t.nodeType&&x.hasData(e)){var n,r,i,o=x._data(e),a=x._data(t,o),s=o.events;if(s){delete a.handle,a.events={};for(n in s)for(r=0,i=s[n].length;i>r;r++)x.event.add(t,n,s[n][r])}a.data&&(a.data=x.extend({},a.data))}}function Ot(e,t){var n,r,i;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!x.support.noCloneEvent&&t[x.expando]){i=x._data(t);for(r in i.events)x.removeEvent(t,r,i.handle);t.removeAttribute(x.expando)}"script"===n&&t.text!==e.text?(Ht(t).text=e.text,qt(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),x.support.html5Clone&&e.innerHTML&&!x.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&Ct.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}x.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){x.fn[e]=function(e){var n,r=0,i=[],o=x(e),a=o.length-1;
for(;a>=r;r++)n=r===a?this:this.clone(!0),x(o[r])[t](n),h.apply(i,n.get());return this.pushStack(i)}});function Ft(e,n){var r,o,a=0,s=typeof e.getElementsByTagName!==i?e.getElementsByTagName(n||"*"):typeof e.querySelectorAll!==i?e.querySelectorAll(n||"*"):t;if(!s)for(s=[],r=e.childNodes||e;null!=(o=r[a]);a++)!n||x.nodeName(o,n)?s.push(o):x.merge(s,Ft(o,n));return n===t||n&&x.nodeName(e,n)?x.merge([e],s):s}function Bt(e){Ct.test(e.type)&&(e.defaultChecked=e.checked)}x.extend({clone:function(e,t,n){var r,i,o,a,s,l=x.contains(e.ownerDocument,e);if(x.support.html5Clone||x.isXMLDoc(e)||!mt.test("<"+e.nodeName+">")?o=e.cloneNode(!0):(Dt.innerHTML=e.outerHTML,Dt.removeChild(o=Dt.firstChild)),!(x.support.noCloneEvent&&x.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||x.isXMLDoc(e)))for(r=Ft(o),s=Ft(e),a=0;null!=(i=s[a]);++a)r[a]&&Ot(i,r[a]);if(t)if(n)for(s=s||Ft(e),r=r||Ft(o),a=0;null!=(i=s[a]);a++)Mt(i,r[a]);else Mt(e,o);return r=Ft(o,"script"),r.length>0&&_t(r,!l&&Ft(e,"script")),r=s=i=null,o},buildFragment:function(e,t,n,r){var i,o,a,s,l,u,c,p=e.length,f=dt(t),d=[],h=0;for(;p>h;h++)if(o=e[h],o||0===o)if("object"===x.type(o))x.merge(d,o.nodeType?[o]:o);else if(wt.test(o)){s=s||f.appendChild(t.createElement("div")),l=(bt.exec(o)||["",""])[1].toLowerCase(),c=At[l]||At._default,s.innerHTML=c[1]+o.replace(vt,"<$1></$2>")+c[2],i=c[0];while(i--)s=s.lastChild;if(!x.support.leadingWhitespace&&yt.test(o)&&d.push(t.createTextNode(yt.exec(o)[0])),!x.support.tbody){o="table"!==l||xt.test(o)?"<table>"!==c[1]||xt.test(o)?0:s:s.firstChild,i=o&&o.childNodes.length;while(i--)x.nodeName(u=o.childNodes[i],"tbody")&&!u.childNodes.length&&o.removeChild(u)}x.merge(d,s.childNodes),s.textContent="";while(s.firstChild)s.removeChild(s.firstChild);s=f.lastChild}else d.push(t.createTextNode(o));s&&f.removeChild(s),x.support.appendChecked||x.grep(Ft(d,"input"),Bt),h=0;while(o=d[h++])if((!r||-1===x.inArray(o,r))&&(a=x.contains(o.ownerDocument,o),s=Ft(f.appendChild(o),"script"),a&&_t(s),n)){i=0;while(o=s[i++])kt.test(o.type||"")&&n.push(o)}return s=null,f},cleanData:function(e,t){var n,r,o,a,s=0,l=x.expando,u=x.cache,c=x.support.deleteExpando,f=x.event.special;for(;null!=(n=e[s]);s++)if((t||x.acceptData(n))&&(o=n[l],a=o&&u[o])){if(a.events)for(r in a.events)f[r]?x.event.remove(n,r):x.removeEvent(n,r,a.handle);u[o]&&(delete u[o],c?delete n[l]:typeof n.removeAttribute!==i?n.removeAttribute(l):n[l]=null,p.push(o))}},_evalUrl:function(e){return x.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})}}),x.fn.extend({wrapAll:function(e){if(x.isFunction(e))return this.each(function(t){x(this).wrapAll(e.call(this,t))});if(this[0]){var t=x(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&1===e.firstChild.nodeType)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return x.isFunction(e)?this.each(function(t){x(this).wrapInner(e.call(this,t))}):this.each(function(){var t=x(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=x.isFunction(e);return this.each(function(n){x(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){x.nodeName(this,"body")||x(this).replaceWith(this.childNodes)}).end()}});var Pt,Rt,Wt,$t=/alpha\([^)]*\)/i,It=/opacity\s*=\s*([^)]*)/,zt=/^(top|right|bottom|left)$/,Xt=/^(none|table(?!-c[ea]).+)/,Ut=/^margin/,Vt=RegExp("^("+w+")(.*)$","i"),Yt=RegExp("^("+w+")(?!px)[a-z%]+$","i"),Jt=RegExp("^([+-])=("+w+")","i"),Gt={BODY:"block"},Qt={position:"absolute",visibility:"hidden",display:"block"},Kt={letterSpacing:0,fontWeight:400},Zt=["Top","Right","Bottom","Left"],en=["Webkit","O","Moz","ms"];function tn(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=en.length;while(i--)if(t=en[i]+n,t in e)return t;return r}function nn(e,t){return e=t||e,"none"===x.css(e,"display")||!x.contains(e.ownerDocument,e)}function rn(e,t){var n,r,i,o=[],a=0,s=e.length;for(;s>a;a++)r=e[a],r.style&&(o[a]=x._data(r,"olddisplay"),n=r.style.display,t?(o[a]||"none"!==n||(r.style.display=""),""===r.style.display&&nn(r)&&(o[a]=x._data(r,"olddisplay",ln(r.nodeName)))):o[a]||(i=nn(r),(n&&"none"!==n||!i)&&x._data(r,"olddisplay",i?n:x.css(r,"display"))));for(a=0;s>a;a++)r=e[a],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?o[a]||"":"none"));return e}x.fn.extend({css:function(e,n){return x.access(this,function(e,n,r){var i,o,a={},s=0;if(x.isArray(n)){for(o=Rt(e),i=n.length;i>s;s++)a[n[s]]=x.css(e,n[s],!1,o);return a}return r!==t?x.style(e,n,r):x.css(e,n)},e,n,arguments.length>1)},show:function(){return rn(this,!0)},hide:function(){return rn(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){nn(this)?x(this).show():x(this).hide()})}}),x.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Wt(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":x.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var o,a,s,l=x.camelCase(n),u=e.style;if(n=x.cssProps[l]||(x.cssProps[l]=tn(u,l)),s=x.cssHooks[n]||x.cssHooks[l],r===t)return s&&"get"in s&&(o=s.get(e,!1,i))!==t?o:u[n];if(a=typeof r,"string"===a&&(o=Jt.exec(r))&&(r=(o[1]+1)*o[2]+parseFloat(x.css(e,n)),a="number"),!(null==r||"number"===a&&isNaN(r)||("number"!==a||x.cssNumber[l]||(r+="px"),x.support.clearCloneStyle||""!==r||0!==n.indexOf("background")||(u[n]="inherit"),s&&"set"in s&&(r=s.set(e,r,i))===t)))try{u[n]=r}catch(c){}}},css:function(e,n,r,i){var o,a,s,l=x.camelCase(n);return n=x.cssProps[l]||(x.cssProps[l]=tn(e.style,l)),s=x.cssHooks[n]||x.cssHooks[l],s&&"get"in s&&(a=s.get(e,!0,r)),a===t&&(a=Wt(e,n,i)),"normal"===a&&n in Kt&&(a=Kt[n]),""===r||r?(o=parseFloat(a),r===!0||x.isNumeric(o)?o||0:a):a}}),e.getComputedStyle?(Rt=function(t){return e.getComputedStyle(t,null)},Wt=function(e,n,r){var i,o,a,s=r||Rt(e),l=s?s.getPropertyValue(n)||s[n]:t,u=e.style;return s&&(""!==l||x.contains(e.ownerDocument,e)||(l=x.style(e,n)),Yt.test(l)&&Ut.test(n)&&(i=u.width,o=u.minWidth,a=u.maxWidth,u.minWidth=u.maxWidth=u.width=l,l=s.width,u.width=i,u.minWidth=o,u.maxWidth=a)),l}):a.documentElement.currentStyle&&(Rt=function(e){return e.currentStyle},Wt=function(e,n,r){var i,o,a,s=r||Rt(e),l=s?s[n]:t,u=e.style;return null==l&&u&&u[n]&&(l=u[n]),Yt.test(l)&&!zt.test(n)&&(i=u.left,o=e.runtimeStyle,a=o&&o.left,a&&(o.left=e.currentStyle.left),u.left="fontSize"===n?"1em":l,l=u.pixelLeft+"px",u.left=i,a&&(o.left=a)),""===l?"auto":l});function on(e,t,n){var r=Vt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function an(e,t,n,r,i){var o=n===(r?"border":"content")?4:"width"===t?1:0,a=0;for(;4>o;o+=2)"margin"===n&&(a+=x.css(e,n+Zt[o],!0,i)),r?("content"===n&&(a-=x.css(e,"padding"+Zt[o],!0,i)),"margin"!==n&&(a-=x.css(e,"border"+Zt[o]+"Width",!0,i))):(a+=x.css(e,"padding"+Zt[o],!0,i),"padding"!==n&&(a+=x.css(e,"border"+Zt[o]+"Width",!0,i)));return a}function sn(e,t,n){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,o=Rt(e),a=x.support.boxSizing&&"border-box"===x.css(e,"boxSizing",!1,o);if(0>=i||null==i){if(i=Wt(e,t,o),(0>i||null==i)&&(i=e.style[t]),Yt.test(i))return i;r=a&&(x.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+an(e,t,n||(a?"border":"content"),r,o)+"px"}function ln(e){var t=a,n=Gt[e];return n||(n=un(e,t),"none"!==n&&n||(Pt=(Pt||x("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(Pt[0].contentWindow||Pt[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=un(e,t),Pt.detach()),Gt[e]=n),n}function un(e,t){var n=x(t.createElement(e)).appendTo(t.body),r=x.css(n[0],"display");return n.remove(),r}x.each(["height","width"],function(e,n){x.cssHooks[n]={get:function(e,r,i){return r?0===e.offsetWidth&&Xt.test(x.css(e,"display"))?x.swap(e,Qt,function(){return sn(e,n,i)}):sn(e,n,i):t},set:function(e,t,r){var i=r&&Rt(e);return on(e,t,r?an(e,n,r,x.support.boxSizing&&"border-box"===x.css(e,"boxSizing",!1,i),i):0)}}}),x.support.opacity||(x.cssHooks.opacity={get:function(e,t){return It.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=x.isNumeric(t)?"alpha(opacity="+100*t+")":"",o=r&&r.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===x.trim(o.replace($t,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||r&&!r.filter)||(n.filter=$t.test(o)?o.replace($t,i):o+" "+i)}}),x(function(){x.support.reliableMarginRight||(x.cssHooks.marginRight={get:function(e,n){return n?x.swap(e,{display:"inline-block"},Wt,[e,"marginRight"]):t}}),!x.support.pixelPosition&&x.fn.position&&x.each(["top","left"],function(e,n){x.cssHooks[n]={get:function(e,r){return r?(r=Wt(e,n),Yt.test(r)?x(e).position()[n]+"px":r):t}}})}),x.expr&&x.expr.filters&&(x.expr.filters.hidden=function(e){return 0>=e.offsetWidth&&0>=e.offsetHeight||!x.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||x.css(e,"display"))},x.expr.filters.visible=function(e){return!x.expr.filters.hidden(e)}),x.each({margin:"",padding:"",border:"Width"},function(e,t){x.cssHooks[e+t]={expand:function(n){var r=0,i={},o="string"==typeof n?n.split(" "):[n];for(;4>r;r++)i[e+Zt[r]+t]=o[r]||o[r-2]||o[0];return i}},Ut.test(e)||(x.cssHooks[e+t].set=on)});var cn=/%20/g,pn=/\[\]$/,fn=/\r?\n/g,dn=/^(?:submit|button|image|reset|file)$/i,hn=/^(?:input|select|textarea|keygen)/i;x.fn.extend({serialize:function(){return x.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=x.prop(this,"elements");return e?x.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!x(this).is(":disabled")&&hn.test(this.nodeName)&&!dn.test(e)&&(this.checked||!Ct.test(e))}).map(function(e,t){var n=x(this).val();return null==n?null:x.isArray(n)?x.map(n,function(e){return{name:t.name,value:e.replace(fn,"\r\n")}}):{name:t.name,value:n.replace(fn,"\r\n")}}).get()}}),x.param=function(e,n){var r,i=[],o=function(e,t){t=x.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(n===t&&(n=x.ajaxSettings&&x.ajaxSettings.traditional),x.isArray(e)||e.jquery&&!x.isPlainObject(e))x.each(e,function(){o(this.name,this.value)});else for(r in e)gn(r,e[r],n,o);return i.join("&").replace(cn,"+")};function gn(e,t,n,r){var i;if(x.isArray(t))x.each(t,function(t,i){n||pn.test(e)?r(e,i):gn(e+"["+("object"==typeof i?t:"")+"]",i,n,r)});else if(n||"object"!==x.type(t))r(e,t);else for(i in t)gn(e+"["+i+"]",t[i],n,r)}x.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){x.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),x.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}});var mn,yn,vn=x.now(),bn=/\?/,xn=/#.*$/,wn=/([?&])_=[^&]*/,Tn=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Cn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Nn=/^(?:GET|HEAD)$/,kn=/^\/\//,En=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Sn=x.fn.load,An={},jn={},Dn="*/".concat("*");try{yn=o.href}catch(Ln){yn=a.createElement("a"),yn.href="",yn=yn.href}mn=En.exec(yn.toLowerCase())||[];function Hn(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,o=t.toLowerCase().match(T)||[];if(x.isFunction(n))while(r=o[i++])"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function qn(e,n,r,i){var o={},a=e===jn;function s(l){var u;return o[l]=!0,x.each(e[l]||[],function(e,l){var c=l(n,r,i);return"string"!=typeof c||a||o[c]?a?!(u=c):t:(n.dataTypes.unshift(c),s(c),!1)}),u}return s(n.dataTypes[0])||!o["*"]&&s("*")}function _n(e,n){var r,i,o=x.ajaxSettings.flatOptions||{};for(i in n)n[i]!==t&&((o[i]?e:r||(r={}))[i]=n[i]);return r&&x.extend(!0,e,r),e}x.fn.load=function(e,n,r){if("string"!=typeof e&&Sn)return Sn.apply(this,arguments);var i,o,a,s=this,l=e.indexOf(" ");return l>=0&&(i=e.slice(l,e.length),e=e.slice(0,l)),x.isFunction(n)?(r=n,n=t):n&&"object"==typeof n&&(a="POST"),s.length>0&&x.ajax({url:e,type:a,dataType:"html",data:n}).done(function(e){o=arguments,s.html(i?x("<div>").append(x.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){s.each(r,o||[e.responseText,t,e])}),this},x.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){x.fn[t]=function(e){return this.on(t,e)}}),x.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:yn,type:"GET",isLocal:Cn.test(mn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Dn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":x.parseJSON,"text xml":x.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?_n(_n(e,x.ajaxSettings),t):_n(x.ajaxSettings,e)},ajaxPrefilter:Hn(An),ajaxTransport:Hn(jn),ajax:function(e,n){"object"==typeof e&&(n=e,e=t),n=n||{};var r,i,o,a,s,l,u,c,p=x.ajaxSetup({},n),f=p.context||p,d=p.context&&(f.nodeType||f.jquery)?x(f):x.event,h=x.Deferred(),g=x.Callbacks("once memory"),m=p.statusCode||{},y={},v={},b=0,w="canceled",C={readyState:0,getResponseHeader:function(e){var t;if(2===b){if(!c){c={};while(t=Tn.exec(a))c[t[1].toLowerCase()]=t[2]}t=c[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===b?a:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return b||(e=v[n]=v[n]||e,y[e]=t),this},overrideMimeType:function(e){return b||(p.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>b)for(t in e)m[t]=[m[t],e[t]];else C.always(e[C.status]);return this},abort:function(e){var t=e||w;return u&&u.abort(t),k(0,t),this}};if(h.promise(C).complete=g.add,C.success=C.done,C.error=C.fail,p.url=((e||p.url||yn)+"").replace(xn,"").replace(kn,mn[1]+"//"),p.type=n.method||n.type||p.method||p.type,p.dataTypes=x.trim(p.dataType||"*").toLowerCase().match(T)||[""],null==p.crossDomain&&(r=En.exec(p.url.toLowerCase()),p.crossDomain=!(!r||r[1]===mn[1]&&r[2]===mn[2]&&(r[3]||("http:"===r[1]?"80":"443"))===(mn[3]||("http:"===mn[1]?"80":"443")))),p.data&&p.processData&&"string"!=typeof p.data&&(p.data=x.param(p.data,p.traditional)),qn(An,p,n,C),2===b)return C;l=p.global,l&&0===x.active++&&x.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!Nn.test(p.type),o=p.url,p.hasContent||(p.data&&(o=p.url+=(bn.test(o)?"&":"?")+p.data,delete p.data),p.cache===!1&&(p.url=wn.test(o)?o.replace(wn,"$1_="+vn++):o+(bn.test(o)?"&":"?")+"_="+vn++)),p.ifModified&&(x.lastModified[o]&&C.setRequestHeader("If-Modified-Since",x.lastModified[o]),x.etag[o]&&C.setRequestHeader("If-None-Match",x.etag[o])),(p.data&&p.hasContent&&p.contentType!==!1||n.contentType)&&C.setRequestHeader("Content-Type",p.contentType),C.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Dn+"; q=0.01":""):p.accepts["*"]);for(i in p.headers)C.setRequestHeader(i,p.headers[i]);if(p.beforeSend&&(p.beforeSend.call(f,C,p)===!1||2===b))return C.abort();w="abort";for(i in{success:1,error:1,complete:1})C[i](p[i]);if(u=qn(jn,p,n,C)){C.readyState=1,l&&d.trigger("ajaxSend",[C,p]),p.async&&p.timeout>0&&(s=setTimeout(function(){C.abort("timeout")},p.timeout));try{b=1,u.send(y,k)}catch(N){if(!(2>b))throw N;k(-1,N)}}else k(-1,"No Transport");function k(e,n,r,i){var c,y,v,w,T,N=n;2!==b&&(b=2,s&&clearTimeout(s),u=t,a=i||"",C.readyState=e>0?4:0,c=e>=200&&300>e||304===e,r&&(w=Mn(p,C,r)),w=On(p,w,C,c),c?(p.ifModified&&(T=C.getResponseHeader("Last-Modified"),T&&(x.lastModified[o]=T),T=C.getResponseHeader("etag"),T&&(x.etag[o]=T)),204===e||"HEAD"===p.type?N="nocontent":304===e?N="notmodified":(N=w.state,y=w.data,v=w.error,c=!v)):(v=N,(e||!N)&&(N="error",0>e&&(e=0))),C.status=e,C.statusText=(n||N)+"",c?h.resolveWith(f,[y,N,C]):h.rejectWith(f,[C,N,v]),C.statusCode(m),m=t,l&&d.trigger(c?"ajaxSuccess":"ajaxError",[C,p,c?y:v]),g.fireWith(f,[C,N]),l&&(d.trigger("ajaxComplete",[C,p]),--x.active||x.event.trigger("ajaxStop")))}return C},getJSON:function(e,t,n){return x.get(e,t,n,"json")},getScript:function(e,n){return x.get(e,t,n,"script")}}),x.each(["get","post"],function(e,n){x[n]=function(e,r,i,o){return x.isFunction(r)&&(o=o||i,i=r,r=t),x.ajax({url:e,type:n,dataType:o,data:r,success:i})}});function Mn(e,n,r){var i,o,a,s,l=e.contents,u=e.dataTypes;while("*"===u[0])u.shift(),o===t&&(o=e.mimeType||n.getResponseHeader("Content-Type"));if(o)for(s in l)if(l[s]&&l[s].test(o)){u.unshift(s);break}if(u[0]in r)a=u[0];else{for(s in r){if(!u[0]||e.converters[s+" "+u[0]]){a=s;break}i||(i=s)}a=a||i}return a?(a!==u[0]&&u.unshift(a),r[a]):t}function On(e,t,n,r){var i,o,a,s,l,u={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)u[a.toLowerCase()]=e.converters[a];o=c.shift();while(o)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!l&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=o,o=c.shift())if("*"===o)o=l;else if("*"!==l&&l!==o){if(a=u[l+" "+o]||u["* "+o],!a)for(i in u)if(s=i.split(" "),s[1]===o&&(a=u[l+" "+s[0]]||u["* "+s[0]])){a===!0?a=u[i]:u[i]!==!0&&(o=s[0],c.unshift(s[1]));break}if(a!==!0)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(p){return{state:"parsererror",error:a?p:"No conversion from "+l+" to "+o}}}return{state:"success",data:t}}x.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return x.globalEval(e),e}}}),x.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),x.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=a.head||x("head")[0]||a.documentElement;return{send:function(t,i){n=a.createElement("script"),n.async=!0,e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,t){(t||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),n=null,t||i(200,"success"))},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(t,!0)}}}});var Fn=[],Bn=/(=)\?(?=&|$)|\?\?/;x.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Fn.pop()||x.expando+"_"+vn++;return this[e]=!0,e}}),x.ajaxPrefilter("json jsonp",function(n,r,i){var o,a,s,l=n.jsonp!==!1&&(Bn.test(n.url)?"url":"string"==typeof n.data&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Bn.test(n.data)&&"data");return l||"jsonp"===n.dataTypes[0]?(o=n.jsonpCallback=x.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,l?n[l]=n[l].replace(Bn,"$1"+o):n.jsonp!==!1&&(n.url+=(bn.test(n.url)?"&":"?")+n.jsonp+"="+o),n.converters["script json"]=function(){return s||x.error(o+" was not called"),s[0]},n.dataTypes[0]="json",a=e[o],e[o]=function(){s=arguments},i.always(function(){e[o]=a,n[o]&&(n.jsonpCallback=r.jsonpCallback,Fn.push(o)),s&&x.isFunction(a)&&a(s[0]),s=a=t}),"script"):t});var Pn,Rn,Wn=0,$n=e.ActiveXObject&&function(){var e;for(e in Pn)Pn[e](t,!0)};function In(){try{return new e.XMLHttpRequest}catch(t){}}function zn(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}x.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&In()||zn()}:In,Rn=x.ajaxSettings.xhr(),x.support.cors=!!Rn&&"withCredentials"in Rn,Rn=x.support.ajax=!!Rn,Rn&&x.ajaxTransport(function(n){if(!n.crossDomain||x.support.cors){var r;return{send:function(i,o){var a,s,l=n.xhr();if(n.username?l.open(n.type,n.url,n.async,n.username,n.password):l.open(n.type,n.url,n.async),n.xhrFields)for(s in n.xhrFields)l[s]=n.xhrFields[s];n.mimeType&&l.overrideMimeType&&l.overrideMimeType(n.mimeType),n.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");try{for(s in i)l.setRequestHeader(s,i[s])}catch(u){}l.send(n.hasContent&&n.data||null),r=function(e,i){var s,u,c,p;try{if(r&&(i||4===l.readyState))if(r=t,a&&(l.onreadystatechange=x.noop,$n&&delete Pn[a]),i)4!==l.readyState&&l.abort();else{p={},s=l.status,u=l.getAllResponseHeaders(),"string"==typeof l.responseText&&(p.text=l.responseText);try{c=l.statusText}catch(f){c=""}s||!n.isLocal||n.crossDomain?1223===s&&(s=204):s=p.text?200:404}}catch(d){i||o(-1,d)}p&&o(s,c,p,u)},n.async?4===l.readyState?setTimeout(r):(a=++Wn,$n&&(Pn||(Pn={},x(e).unload($n)),Pn[a]=r),l.onreadystatechange=r):r()},abort:function(){r&&r(t,!0)}}}});var Xn,Un,Vn=/^(?:toggle|show|hide)$/,Yn=RegExp("^(?:([+-])=|)("+w+")([a-z%]*)$","i"),Jn=/queueHooks$/,Gn=[nr],Qn={"*":[function(e,t){var n=this.createTween(e,t),r=n.cur(),i=Yn.exec(t),o=i&&i[3]||(x.cssNumber[e]?"":"px"),a=(x.cssNumber[e]||"px"!==o&&+r)&&Yn.exec(x.css(n.elem,e)),s=1,l=20;if(a&&a[3]!==o){o=o||a[3],i=i||[],a=+r||1;do s=s||".5",a/=s,x.style(n.elem,e,a+o);while(s!==(s=n.cur()/r)&&1!==s&&--l)}return i&&(a=n.start=+a||+r||0,n.unit=o,n.end=i[1]?a+(i[1]+1)*i[2]:+i[2]),n}]};function Kn(){return setTimeout(function(){Xn=t}),Xn=x.now()}function Zn(e,t,n){var r,i=(Qn[t]||[]).concat(Qn["*"]),o=0,a=i.length;for(;a>o;o++)if(r=i[o].call(n,t,e))return r}function er(e,t,n){var r,i,o=0,a=Gn.length,s=x.Deferred().always(function(){delete l.elem}),l=function(){if(i)return!1;var t=Xn||Kn(),n=Math.max(0,u.startTime+u.duration-t),r=n/u.duration||0,o=1-r,a=0,l=u.tweens.length;for(;l>a;a++)u.tweens[a].run(o);return s.notifyWith(e,[u,o,n]),1>o&&l?n:(s.resolveWith(e,[u]),!1)},u=s.promise({elem:e,props:x.extend({},t),opts:x.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Xn||Kn(),duration:n.duration,tweens:[],createTween:function(t,n){var r=x.Tween(e,u.opts,t,n,u.opts.specialEasing[t]||u.opts.easing);return u.tweens.push(r),r},stop:function(t){var n=0,r=t?u.tweens.length:0;if(i)return this;for(i=!0;r>n;n++)u.tweens[n].run(1);return t?s.resolveWith(e,[u,t]):s.rejectWith(e,[u,t]),this}}),c=u.props;for(tr(c,u.opts.specialEasing);a>o;o++)if(r=Gn[o].call(u,e,c,u.opts))return r;return x.map(c,Zn,u),x.isFunction(u.opts.start)&&u.opts.start.call(e,u),x.fx.timer(x.extend(l,{elem:e,anim:u,queue:u.opts.queue})),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always)}function tr(e,t){var n,r,i,o,a;for(n in e)if(r=x.camelCase(n),i=t[r],o=e[n],x.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),a=x.cssHooks[r],a&&"expand"in a){o=a.expand(o),delete e[r];for(n in o)n in e||(e[n]=o[n],t[n]=i)}else t[r]=i}x.Animation=x.extend(er,{tweener:function(e,t){x.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;i>r;r++)n=e[r],Qn[n]=Qn[n]||[],Qn[n].unshift(t)},prefilter:function(e,t){t?Gn.unshift(e):Gn.push(e)}});function nr(e,t,n){var r,i,o,a,s,l,u=this,c={},p=e.style,f=e.nodeType&&nn(e),d=x._data(e,"fxshow");n.queue||(s=x._queueHooks(e,"fx"),null==s.unqueued&&(s.unqueued=0,l=s.empty.fire,s.empty.fire=function(){s.unqueued||l()}),s.unqueued++,u.always(function(){u.always(function(){s.unqueued--,x.queue(e,"fx").length||s.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],"inline"===x.css(e,"display")&&"none"===x.css(e,"float")&&(x.support.inlineBlockNeedsLayout&&"inline"!==ln(e.nodeName)?p.zoom=1:p.display="inline-block")),n.overflow&&(p.overflow="hidden",x.support.shrinkWrapBlocks||u.always(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(r in t)if(i=t[r],Vn.exec(i)){if(delete t[r],o=o||"toggle"===i,i===(f?"hide":"show"))continue;c[r]=d&&d[r]||x.style(e,r)}if(!x.isEmptyObject(c)){d?"hidden"in d&&(f=d.hidden):d=x._data(e,"fxshow",{}),o&&(d.hidden=!f),f?x(e).show():u.done(function(){x(e).hide()}),u.done(function(){var t;x._removeData(e,"fxshow");for(t in c)x.style(e,t,c[t])});for(r in c)a=Zn(f?d[r]:0,r,u),r in d||(d[r]=a.start,f&&(a.end=a.start,a.start="width"===r||"height"===r?1:0))}}function rr(e,t,n,r,i){return new rr.prototype.init(e,t,n,r,i)}x.Tween=rr,rr.prototype={constructor:rr,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(x.cssNumber[n]?"":"px")},cur:function(){var e=rr.propHooks[this.prop];return e&&e.get?e.get(this):rr.propHooks._default.get(this)},run:function(e){var t,n=rr.propHooks[this.prop];return this.pos=t=this.options.duration?x.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):rr.propHooks._default.set(this),this}},rr.prototype.init.prototype=rr.prototype,rr.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=x.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){x.fx.step[e.prop]?x.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[x.cssProps[e.prop]]||x.cssHooks[e.prop])?x.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},rr.propHooks.scrollTop=rr.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},x.each(["toggle","show","hide"],function(e,t){var n=x.fn[t];x.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(ir(t,!0),e,r,i)}}),x.fn.extend({fadeTo:function(e,t,n,r){return this.filter(nn).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=x.isEmptyObject(e),o=x.speed(t,n,r),a=function(){var t=er(this,x.extend({},e),o);(i||x._data(this,"finish"))&&t.stop(!0)};return a.finish=a,i||o.queue===!1?this.each(a):this.queue(o.queue,a)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return"string"!=typeof e&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",o=x.timers,a=x._data(this);if(n)a[n]&&a[n].stop&&i(a[n]);else for(n in a)a[n]&&a[n].stop&&Jn.test(n)&&i(a[n]);for(n=o.length;n--;)o[n].elem!==this||null!=e&&o[n].queue!==e||(o[n].anim.stop(r),t=!1,o.splice(n,1));(t||!r)&&x.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=x._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],o=x.timers,a=r?r.length:0;for(n.finish=!0,x.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;a>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}});function ir(e,t){var n,r={height:e},i=0;for(t=t?1:0;4>i;i+=2-t)n=Zt[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}x.each({slideDown:ir("show"),slideUp:ir("hide"),slideToggle:ir("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){x.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),x.speed=function(e,t,n){var r=e&&"object"==typeof e?x.extend({},e):{complete:n||!n&&t||x.isFunction(e)&&e,duration:e,easing:n&&t||t&&!x.isFunction(t)&&t};return r.duration=x.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in x.fx.speeds?x.fx.speeds[r.duration]:x.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){x.isFunction(r.old)&&r.old.call(this),r.queue&&x.dequeue(this,r.queue)},r},x.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},x.timers=[],x.fx=rr.prototype.init,x.fx.tick=function(){var e,n=x.timers,r=0;for(Xn=x.now();n.length>r;r++)e=n[r],e()||n[r]!==e||n.splice(r--,1);n.length||x.fx.stop(),Xn=t},x.fx.timer=function(e){e()&&x.timers.push(e)&&x.fx.start()},x.fx.interval=13,x.fx.start=function(){Un||(Un=setInterval(x.fx.tick,x.fx.interval))},x.fx.stop=function(){clearInterval(Un),Un=null},x.fx.speeds={slow:600,fast:200,_default:400},x.fx.step={},x.expr&&x.expr.filters&&(x.expr.filters.animated=function(e){return x.grep(x.timers,function(t){return e===t.elem}).length}),x.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){x.offset.setOffset(this,e,t)});var n,r,o={top:0,left:0},a=this[0],s=a&&a.ownerDocument;if(s)return n=s.documentElement,x.contains(n,a)?(typeof a.getBoundingClientRect!==i&&(o=a.getBoundingClientRect()),r=or(s),{top:o.top+(r.pageYOffset||n.scrollTop)-(n.clientTop||0),left:o.left+(r.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}):o},x.offset={setOffset:function(e,t,n){var r=x.css(e,"position");"static"===r&&(e.style.position="relative");var i=x(e),o=i.offset(),a=x.css(e,"top"),s=x.css(e,"left"),l=("absolute"===r||"fixed"===r)&&x.inArray("auto",[a,s])>-1,u={},c={},p,f;l?(c=i.position(),p=c.top,f=c.left):(p=parseFloat(a)||0,f=parseFloat(s)||0),x.isFunction(t)&&(t=t.call(e,n,o)),null!=t.top&&(u.top=t.top-o.top+p),null!=t.left&&(u.left=t.left-o.left+f),"using"in t?t.using.call(e,u):i.css(u)}},x.fn.extend({position:function(){if(this[0]){var e,t,n={top:0,left:0},r=this[0];return"fixed"===x.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),x.nodeName(e[0],"html")||(n=e.offset()),n.top+=x.css(e[0],"borderTopWidth",!0),n.left+=x.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-x.css(r,"marginTop",!0),left:t.left-n.left-x.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||s;while(e&&!x.nodeName(e,"html")&&"static"===x.css(e,"position"))e=e.offsetParent;return e||s})}}),x.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);x.fn[e]=function(i){return x.access(this,function(e,i,o){var a=or(e);return o===t?a?n in a?a[n]:a.document.documentElement[i]:e[i]:(a?a.scrollTo(r?x(a).scrollLeft():o,r?o:x(a).scrollTop()):e[i]=o,t)},e,i,arguments.length,null)}});function or(e){return x.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}x.each({Height:"height",Width:"width"},function(e,n){x.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){x.fn[i]=function(i,o){var a=arguments.length&&(r||"boolean"!=typeof i),s=r||(i===!0||o===!0?"margin":"border");return x.access(this,function(n,r,i){var o;return x.isWindow(n)?n.document.documentElement["client"+e]:9===n.nodeType?(o=n.documentElement,Math.max(n.body["scroll"+e],o["scroll"+e],n.body["offset"+e],o["offset"+e],o["client"+e])):i===t?x.css(n,r,s):x.style(n,r,i,s)},n,a?i:t,a,null)}})}),x.fn.size=function(){return this.length},x.fn.andSelf=x.fn.addBack,"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=x:(e.jQuery=e.$=x,"function"==typeof define&&define.amd&&define("jquery",[],function(){return x}))})(window);(function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=r.unshift,l=i.toString,c=i.hasOwnProperty,h=r.forEach,p=r.map,d=r.reduce,v=r.reduceRight,m=r.filter,g=r.every,y=r.some,b=r.indexOf,w=r.lastIndexOf,E=Array.isArray,S=Object.keys,x=s.bind,T=function(e){if(e instanceof T)return e;if(!(this instanceof T))return new T(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=T),exports._=T):e._=T,T.VERSION="1.4.2";var N=T.each=T.forEach=function(e,t,r){if(e==null)return;if(h&&e.forEach===h)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(T.has(e,o)&&t.call(r,e[o],o,e)===n)return
};T.map=T.collect=function(e,t,n){var r=[];return e==null?r:p&&e.map===p?e.map(t,n):(N(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)},T.reduce=T.foldl=T.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(d&&e.reduce===d)return r&&(t=T.bind(t,r)),i?e.reduce(t,n):e.reduce(t);N(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},T.reduceRight=T.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(v&&e.reduceRight===v)return r&&(t=T.bind(t,r)),arguments.length>2?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=T.keys(e);s=o.length}N(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},T.find=T.detect=function(e,t,n){var r;return C(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},T.filter=T.select=function(e,t,n){var r=[];return e==null?r:m&&e.filter===m?e.filter(t,n):(N(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},T.reject=function(e,t,n){var r=[];return e==null?r:(N(e,function(e,i,s){t.call(n,e,i,s)||(r[r.length]=e)}),r)},T.every=T.all=function(e,t,r){t||(t=T.identity);var i=!0;return e==null?i:g&&e.every===g?e.every(t,r):(N(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var C=T.some=T.any=function(e,t,r){t||(t=T.identity);var i=!1;return e==null?i:y&&e.some===y?e.some(t,r):(N(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};T.contains=T.include=function(e,t){var n=!1;return e==null?n:b&&e.indexOf===b?e.indexOf(t)!=-1:(n=C(e,function(e){return e===t}),n)},T.invoke=function(e,t){var n=u.call(arguments,2);return T.map(e,function(e){return(T.isFunction(t)?t:e[t]).apply(e,n)})},T.pluck=function(e,t){return T.map(e,function(e){return e[t]})},T.where=function(e,t){return T.isEmpty(t)?[]:T.filter(e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},T.max=function(e,t,n){if(!t&&T.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&T.isEmpty(e))return-Infinity;var r={computed:-Infinity};return N(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},T.min=function(e,t,n){if(!t&&T.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&T.isEmpty(e))return Infinity;var r={computed:Infinity};return N(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},T.shuffle=function(e){var t,n=0,r=[];return N(e,function(e){t=T.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return T.isFunction(e)?e:function(t){return t[e]}};T.sortBy=function(e,t,n){var r=k(t);return T.pluck(T.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t);return N(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};T.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(T.has(e,t)?e[t]:e[t]=[]).push(n)})},T.countBy=function(e,t,n){return L(e,t,n,function(e,t,n){T.has(e,t)||(e[t]=0),e[t]++})},T.sortedIndex=function(e,t,n,r){n=n==null?T.identity:k(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},T.toArray=function(e){return e?e.length===+e.length?u.call(e):T.values(e):[]},T.size=function(e){return e.length===+e.length?e.length:T.keys(e).length},T.first=T.head=T.take=function(e,t,n){return t!=null&&!n?u.call(e,0,t):e[0]},T.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))},T.last=function(e,t,n){return t!=null&&!n?u.call(e,Math.max(e.length-t,0)):e[e.length-1]},T.rest=T.tail=T.drop=function(e,t,n){return u.call(e,t==null||n?1:t)},T.compact=function(e){return T.filter(e,function(e){return!!e})};var A=function(e,t,n){return N(e,function(e){T.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n};T.flatten=function(e,t){return A(e,t,[])},T.without=function(e){return T.difference(e,u.call(arguments,1))},T.uniq=T.unique=function(e,t,n,r){var i=n?T.map(e,n,r):e,s=[],o=[];return N(i,function(n,r){if(t?!r||o[o.length-1]!==n:!T.contains(o,n))o.push(n),s.push(e[r])}),s},T.union=function(){return T.uniq(a.apply(r,arguments))},T.intersection=function(e){var t=u.call(arguments,1);return T.filter(T.uniq(e),function(e){return T.every(t,function(t){return T.indexOf(t,e)>=0})})},T.difference=function(e){var t=a.apply(r,u.call(arguments,1));return T.filter(e,function(e){return!T.contains(t,e)})},T.zip=function(){var e=u.call(arguments),t=T.max(T.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=T.pluck(e,""+r);return n},T.object=function(e,t){var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},T.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number")return r=T.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(b&&e.indexOf===b)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},T.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(w&&e.lastIndexOf===w)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},T.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var O=function(){};T.bind=function(t,n){var r,i;if(t.bind===x&&x)return x.apply(t,u.call(arguments,1));if(!T.isFunction(t))throw new TypeError;return i=u.call(arguments,2),r=function(){if(this instanceof r){O.prototype=t.prototype;var e=new O,s=t.apply(e,i.concat(u.call(arguments)));return Object(s)===s?s:e}return t.apply(n,i.concat(u.call(arguments)))}},T.bindAll=function(e){var t=u.call(arguments,1);return t.length==0&&(t=T.functions(e)),N(t,function(t){e[t]=T.bind(e[t],e)}),e},T.memoize=function(e,t){var n={};return t||(t=T.identity),function(){var r=t.apply(this,arguments);return T.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},T.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},T.defer=function(e){return T.delay.apply(T,[e,1].concat(u.call(arguments,1)))},T.throttle=function(e,t){var n,r,i,s,o,u,a=T.debounce(function(){o=s=!1},t);return function(){n=this,r=arguments;var f=function(){i=null,o&&(u=e.apply(n,r)),a()};return i||(i=setTimeout(f,t)),s?o=!0:(s=!0,u=e.apply(n,r)),a(),u}},T.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},T.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},T.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},T.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},T.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},T.keys=S||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)T.has(e,n)&&(t[t.length]=n);return t},T.values=function(e){var t=[];for(var n in e)T.has(e,n)&&t.push(e[n]);return t},T.pairs=function(e){var t=[];for(var n in e)T.has(e,n)&&t.push([n,e[n]]);return t},T.invert=function(e){var t={};for(var n in e)T.has(e,n)&&(t[e[n]]=n);return t},T.functions=T.methods=function(e){var t=[];for(var n in e)T.isFunction(e[n])&&t.push(n);return t.sort()},T.extend=function(e){return N(u.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},T.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return N(n,function(n){n in e&&(t[n]=e[n])}),t},T.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)T.contains(n,i)||(t[i]=e[i]);return t},T.defaults=function(e){return N(u.call(arguments,1),function(t){for(var n in t)e[n]==null&&(e[n]=t[n])}),e},T.clone=function(e){return T.isObject(e)?T.isArray(e)?e.slice():T.extend({},e):e},T.tap=function(e,t){return t(e),e};var M=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof T&&(e=e._wrapped),t instanceof T&&(t=t._wrapped);var i=l.call(e);if(i!=l.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,u=!0;if(i=="[object Array]"){o=e.length,u=o==t.length;if(u)while(o--)if(!(u=M(e[o],t[o],n,r)))break}else{var a=e.constructor,f=t.constructor;if(a!==f&&!(T.isFunction(a)&&a instanceof a&&T.isFunction(f)&&f instanceof f))return!1;for(var c in e)if(T.has(e,c)){o++;if(!(u=T.has(t,c)&&M(e[c],t[c],n,r)))break}if(u){for(c in t)if(T.has(t,c)&&!o--)break;u=!o}}return n.pop(),r.pop(),u};T.isEqual=function(e,t){return M(e,t,[],[])},T.isEmpty=function(e){if(e==null)return!0;if(T.isArray(e)||T.isString(e))return e.length===0;for(var t in e)if(T.has(e,t))return!1;return!0},T.isElement=function(e){return!!e&&e.nodeType===1},T.isArray=E||function(e){return l.call(e)=="[object Array]"},T.isObject=function(e){return e===Object(e)},N(["Arguments","Function","String","Number","Date","RegExp"],function(e){T["is"+e]=function(t){return l.call(t)=="[object "+e+"]"}}),T.isArguments(arguments)||(T.isArguments=function(e){return!!e&&!!T.has(e,"callee")}),typeof/./!="function"&&(T.isFunction=function(e){return typeof e=="function"}),T.isFinite=function(e){return T.isNumber(e)&&isFinite(e)},T.isNaN=function(e){return T.isNumber(e)&&e!=+e},T.isBoolean=function(e){return e===!0||e===!1||l.call(e)=="[object Boolean]"},T.isNull=function(e){return e===null},T.isUndefined=function(e){return e===void 0},T.has=function(e,t){return c.call(e,t)},T.noConflict=function(){return e._=t,this},T.identity=function(e){return e},T.times=function(e,t,n){for(var r=0;r<e;r++)t.call(n,r)},T.random=function(e,t){return t==null&&(t=e,e=0),e+(0|Math.random()*(t-e+1))};var _={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};_.unescape=T.invert(_.escape);var D={escape:new RegExp("["+T.keys(_.escape).join("")+"]","g"),unescape:new RegExp("("+T.keys(_.unescape).join("|")+")","g")};T.each(["escape","unescape"],function(e){T[e]=function(t){return t==null?"":(""+t).replace(D[e],function(t){return _[e][t]})}}),T.result=function(e,t){if(e==null)return null;var n=e[t];return T.isFunction(n)?n.call(e):n},T.mixin=function(e){N(T.functions(e),function(t){var n=T[t]=e[t];T.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),F.call(this,n.apply(T,e))}})};var P=0;T.uniqueId=function(e){var t=P++;return e?e+t:t},T.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var H=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;T.template=function(e,t,n){n=T.defaults({},n,T.templateSettings);var r=new RegExp([(n.escape||H).source,(n.interpolate||H).source,(n.evaluate||H).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(t,n,r,o,u){s+=e.slice(i,u).replace(j,function(e){return"\\"+B[e]}),s+=n?"'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?"'+\n((__t=("+r+"))==null?'':__t)+\n'":o?"';\n"+o+"\n__p+='":"",i=u+t.length}),s+="';\n",n.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=new Function(n.variable||"obj","_",s)}catch(u){throw u.source=s,u}if(t)return o(t,T);var a=function(e){return o.call(this,e,T)};return a.source="function("+(n.variable||"obj")+"){\n"+s+"}",a},T.chain=function(e){return T(e).chain()};var F=function(e){return this._chain?T(e).chain():e};T.mixin(T),N(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];T.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],F.call(this,n)}}),N(["concat","join","slice"],function(e){var t=r[e];T.prototype[e]=function(){return F.call(this,t.apply(this._wrapped,arguments))}}),T.extend(T.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this);(function(a){function b(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function c(a,b){return function(c){return k(a.call(this,c),b)}}function d(a,b){return function(c){return this.lang().ordinal(a.call(this,c),b)}}function e(){}function f(a){w(a),h(this,a)}function g(a){var b=q(a),c=b.year||0,d=b.month||0,e=b.week||0,f=b.day||0,g=b.hour||0,h=b.minute||0,i=b.second||0,j=b.millisecond||0;this._milliseconds=+j+1e3*i+6e4*h+36e5*g,this._days=+f+7*e,this._months=+d+12*c,this._data={},this._bubble()}function h(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return b.hasOwnProperty("toString")&&(a.toString=b.toString),b.hasOwnProperty("valueOf")&&(a.valueOf=b.valueOf),a}function i(a){var b,c={};for(b in a)a.hasOwnProperty(b)&&qb.hasOwnProperty(b)&&(c[b]=a[b]);return c}function j(a){return 0>a?Math.ceil(a):Math.floor(a)}function k(a,b,c){for(var d=""+Math.abs(a),e=a>=0;d.length<b;)d="0"+d;return(e?c?"+":"":"-")+d}function l(a,b,c,d){var e,f,g=b._milliseconds,h=b._days,i=b._months;g&&a._d.setTime(+a._d+g*c),(h||i)&&(e=a.minute(),f=a.hour()),h&&a.date(a.date()+h*c),i&&a.month(a.month()+i*c),g&&!d&&db.updateOffset(a),(h||i)&&(a.minute(e),a.hour(f))}function m(a){return"[object Array]"===Object.prototype.toString.call(a)}function n(a){return"[object Date]"===Object.prototype.toString.call(a)||a instanceof Date}function o(a,b,c){var d,e=Math.min(a.length,b.length),f=Math.abs(a.length-b.length),g=0;for(d=0;e>d;d++)(c&&a[d]!==b[d]||!c&&s(a[d])!==s(b[d]))&&g++;return g+f}function p(a){if(a){var b=a.toLowerCase().replace(/(.)s$/,"$1");a=Tb[a]||Ub[b]||b}return a}function q(a){var b,c,d={};for(c in a)a.hasOwnProperty(c)&&(b=p(c),b&&(d[b]=a[c]));return d}function r(b){var c,d;if(0===b.indexOf("week"))c=7,d="day";else{if(0!==b.indexOf("month"))return;c=12,d="month"}db[b]=function(e,f){var g,h,i=db.fn._lang[b],j=[];if("number"==typeof e&&(f=e,e=a),h=function(a){var b=db().utc().set(d,a);return i.call(db.fn._lang,b,e||"")},null!=f)return h(f);for(g=0;c>g;g++)j.push(h(g));return j}}function s(a){var b=+a,c=0;return 0!==b&&isFinite(b)&&(c=b>=0?Math.floor(b):Math.ceil(b)),c}function t(a,b){return new Date(Date.UTC(a,b+1,0)).getUTCDate()}function u(a){return v(a)?366:365}function v(a){return a%4===0&&a%100!==0||a%400===0}function w(a){var b;a._a&&-2===a._pf.overflow&&(b=a._a[jb]<0||a._a[jb]>11?jb:a._a[kb]<1||a._a[kb]>t(a._a[ib],a._a[jb])?kb:a._a[lb]<0||a._a[lb]>23?lb:a._a[mb]<0||a._a[mb]>59?mb:a._a[nb]<0||a._a[nb]>59?nb:a._a[ob]<0||a._a[ob]>999?ob:-1,a._pf._overflowDayOfYear&&(ib>b||b>kb)&&(b=kb),a._pf.overflow=b)}function x(a){return null==a._isValid&&(a._isValid=!isNaN(a._d.getTime())&&a._pf.overflow<0&&!a._pf.empty&&!a._pf.invalidMonth&&!a._pf.nullInput&&!a._pf.invalidFormat&&!a._pf.userInvalidated,a._strict&&(a._isValid=a._isValid&&0===a._pf.charsLeftOver&&0===a._pf.unusedTokens.length)),a._isValid}function y(a){return a?a.toLowerCase().replace("_","-"):a}function z(a,b){return b._isUTC?db(a).zone(b._offset||0):db(a).local()}function A(a,b){return b.abbr=a,pb[a]||(pb[a]=new e),pb[a].set(b),pb[a]}function B(a){delete pb[a]}function C(a){var b,c,d,e,f=0,g=function(a){if(!pb[a]&&rb)try{require("./lang/"+a)}catch(b){}return pb[a]};if(!a)return db.fn._lang;if(!m(a)){if(c=g(a))return c;a=[a]}for(;f<a.length;){for(e=y(a[f]).split("-"),b=e.length,d=y(a[f+1]),d=d?d.split("-"):null;b>0;){if(c=g(e.slice(0,b).join("-")))return c;if(d&&d.length>=b&&o(e,d,!0)>=b-1)break;b--}f++}return db.fn._lang}function D(a){return a.match(/\[[\s\S]/)?a.replace(/^\[|\]$/g,""):a.replace(/\\/g,"")}function E(a){var b,c,d=a.match(vb);for(b=0,c=d.length;c>b;b++)d[b]=Yb[d[b]]?Yb[d[b]]:D(d[b]);return function(e){var f="";for(b=0;c>b;b++)f+=d[b]instanceof Function?d[b].call(e,a):d[b];return f}}function F(a,b){return a.isValid()?(b=G(b,a.lang()),Vb[b]||(Vb[b]=E(b)),Vb[b](a)):a.lang().invalidDate()}function G(a,b){function c(a){return b.longDateFormat(a)||a}var d=5;for(wb.lastIndex=0;d>=0&&wb.test(a);)a=a.replace(wb,c),wb.lastIndex=0,d-=1;return a}function H(a,b){var c,d=b._strict;switch(a){case"DDDD":return Ib;case"YYYY":case"GGGG":case"gggg":return d?Jb:zb;case"Y":case"G":case"g":return Lb;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return d?Kb:Ab;case"S":if(d)return Gb;case"SS":if(d)return Hb;case"SSS":if(d)return Ib;case"DDD":return yb;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return Cb;case"a":case"A":return C(b._l)._meridiemParse;case"X":return Fb;case"Z":case"ZZ":return Db;case"T":return Eb;case"SSSS":return Bb;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return d?Hb:xb;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return xb;default:return c=new RegExp(P(O(a.replace("\\","")),"i"))}}function I(a){a=a||"";var b=a.match(Db)||[],c=b[b.length-1]||[],d=(c+"").match(Qb)||["-",0,0],e=+(60*d[1])+s(d[2]);return"+"===d[0]?-e:e}function J(a,b,c){var d,e=c._a;switch(a){case"M":case"MM":null!=b&&(e[jb]=s(b)-1);break;case"MMM":case"MMMM":d=C(c._l).monthsParse(b),null!=d?e[jb]=d:c._pf.invalidMonth=b;break;case"D":case"DD":null!=b&&(e[kb]=s(b));break;case"DDD":case"DDDD":null!=b&&(c._dayOfYear=s(b));break;case"YY":e[ib]=s(b)+(s(b)>68?1900:2e3);break;case"YYYY":case"YYYYY":case"YYYYYY":e[ib]=s(b);break;case"a":case"A":c._isPm=C(c._l).isPM(b);break;case"H":case"HH":case"h":case"hh":e[lb]=s(b);break;case"m":case"mm":e[mb]=s(b);break;case"s":case"ss":e[nb]=s(b);break;case"S":case"SS":case"SSS":case"SSSS":e[ob]=s(1e3*("0."+b));break;case"X":c._d=new Date(1e3*parseFloat(b));break;case"Z":case"ZZ":c._useUTC=!0,c._tzm=I(b);break;case"w":case"ww":case"W":case"WW":case"d":case"dd":case"ddd":case"dddd":case"e":case"E":a=a.substr(0,1);case"gg":case"gggg":case"GG":case"GGGG":case"GGGGG":a=a.substr(0,2),b&&(c._w=c._w||{},c._w[a]=b)}}function K(a){var b,c,d,e,f,g,h,i,j,k,l=[];if(!a._d){for(d=M(a),a._w&&null==a._a[kb]&&null==a._a[jb]&&(f=function(b){var c=parseInt(b,10);return b?b.length<3?c>68?1900+c:2e3+c:c:null==a._a[ib]?db().weekYear():a._a[ib]},g=a._w,null!=g.GG||null!=g.W||null!=g.E?h=Z(f(g.GG),g.W||1,g.E,4,1):(i=C(a._l),j=null!=g.d?V(g.d,i):null!=g.e?parseInt(g.e,10)+i._week.dow:0,k=parseInt(g.w,10)||1,null!=g.d&&j<i._week.dow&&k++,h=Z(f(g.gg),k,j,i._week.doy,i._week.dow)),a._a[ib]=h.year,a._dayOfYear=h.dayOfYear),a._dayOfYear&&(e=null==a._a[ib]?d[ib]:a._a[ib],a._dayOfYear>u(e)&&(a._pf._overflowDayOfYear=!0),c=U(e,0,a._dayOfYear),a._a[jb]=c.getUTCMonth(),a._a[kb]=c.getUTCDate()),b=0;3>b&&null==a._a[b];++b)a._a[b]=l[b]=d[b];for(;7>b;b++)a._a[b]=l[b]=null==a._a[b]?2===b?1:0:a._a[b];l[lb]+=s((a._tzm||0)/60),l[mb]+=s((a._tzm||0)%60),a._d=(a._useUTC?U:T).apply(null,l)}}function L(a){var b;a._d||(b=q(a._i),a._a=[b.year,b.month,b.day,b.hour,b.minute,b.second,b.millisecond],K(a))}function M(a){var b=new Date;return a._useUTC?[b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate()]:[b.getFullYear(),b.getMonth(),b.getDate()]}function N(a){a._a=[],a._pf.empty=!0;var b,c,d,e,f,g=C(a._l),h=""+a._i,i=h.length,j=0;for(d=G(a._f,g).match(vb)||[],b=0;b<d.length;b++)e=d[b],c=(h.match(H(e,a))||[])[0],c&&(f=h.substr(0,h.indexOf(c)),f.length>0&&a._pf.unusedInput.push(f),h=h.slice(h.indexOf(c)+c.length),j+=c.length),Yb[e]?(c?a._pf.empty=!1:a._pf.unusedTokens.push(e),J(e,c,a)):a._strict&&!c&&a._pf.unusedTokens.push(e);a._pf.charsLeftOver=i-j,h.length>0&&a._pf.unusedInput.push(h),a._isPm&&a._a[lb]<12&&(a._a[lb]+=12),a._isPm===!1&&12===a._a[lb]&&(a._a[lb]=0),K(a),w(a)}function O(a){return a.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(a,b,c,d,e){return b||c||d||e})}function P(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function Q(a){var c,d,e,f,g;if(0===a._f.length)return a._pf.invalidFormat=!0,a._d=new Date(0/0),void 0;for(f=0;f<a._f.length;f++)g=0,c=h({},a),c._pf=b(),c._f=a._f[f],N(c),x(c)&&(g+=c._pf.charsLeftOver,g+=10*c._pf.unusedTokens.length,c._pf.score=g,(null==e||e>g)&&(e=g,d=c));h(a,d||c)}function R(a){var b,c,d=a._i,e=Mb.exec(d);if(e){for(a._pf.iso=!0,b=0,c=Ob.length;c>b;b++)if(Ob[b][1].exec(d)){a._f=Ob[b][0]+(e[6]||" ");break}for(b=0,c=Pb.length;c>b;b++)if(Pb[b][1].exec(d)){a._f+=Pb[b][0];break}d.match(Db)&&(a._f+="Z"),N(a)}else a._d=new Date(d)}function S(b){var c=b._i,d=sb.exec(c);c===a?b._d=new Date:d?b._d=new Date(+d[1]):"string"==typeof c?R(b):m(c)?(b._a=c.slice(0),K(b)):n(c)?b._d=new Date(+c):"object"==typeof c?L(b):b._d=new Date(c)}function T(a,b,c,d,e,f,g){var h=new Date(a,b,c,d,e,f,g);return 1970>a&&h.setFullYear(a),h}function U(a){var b=new Date(Date.UTC.apply(null,arguments));return 1970>a&&b.setUTCFullYear(a),b}function V(a,b){if("string"==typeof a)if(isNaN(a)){if(a=b.weekdaysParse(a),"number"!=typeof a)return null}else a=parseInt(a,10);return a}function W(a,b,c,d,e){return e.relativeTime(b||1,!!c,a,d)}function X(a,b,c){var d=hb(Math.abs(a)/1e3),e=hb(d/60),f=hb(e/60),g=hb(f/24),h=hb(g/365),i=45>d&&["s",d]||1===e&&["m"]||45>e&&["mm",e]||1===f&&["h"]||22>f&&["hh",f]||1===g&&["d"]||25>=g&&["dd",g]||45>=g&&["M"]||345>g&&["MM",hb(g/30)]||1===h&&["y"]||["yy",h];return i[2]=b,i[3]=a>0,i[4]=c,W.apply({},i)}function Y(a,b,c){var d,e=c-b,f=c-a.day();return f>e&&(f-=7),e-7>f&&(f+=7),d=db(a).add("d",f),{week:Math.ceil(d.dayOfYear()/7),year:d.year()}}function Z(a,b,c,d,e){var f,g,h=U(a,0,1).getUTCDay();return c=null!=c?c:e,f=e-h+(h>d?7:0)-(e>h?7:0),g=7*(b-1)+(c-e)+f+1,{year:g>0?a:a-1,dayOfYear:g>0?g:u(a-1)+g}}function $(a){var b=a._i,c=a._f;return null===b?db.invalid({nullInput:!0}):("string"==typeof b&&(a._i=b=C().preparse(b)),db.isMoment(b)?(a=i(b),a._d=new Date(+b._d)):c?m(c)?Q(a):N(a):S(a),new f(a))}function _(a,b){db.fn[a]=db.fn[a+"s"]=function(a){var c=this._isUTC?"UTC":"";return null!=a?(this._d["set"+c+b](a),db.updateOffset(this),this):this._d["get"+c+b]()}}function ab(a){db.duration.fn[a]=function(){return this._data[a]}}function bb(a,b){db.duration.fn["as"+a]=function(){return+this/b}}function cb(a){var b=!1,c=db;"undefined"==typeof ender&&(a?(gb.moment=function(){return!b&&console&&console.warn&&(b=!0,console.warn("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.")),c.apply(null,arguments)},h(gb.moment,c)):gb.moment=db)}for(var db,eb,fb="2.5.1",gb=this,hb=Math.round,ib=0,jb=1,kb=2,lb=3,mb=4,nb=5,ob=6,pb={},qb={_isAMomentObject:null,_i:null,_f:null,_l:null,_strict:null,_isUTC:null,_offset:null,_pf:null,_lang:null},rb="undefined"!=typeof module&&module.exports&&"undefined"!=typeof require,sb=/^\/?Date\((\-?\d+)/i,tb=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,ub=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,vb=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,wb=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,xb=/\d\d?/,yb=/\d{1,3}/,zb=/\d{1,4}/,Ab=/[+\-]?\d{1,6}/,Bb=/\d+/,Cb=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Db=/Z|[\+\-]\d\d:?\d\d/gi,Eb=/T/i,Fb=/[\+\-]?\d+(\.\d{1,3})?/,Gb=/\d/,Hb=/\d\d/,Ib=/\d{3}/,Jb=/\d{4}/,Kb=/[+-]?\d{6}/,Lb=/[+-]?\d+/,Mb=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Nb="YYYY-MM-DDTHH:mm:ssZ",Ob=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],Pb=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],Qb=/([\+\-]|\d\d)/gi,Rb="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),Sb={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},Tb={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},Ub={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},Vb={},Wb="DDD w W M D d".split(" "),Xb="M D H h m s w W".split(" "),Yb={M:function(){return this.month()+1},MMM:function(a){return this.lang().monthsShort(this,a)},MMMM:function(a){return this.lang().months(this,a)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(a){return this.lang().weekdaysMin(this,a)},ddd:function(a){return this.lang().weekdaysShort(this,a)},dddd:function(a){return this.lang().weekdays(this,a)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return k(this.year()%100,2)},YYYY:function(){return k(this.year(),4)},YYYYY:function(){return k(this.year(),5)},YYYYYY:function(){var a=this.year(),b=a>=0?"+":"-";return b+k(Math.abs(a),6)},gg:function(){return k(this.weekYear()%100,2)},gggg:function(){return k(this.weekYear(),4)},ggggg:function(){return k(this.weekYear(),5)},GG:function(){return k(this.isoWeekYear()%100,2)},GGGG:function(){return k(this.isoWeekYear(),4)},GGGGG:function(){return k(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return s(this.milliseconds()/100)},SS:function(){return k(s(this.milliseconds()/10),2)},SSS:function(){return k(this.milliseconds(),3)},SSSS:function(){return k(this.milliseconds(),3)},Z:function(){var a=-this.zone(),b="+";return 0>a&&(a=-a,b="-"),b+k(s(a/60),2)+":"+k(s(a)%60,2)},ZZ:function(){var a=-this.zone(),b="+";return 0>a&&(a=-a,b="-"),b+k(s(a/60),2)+k(s(a)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()},Q:function(){return this.quarter()}},Zb=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];Wb.length;)eb=Wb.pop(),Yb[eb+"o"]=d(Yb[eb],eb);for(;Xb.length;)eb=Xb.pop(),Yb[eb+eb]=c(Yb[eb],2);for(Yb.DDDD=c(Yb.DDD,3),h(e.prototype,{set:function(a){var b,c;for(c in a)b=a[c],"function"==typeof b?this[c]=b:this["_"+c]=b},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(a){return this._months[a.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(a){return this._monthsShort[a.month()]},monthsParse:function(a){var b,c,d;for(this._monthsParse||(this._monthsParse=[]),b=0;12>b;b++)if(this._monthsParse[b]||(c=db.utc([2e3,b]),d="^"+this.months(c,"")+"|^"+this.monthsShort(c,""),this._monthsParse[b]=new RegExp(d.replace(".",""),"i")),this._monthsParse[b].test(a))return b},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(a){return this._weekdays[a.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(a){return this._weekdaysShort[a.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(a){return this._weekdaysMin[a.day()]},weekdaysParse:function(a){var b,c,d;for(this._weekdaysParse||(this._weekdaysParse=[]),b=0;7>b;b++)if(this._weekdaysParse[b]||(c=db([2e3,1]).day(b),d="^"+this.weekdays(c,"")+"|^"+this.weekdaysShort(c,"")+"|^"+this.weekdaysMin(c,""),this._weekdaysParse[b]=new RegExp(d.replace(".",""),"i")),this._weekdaysParse[b].test(a))return b},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(a){var b=this._longDateFormat[a];return!b&&this._longDateFormat[a.toUpperCase()]&&(b=this._longDateFormat[a.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(a){return a.slice(1)}),this._longDateFormat[a]=b),b},isPM:function(a){return"p"===(a+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(a,b,c){return a>11?c?"pm":"PM":c?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(a,b){var c=this._calendar[a];return"function"==typeof c?c.apply(b):c},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(a,b,c,d){var e=this._relativeTime[c];return"function"==typeof e?e(a,b,c,d):e.replace(/%d/i,a)},pastFuture:function(a,b){var c=this._relativeTime[a>0?"future":"past"];return"function"==typeof c?c(b):c.replace(/%s/i,b)},ordinal:function(a){return this._ordinal.replace("%d",a)},_ordinal:"%d",preparse:function(a){return a},postformat:function(a){return a},week:function(a){return Y(a,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),db=function(c,d,e,f){var g;return"boolean"==typeof e&&(f=e,e=a),g={},g._isAMomentObject=!0,g._i=c,g._f=d,g._l=e,g._strict=f,g._isUTC=!1,g._pf=b(),$(g)},db.utc=function(c,d,e,f){var g;return"boolean"==typeof e&&(f=e,e=a),g={},g._isAMomentObject=!0,g._useUTC=!0,g._isUTC=!0,g._l=e,g._i=c,g._f=d,g._strict=f,g._pf=b(),$(g).utc()},db.unix=function(a){return db(1e3*a)},db.duration=function(a,b){var c,d,e,f=a,h=null;return db.isDuration(a)?f={ms:a._milliseconds,d:a._days,M:a._months}:"number"==typeof a?(f={},b?f[b]=a:f.milliseconds=a):(h=tb.exec(a))?(c="-"===h[1]?-1:1,f={y:0,d:s(h[kb])*c,h:s(h[lb])*c,m:s(h[mb])*c,s:s(h[nb])*c,ms:s(h[ob])*c}):(h=ub.exec(a))&&(c="-"===h[1]?-1:1,e=function(a){var b=a&&parseFloat(a.replace(",","."));return(isNaN(b)?0:b)*c},f={y:e(h[2]),M:e(h[3]),d:e(h[4]),h:e(h[5]),m:e(h[6]),s:e(h[7]),w:e(h[8])}),d=new g(f),db.isDuration(a)&&a.hasOwnProperty("_lang")&&(d._lang=a._lang),d},db.version=fb,db.defaultFormat=Nb,db.updateOffset=function(){},db.lang=function(a,b){var c;return a?(b?A(y(a),b):null===b?(B(a),a="en"):pb[a]||C(a),c=db.duration.fn._lang=db.fn._lang=C(a),c._abbr):db.fn._lang._abbr},db.langData=function(a){return a&&a._lang&&a._lang._abbr&&(a=a._lang._abbr),C(a)},db.isMoment=function(a){return a instanceof f||null!=a&&a.hasOwnProperty("_isAMomentObject")},db.isDuration=function(a){return a instanceof g},eb=Zb.length-1;eb>=0;--eb)r(Zb[eb]);for(db.normalizeUnits=function(a){return p(a)},db.invalid=function(a){var b=db.utc(0/0);return null!=a?h(b._pf,a):b._pf.userInvalidated=!0,b},db.parseZone=function(a){return db(a).parseZone()},h(db.fn=f.prototype,{clone:function(){return db(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().lang("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var a=db(this).utc();return 0<a.year()&&a.year()<=9999?F(a,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):F(a,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var a=this;return[a.year(),a.month(),a.date(),a.hours(),a.minutes(),a.seconds(),a.milliseconds()]},isValid:function(){return x(this)},isDSTShifted:function(){return this._a?this.isValid()&&o(this._a,(this._isUTC?db.utc(this._a):db(this._a)).toArray())>0:!1
},parsingFlags:function(){return h({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(a){var b=F(this,a||db.defaultFormat);return this.lang().postformat(b)},add:function(a,b){var c;return c="string"==typeof a?db.duration(+b,a):db.duration(a,b),l(this,c,1),this},subtract:function(a,b){var c;return c="string"==typeof a?db.duration(+b,a):db.duration(a,b),l(this,c,-1),this},diff:function(a,b,c){var d,e,f=z(a,this),g=6e4*(this.zone()-f.zone());return b=p(b),"year"===b||"month"===b?(d=432e5*(this.daysInMonth()+f.daysInMonth()),e=12*(this.year()-f.year())+(this.month()-f.month()),e+=(this-db(this).startOf("month")-(f-db(f).startOf("month")))/d,e-=6e4*(this.zone()-db(this).startOf("month").zone()-(f.zone()-db(f).startOf("month").zone()))/d,"year"===b&&(e/=12)):(d=this-f,e="second"===b?d/1e3:"minute"===b?d/6e4:"hour"===b?d/36e5:"day"===b?(d-g)/864e5:"week"===b?(d-g)/6048e5:d),c?e:j(e)},from:function(a,b){return db.duration(this.diff(a)).lang(this.lang()._abbr).humanize(!b)},fromNow:function(a){return this.from(db(),a)},calendar:function(){var a=z(db(),this).startOf("day"),b=this.diff(a,"days",!0),c=-6>b?"sameElse":-1>b?"lastWeek":0>b?"lastDay":1>b?"sameDay":2>b?"nextDay":7>b?"nextWeek":"sameElse";return this.format(this.lang().calendar(c,this))},isLeapYear:function(){return v(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(a){var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=a?(a=V(a,this.lang()),this.add({d:a-b})):b},month:function(a){var b,c=this._isUTC?"UTC":"";return null!=a?"string"==typeof a&&(a=this.lang().monthsParse(a),"number"!=typeof a)?this:(b=this.date(),this.date(1),this._d["set"+c+"Month"](a),this.date(Math.min(b,this.daysInMonth())),db.updateOffset(this),this):this._d["get"+c+"Month"]()},startOf:function(a){switch(a=p(a)){case"year":this.month(0);case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===a?this.weekday(0):"isoWeek"===a&&this.isoWeekday(1),this},endOf:function(a){return a=p(a),this.startOf(a).add("isoWeek"===a?"week":a,1).subtract("ms",1)},isAfter:function(a,b){return b="undefined"!=typeof b?b:"millisecond",+this.clone().startOf(b)>+db(a).startOf(b)},isBefore:function(a,b){return b="undefined"!=typeof b?b:"millisecond",+this.clone().startOf(b)<+db(a).startOf(b)},isSame:function(a,b){return b=b||"ms",+this.clone().startOf(b)===+z(a,this).startOf(b)},min:function(a){return a=db.apply(null,arguments),this>a?this:a},max:function(a){return a=db.apply(null,arguments),a>this?this:a},zone:function(a){var b=this._offset||0;return null==a?this._isUTC?b:this._d.getTimezoneOffset():("string"==typeof a&&(a=I(a)),Math.abs(a)<16&&(a=60*a),this._offset=a,this._isUTC=!0,b!==a&&l(this,db.duration(b-a,"m"),1,!0),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.zone(this._tzm):"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(a){return a=a?db(a).zone():0,(this.zone()-a)%60===0},daysInMonth:function(){return t(this.year(),this.month())},dayOfYear:function(a){var b=hb((db(this).startOf("day")-db(this).startOf("year"))/864e5)+1;return null==a?b:this.add("d",a-b)},quarter:function(){return Math.ceil((this.month()+1)/3)},weekYear:function(a){var b=Y(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==a?b:this.add("y",a-b)},isoWeekYear:function(a){var b=Y(this,1,4).year;return null==a?b:this.add("y",a-b)},week:function(a){var b=this.lang().week(this);return null==a?b:this.add("d",7*(a-b))},isoWeek:function(a){var b=Y(this,1,4).week;return null==a?b:this.add("d",7*(a-b))},weekday:function(a){var b=(this.day()+7-this.lang()._week.dow)%7;return null==a?b:this.add("d",a-b)},isoWeekday:function(a){return null==a?this.day()||7:this.day(this.day()%7?a:a-7)},get:function(a){return a=p(a),this[a]()},set:function(a,b){return a=p(a),"function"==typeof this[a]&&this[a](b),this},lang:function(b){return b===a?this._lang:(this._lang=C(b),this)}}),eb=0;eb<Rb.length;eb++)_(Rb[eb].toLowerCase().replace(/s$/,""),Rb[eb]);_("year","FullYear"),db.fn.days=db.fn.day,db.fn.months=db.fn.month,db.fn.weeks=db.fn.week,db.fn.isoWeeks=db.fn.isoWeek,db.fn.toJSON=db.fn.toISOString,h(db.duration.fn=g.prototype,{_bubble:function(){var a,b,c,d,e=this._milliseconds,f=this._days,g=this._months,h=this._data;h.milliseconds=e%1e3,a=j(e/1e3),h.seconds=a%60,b=j(a/60),h.minutes=b%60,c=j(b/60),h.hours=c%24,f+=j(c/24),h.days=f%30,g+=j(f/30),h.months=g%12,d=j(g/12),h.years=d},weeks:function(){return j(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*s(this._months/12)},humanize:function(a){var b=+this,c=X(b,!a,this.lang());return a&&(c=this.lang().pastFuture(b,c)),this.lang().postformat(c)},add:function(a,b){var c=db.duration(a,b);return this._milliseconds+=c._milliseconds,this._days+=c._days,this._months+=c._months,this._bubble(),this},subtract:function(a,b){var c=db.duration(a,b);return this._milliseconds-=c._milliseconds,this._days-=c._days,this._months-=c._months,this._bubble(),this},get:function(a){return a=p(a),this[a.toLowerCase()+"s"]()},as:function(a){return a=p(a),this["as"+a.charAt(0).toUpperCase()+a.slice(1)+"s"]()},lang:db.fn.lang,toIsoString:function(){var a=Math.abs(this.years()),b=Math.abs(this.months()),c=Math.abs(this.days()),d=Math.abs(this.hours()),e=Math.abs(this.minutes()),f=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(a?a+"Y":"")+(b?b+"M":"")+(c?c+"D":"")+(d||e||f?"T":"")+(d?d+"H":"")+(e?e+"M":"")+(f?f+"S":""):"P0D"}});for(eb in Sb)Sb.hasOwnProperty(eb)&&(bb(eb,Sb[eb]),ab(eb.toLowerCase()));bb("Weeks",6048e5),db.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},db.lang("en",{ordinal:function(a){var b=a%10,c=1===s(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return a+c}}),rb?(module.exports=db,cb(!0)):"function"==typeof define&&define.amd?define("moment",function(b,c,d){return d.config&&d.config()&&d.config().noGlobal!==!0&&cb(d.config().noGlobal===a),db}):cb()}).call(this);(function(window,document,undefined){"use strict";function minErr(module){return function(){var code=arguments[0],prefix="["+(module?module+":":"")+code+"] ",template=arguments[1],templateArgs=arguments,stringify=function(obj){if(typeof obj==="function"){return obj.toString().replace(/ \{[\s\S]*$/,"")}else if(typeof obj==="undefined"){return"undefined"}else if(typeof obj!=="string"){return JSON.stringify(obj)}return obj},message,i;message=prefix+template.replace(/\{\d+\}/g,function(match){var index=+match.slice(1,-1),arg;if(index+2<templateArgs.length){arg=templateArgs[index+2];if(typeof arg==="function"){return arg.toString().replace(/ ?\{[\s\S]*$/,"")}else if(typeof arg==="undefined"){return"undefined"}else if(typeof arg!=="string"){return toJson(arg)}return arg}return match});message=message+"\nhttp://errors.angularjs.org/1.2.6/"+(module?module+"/":"")+code;for(i=2;i<arguments.length;i++){message=message+(i==2?"?":"&")+"p"+(i-2)+"="+encodeURIComponent(stringify(arguments[i]))}return new Error(message)}}var lowercase=function(string){return isString(string)?string.toLowerCase():string};var uppercase=function(string){return isString(string)?string.toUpperCase():string};var manualLowercase=function(s){return isString(s)?s.replace(/[A-Z]/g,function(ch){return String.fromCharCode(ch.charCodeAt(0)|32)}):s};var manualUppercase=function(s){return isString(s)?s.replace(/[a-z]/g,function(ch){return String.fromCharCode(ch.charCodeAt(0)&~32)}):s};if("i"!=="I".toLowerCase()){lowercase=manualLowercase;uppercase=manualUppercase}var msie,jqLite,jQuery,slice=[].slice,push=[].push,toString=Object.prototype.toString,ngMinErr=minErr("ng"),_angular=window.angular,angular=window.angular||(window.angular={}),angularModule,nodeName_,uid=["0","0","0"];msie=int((/msie (\d+)/.exec(lowercase(navigator.userAgent))||[])[1]);if(isNaN(msie)){msie=int((/trident\/.*; rv:(\d+)/.exec(lowercase(navigator.userAgent))||[])[1])}function isArrayLike(obj){if(obj==null||isWindow(obj)){return false}var length=obj.length;if(obj.nodeType===1&&length){return true}return isString(obj)||isArray(obj)||length===0||typeof length==="number"&&length>0&&length-1 in obj}function forEach(obj,iterator,context){var key;if(obj){if(isFunction(obj)){for(key in obj){if(key!="prototype"&&key!="length"&&key!="name"&&(!obj.hasOwnProperty||obj.hasOwnProperty(key))){iterator.call(context,obj[key],key)}}}else if(obj.forEach&&obj.forEach!==forEach){obj.forEach(iterator,context)}else if(isArrayLike(obj)){for(key=0;key<obj.length;key++)iterator.call(context,obj[key],key)}else{for(key in obj){if(obj.hasOwnProperty(key)){iterator.call(context,obj[key],key)}}}}return obj}function sortedKeys(obj){var keys=[];for(var key in obj){if(obj.hasOwnProperty(key)){keys.push(key)}}return keys.sort()}function forEachSorted(obj,iterator,context){var keys=sortedKeys(obj);for(var i=0;i<keys.length;i++){iterator.call(context,obj[keys[i]],keys[i])}return keys}function reverseParams(iteratorFn){return function(value,key){iteratorFn(key,value)}}function nextUid(){var index=uid.length;var digit;while(index){index--;digit=uid[index].charCodeAt(0);if(digit==57){uid[index]="A";return uid.join("")}if(digit==90){uid[index]="0"}else{uid[index]=String.fromCharCode(digit+1);return uid.join("")}}uid.unshift("0");return uid.join("")}function setHashKey(obj,h){if(h){obj.$$hashKey=h}else{delete obj.$$hashKey}}function extend(dst){var h=dst.$$hashKey;forEach(arguments,function(obj){if(obj!==dst){forEach(obj,function(value,key){dst[key]=value})}});setHashKey(dst,h);return dst}function int(str){return parseInt(str,10)}function inherit(parent,extra){return extend(new(extend(function(){},{prototype:parent})),extra)}function noop(){}noop.$inject=[];function identity($){return $}identity.$inject=[];function valueFn(value){return function(){return value}}function isUndefined(value){return typeof value==="undefined"}function isDefined(value){return typeof value!=="undefined"}function isObject(value){return value!=null&&typeof value==="object"}function isString(value){return typeof value==="string"}function isNumber(value){return typeof value==="number"}function isDate(value){return toString.call(value)==="[object Date]"}function isArray(value){return toString.call(value)==="[object Array]"}function isFunction(value){return typeof value==="function"}function isRegExp(value){return toString.call(value)==="[object RegExp]"}function isWindow(obj){return obj&&obj.document&&obj.location&&obj.alert&&obj.setInterval}function isScope(obj){return obj&&obj.$evalAsync&&obj.$watch}function isFile(obj){return toString.call(obj)==="[object File]"}function isBoolean(value){return typeof value==="boolean"}var trim=function(){if(!String.prototype.trim){return function(value){return isString(value)?value.replace(/^\s\s*/,"").replace(/\s\s*$/,""):value}}return function(value){return isString(value)?value.trim():value}}();function isElement(node){return!!(node&&(node.nodeName||node.on&&node.find))}function makeMap(str){var obj={},items=str.split(","),i;for(i=0;i<items.length;i++)obj[items[i]]=true;return obj}if(msie<9){nodeName_=function(element){element=element.nodeName?element:element[0];return element.scopeName&&element.scopeName!="HTML"?uppercase(element.scopeName+":"+element.nodeName):element.nodeName}}else{nodeName_=function(element){return element.nodeName?element.nodeName:element[0].nodeName}}function map(obj,iterator,context){var results=[];forEach(obj,function(value,index,list){results.push(iterator.call(context,value,index,list))});return results}function size(obj,ownPropsOnly){var count=0,key;if(isArray(obj)||isString(obj)){return obj.length}else if(isObject(obj)){for(key in obj)if(!ownPropsOnly||obj.hasOwnProperty(key))count++}return count}function includes(array,obj){return indexOf(array,obj)!=-1}function indexOf(array,obj){if(array.indexOf)return array.indexOf(obj);for(var i=0;i<array.length;i++){if(obj===array[i])return i}return-1}function arrayRemove(array,value){var index=indexOf(array,value);if(index>=0)array.splice(index,1);return value}function isLeafNode(node){if(node){switch(node.nodeName){case"OPTION":case"PRE":case"TITLE":return true}}return false}function copy(source,destination){if(isWindow(source)||isScope(source)){throw ngMinErr("cpws","Can't copy! Making copies of Window or Scope instances is not supported.")}if(!destination){destination=source;if(source){if(isArray(source)){destination=copy(source,[])}else if(isDate(source)){destination=new Date(source.getTime())}else if(isRegExp(source)){destination=new RegExp(source.source)}else if(isObject(source)){destination=copy(source,{})}}}else{if(source===destination)throw ngMinErr("cpi","Can't copy! Source and destination are identical.");if(isArray(source)){destination.length=0;for(var i=0;i<source.length;i++){destination.push(copy(source[i]))}}else{var h=destination.$$hashKey;forEach(destination,function(value,key){delete destination[key]});for(var key in source){destination[key]=copy(source[key])}setHashKey(destination,h)}}return destination}function shallowCopy(src,dst){dst=dst||{};for(var key in src){if(src.hasOwnProperty(key)&&key.charAt(0)!=="$"&&key.charAt(1)!=="$"){dst[key]=src[key]}}return dst}function equals(o1,o2){if(o1===o2)return true;if(o1===null||o2===null)return false;if(o1!==o1&&o2!==o2)return true;var t1=typeof o1,t2=typeof o2,length,key,keySet;if(t1==t2){if(t1=="object"){if(isArray(o1)){if(!isArray(o2))return false;if((length=o1.length)==o2.length){for(key=0;key<length;key++){if(!equals(o1[key],o2[key]))return false}return true}}else if(isDate(o1)){return isDate(o2)&&o1.getTime()==o2.getTime()}else if(isRegExp(o1)&&isRegExp(o2)){return o1.toString()==o2.toString()}else{if(isScope(o1)||isScope(o2)||isWindow(o1)||isWindow(o2)||isArray(o2))return false;keySet={};for(key in o1){if(key.charAt(0)==="$"||isFunction(o1[key]))continue;if(!equals(o1[key],o2[key]))return false;keySet[key]=true}for(key in o2){if(!keySet.hasOwnProperty(key)&&key.charAt(0)!=="$"&&o2[key]!==undefined&&!isFunction(o2[key]))return false}return true}}}return false}function csp(){return document.securityPolicy&&document.securityPolicy.isActive||document.querySelector&&!!(document.querySelector("[ng-csp]")||document.querySelector("[data-ng-csp]"))}function concat(array1,array2,index){return array1.concat(slice.call(array2,index))}function sliceArgs(args,startIndex){return slice.call(args,startIndex||0)}function bind(self,fn){var curryArgs=arguments.length>2?sliceArgs(arguments,2):[];if(isFunction(fn)&&!(fn instanceof RegExp)){return curryArgs.length?function(){return arguments.length?fn.apply(self,curryArgs.concat(slice.call(arguments,0))):fn.apply(self,curryArgs)}:function(){return arguments.length?fn.apply(self,arguments):fn.call(self)}}else{return fn}}function toJsonReplacer(key,value){var val=value;if(typeof key==="string"&&key.charAt(0)==="$"){val=undefined}else if(isWindow(value)){val="$WINDOW"}else if(value&&document===value){val="$DOCUMENT"}else if(isScope(value)){val="$SCOPE"}return val}function toJson(obj,pretty){if(typeof obj==="undefined")return undefined;return JSON.stringify(obj,toJsonReplacer,pretty?"  ":null)}function fromJson(json){return isString(json)?JSON.parse(json):json}function toBoolean(value){if(value&&value.length!==0){var v=lowercase(""+value);value=!(v=="f"||v=="0"||v=="false"||v=="no"||v=="n"||v=="[]")}else{value=false}return value}function startingTag(element){element=jqLite(element).clone();try{element.empty()}catch(e){}var TEXT_NODE=3;var elemHtml=jqLite("<div>").append(element).html();try{return element[0].nodeType===TEXT_NODE?lowercase(elemHtml):elemHtml.match(/^(<[^>]+>)/)[1].replace(/^<([\w\-]+)/,function(match,nodeName){return"<"+lowercase(nodeName)})}catch(e){return lowercase(elemHtml)}}function tryDecodeURIComponent(value){try{return decodeURIComponent(value)}catch(e){}}function parseKeyValue(keyValue){var obj={},key_value,key;forEach((keyValue||"").split("&"),function(keyValue){if(keyValue){key_value=keyValue.split("=");key=tryDecodeURIComponent(key_value[0]);if(isDefined(key)){var val=isDefined(key_value[1])?tryDecodeURIComponent(key_value[1]):true;if(!obj[key]){obj[key]=val}else if(isArray(obj[key])){obj[key].push(val)}else{obj[key]=[obj[key],val]}}}});return obj}function toKeyValue(obj){var parts=[];forEach(obj,function(value,key){if(isArray(value)){forEach(value,function(arrayValue){parts.push(encodeUriQuery(key,true)+(arrayValue===true?"":"="+encodeUriQuery(arrayValue,true)))})}else{parts.push(encodeUriQuery(key,true)+(value===true?"":"="+encodeUriQuery(value,true)))}});return parts.length?parts.join("&"):""}function encodeUriSegment(val){return encodeUriQuery(val,true).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function encodeUriQuery(val,pctEncodeSpaces){return encodeURIComponent(val).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,pctEncodeSpaces?"%20":"+")}function angularInit(element,bootstrap){var elements=[element],appElement,module,names=["ng:app","ng-app","x-ng-app","data-ng-app"],NG_APP_CLASS_REGEXP=/\sng[:\-]app(:\s*([\w\d_]+);?)?\s/;function append(element){element&&elements.push(element)}forEach(names,function(name){names[name]=true;append(document.getElementById(name));name=name.replace(":","\\:");if(element.querySelectorAll){forEach(element.querySelectorAll("."+name),append);forEach(element.querySelectorAll("."+name+"\\:"),append);forEach(element.querySelectorAll("["+name+"]"),append)}});forEach(elements,function(element){if(!appElement){var className=" "+element.className+" ";var match=NG_APP_CLASS_REGEXP.exec(className);if(match){appElement=element;module=(match[2]||"").replace(/\s+/g,",")}else{forEach(element.attributes,function(attr){if(!appElement&&names[attr.name]){appElement=element;module=attr.value}})}}});if(appElement){bootstrap(appElement,module?[module]:[])}}function bootstrap(element,modules){var doBootstrap=function(){element=jqLite(element);if(element.injector()){var tag=element[0]===document?"document":startingTag(element);throw ngMinErr("btstrpd","App Already Bootstrapped with this Element '{0}'",tag)}modules=modules||[];modules.unshift(["$provide",function($provide){$provide.value("$rootElement",element)}]);modules.unshift("ng");var injector=createInjector(modules);injector.invoke(["$rootScope","$rootElement","$compile","$injector","$animate",function(scope,element,compile,injector,animate){scope.$apply(function(){element.data("$injector",injector);compile(element)(scope)})}]);return injector};var NG_DEFER_BOOTSTRAP=/^NG_DEFER_BOOTSTRAP!/;if(window&&!NG_DEFER_BOOTSTRAP.test(window.name)){return doBootstrap()}window.name=window.name.replace(NG_DEFER_BOOTSTRAP,"");angular.resumeBootstrap=function(extraModules){forEach(extraModules,function(module){modules.push(module)});doBootstrap()}}var SNAKE_CASE_REGEXP=/[A-Z]/g;function snake_case(name,separator){separator=separator||"_";return name.replace(SNAKE_CASE_REGEXP,function(letter,pos){return(pos?separator:"")+letter.toLowerCase()})}function bindJQuery(){jQuery=window.jQuery;if(jQuery){jqLite=jQuery;extend(jQuery.fn,{scope:JQLitePrototype.scope,isolateScope:JQLitePrototype.isolateScope,controller:JQLitePrototype.controller,injector:JQLitePrototype.injector,inheritedData:JQLitePrototype.inheritedData});jqLitePatchJQueryRemove("remove",true,true,false);jqLitePatchJQueryRemove("empty",false,false,false);jqLitePatchJQueryRemove("html",false,false,true)}else{jqLite=JQLite}angular.element=jqLite}function assertArg(arg,name,reason){if(!arg){throw ngMinErr("areq","Argument '{0}' is {1}",name||"?",reason||"required")}return arg}function assertArgFn(arg,name,acceptArrayAnnotation){if(acceptArrayAnnotation&&isArray(arg)){arg=arg[arg.length-1]}assertArg(isFunction(arg),name,"not a function, got "+(arg&&typeof arg=="object"?arg.constructor.name||"Object":typeof arg));return arg}function assertNotHasOwnProperty(name,context){if(name==="hasOwnProperty"){throw ngMinErr("badname","hasOwnProperty is not a valid {0} name",context)}}function getter(obj,path,bindFnToScope){if(!path)return obj;var keys=path.split(".");var key;var lastInstance=obj;var len=keys.length;for(var i=0;i<len;i++){key=keys[i];if(obj){obj=(lastInstance=obj)[key]}}if(!bindFnToScope&&isFunction(obj)){return bind(lastInstance,obj)}return obj}function getBlockElements(nodes){var startNode=nodes[0],endNode=nodes[nodes.length-1];if(startNode===endNode){return jqLite(startNode)}var element=startNode;var elements=[element];do{element=element.nextSibling;if(!element)break;elements.push(element)}while(element!==endNode);return jqLite(elements)}function setupModuleLoader(window){var $injectorMinErr=minErr("$injector");var ngMinErr=minErr("ng");function ensure(obj,name,factory){return obj[name]||(obj[name]=factory())}var angular=ensure(window,"angular",Object);angular.$$minErr=angular.$$minErr||minErr;return ensure(angular,"module",function(){var modules={};return function module(name,requires,configFn){var assertNotHasOwnProperty=function(name,context){if(name==="hasOwnProperty"){throw ngMinErr("badname","hasOwnProperty is not a valid {0} name",context)}};assertNotHasOwnProperty(name,"module");if(requires&&modules.hasOwnProperty(name)){modules[name]=null}return ensure(modules,name,function(){if(!requires){throw $injectorMinErr("nomod","Module '{0}' is not available! You either misspelled "+"the module name or forgot to load it. If registering a module ensure that you "+"specify the dependencies as the second argument.",name)}var invokeQueue=[];var runBlocks=[];var config=invokeLater("$injector","invoke");var moduleInstance={_invokeQueue:invokeQueue,_runBlocks:runBlocks,requires:requires,name:name,provider:invokeLater("$provide","provider"),factory:invokeLater("$provide","factory"),service:invokeLater("$provide","service"),value:invokeLater("$provide","value"),constant:invokeLater("$provide","constant","unshift"),animation:invokeLater("$animateProvider","register"),filter:invokeLater("$filterProvider","register"),controller:invokeLater("$controllerProvider","register"),directive:invokeLater("$compileProvider","directive"),config:config,run:function(block){runBlocks.push(block);return this}};if(configFn){config(configFn)}return moduleInstance;function invokeLater(provider,method,insertMethod){return function(){invokeQueue[insertMethod||"push"]([provider,method,arguments]);return moduleInstance}}})}})}var version={full:"1.2.6",major:1,minor:2,dot:6,codeName:"taco-salsafication"};function publishExternalAPI(angular){extend(angular,{bootstrap:bootstrap,copy:copy,extend:extend,equals:equals,element:jqLite,forEach:forEach,injector:createInjector,noop:noop,bind:bind,toJson:toJson,fromJson:fromJson,identity:identity,isUndefined:isUndefined,isDefined:isDefined,isString:isString,isFunction:isFunction,isObject:isObject,isNumber:isNumber,isElement:isElement,isArray:isArray,version:version,isDate:isDate,lowercase:lowercase,uppercase:uppercase,callbacks:{counter:0},$$minErr:minErr,$$csp:csp});angularModule=setupModuleLoader(window);try{angularModule("ngLocale")}catch(e){angularModule("ngLocale",[]).provider("$locale",$LocaleProvider)}angularModule("ng",["ngLocale"],["$provide",function ngModule($provide){$provide.provider({$$sanitizeUri:$$SanitizeUriProvider});$provide.provider("$compile",$CompileProvider).directive({a:htmlAnchorDirective,input:inputDirective,textarea:inputDirective,form:formDirective,script:scriptDirective,select:selectDirective,style:styleDirective,option:optionDirective,ngBind:ngBindDirective,ngBindHtml:ngBindHtmlDirective,ngBindTemplate:ngBindTemplateDirective,ngClass:ngClassDirective,ngClassEven:ngClassEvenDirective,ngClassOdd:ngClassOddDirective,ngCloak:ngCloakDirective,ngController:ngControllerDirective,ngForm:ngFormDirective,ngHide:ngHideDirective,ngIf:ngIfDirective,ngInclude:ngIncludeDirective,ngInit:ngInitDirective,ngNonBindable:ngNonBindableDirective,ngPluralize:ngPluralizeDirective,ngRepeat:ngRepeatDirective,ngShow:ngShowDirective,ngStyle:ngStyleDirective,ngSwitch:ngSwitchDirective,ngSwitchWhen:ngSwitchWhenDirective,ngSwitchDefault:ngSwitchDefaultDirective,ngOptions:ngOptionsDirective,ngTransclude:ngTranscludeDirective,ngModel:ngModelDirective,ngList:ngListDirective,ngChange:ngChangeDirective,required:requiredDirective,ngRequired:requiredDirective,ngValue:ngValueDirective}).directive({ngInclude:ngIncludeFillContentDirective}).directive(ngAttributeAliasDirectives).directive(ngEventDirectives);$provide.provider({$anchorScroll:$AnchorScrollProvider,$animate:$AnimateProvider,$browser:$BrowserProvider,$cacheFactory:$CacheFactoryProvider,$controller:$ControllerProvider,$document:$DocumentProvider,$exceptionHandler:$ExceptionHandlerProvider,$filter:$FilterProvider,$interpolate:$InterpolateProvider,$interval:$IntervalProvider,$http:$HttpProvider,$httpBackend:$HttpBackendProvider,$location:$LocationProvider,$log:$LogProvider,$parse:$ParseProvider,$rootScope:$RootScopeProvider,$q:$QProvider,$sce:$SceProvider,$sceDelegate:$SceDelegateProvider,$sniffer:$SnifferProvider,$templateCache:$TemplateCacheProvider,$timeout:$TimeoutProvider,$window:$WindowProvider})}])}var jqCache=JQLite.cache={},jqName=JQLite.expando="ng-"+(new Date).getTime(),jqId=1,addEventListenerFn=window.document.addEventListener?function(element,type,fn){element.addEventListener(type,fn,false)}:function(element,type,fn){element.attachEvent("on"+type,fn)},removeEventListenerFn=window.document.removeEventListener?function(element,type,fn){element.removeEventListener(type,fn,false)}:function(element,type,fn){element.detachEvent("on"+type,fn)};function jqNextId(){return++jqId}var SPECIAL_CHARS_REGEXP=/([\:\-\_]+(.))/g;var MOZ_HACK_REGEXP=/^moz([A-Z])/;var jqLiteMinErr=minErr("jqLite");function camelCase(name){return name.replace(SPECIAL_CHARS_REGEXP,function(_,separator,letter,offset){return offset?letter.toUpperCase():letter}).replace(MOZ_HACK_REGEXP,"Moz$1")}function jqLitePatchJQueryRemove(name,dispatchThis,filterElems,getterIfNoArguments){var originalJqFn=jQuery.fn[name];originalJqFn=originalJqFn.$original||originalJqFn;removePatch.$original=originalJqFn;jQuery.fn[name]=removePatch;function removePatch(param){var list=filterElems&&param?[this.filter(param)]:[this],fireEvent=dispatchThis,set,setIndex,setLength,element,childIndex,childLength,children;if(!getterIfNoArguments||param!=null){while(list.length){set=list.shift();for(setIndex=0,setLength=set.length;setIndex<setLength;setIndex++){element=jqLite(set[setIndex]);if(fireEvent){element.triggerHandler("$destroy")}else{fireEvent=!fireEvent}for(childIndex=0,childLength=(children=element.children()).length;childIndex<childLength;childIndex++){list.push(jQuery(children[childIndex]))}}}}return originalJqFn.apply(this,arguments)}}function JQLite(element){if(element instanceof JQLite){return element}if(!(this instanceof JQLite)){if(isString(element)&&element.charAt(0)!="<"){throw jqLiteMinErr("nosel","Looking up elements via selectors is not supported by jqLite! See: http://docs.angularjs.org/api/angular.element")}return new JQLite(element)}if(isString(element)){var div=document.createElement("div");div.innerHTML="<div>&#160;</div>"+element;div.removeChild(div.firstChild);jqLiteAddNodes(this,div.childNodes);var fragment=jqLite(document.createDocumentFragment());fragment.append(this)}else{jqLiteAddNodes(this,element)}}function jqLiteClone(element){return element.cloneNode(true)}function jqLiteDealoc(element){jqLiteRemoveData(element);for(var i=0,children=element.childNodes||[];i<children.length;i++){jqLiteDealoc(children[i])}}function jqLiteOff(element,type,fn,unsupported){if(isDefined(unsupported))throw jqLiteMinErr("offargs","jqLite#off() does not support the `selector` argument");var events=jqLiteExpandoStore(element,"events"),handle=jqLiteExpandoStore(element,"handle");if(!handle)return;if(isUndefined(type)){forEach(events,function(eventHandler,type){removeEventListenerFn(element,type,eventHandler);delete events[type]})}else{forEach(type.split(" "),function(type){if(isUndefined(fn)){removeEventListenerFn(element,type,events[type]);delete events[type]}else{arrayRemove(events[type]||[],fn)}})}}function jqLiteRemoveData(element,name){var expandoId=element[jqName],expandoStore=jqCache[expandoId];if(expandoStore){if(name){delete jqCache[expandoId].data[name];return}if(expandoStore.handle){expandoStore.events.$destroy&&expandoStore.handle({},"$destroy");jqLiteOff(element)}delete jqCache[expandoId];element[jqName]=undefined}}function jqLiteExpandoStore(element,key,value){var expandoId=element[jqName],expandoStore=jqCache[expandoId||-1];if(isDefined(value)){if(!expandoStore){element[jqName]=expandoId=jqNextId();expandoStore=jqCache[expandoId]={}}expandoStore[key]=value}else{return expandoStore&&expandoStore[key]}}function jqLiteData(element,key,value){var data=jqLiteExpandoStore(element,"data"),isSetter=isDefined(value),keyDefined=!isSetter&&isDefined(key),isSimpleGetter=keyDefined&&!isObject(key);if(!data&&!isSimpleGetter){jqLiteExpandoStore(element,"data",data={})}if(isSetter){data[key]=value}else{if(keyDefined){if(isSimpleGetter){return data&&data[key]}else{extend(data,key)}}else{return data}}}function jqLiteHasClass(element,selector){if(!element.getAttribute)return false;return(" "+(element.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").indexOf(" "+selector+" ")>-1}function jqLiteRemoveClass(element,cssClasses){if(cssClasses&&element.setAttribute){forEach(cssClasses.split(" "),function(cssClass){element.setAttribute("class",trim((" "+(element.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").replace(" "+trim(cssClass)+" "," ")))})}}function jqLiteAddClass(element,cssClasses){if(cssClasses&&element.setAttribute){var existingClasses=(" "+(element.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ");forEach(cssClasses.split(" "),function(cssClass){cssClass=trim(cssClass);if(existingClasses.indexOf(" "+cssClass+" ")===-1){existingClasses+=cssClass+" "}});element.setAttribute("class",trim(existingClasses))}}function jqLiteAddNodes(root,elements){if(elements){elements=!elements.nodeName&&isDefined(elements.length)&&!isWindow(elements)?elements:[elements];for(var i=0;i<elements.length;i++){root.push(elements[i])}}}function jqLiteController(element,name){return jqLiteInheritedData(element,"$"+(name||"ngController")+"Controller")}function jqLiteInheritedData(element,name,value){element=jqLite(element);if(element[0].nodeType==9){element=element.find("html")}var names=isArray(name)?name:[name];while(element.length){for(var i=0,ii=names.length;i<ii;i++){if((value=element.data(names[i]))!==undefined)return value}element=element.parent()}}function jqLiteEmpty(element){for(var i=0,childNodes=element.childNodes;i<childNodes.length;i++){jqLiteDealoc(childNodes[i])}while(element.firstChild){element.removeChild(element.firstChild)}}var JQLitePrototype=JQLite.prototype={ready:function(fn){var fired=false;function trigger(){if(fired)return;fired=true;fn()}if(document.readyState==="complete"){setTimeout(trigger)}else{this.on("DOMContentLoaded",trigger);JQLite(window).on("load",trigger)}},toString:function(){var value=[];forEach(this,function(e){value.push(""+e)});return"["+value.join(", ")+"]"},eq:function(index){return index>=0?jqLite(this[index]):jqLite(this[this.length+index])},length:0,push:push,sort:[].sort,splice:[].splice};var BOOLEAN_ATTR={};forEach("multiple,selected,checked,disabled,readOnly,required,open".split(","),function(value){BOOLEAN_ATTR[lowercase(value)]=value});var BOOLEAN_ELEMENTS={};forEach("input,select,option,textarea,button,form,details".split(","),function(value){BOOLEAN_ELEMENTS[uppercase(value)]=true
});function getBooleanAttrName(element,name){var booleanAttr=BOOLEAN_ATTR[name.toLowerCase()];return booleanAttr&&BOOLEAN_ELEMENTS[element.nodeName]&&booleanAttr}forEach({data:jqLiteData,inheritedData:jqLiteInheritedData,scope:function(element){return jqLite(element).data("$scope")||jqLiteInheritedData(element.parentNode||element,["$isolateScope","$scope"])},isolateScope:function(element){return jqLite(element).data("$isolateScope")||jqLite(element).data("$isolateScopeNoTemplate")},controller:jqLiteController,injector:function(element){return jqLiteInheritedData(element,"$injector")},removeAttr:function(element,name){element.removeAttribute(name)},hasClass:jqLiteHasClass,css:function(element,name,value){name=camelCase(name);if(isDefined(value)){element.style[name]=value}else{var val;if(msie<=8){val=element.currentStyle&&element.currentStyle[name];if(val==="")val="auto"}val=val||element.style[name];if(msie<=8){val=val===""?undefined:val}return val}},attr:function(element,name,value){var lowercasedName=lowercase(name);if(BOOLEAN_ATTR[lowercasedName]){if(isDefined(value)){if(!!value){element[name]=true;element.setAttribute(name,lowercasedName)}else{element[name]=false;element.removeAttribute(lowercasedName)}}else{return element[name]||(element.attributes.getNamedItem(name)||noop).specified?lowercasedName:undefined}}else if(isDefined(value)){element.setAttribute(name,value)}else if(element.getAttribute){var ret=element.getAttribute(name,2);return ret===null?undefined:ret}},prop:function(element,name,value){if(isDefined(value)){element[name]=value}else{return element[name]}},text:function(){var NODE_TYPE_TEXT_PROPERTY=[];if(msie<9){NODE_TYPE_TEXT_PROPERTY[1]="innerText";NODE_TYPE_TEXT_PROPERTY[3]="nodeValue"}else{NODE_TYPE_TEXT_PROPERTY[1]=NODE_TYPE_TEXT_PROPERTY[3]="textContent"}getText.$dv="";return getText;function getText(element,value){var textProp=NODE_TYPE_TEXT_PROPERTY[element.nodeType];if(isUndefined(value)){return textProp?element[textProp]:""}element[textProp]=value}}(),val:function(element,value){if(isUndefined(value)){if(nodeName_(element)==="SELECT"&&element.multiple){var result=[];forEach(element.options,function(option){if(option.selected){result.push(option.value||option.text)}});return result.length===0?null:result}return element.value}element.value=value},html:function(element,value){if(isUndefined(value)){return element.innerHTML}for(var i=0,childNodes=element.childNodes;i<childNodes.length;i++){jqLiteDealoc(childNodes[i])}element.innerHTML=value},empty:jqLiteEmpty},function(fn,name){JQLite.prototype[name]=function(arg1,arg2){var i,key;if(fn!==jqLiteEmpty&&(fn.length==2&&fn!==jqLiteHasClass&&fn!==jqLiteController?arg1:arg2)===undefined){if(isObject(arg1)){for(i=0;i<this.length;i++){if(fn===jqLiteData){fn(this[i],arg1)}else{for(key in arg1){fn(this[i],key,arg1[key])}}}return this}else{var value=fn.$dv;var jj=value===undefined?Math.min(this.length,1):this.length;for(var j=0;j<jj;j++){var nodeValue=fn(this[j],arg1,arg2);value=value?value+nodeValue:nodeValue}return value}}else{for(i=0;i<this.length;i++){fn(this[i],arg1,arg2)}return this}}});function createEventHandler(element,events){var eventHandler=function(event,type){if(!event.preventDefault){event.preventDefault=function(){event.returnValue=false}}if(!event.stopPropagation){event.stopPropagation=function(){event.cancelBubble=true}}if(!event.target){event.target=event.srcElement||document}if(isUndefined(event.defaultPrevented)){var prevent=event.preventDefault;event.preventDefault=function(){event.defaultPrevented=true;prevent.call(event)};event.defaultPrevented=false}event.isDefaultPrevented=function(){return event.defaultPrevented||event.returnValue===false};var eventHandlersCopy=shallowCopy(events[type||event.type]||[]);forEach(eventHandlersCopy,function(fn){fn.call(element,event)});if(msie<=8){event.preventDefault=null;event.stopPropagation=null;event.isDefaultPrevented=null}else{delete event.preventDefault;delete event.stopPropagation;delete event.isDefaultPrevented}};eventHandler.elem=element;return eventHandler}forEach({removeData:jqLiteRemoveData,dealoc:jqLiteDealoc,on:function onFn(element,type,fn,unsupported){if(isDefined(unsupported))throw jqLiteMinErr("onargs","jqLite#on() does not support the `selector` or `eventData` parameters");var events=jqLiteExpandoStore(element,"events"),handle=jqLiteExpandoStore(element,"handle");if(!events)jqLiteExpandoStore(element,"events",events={});if(!handle)jqLiteExpandoStore(element,"handle",handle=createEventHandler(element,events));forEach(type.split(" "),function(type){var eventFns=events[type];if(!eventFns){if(type=="mouseenter"||type=="mouseleave"){var contains=document.body.contains||document.body.compareDocumentPosition?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!!(bup&&bup.nodeType===1&&(adown.contains?adown.contains(bup):a.compareDocumentPosition&&a.compareDocumentPosition(bup)&16))}:function(a,b){if(b){while(b=b.parentNode){if(b===a){return true}}}return false};events[type]=[];var eventmap={mouseleave:"mouseout",mouseenter:"mouseover"};onFn(element,eventmap[type],function(event){var target=this,related=event.relatedTarget;if(!related||related!==target&&!contains(target,related)){handle(event,type)}})}else{addEventListenerFn(element,type,handle);events[type]=[]}eventFns=events[type]}eventFns.push(fn)})},off:jqLiteOff,one:function(element,type,fn){element=jqLite(element);element.on(type,function onFn(){element.off(type,fn);element.off(type,onFn)});element.on(type,fn)},replaceWith:function(element,replaceNode){var index,parent=element.parentNode;jqLiteDealoc(element);forEach(new JQLite(replaceNode),function(node){if(index){parent.insertBefore(node,index.nextSibling)}else{parent.replaceChild(node,element)}index=node})},children:function(element){var children=[];forEach(element.childNodes,function(element){if(element.nodeType===1)children.push(element)});return children},contents:function(element){return element.childNodes||[]},append:function(element,node){forEach(new JQLite(node),function(child){if(element.nodeType===1||element.nodeType===11){element.appendChild(child)}})},prepend:function(element,node){if(element.nodeType===1){var index=element.firstChild;forEach(new JQLite(node),function(child){element.insertBefore(child,index)})}},wrap:function(element,wrapNode){wrapNode=jqLite(wrapNode)[0];var parent=element.parentNode;if(parent){parent.replaceChild(wrapNode,element)}wrapNode.appendChild(element)},remove:function(element){jqLiteDealoc(element);var parent=element.parentNode;if(parent)parent.removeChild(element)},after:function(element,newElement){var index=element,parent=element.parentNode;forEach(new JQLite(newElement),function(node){parent.insertBefore(node,index.nextSibling);index=node})},addClass:jqLiteAddClass,removeClass:jqLiteRemoveClass,toggleClass:function(element,selector,condition){if(isUndefined(condition)){condition=!jqLiteHasClass(element,selector)}(condition?jqLiteAddClass:jqLiteRemoveClass)(element,selector)},parent:function(element){var parent=element.parentNode;return parent&&parent.nodeType!==11?parent:null},next:function(element){if(element.nextElementSibling){return element.nextElementSibling}var elm=element.nextSibling;while(elm!=null&&elm.nodeType!==1){elm=elm.nextSibling}return elm},find:function(element,selector){if(element.getElementsByTagName){return element.getElementsByTagName(selector)}else{return[]}},clone:jqLiteClone,triggerHandler:function(element,eventName,eventData){var eventFns=(jqLiteExpandoStore(element,"events")||{})[eventName];eventData=eventData||[];var event=[{preventDefault:noop,stopPropagation:noop}];forEach(eventFns,function(fn){fn.apply(element,event.concat(eventData))})}},function(fn,name){JQLite.prototype[name]=function(arg1,arg2,arg3){var value;for(var i=0;i<this.length;i++){if(isUndefined(value)){value=fn(this[i],arg1,arg2,arg3);if(isDefined(value)){value=jqLite(value)}}else{jqLiteAddNodes(value,fn(this[i],arg1,arg2,arg3))}}return isDefined(value)?value:this};JQLite.prototype.bind=JQLite.prototype.on;JQLite.prototype.unbind=JQLite.prototype.off});function hashKey(obj){var objType=typeof obj,key;if(objType=="object"&&obj!==null){if(typeof(key=obj.$$hashKey)=="function"){key=obj.$$hashKey()}else if(key===undefined){key=obj.$$hashKey=nextUid()}}else{key=obj}return objType+":"+key}function HashMap(array){forEach(array,this.put,this)}HashMap.prototype={put:function(key,value){this[hashKey(key)]=value},get:function(key){return this[hashKey(key)]},remove:function(key){var value=this[key=hashKey(key)];delete this[key];return value}};var FN_ARGS=/^function\s*[^\(]*\(\s*([^\)]*)\)/m;var FN_ARG_SPLIT=/,/;var FN_ARG=/^\s*(_?)(\S+?)\1\s*$/;var STRIP_COMMENTS=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm;var $injectorMinErr=minErr("$injector");function annotate(fn){var $inject,fnText,argDecl,last;if(typeof fn=="function"){if(!($inject=fn.$inject)){$inject=[];if(fn.length){fnText=fn.toString().replace(STRIP_COMMENTS,"");argDecl=fnText.match(FN_ARGS);forEach(argDecl[1].split(FN_ARG_SPLIT),function(arg){arg.replace(FN_ARG,function(all,underscore,name){$inject.push(name)})})}fn.$inject=$inject}}else if(isArray(fn)){last=fn.length-1;assertArgFn(fn[last],"fn");$inject=fn.slice(0,last)}else{assertArgFn(fn,"fn",true)}return $inject}function createInjector(modulesToLoad){var INSTANTIATING={},providerSuffix="Provider",path=[],loadedModules=new HashMap,providerCache={$provide:{provider:supportObject(provider),factory:supportObject(factory),service:supportObject(service),value:supportObject(value),constant:supportObject(constant),decorator:decorator}},providerInjector=providerCache.$injector=createInternalInjector(providerCache,function(){throw $injectorMinErr("unpr","Unknown provider: {0}",path.join(" <- "))}),instanceCache={},instanceInjector=instanceCache.$injector=createInternalInjector(instanceCache,function(servicename){var provider=providerInjector.get(servicename+providerSuffix);return instanceInjector.invoke(provider.$get,provider)});forEach(loadModules(modulesToLoad),function(fn){instanceInjector.invoke(fn||noop)});return instanceInjector;function supportObject(delegate){return function(key,value){if(isObject(key)){forEach(key,reverseParams(delegate))}else{return delegate(key,value)}}}function provider(name,provider_){assertNotHasOwnProperty(name,"service");if(isFunction(provider_)||isArray(provider_)){provider_=providerInjector.instantiate(provider_)}if(!provider_.$get){throw $injectorMinErr("pget","Provider '{0}' must define $get factory method.",name)}return providerCache[name+providerSuffix]=provider_}function factory(name,factoryFn){return provider(name,{$get:factoryFn})}function service(name,constructor){return factory(name,["$injector",function($injector){return $injector.instantiate(constructor)}])}function value(name,val){return factory(name,valueFn(val))}function constant(name,value){assertNotHasOwnProperty(name,"constant");providerCache[name]=value;instanceCache[name]=value}function decorator(serviceName,decorFn){var origProvider=providerInjector.get(serviceName+providerSuffix),orig$get=origProvider.$get;origProvider.$get=function(){var origInstance=instanceInjector.invoke(orig$get,origProvider);return instanceInjector.invoke(decorFn,null,{$delegate:origInstance})}}function loadModules(modulesToLoad){var runBlocks=[],moduleFn,invokeQueue,i,ii;forEach(modulesToLoad,function(module){if(loadedModules.get(module))return;loadedModules.put(module,true);try{if(isString(module)){moduleFn=angularModule(module);runBlocks=runBlocks.concat(loadModules(moduleFn.requires)).concat(moduleFn._runBlocks);for(invokeQueue=moduleFn._invokeQueue,i=0,ii=invokeQueue.length;i<ii;i++){var invokeArgs=invokeQueue[i],provider=providerInjector.get(invokeArgs[0]);provider[invokeArgs[1]].apply(provider,invokeArgs[2])}}else if(isFunction(module)){runBlocks.push(providerInjector.invoke(module))}else if(isArray(module)){runBlocks.push(providerInjector.invoke(module))}else{assertArgFn(module,"module")}}catch(e){if(isArray(module)){module=module[module.length-1]}if(e.message&&e.stack&&e.stack.indexOf(e.message)==-1){e=e.message+"\n"+e.stack}throw $injectorMinErr("modulerr","Failed to instantiate module {0} due to:\n{1}",module,e.stack||e.message||e)}});return runBlocks}function createInternalInjector(cache,factory){function getService(serviceName){if(cache.hasOwnProperty(serviceName)){if(cache[serviceName]===INSTANTIATING){throw $injectorMinErr("cdep","Circular dependency found: {0}",path.join(" <- "))}return cache[serviceName]}else{try{path.unshift(serviceName);cache[serviceName]=INSTANTIATING;return cache[serviceName]=factory(serviceName)}finally{path.shift()}}}function invoke(fn,self,locals){var args=[],$inject=annotate(fn),length,i,key;for(i=0,length=$inject.length;i<length;i++){key=$inject[i];if(typeof key!=="string"){throw $injectorMinErr("itkn","Incorrect injection token! Expected service name as string, got {0}",key)}args.push(locals&&locals.hasOwnProperty(key)?locals[key]:getService(key))}if(!fn.$inject){fn=fn[length]}return fn.apply(self,args)}function instantiate(Type,locals){var Constructor=function(){},instance,returnedValue;Constructor.prototype=(isArray(Type)?Type[Type.length-1]:Type).prototype;instance=new Constructor;returnedValue=invoke(Type,instance,locals);return isObject(returnedValue)||isFunction(returnedValue)?returnedValue:instance}return{invoke:invoke,instantiate:instantiate,get:getService,annotate:annotate,has:function(name){return providerCache.hasOwnProperty(name+providerSuffix)||cache.hasOwnProperty(name)}}}}function $AnchorScrollProvider(){var autoScrollingEnabled=true;this.disableAutoScrolling=function(){autoScrollingEnabled=false};this.$get=["$window","$location","$rootScope",function($window,$location,$rootScope){var document=$window.document;function getFirstAnchor(list){var result=null;forEach(list,function(element){if(!result&&lowercase(element.nodeName)==="a")result=element});return result}function scroll(){var hash=$location.hash(),elm;if(!hash)$window.scrollTo(0,0);else if(elm=document.getElementById(hash))elm.scrollIntoView();else if(elm=getFirstAnchor(document.getElementsByName(hash)))elm.scrollIntoView();else if(hash==="top")$window.scrollTo(0,0)}if(autoScrollingEnabled){$rootScope.$watch(function autoScrollWatch(){return $location.hash()},function autoScrollWatchAction(){$rootScope.$evalAsync(scroll)})}return scroll}]}var $animateMinErr=minErr("$animate");var $AnimateProvider=["$provide",function($provide){this.$$selectors={};this.register=function(name,factory){var key=name+"-animation";if(name&&name.charAt(0)!=".")throw $animateMinErr("notcsel","Expecting class selector starting with '.' got '{0}'.",name);this.$$selectors[name.substr(1)]=key;$provide.factory(key,factory)};this.classNameFilter=function(expression){if(arguments.length===1){this.$$classNameFilter=expression instanceof RegExp?expression:null}return this.$$classNameFilter};this.$get=["$timeout",function($timeout){return{enter:function(element,parent,after,done){if(after){after.after(element)}else{if(!parent||!parent[0]){parent=after.parent()}parent.append(element)}done&&$timeout(done,0,false)},leave:function(element,done){element.remove();done&&$timeout(done,0,false)},move:function(element,parent,after,done){this.enter(element,parent,after,done)},addClass:function(element,className,done){className=isString(className)?className:isArray(className)?className.join(" "):"";forEach(element,function(element){jqLiteAddClass(element,className)});done&&$timeout(done,0,false)},removeClass:function(element,className,done){className=isString(className)?className:isArray(className)?className.join(" "):"";forEach(element,function(element){jqLiteRemoveClass(element,className)});done&&$timeout(done,0,false)},enabled:noop}}]}];function Browser(window,document,$log,$sniffer){var self=this,rawDocument=document[0],location=window.location,history=window.history,setTimeout=window.setTimeout,clearTimeout=window.clearTimeout,pendingDeferIds={};self.isMock=false;var outstandingRequestCount=0;var outstandingRequestCallbacks=[];self.$$completeOutstandingRequest=completeOutstandingRequest;self.$$incOutstandingRequestCount=function(){outstandingRequestCount++};function completeOutstandingRequest(fn){try{fn.apply(null,sliceArgs(arguments,1))}finally{outstandingRequestCount--;if(outstandingRequestCount===0){while(outstandingRequestCallbacks.length){try{outstandingRequestCallbacks.pop()()}catch(e){$log.error(e)}}}}}self.notifyWhenNoOutstandingRequests=function(callback){forEach(pollFns,function(pollFn){pollFn()});if(outstandingRequestCount===0){callback()}else{outstandingRequestCallbacks.push(callback)}};var pollFns=[],pollTimeout;self.addPollFn=function(fn){if(isUndefined(pollTimeout))startPoller(100,setTimeout);pollFns.push(fn);return fn};function startPoller(interval,setTimeout){(function check(){forEach(pollFns,function(pollFn){pollFn()});pollTimeout=setTimeout(check,interval)})()}var lastBrowserUrl=location.href,baseElement=document.find("base"),newLocation=null;self.url=function(url,replace){if(location!==window.location)location=window.location;if(url){if(lastBrowserUrl==url)return;lastBrowserUrl=url;if($sniffer.history){if(replace)history.replaceState(null,"",url);else{history.pushState(null,"",url);baseElement.attr("href",baseElement.attr("href"))}}else{newLocation=url;if(replace){location.replace(url)}else{location.href=url}}return self}else{return newLocation||location.href.replace(/%27/g,"'")}};var urlChangeListeners=[],urlChangeInit=false;function fireUrlChange(){newLocation=null;if(lastBrowserUrl==self.url())return;lastBrowserUrl=self.url();forEach(urlChangeListeners,function(listener){listener(self.url())})}self.onUrlChange=function(callback){if(!urlChangeInit){if($sniffer.history)jqLite(window).on("popstate",fireUrlChange);if($sniffer.hashchange)jqLite(window).on("hashchange",fireUrlChange);else self.addPollFn(fireUrlChange);urlChangeInit=true}urlChangeListeners.push(callback);return callback};self.baseHref=function(){var href=baseElement.attr("href");return href?href.replace(/^https?\:\/\/[^\/]*/,""):""};var lastCookies={};var lastCookieString="";var cookiePath=self.baseHref();self.cookies=function(name,value){var cookieLength,cookieArray,cookie,i,index;if(name){if(value===undefined){rawDocument.cookie=escape(name)+"=;path="+cookiePath+";expires=Thu, 01 Jan 1970 00:00:00 GMT"}else{if(isString(value)){cookieLength=(rawDocument.cookie=escape(name)+"="+escape(value)+";path="+cookiePath).length+1;if(cookieLength>4096){$log.warn("Cookie '"+name+"' possibly not set or overflowed because it was too large ("+cookieLength+" > 4096 bytes)!")}}}}else{if(rawDocument.cookie!==lastCookieString){lastCookieString=rawDocument.cookie;cookieArray=lastCookieString.split("; ");lastCookies={};for(i=0;i<cookieArray.length;i++){cookie=cookieArray[i];index=cookie.indexOf("=");if(index>0){name=unescape(cookie.substring(0,index));if(lastCookies[name]===undefined){lastCookies[name]=unescape(cookie.substring(index+1))}}}}return lastCookies}};self.defer=function(fn,delay){var timeoutId;outstandingRequestCount++;timeoutId=setTimeout(function(){delete pendingDeferIds[timeoutId];completeOutstandingRequest(fn)},delay||0);pendingDeferIds[timeoutId]=true;return timeoutId};self.defer.cancel=function(deferId){if(pendingDeferIds[deferId]){delete pendingDeferIds[deferId];clearTimeout(deferId);completeOutstandingRequest(noop);return true}return false}}function $BrowserProvider(){this.$get=["$window","$log","$sniffer","$document",function($window,$log,$sniffer,$document){return new Browser($window,$document,$log,$sniffer)}]}function $CacheFactoryProvider(){this.$get=function(){var caches={};function cacheFactory(cacheId,options){if(cacheId in caches){throw minErr("$cacheFactory")("iid","CacheId '{0}' is already taken!",cacheId)}var size=0,stats=extend({},options,{id:cacheId}),data={},capacity=options&&options.capacity||Number.MAX_VALUE,lruHash={},freshEnd=null,staleEnd=null;return caches[cacheId]={put:function(key,value){var lruEntry=lruHash[key]||(lruHash[key]={key:key});refresh(lruEntry);if(isUndefined(value))return;if(!(key in data))size++;data[key]=value;if(size>capacity){this.remove(staleEnd.key)}return value},get:function(key){var lruEntry=lruHash[key];if(!lruEntry)return;refresh(lruEntry);return data[key]},remove:function(key){var lruEntry=lruHash[key];if(!lruEntry)return;if(lruEntry==freshEnd)freshEnd=lruEntry.p;if(lruEntry==staleEnd)staleEnd=lruEntry.n;link(lruEntry.n,lruEntry.p);delete lruHash[key];delete data[key];size--},removeAll:function(){data={};size=0;lruHash={};freshEnd=staleEnd=null},destroy:function(){data=null;stats=null;lruHash=null;delete caches[cacheId]},info:function(){return extend({},stats,{size:size})}};function refresh(entry){if(entry!=freshEnd){if(!staleEnd){staleEnd=entry}else if(staleEnd==entry){staleEnd=entry.n}link(entry.n,entry.p);link(entry,freshEnd);freshEnd=entry;freshEnd.n=null}}function link(nextEntry,prevEntry){if(nextEntry!=prevEntry){if(nextEntry)nextEntry.p=prevEntry;if(prevEntry)prevEntry.n=nextEntry}}}cacheFactory.info=function(){var info={};forEach(caches,function(cache,cacheId){info[cacheId]=cache.info()});return info};cacheFactory.get=function(cacheId){return caches[cacheId]};return cacheFactory}}function $TemplateCacheProvider(){this.$get=["$cacheFactory",function($cacheFactory){return $cacheFactory("templates")}]}var $compileMinErr=minErr("$compile");$CompileProvider.$inject=["$provide","$$sanitizeUriProvider"];function $CompileProvider($provide,$$sanitizeUriProvider){var hasDirectives={},Suffix="Directive",COMMENT_DIRECTIVE_REGEXP=/^\s*directive\:\s*([\d\w\-_]+)\s+(.*)$/,CLASS_DIRECTIVE_REGEXP=/(([\d\w\-_]+)(?:\:([^;]+))?;?)/;var EVENT_HANDLER_ATTR_REGEXP=/^(on[a-z]+|formaction)$/;this.directive=function registerDirective(name,directiveFactory){assertNotHasOwnProperty(name,"directive");if(isString(name)){assertArg(directiveFactory,"directiveFactory");if(!hasDirectives.hasOwnProperty(name)){hasDirectives[name]=[];$provide.factory(name+Suffix,["$injector","$exceptionHandler",function($injector,$exceptionHandler){var directives=[];forEach(hasDirectives[name],function(directiveFactory,index){try{var directive=$injector.invoke(directiveFactory);if(isFunction(directive)){directive={compile:valueFn(directive)}}else if(!directive.compile&&directive.link){directive.compile=valueFn(directive.link)}directive.priority=directive.priority||0;directive.index=index;directive.name=directive.name||name;directive.require=directive.require||directive.controller&&directive.name;directive.restrict=directive.restrict||"A";directives.push(directive)}catch(e){$exceptionHandler(e)}});return directives}])}hasDirectives[name].push(directiveFactory)}else{forEach(name,reverseParams(registerDirective))}return this};this.aHrefSanitizationWhitelist=function(regexp){if(isDefined(regexp)){$$sanitizeUriProvider.aHrefSanitizationWhitelist(regexp);return this}else{return $$sanitizeUriProvider.aHrefSanitizationWhitelist()}};this.imgSrcSanitizationWhitelist=function(regexp){if(isDefined(regexp)){$$sanitizeUriProvider.imgSrcSanitizationWhitelist(regexp);return this}else{return $$sanitizeUriProvider.imgSrcSanitizationWhitelist()}};this.$get=["$injector","$interpolate","$exceptionHandler","$http","$templateCache","$parse","$controller","$rootScope","$document","$sce","$animate","$$sanitizeUri",function($injector,$interpolate,$exceptionHandler,$http,$templateCache,$parse,$controller,$rootScope,$document,$sce,$animate,$$sanitizeUri){var Attributes=function(element,attr){this.$$element=element;this.$attr=attr||{}};Attributes.prototype={$normalize:directiveNormalize,$addClass:function(classVal){if(classVal&&classVal.length>0){$animate.addClass(this.$$element,classVal)}},$removeClass:function(classVal){if(classVal&&classVal.length>0){$animate.removeClass(this.$$element,classVal)}},$updateClass:function(newClasses,oldClasses){this.$removeClass(tokenDifference(oldClasses,newClasses));this.$addClass(tokenDifference(newClasses,oldClasses))},$set:function(key,value,writeAttr,attrName){var booleanKey=getBooleanAttrName(this.$$element[0],key),normalizedVal,nodeName;if(booleanKey){this.$$element.prop(key,value);attrName=booleanKey}this[key]=value;if(attrName){this.$attr[key]=attrName}else{attrName=this.$attr[key];if(!attrName){this.$attr[key]=attrName=snake_case(key,"-")}}nodeName=nodeName_(this.$$element);if(nodeName==="A"&&key==="href"||nodeName==="IMG"&&key==="src"){this[key]=value=$$sanitizeUri(value,key==="src")}if(writeAttr!==false){if(value===null||value===undefined){this.$$element.removeAttr(attrName)}else{this.$$element.attr(attrName,value)}}var $$observers=this.$$observers;$$observers&&forEach($$observers[key],function(fn){try{fn(value)}catch(e){$exceptionHandler(e)}})},$observe:function(key,fn){var attrs=this,$$observers=attrs.$$observers||(attrs.$$observers={}),listeners=$$observers[key]||($$observers[key]=[]);listeners.push(fn);$rootScope.$evalAsync(function(){if(!listeners.$$inter){fn(attrs[key])}});return fn}};var startSymbol=$interpolate.startSymbol(),endSymbol=$interpolate.endSymbol(),denormalizeTemplate=startSymbol=="{{"||endSymbol=="}}"?identity:function denormalizeTemplate(template){return template.replace(/\{\{/g,startSymbol).replace(/}}/g,endSymbol)},NG_ATTR_BINDING=/^ngAttr[A-Z]/;return compile;function compile($compileNodes,transcludeFn,maxPriority,ignoreDirective,previousCompileContext){if(!($compileNodes instanceof jqLite)){$compileNodes=jqLite($compileNodes)}forEach($compileNodes,function(node,index){if(node.nodeType==3&&node.nodeValue.match(/\S+/)){$compileNodes[index]=node=jqLite(node).wrap("<span></span>").parent()[0]}});var compositeLinkFn=compileNodes($compileNodes,transcludeFn,$compileNodes,maxPriority,ignoreDirective,previousCompileContext);safeAddClass($compileNodes,"ng-scope");return function publicLinkFn(scope,cloneConnectFn,transcludeControllers){assertArg(scope,"scope");var $linkNode=cloneConnectFn?JQLitePrototype.clone.call($compileNodes):$compileNodes;forEach(transcludeControllers,function(instance,name){$linkNode.data("$"+name+"Controller",instance)});for(var i=0,ii=$linkNode.length;i<ii;i++){var node=$linkNode[i],nodeType=node.nodeType;if(nodeType===1||nodeType===9){$linkNode.eq(i).data("$scope",scope)}}if(cloneConnectFn)cloneConnectFn($linkNode,scope);if(compositeLinkFn)compositeLinkFn(scope,$linkNode,$linkNode);return $linkNode}}function safeAddClass($element,className){try{$element.addClass(className)}catch(e){}}function compileNodes(nodeList,transcludeFn,$rootElement,maxPriority,ignoreDirective,previousCompileContext){var linkFns=[],attrs,directives,nodeLinkFn,childNodes,childLinkFn,linkFnFound;for(var i=0;i<nodeList.length;i++){attrs=new Attributes;directives=collectDirectives(nodeList[i],[],attrs,i===0?maxPriority:undefined,ignoreDirective);nodeLinkFn=directives.length?applyDirectivesToNode(directives,nodeList[i],attrs,transcludeFn,$rootElement,null,[],[],previousCompileContext):null;if(nodeLinkFn&&nodeLinkFn.scope){safeAddClass(jqLite(nodeList[i]),"ng-scope")}childLinkFn=nodeLinkFn&&nodeLinkFn.terminal||!(childNodes=nodeList[i].childNodes)||!childNodes.length?null:compileNodes(childNodes,nodeLinkFn?nodeLinkFn.transclude:transcludeFn);linkFns.push(nodeLinkFn,childLinkFn);linkFnFound=linkFnFound||nodeLinkFn||childLinkFn;previousCompileContext=null}return linkFnFound?compositeLinkFn:null;function compositeLinkFn(scope,nodeList,$rootElement,boundTranscludeFn){var nodeLinkFn,childLinkFn,node,$node,childScope,childTranscludeFn,i,ii,n;var nodeListLength=nodeList.length,stableNodeList=new Array(nodeListLength);for(i=0;i<nodeListLength;i++){stableNodeList[i]=nodeList[i]}for(i=0,n=0,ii=linkFns.length;i<ii;n++){node=stableNodeList[n];nodeLinkFn=linkFns[i++];childLinkFn=linkFns[i++];$node=jqLite(node);if(nodeLinkFn){if(nodeLinkFn.scope){childScope=scope.$new();$node.data("$scope",childScope)}else{childScope=scope}childTranscludeFn=nodeLinkFn.transclude;if(childTranscludeFn||!boundTranscludeFn&&transcludeFn){nodeLinkFn(childLinkFn,childScope,node,$rootElement,createBoundTranscludeFn(scope,childTranscludeFn||transcludeFn))}else{nodeLinkFn(childLinkFn,childScope,node,$rootElement,boundTranscludeFn)}}else if(childLinkFn){childLinkFn(scope,node.childNodes,undefined,boundTranscludeFn)}}}}function createBoundTranscludeFn(scope,transcludeFn){return function boundTranscludeFn(transcludedScope,cloneFn,controllers){var scopeCreated=false;if(!transcludedScope){transcludedScope=scope.$new();transcludedScope.$$transcluded=true;scopeCreated=true}var clone=transcludeFn(transcludedScope,cloneFn,controllers);if(scopeCreated){clone.on("$destroy",bind(transcludedScope,transcludedScope.$destroy))}return clone}}function collectDirectives(node,directives,attrs,maxPriority,ignoreDirective){var nodeType=node.nodeType,attrsMap=attrs.$attr,match,className;switch(nodeType){case 1:addDirective(directives,directiveNormalize(nodeName_(node).toLowerCase()),"E",maxPriority,ignoreDirective);for(var attr,name,nName,ngAttrName,value,nAttrs=node.attributes,j=0,jj=nAttrs&&nAttrs.length;j<jj;j++){var attrStartName=false;var attrEndName=false;attr=nAttrs[j];if(!msie||msie>=8||attr.specified){name=attr.name;ngAttrName=directiveNormalize(name);if(NG_ATTR_BINDING.test(ngAttrName)){name=snake_case(ngAttrName.substr(6),"-")}var directiveNName=ngAttrName.replace(/(Start|End)$/,"");if(ngAttrName===directiveNName+"Start"){attrStartName=name;attrEndName=name.substr(0,name.length-5)+"end";name=name.substr(0,name.length-6)}nName=directiveNormalize(name.toLowerCase());attrsMap[nName]=name;attrs[nName]=value=trim(attr.value);if(getBooleanAttrName(node,nName)){attrs[nName]=true}addAttrInterpolateDirective(node,directives,value,nName);addDirective(directives,nName,"A",maxPriority,ignoreDirective,attrStartName,attrEndName)}}className=node.className;if(isString(className)&&className!==""){while(match=CLASS_DIRECTIVE_REGEXP.exec(className)){nName=directiveNormalize(match[2]);if(addDirective(directives,nName,"C",maxPriority,ignoreDirective)){attrs[nName]=trim(match[3])}className=className.substr(match.index+match[0].length)}}break;case 3:addTextInterpolateDirective(directives,node.nodeValue);break;case 8:try{match=COMMENT_DIRECTIVE_REGEXP.exec(node.nodeValue);if(match){nName=directiveNormalize(match[1]);if(addDirective(directives,nName,"M",maxPriority,ignoreDirective)){attrs[nName]=trim(match[2])}}}catch(e){}break}directives.sort(byPriority);return directives}function groupScan(node,attrStart,attrEnd){var nodes=[];var depth=0;if(attrStart&&node.hasAttribute&&node.hasAttribute(attrStart)){var startNode=node;do{if(!node){throw $compileMinErr("uterdir","Unterminated attribute, found '{0}' but no matching '{1}' found.",attrStart,attrEnd)}if(node.nodeType==1){if(node.hasAttribute(attrStart))depth++;if(node.hasAttribute(attrEnd))depth--}nodes.push(node);node=node.nextSibling}while(depth>0)}else{nodes.push(node)}return jqLite(nodes)}function groupElementsLinkFnWrapper(linkFn,attrStart,attrEnd){return function(scope,element,attrs,controllers,transcludeFn){element=groupScan(element[0],attrStart,attrEnd);return linkFn(scope,element,attrs,controllers,transcludeFn)}}function applyDirectivesToNode(directives,compileNode,templateAttrs,transcludeFn,jqCollection,originalReplaceDirective,preLinkFns,postLinkFns,previousCompileContext){previousCompileContext=previousCompileContext||{};var terminalPriority=-Number.MAX_VALUE,newScopeDirective,controllerDirectives=previousCompileContext.controllerDirectives,newIsolateScopeDirective=previousCompileContext.newIsolateScopeDirective,templateDirective=previousCompileContext.templateDirective,nonTlbTranscludeDirective=previousCompileContext.nonTlbTranscludeDirective,hasTranscludeDirective=false,hasElementTranscludeDirective=false,$compileNode=templateAttrs.$$element=jqLite(compileNode),directive,directiveName,$template,replaceDirective=originalReplaceDirective,childTranscludeFn=transcludeFn,linkFn,directiveValue;for(var i=0,ii=directives.length;i<ii;i++){directive=directives[i];
var attrStart=directive.$$start;var attrEnd=directive.$$end;if(attrStart){$compileNode=groupScan(compileNode,attrStart,attrEnd)}$template=undefined;if(terminalPriority>directive.priority){break}if(directiveValue=directive.scope){newScopeDirective=newScopeDirective||directive;if(!directive.templateUrl){assertNoDuplicate("new/isolated scope",newIsolateScopeDirective,directive,$compileNode);if(isObject(directiveValue)){newIsolateScopeDirective=directive}}}directiveName=directive.name;if(!directive.templateUrl&&directive.controller){directiveValue=directive.controller;controllerDirectives=controllerDirectives||{};assertNoDuplicate("'"+directiveName+"' controller",controllerDirectives[directiveName],directive,$compileNode);controllerDirectives[directiveName]=directive}if(directiveValue=directive.transclude){hasTranscludeDirective=true;if(!directive.$$tlb){assertNoDuplicate("transclusion",nonTlbTranscludeDirective,directive,$compileNode);nonTlbTranscludeDirective=directive}if(directiveValue=="element"){hasElementTranscludeDirective=true;terminalPriority=directive.priority;$template=groupScan(compileNode,attrStart,attrEnd);$compileNode=templateAttrs.$$element=jqLite(document.createComment(" "+directiveName+": "+templateAttrs[directiveName]+" "));compileNode=$compileNode[0];replaceWith(jqCollection,jqLite(sliceArgs($template)),compileNode);childTranscludeFn=compile($template,transcludeFn,terminalPriority,replaceDirective&&replaceDirective.name,{nonTlbTranscludeDirective:nonTlbTranscludeDirective})}else{$template=jqLite(jqLiteClone(compileNode)).contents();$compileNode.empty();childTranscludeFn=compile($template,transcludeFn)}}if(directive.template){assertNoDuplicate("template",templateDirective,directive,$compileNode);templateDirective=directive;directiveValue=isFunction(directive.template)?directive.template($compileNode,templateAttrs):directive.template;directiveValue=denormalizeTemplate(directiveValue);if(directive.replace){replaceDirective=directive;$template=jqLite("<div>"+trim(directiveValue)+"</div>").contents();compileNode=$template[0];if($template.length!=1||compileNode.nodeType!==1){throw $compileMinErr("tplrt","Template for directive '{0}' must have exactly one root element. {1}",directiveName,"")}replaceWith(jqCollection,$compileNode,compileNode);var newTemplateAttrs={$attr:{}};var templateDirectives=collectDirectives(compileNode,[],newTemplateAttrs);var unprocessedDirectives=directives.splice(i+1,directives.length-(i+1));if(newIsolateScopeDirective){markDirectivesAsIsolate(templateDirectives)}directives=directives.concat(templateDirectives).concat(unprocessedDirectives);mergeTemplateAttributes(templateAttrs,newTemplateAttrs);ii=directives.length}else{$compileNode.html(directiveValue)}}if(directive.templateUrl){assertNoDuplicate("template",templateDirective,directive,$compileNode);templateDirective=directive;if(directive.replace){replaceDirective=directive}nodeLinkFn=compileTemplateUrl(directives.splice(i,directives.length-i),$compileNode,templateAttrs,jqCollection,childTranscludeFn,preLinkFns,postLinkFns,{controllerDirectives:controllerDirectives,newIsolateScopeDirective:newIsolateScopeDirective,templateDirective:templateDirective,nonTlbTranscludeDirective:nonTlbTranscludeDirective});ii=directives.length}else if(directive.compile){try{linkFn=directive.compile($compileNode,templateAttrs,childTranscludeFn);if(isFunction(linkFn)){addLinkFns(null,linkFn,attrStart,attrEnd)}else if(linkFn){addLinkFns(linkFn.pre,linkFn.post,attrStart,attrEnd)}}catch(e){$exceptionHandler(e,startingTag($compileNode))}}if(directive.terminal){nodeLinkFn.terminal=true;terminalPriority=Math.max(terminalPriority,directive.priority)}}nodeLinkFn.scope=newScopeDirective&&newScopeDirective.scope===true;nodeLinkFn.transclude=hasTranscludeDirective&&childTranscludeFn;return nodeLinkFn;function addLinkFns(pre,post,attrStart,attrEnd){if(pre){if(attrStart)pre=groupElementsLinkFnWrapper(pre,attrStart,attrEnd);pre.require=directive.require;if(newIsolateScopeDirective===directive||directive.$$isolateScope){pre=cloneAndAnnotateFn(pre,{isolateScope:true})}preLinkFns.push(pre)}if(post){if(attrStart)post=groupElementsLinkFnWrapper(post,attrStart,attrEnd);post.require=directive.require;if(newIsolateScopeDirective===directive||directive.$$isolateScope){post=cloneAndAnnotateFn(post,{isolateScope:true})}postLinkFns.push(post)}}function getControllers(require,$element,elementControllers){var value,retrievalMethod="data",optional=false;if(isString(require)){while((value=require.charAt(0))=="^"||value=="?"){require=require.substr(1);if(value=="^"){retrievalMethod="inheritedData"}optional=optional||value=="?"}value=null;if(elementControllers&&retrievalMethod==="data"){value=elementControllers[require]}value=value||$element[retrievalMethod]("$"+require+"Controller");if(!value&&!optional){throw $compileMinErr("ctreq","Controller '{0}', required by directive '{1}', can't be found!",require,directiveName)}return value}else if(isArray(require)){value=[];forEach(require,function(require){value.push(getControllers(require,$element,elementControllers))})}return value}function nodeLinkFn(childLinkFn,scope,linkNode,$rootElement,boundTranscludeFn){var attrs,$element,i,ii,linkFn,controller,isolateScope,elementControllers={},transcludeFn;if(compileNode===linkNode){attrs=templateAttrs}else{attrs=shallowCopy(templateAttrs,new Attributes(jqLite(linkNode),templateAttrs.$attr))}$element=attrs.$$element;if(newIsolateScopeDirective){var LOCAL_REGEXP=/^\s*([@=&])(\??)\s*(\w*)\s*$/;var $linkNode=jqLite(linkNode);isolateScope=scope.$new(true);if(templateDirective&&templateDirective===newIsolateScopeDirective.$$originalDirective){$linkNode.data("$isolateScope",isolateScope)}else{$linkNode.data("$isolateScopeNoTemplate",isolateScope)}safeAddClass($linkNode,"ng-isolate-scope");forEach(newIsolateScopeDirective.scope,function(definition,scopeName){var match=definition.match(LOCAL_REGEXP)||[],attrName=match[3]||scopeName,optional=match[2]=="?",mode=match[1],lastValue,parentGet,parentSet,compare;isolateScope.$$isolateBindings[scopeName]=mode+attrName;switch(mode){case"@":attrs.$observe(attrName,function(value){isolateScope[scopeName]=value});attrs.$$observers[attrName].$$scope=scope;if(attrs[attrName]){isolateScope[scopeName]=$interpolate(attrs[attrName])(scope)}break;case"=":if(optional&&!attrs[attrName]){return}parentGet=$parse(attrs[attrName]);if(parentGet.literal){compare=equals}else{compare=function(a,b){return a===b}}parentSet=parentGet.assign||function(){lastValue=isolateScope[scopeName]=parentGet(scope);throw $compileMinErr("nonassign","Expression '{0}' used with directive '{1}' is non-assignable!",attrs[attrName],newIsolateScopeDirective.name)};lastValue=isolateScope[scopeName]=parentGet(scope);isolateScope.$watch(function parentValueWatch(){var parentValue=parentGet(scope);if(!compare(parentValue,isolateScope[scopeName])){if(!compare(parentValue,lastValue)){isolateScope[scopeName]=parentValue}else{parentSet(scope,parentValue=isolateScope[scopeName])}}return lastValue=parentValue},null,parentGet.literal);break;case"&":parentGet=$parse(attrs[attrName]);isolateScope[scopeName]=function(locals){return parentGet(scope,locals)};break;default:throw $compileMinErr("iscp","Invalid isolate scope definition for directive '{0}'."+" Definition: {... {1}: '{2}' ...}",newIsolateScopeDirective.name,scopeName,definition)}})}transcludeFn=boundTranscludeFn&&controllersBoundTransclude;if(controllerDirectives){forEach(controllerDirectives,function(directive){var locals={$scope:directive===newIsolateScopeDirective||directive.$$isolateScope?isolateScope:scope,$element:$element,$attrs:attrs,$transclude:transcludeFn},controllerInstance;controller=directive.controller;if(controller=="@"){controller=attrs[directive.name]}controllerInstance=$controller(controller,locals);elementControllers[directive.name]=controllerInstance;if(!hasElementTranscludeDirective){$element.data("$"+directive.name+"Controller",controllerInstance)}if(directive.controllerAs){locals.$scope[directive.controllerAs]=controllerInstance}})}for(i=0,ii=preLinkFns.length;i<ii;i++){try{linkFn=preLinkFns[i];linkFn(linkFn.isolateScope?isolateScope:scope,$element,attrs,linkFn.require&&getControllers(linkFn.require,$element,elementControllers),transcludeFn)}catch(e){$exceptionHandler(e,startingTag($element))}}var scopeToChild=scope;if(newIsolateScopeDirective&&(newIsolateScopeDirective.template||newIsolateScopeDirective.templateUrl===null)){scopeToChild=isolateScope}childLinkFn&&childLinkFn(scopeToChild,linkNode.childNodes,undefined,boundTranscludeFn);for(i=postLinkFns.length-1;i>=0;i--){try{linkFn=postLinkFns[i];linkFn(linkFn.isolateScope?isolateScope:scope,$element,attrs,linkFn.require&&getControllers(linkFn.require,$element,elementControllers),transcludeFn)}catch(e){$exceptionHandler(e,startingTag($element))}}function controllersBoundTransclude(scope,cloneAttachFn){var transcludeControllers;if(arguments.length<2){cloneAttachFn=scope;scope=undefined}if(hasElementTranscludeDirective){transcludeControllers=elementControllers}return boundTranscludeFn(scope,cloneAttachFn,transcludeControllers)}}}function markDirectivesAsIsolate(directives){for(var j=0,jj=directives.length;j<jj;j++){directives[j]=inherit(directives[j],{$$isolateScope:true})}}function addDirective(tDirectives,name,location,maxPriority,ignoreDirective,startAttrName,endAttrName){if(name===ignoreDirective)return null;var match=null;if(hasDirectives.hasOwnProperty(name)){for(var directive,directives=$injector.get(name+Suffix),i=0,ii=directives.length;i<ii;i++){try{directive=directives[i];if((maxPriority===undefined||maxPriority>directive.priority)&&directive.restrict.indexOf(location)!=-1){if(startAttrName){directive=inherit(directive,{$$start:startAttrName,$$end:endAttrName})}tDirectives.push(directive);match=directive}}catch(e){$exceptionHandler(e)}}}return match}function mergeTemplateAttributes(dst,src){var srcAttr=src.$attr,dstAttr=dst.$attr,$element=dst.$$element;forEach(dst,function(value,key){if(key.charAt(0)!="$"){if(src[key]){value+=(key==="style"?";":" ")+src[key]}dst.$set(key,value,true,srcAttr[key])}});forEach(src,function(value,key){if(key=="class"){safeAddClass($element,value);dst["class"]=(dst["class"]?dst["class"]+" ":"")+value}else if(key=="style"){$element.attr("style",$element.attr("style")+";"+value);dst["style"]=(dst["style"]?dst["style"]+";":"")+value}else if(key.charAt(0)!="$"&&!dst.hasOwnProperty(key)){dst[key]=value;dstAttr[key]=srcAttr[key]}})}function compileTemplateUrl(directives,$compileNode,tAttrs,$rootElement,childTranscludeFn,preLinkFns,postLinkFns,previousCompileContext){var linkQueue=[],afterTemplateNodeLinkFn,afterTemplateChildLinkFn,beforeTemplateCompileNode=$compileNode[0],origAsyncDirective=directives.shift(),derivedSyncDirective=extend({},origAsyncDirective,{templateUrl:null,transclude:null,replace:null,$$originalDirective:origAsyncDirective}),templateUrl=isFunction(origAsyncDirective.templateUrl)?origAsyncDirective.templateUrl($compileNode,tAttrs):origAsyncDirective.templateUrl;$compileNode.empty();$http.get($sce.getTrustedResourceUrl(templateUrl),{cache:$templateCache}).success(function(content){var compileNode,tempTemplateAttrs,$template,childBoundTranscludeFn;content=denormalizeTemplate(content);if(origAsyncDirective.replace){$template=jqLite("<div>"+trim(content)+"</div>").contents();compileNode=$template[0];if($template.length!=1||compileNode.nodeType!==1){throw $compileMinErr("tplrt","Template for directive '{0}' must have exactly one root element. {1}",origAsyncDirective.name,templateUrl)}tempTemplateAttrs={$attr:{}};replaceWith($rootElement,$compileNode,compileNode);var templateDirectives=collectDirectives(compileNode,[],tempTemplateAttrs);if(isObject(origAsyncDirective.scope)){markDirectivesAsIsolate(templateDirectives)}directives=templateDirectives.concat(directives);mergeTemplateAttributes(tAttrs,tempTemplateAttrs)}else{compileNode=beforeTemplateCompileNode;$compileNode.html(content)}directives.unshift(derivedSyncDirective);afterTemplateNodeLinkFn=applyDirectivesToNode(directives,compileNode,tAttrs,childTranscludeFn,$compileNode,origAsyncDirective,preLinkFns,postLinkFns,previousCompileContext);forEach($rootElement,function(node,i){if(node==compileNode){$rootElement[i]=$compileNode[0]}});afterTemplateChildLinkFn=compileNodes($compileNode[0].childNodes,childTranscludeFn);while(linkQueue.length){var scope=linkQueue.shift(),beforeTemplateLinkNode=linkQueue.shift(),linkRootElement=linkQueue.shift(),boundTranscludeFn=linkQueue.shift(),linkNode=$compileNode[0];if(beforeTemplateLinkNode!==beforeTemplateCompileNode){linkNode=jqLiteClone(compileNode);replaceWith(linkRootElement,jqLite(beforeTemplateLinkNode),linkNode)}if(afterTemplateNodeLinkFn.transclude){childBoundTranscludeFn=createBoundTranscludeFn(scope,afterTemplateNodeLinkFn.transclude)}else{childBoundTranscludeFn=boundTranscludeFn}afterTemplateNodeLinkFn(afterTemplateChildLinkFn,scope,linkNode,$rootElement,childBoundTranscludeFn)}linkQueue=null}).error(function(response,code,headers,config){throw $compileMinErr("tpload","Failed to load template: {0}",config.url)});return function delayedNodeLinkFn(ignoreChildLinkFn,scope,node,rootElement,boundTranscludeFn){if(linkQueue){linkQueue.push(scope);linkQueue.push(node);linkQueue.push(rootElement);linkQueue.push(boundTranscludeFn)}else{afterTemplateNodeLinkFn(afterTemplateChildLinkFn,scope,node,rootElement,boundTranscludeFn)}}}function byPriority(a,b){var diff=b.priority-a.priority;if(diff!==0)return diff;if(a.name!==b.name)return a.name<b.name?-1:1;return a.index-b.index}function assertNoDuplicate(what,previousDirective,directive,element){if(previousDirective){throw $compileMinErr("multidir","Multiple directives [{0}, {1}] asking for {2} on: {3}",previousDirective.name,directive.name,what,startingTag(element))}}function addTextInterpolateDirective(directives,text){var interpolateFn=$interpolate(text,true);if(interpolateFn){directives.push({priority:0,compile:valueFn(function textInterpolateLinkFn(scope,node){var parent=node.parent(),bindings=parent.data("$binding")||[];bindings.push(interpolateFn);safeAddClass(parent.data("$binding",bindings),"ng-binding");scope.$watch(interpolateFn,function interpolateFnWatchAction(value){node[0].nodeValue=value})})})}}function getTrustedContext(node,attrNormalizedName){if(attrNormalizedName=="srcdoc"){return $sce.HTML}var tag=nodeName_(node);if(attrNormalizedName=="xlinkHref"||tag=="FORM"&&attrNormalizedName=="action"||tag!="IMG"&&(attrNormalizedName=="src"||attrNormalizedName=="ngSrc")){return $sce.RESOURCE_URL}}function addAttrInterpolateDirective(node,directives,value,name){var interpolateFn=$interpolate(value,true);if(!interpolateFn)return;if(name==="multiple"&&nodeName_(node)==="SELECT"){throw $compileMinErr("selmulti","Binding to the 'multiple' attribute is not supported. Element: {0}",startingTag(node))}directives.push({priority:100,compile:function(){return{pre:function attrInterpolatePreLinkFn(scope,element,attr){var $$observers=attr.$$observers||(attr.$$observers={});if(EVENT_HANDLER_ATTR_REGEXP.test(name)){throw $compileMinErr("nodomevents","Interpolations for HTML DOM event attributes are disallowed.  Please use the "+"ng- versions (such as ng-click instead of onclick) instead.")}interpolateFn=$interpolate(attr[name],true,getTrustedContext(node,name));if(!interpolateFn)return;attr[name]=interpolateFn(scope);($$observers[name]||($$observers[name]=[])).$$inter=true;(attr.$$observers&&attr.$$observers[name].$$scope||scope).$watch(interpolateFn,function interpolateFnWatchAction(newValue,oldValue){if(name==="class"&&newValue!=oldValue){attr.$updateClass(newValue,oldValue)}else{attr.$set(name,newValue)}})}}}})}function replaceWith($rootElement,elementsToRemove,newNode){var firstElementToRemove=elementsToRemove[0],removeCount=elementsToRemove.length,parent=firstElementToRemove.parentNode,i,ii;if($rootElement){for(i=0,ii=$rootElement.length;i<ii;i++){if($rootElement[i]==firstElementToRemove){$rootElement[i++]=newNode;for(var j=i,j2=j+removeCount-1,jj=$rootElement.length;j<jj;j++,j2++){if(j2<jj){$rootElement[j]=$rootElement[j2]}else{delete $rootElement[j]}}$rootElement.length-=removeCount-1;break}}}if(parent){parent.replaceChild(newNode,firstElementToRemove)}var fragment=document.createDocumentFragment();fragment.appendChild(firstElementToRemove);newNode[jqLite.expando]=firstElementToRemove[jqLite.expando];for(var k=1,kk=elementsToRemove.length;k<kk;k++){var element=elementsToRemove[k];jqLite(element).remove();fragment.appendChild(element);delete elementsToRemove[k]}elementsToRemove[0]=newNode;elementsToRemove.length=1}function cloneAndAnnotateFn(fn,annotation){return extend(function(){return fn.apply(null,arguments)},fn,annotation)}}]}var PREFIX_REGEXP=/^(x[\:\-_]|data[\:\-_])/i;function directiveNormalize(name){return camelCase(name.replace(PREFIX_REGEXP,""))}function nodesetLinkingFn(scope,nodeList,rootElement,boundTranscludeFn){}function directiveLinkingFn(nodesetLinkingFn,scope,node,rootElement,boundTranscludeFn){}function tokenDifference(str1,str2){var values="",tokens1=str1.split(/\s+/),tokens2=str2.split(/\s+/);outer:for(var i=0;i<tokens1.length;i++){var token=tokens1[i];for(var j=0;j<tokens2.length;j++){if(token==tokens2[j])continue outer}values+=(values.length>0?" ":"")+token}return values}function $ControllerProvider(){var controllers={},CNTRL_REG=/^(\S+)(\s+as\s+(\w+))?$/;this.register=function(name,constructor){assertNotHasOwnProperty(name,"controller");if(isObject(name)){extend(controllers,name)}else{controllers[name]=constructor}};this.$get=["$injector","$window",function($injector,$window){return function(expression,locals){var instance,match,constructor,identifier;if(isString(expression)){match=expression.match(CNTRL_REG),constructor=match[1],identifier=match[3];expression=controllers.hasOwnProperty(constructor)?controllers[constructor]:getter(locals.$scope,constructor,true)||getter($window,constructor,true);assertArgFn(expression,constructor,true)}instance=$injector.instantiate(expression,locals);if(identifier){if(!(locals&&typeof locals.$scope=="object")){throw minErr("$controller")("noscp","Cannot export controller '{0}' as '{1}'! No $scope object provided via `locals`.",constructor||expression.name,identifier)}locals.$scope[identifier]=instance}return instance}}]}function $DocumentProvider(){this.$get=["$window",function(window){return jqLite(window.document)}]}function $ExceptionHandlerProvider(){this.$get=["$log",function($log){return function(exception,cause){$log.error.apply($log,arguments)}}]}function parseHeaders(headers){var parsed={},key,val,i;if(!headers)return parsed;forEach(headers.split("\n"),function(line){i=line.indexOf(":");key=lowercase(trim(line.substr(0,i)));val=trim(line.substr(i+1));if(key){if(parsed[key]){parsed[key]+=", "+val}else{parsed[key]=val}}});return parsed}function headersGetter(headers){var headersObj=isObject(headers)?headers:undefined;return function(name){if(!headersObj)headersObj=parseHeaders(headers);if(name){return headersObj[lowercase(name)]||null}return headersObj}}function transformData(data,headers,fns){if(isFunction(fns))return fns(data,headers);forEach(fns,function(fn){data=fn(data,headers)});return data}function isSuccess(status){return 200<=status&&status<300}function $HttpProvider(){var JSON_START=/^\s*(\[|\{[^\{])/,JSON_END=/[\}\]]\s*$/,PROTECTION_PREFIX=/^\)\]\}',?\n/,CONTENT_TYPE_APPLICATION_JSON={"Content-Type":"application/json;charset=utf-8"};var defaults=this.defaults={transformResponse:[function(data){if(isString(data)){data=data.replace(PROTECTION_PREFIX,"");if(JSON_START.test(data)&&JSON_END.test(data))data=fromJson(data)}return data}],transformRequest:[function(d){return isObject(d)&&!isFile(d)?toJson(d):d}],headers:{common:{Accept:"application/json, text/plain, */*"},post:CONTENT_TYPE_APPLICATION_JSON,put:CONTENT_TYPE_APPLICATION_JSON,patch:CONTENT_TYPE_APPLICATION_JSON},xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN"};var interceptorFactories=this.interceptors=[];var responseInterceptorFactories=this.responseInterceptors=[];this.$get=["$httpBackend","$browser","$cacheFactory","$rootScope","$q","$injector",function($httpBackend,$browser,$cacheFactory,$rootScope,$q,$injector){var defaultCache=$cacheFactory("$http");var reversedInterceptors=[];forEach(interceptorFactories,function(interceptorFactory){reversedInterceptors.unshift(isString(interceptorFactory)?$injector.get(interceptorFactory):$injector.invoke(interceptorFactory))});forEach(responseInterceptorFactories,function(interceptorFactory,index){var responseFn=isString(interceptorFactory)?$injector.get(interceptorFactory):$injector.invoke(interceptorFactory);reversedInterceptors.splice(index,0,{response:function(response){return responseFn($q.when(response))},responseError:function(response){return responseFn($q.reject(response))}})});function $http(requestConfig){var config={transformRequest:defaults.transformRequest,transformResponse:defaults.transformResponse};var headers=mergeHeaders(requestConfig);extend(config,requestConfig);config.headers=headers;config.method=uppercase(config.method);var xsrfValue=urlIsSameOrigin(config.url)?$browser.cookies()[config.xsrfCookieName||defaults.xsrfCookieName]:undefined;if(xsrfValue){headers[config.xsrfHeaderName||defaults.xsrfHeaderName]=xsrfValue}var serverRequest=function(config){headers=config.headers;var reqData=transformData(config.data,headersGetter(headers),config.transformRequest);if(isUndefined(config.data)){forEach(headers,function(value,header){if(lowercase(header)==="content-type"){delete headers[header]}})}if(isUndefined(config.withCredentials)&&!isUndefined(defaults.withCredentials)){config.withCredentials=defaults.withCredentials}return sendReq(config,reqData,headers).then(transformResponse,transformResponse)};var chain=[serverRequest,undefined];var promise=$q.when(config);forEach(reversedInterceptors,function(interceptor){if(interceptor.request||interceptor.requestError){chain.unshift(interceptor.request,interceptor.requestError)}if(interceptor.response||interceptor.responseError){chain.push(interceptor.response,interceptor.responseError)}});while(chain.length){var thenFn=chain.shift();var rejectFn=chain.shift();promise=promise.then(thenFn,rejectFn)}promise.success=function(fn){promise.then(function(response){fn(response.data,response.status,response.headers,config)});return promise};promise.error=function(fn){promise.then(null,function(response){fn(response.data,response.status,response.headers,config)});return promise};return promise;function transformResponse(response){var resp=extend({},response,{data:transformData(response.data,response.headers,config.transformResponse)});return isSuccess(response.status)?resp:$q.reject(resp)}function mergeHeaders(config){var defHeaders=defaults.headers,reqHeaders=extend({},config.headers),defHeaderName,lowercaseDefHeaderName,reqHeaderName;defHeaders=extend({},defHeaders.common,defHeaders[lowercase(config.method)]);execHeaders(defHeaders);execHeaders(reqHeaders);defaultHeadersIteration:for(defHeaderName in defHeaders){lowercaseDefHeaderName=lowercase(defHeaderName);for(reqHeaderName in reqHeaders){if(lowercase(reqHeaderName)===lowercaseDefHeaderName){continue defaultHeadersIteration}}reqHeaders[defHeaderName]=defHeaders[defHeaderName]}return reqHeaders;function execHeaders(headers){var headerContent;forEach(headers,function(headerFn,header){if(isFunction(headerFn)){headerContent=headerFn();if(headerContent!=null){headers[header]=headerContent}else{delete headers[header]}}})}}}$http.pendingRequests=[];createShortMethods("get","delete","head","jsonp");createShortMethodsWithData("post","put");$http.defaults=defaults;return $http;function createShortMethods(names){forEach(arguments,function(name){$http[name]=function(url,config){return $http(extend(config||{},{method:name,url:url}))}})}function createShortMethodsWithData(name){forEach(arguments,function(name){$http[name]=function(url,data,config){return $http(extend(config||{},{method:name,url:url,data:data}))}})}function sendReq(config,reqData,reqHeaders){var deferred=$q.defer(),promise=deferred.promise,cache,cachedResp,url=buildUrl(config.url,config.params);$http.pendingRequests.push(config);promise.then(removePendingReq,removePendingReq);if((config.cache||defaults.cache)&&config.cache!==false&&config.method=="GET"){cache=isObject(config.cache)?config.cache:isObject(defaults.cache)?defaults.cache:defaultCache}if(cache){cachedResp=cache.get(url);if(isDefined(cachedResp)){if(cachedResp.then){cachedResp.then(removePendingReq,removePendingReq);return cachedResp}else{if(isArray(cachedResp)){resolvePromise(cachedResp[1],cachedResp[0],copy(cachedResp[2]))}else{resolvePromise(cachedResp,200,{})}}}else{cache.put(url,promise)}}if(isUndefined(cachedResp)){$httpBackend(config.method,url,reqData,done,reqHeaders,config.timeout,config.withCredentials,config.responseType)}return promise;function done(status,response,headersString){if(cache){if(isSuccess(status)){cache.put(url,[status,response,parseHeaders(headersString)])}else{cache.remove(url)}}resolvePromise(response,status,headersString);if(!$rootScope.$$phase)$rootScope.$apply()}function resolvePromise(response,status,headers){status=Math.max(status,0);(isSuccess(status)?deferred.resolve:deferred.reject)({data:response,status:status,headers:headersGetter(headers),config:config})}function removePendingReq(){var idx=indexOf($http.pendingRequests,config);if(idx!==-1)$http.pendingRequests.splice(idx,1)}}function buildUrl(url,params){if(!params)return url;var parts=[];forEachSorted(params,function(value,key){if(value===null||isUndefined(value))return;if(!isArray(value))value=[value];forEach(value,function(v){if(isObject(v)){v=toJson(v)}parts.push(encodeUriQuery(key)+"="+encodeUriQuery(v))})});return url+(url.indexOf("?")==-1?"?":"&")+parts.join("&")}}]}var XHR=window.XMLHttpRequest||function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e1){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e2){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e3){}throw minErr("$httpBackend")("noxhr","This browser does not support XMLHttpRequest.")};function $HttpBackendProvider(){this.$get=["$browser","$window","$document",function($browser,$window,$document){return createHttpBackend($browser,XHR,$browser.defer,$window.angular.callbacks,$document[0])}]}function createHttpBackend($browser,XHR,$browserDefer,callbacks,rawDocument){var ABORTED=-1;return function(method,url,post,callback,headers,timeout,withCredentials,responseType){var status;$browser.$$incOutstandingRequestCount();url=url||$browser.url();if(lowercase(method)=="jsonp"){var callbackId="_"+(callbacks.counter++).toString(36);callbacks[callbackId]=function(data){callbacks[callbackId].data=data};var jsonpDone=jsonpReq(url.replace("JSON_CALLBACK","angular.callbacks."+callbackId),function(){if(callbacks[callbackId].data){completeRequest(callback,200,callbacks[callbackId].data)}else{completeRequest(callback,status||-2)}delete callbacks[callbackId]})}else{var xhr=new XHR;xhr.open(method,url,true);forEach(headers,function(value,key){if(isDefined(value)){xhr.setRequestHeader(key,value)}});xhr.onreadystatechange=function(){if(xhr.readyState==4){var responseHeaders=null,response=null;if(status!==ABORTED){responseHeaders=xhr.getAllResponseHeaders();response=xhr.responseType?xhr.response:xhr.responseText}completeRequest(callback,status||xhr.status,response,responseHeaders)}};if(withCredentials){xhr.withCredentials=true}if(responseType){xhr.responseType=responseType}xhr.send(post||null)}if(timeout>0){var timeoutId=$browserDefer(timeoutRequest,timeout)}else if(timeout&&timeout.then){timeout.then(timeoutRequest)}function timeoutRequest(){status=ABORTED;jsonpDone&&jsonpDone();xhr&&xhr.abort()}function completeRequest(callback,status,response,headersString){var protocol=urlResolve(url).protocol;timeoutId&&$browserDefer.cancel(timeoutId);jsonpDone=xhr=null;status=protocol=="file"&&status===0?response?200:404:status;status=status==1223?204:status;callback(status,response,headersString);$browser.$$completeOutstandingRequest(noop)}};function jsonpReq(url,done){var script=rawDocument.createElement("script"),doneWrapper=function(){script.onreadystatechange=script.onload=script.onerror=null;rawDocument.body.removeChild(script);if(done)done()};script.type="text/javascript";script.src=url;if(msie&&msie<=8){script.onreadystatechange=function(){if(/loaded|complete/.test(script.readyState)){doneWrapper()}}}else{script.onload=script.onerror=function(){doneWrapper()}}rawDocument.body.appendChild(script);return doneWrapper}}var $interpolateMinErr=minErr("$interpolate");function $InterpolateProvider(){var startSymbol="{{";var endSymbol="}}";this.startSymbol=function(value){if(value){startSymbol=value;return this}else{return startSymbol}};this.endSymbol=function(value){if(value){endSymbol=value;return this}else{return endSymbol}};this.$get=["$parse","$exceptionHandler","$sce",function($parse,$exceptionHandler,$sce){var startSymbolLength=startSymbol.length,endSymbolLength=endSymbol.length;function $interpolate(text,mustHaveExpression,trustedContext){var startIndex,endIndex,index=0,parts=[],length=text.length,hasInterpolation=false,fn,exp,concat=[];while(index<length){if((startIndex=text.indexOf(startSymbol,index))!=-1&&(endIndex=text.indexOf(endSymbol,startIndex+startSymbolLength))!=-1){index!=startIndex&&parts.push(text.substring(index,startIndex));parts.push(fn=$parse(exp=text.substring(startIndex+startSymbolLength,endIndex)));fn.exp=exp;index=endIndex+endSymbolLength;hasInterpolation=true}else{index!=length&&parts.push(text.substring(index));index=length}}if(!(length=parts.length)){parts.push("");length=1}if(trustedContext&&parts.length>1){throw $interpolateMinErr("noconcat","Error while interpolating: {0}\nStrict Contextual Escaping disallows "+"interpolations that concatenate multiple expressions when a trusted value is "+"required.  See http://docs.angularjs.org/api/ng.$sce",text)}if(!mustHaveExpression||hasInterpolation){concat.length=length;fn=function(context){try{for(var i=0,ii=length,part;i<ii;i++){if(typeof(part=parts[i])=="function"){part=part(context);if(trustedContext){part=$sce.getTrusted(trustedContext,part)}else{part=$sce.valueOf(part)}if(part===null||isUndefined(part)){part=""}else if(typeof part!="string"){part=toJson(part)}}concat[i]=part}return concat.join("")}catch(err){var newErr=$interpolateMinErr("interr","Can't interpolate: {0}\n{1}",text,err.toString());$exceptionHandler(newErr)}};fn.exp=text;fn.parts=parts;return fn}}$interpolate.startSymbol=function(){return startSymbol};$interpolate.endSymbol=function(){return endSymbol};return $interpolate}]}function $IntervalProvider(){this.$get=["$rootScope","$window","$q",function($rootScope,$window,$q){var intervals={};function interval(fn,delay,count,invokeApply){var setInterval=$window.setInterval,clearInterval=$window.clearInterval,deferred=$q.defer(),promise=deferred.promise,iteration=0,skipApply=isDefined(invokeApply)&&!invokeApply;count=isDefined(count)?count:0,promise.then(null,null,fn);promise.$$intervalId=setInterval(function tick(){deferred.notify(iteration++);if(count>0&&iteration>=count){deferred.resolve(iteration);clearInterval(promise.$$intervalId);delete intervals[promise.$$intervalId]}if(!skipApply)$rootScope.$apply()},delay);intervals[promise.$$intervalId]=deferred;return promise}interval.cancel=function(promise){if(promise&&promise.$$intervalId in intervals){intervals[promise.$$intervalId].reject("canceled");clearInterval(promise.$$intervalId);delete intervals[promise.$$intervalId];return true}return false};return interval}]}function $LocaleProvider(){this.$get=function(){return{id:"en-us",NUMBER_FORMATS:{DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:[{minInt:1,minFrac:0,maxFrac:3,posPre:"",posSuf:"",negPre:"-",negSuf:"",gSize:3,lgSize:3},{minInt:1,minFrac:2,maxFrac:2,posPre:"¤",posSuf:"",negPre:"(¤",negSuf:")",gSize:3,lgSize:3}],CURRENCY_SYM:"$"},DATETIME_FORMATS:{MONTH:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),SHORTMONTH:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),DAY:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),SHORTDAY:"Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(","),AMPMS:["AM","PM"],medium:"MMM d, y h:mm:ss a","short":"M/d/yy h:mm a",fullDate:"EEEE, MMMM d, y",longDate:"MMMM d, y",mediumDate:"MMM d, y",shortDate:"M/d/yy",mediumTime:"h:mm:ss a",shortTime:"h:mm a"},pluralCat:function(num){if(num===1){return"one"
}return"other"}}}}var PATH_MATCH=/^([^\?#]*)(\?([^#]*))?(#(.*))?$/,DEFAULT_PORTS={http:80,https:443,ftp:21};var $locationMinErr=minErr("$location");function encodePath(path){var segments=path.split("/"),i=segments.length;while(i--){segments[i]=encodeUriSegment(segments[i])}return segments.join("/")}function parseAbsoluteUrl(absoluteUrl,locationObj,appBase){var parsedUrl=urlResolve(absoluteUrl,appBase);locationObj.$$protocol=parsedUrl.protocol;locationObj.$$host=parsedUrl.hostname;locationObj.$$port=int(parsedUrl.port)||DEFAULT_PORTS[parsedUrl.protocol]||null}function parseAppUrl(relativeUrl,locationObj,appBase){var prefixed=relativeUrl.charAt(0)!=="/";if(prefixed){relativeUrl="/"+relativeUrl}var match=urlResolve(relativeUrl,appBase);locationObj.$$path=decodeURIComponent(prefixed&&match.pathname.charAt(0)==="/"?match.pathname.substring(1):match.pathname);locationObj.$$search=parseKeyValue(match.search);locationObj.$$hash=decodeURIComponent(match.hash);if(locationObj.$$path&&locationObj.$$path.charAt(0)!="/"){locationObj.$$path="/"+locationObj.$$path}}function beginsWith(begin,whole){if(whole.indexOf(begin)===0){return whole.substr(begin.length)}}function stripHash(url){var index=url.indexOf("#");return index==-1?url:url.substr(0,index)}function stripFile(url){return url.substr(0,stripHash(url).lastIndexOf("/")+1)}function serverBase(url){return url.substring(0,url.indexOf("/",url.indexOf("//")+2))}function LocationHtml5Url(appBase,basePrefix){this.$$html5=true;basePrefix=basePrefix||"";var appBaseNoFile=stripFile(appBase);parseAbsoluteUrl(appBase,this,appBase);this.$$parse=function(url){var pathUrl=beginsWith(appBaseNoFile,url);if(!isString(pathUrl)){throw $locationMinErr("ipthprfx",'Invalid url "{0}", missing path prefix "{1}".',url,appBaseNoFile)}parseAppUrl(pathUrl,this,appBase);if(!this.$$path){this.$$path="/"}this.$$compose()};this.$$compose=function(){var search=toKeyValue(this.$$search),hash=this.$$hash?"#"+encodeUriSegment(this.$$hash):"";this.$$url=encodePath(this.$$path)+(search?"?"+search:"")+hash;this.$$absUrl=appBaseNoFile+this.$$url.substr(1)};this.$$rewrite=function(url){var appUrl,prevAppUrl;if((appUrl=beginsWith(appBase,url))!==undefined){prevAppUrl=appUrl;if((appUrl=beginsWith(basePrefix,appUrl))!==undefined){return appBaseNoFile+(beginsWith("/",appUrl)||appUrl)}else{return appBase+prevAppUrl}}else if((appUrl=beginsWith(appBaseNoFile,url))!==undefined){return appBaseNoFile+appUrl}else if(appBaseNoFile==url+"/"){return appBaseNoFile}}}function LocationHashbangUrl(appBase,hashPrefix){var appBaseNoFile=stripFile(appBase);parseAbsoluteUrl(appBase,this,appBase);this.$$parse=function(url){var withoutBaseUrl=beginsWith(appBase,url)||beginsWith(appBaseNoFile,url);var withoutHashUrl=withoutBaseUrl.charAt(0)=="#"?beginsWith(hashPrefix,withoutBaseUrl):this.$$html5?withoutBaseUrl:"";if(!isString(withoutHashUrl)){throw $locationMinErr("ihshprfx",'Invalid url "{0}", missing hash prefix "{1}".',url,hashPrefix)}parseAppUrl(withoutHashUrl,this,appBase);this.$$path=removeWindowsDriveName(this.$$path,withoutHashUrl,appBase);this.$$compose();function removeWindowsDriveName(path,url,base){var windowsFilePathExp=/^\/?.*?:(\/.*)/;var firstPathSegmentMatch;if(url.indexOf(base)===0){url=url.replace(base,"")}if(windowsFilePathExp.exec(url)){return path}firstPathSegmentMatch=windowsFilePathExp.exec(path);return firstPathSegmentMatch?firstPathSegmentMatch[1]:path}};this.$$compose=function(){var search=toKeyValue(this.$$search),hash=this.$$hash?"#"+encodeUriSegment(this.$$hash):"";this.$$url=encodePath(this.$$path)+(search?"?"+search:"")+hash;this.$$absUrl=appBase+(this.$$url?hashPrefix+this.$$url:"")};this.$$rewrite=function(url){if(stripHash(appBase)==stripHash(url)){return url}}}function LocationHashbangInHtml5Url(appBase,hashPrefix){this.$$html5=true;LocationHashbangUrl.apply(this,arguments);var appBaseNoFile=stripFile(appBase);this.$$rewrite=function(url){var appUrl;if(appBase==stripHash(url)){return url}else if(appUrl=beginsWith(appBaseNoFile,url)){return appBase+hashPrefix+appUrl}else if(appBaseNoFile===url+"/"){return appBaseNoFile}}}LocationHashbangInHtml5Url.prototype=LocationHashbangUrl.prototype=LocationHtml5Url.prototype={$$html5:false,$$replace:false,absUrl:locationGetter("$$absUrl"),url:function(url,replace){if(isUndefined(url))return this.$$url;var match=PATH_MATCH.exec(url);if(match[1])this.path(decodeURIComponent(match[1]));if(match[2]||match[1])this.search(match[3]||"");this.hash(match[5]||"",replace);return this},protocol:locationGetter("$$protocol"),host:locationGetter("$$host"),port:locationGetter("$$port"),path:locationGetterSetter("$$path",function(path){return path.charAt(0)=="/"?path:"/"+path}),search:function(search,paramValue){switch(arguments.length){case 0:return this.$$search;case 1:if(isString(search)){this.$$search=parseKeyValue(search)}else if(isObject(search)){this.$$search=search}else{throw $locationMinErr("isrcharg","The first argument of the `$location#search()` call must be a string or an object.")}break;default:if(isUndefined(paramValue)||paramValue===null){delete this.$$search[search]}else{this.$$search[search]=paramValue}}this.$$compose();return this},hash:locationGetterSetter("$$hash",identity),replace:function(){this.$$replace=true;return this}};function locationGetter(property){return function(){return this[property]}}function locationGetterSetter(property,preprocess){return function(value){if(isUndefined(value))return this[property];this[property]=preprocess(value);this.$$compose();return this}}function $LocationProvider(){var hashPrefix="",html5Mode=false;this.hashPrefix=function(prefix){if(isDefined(prefix)){hashPrefix=prefix;return this}else{return hashPrefix}};this.html5Mode=function(mode){if(isDefined(mode)){html5Mode=mode;return this}else{return html5Mode}};this.$get=["$rootScope","$browser","$sniffer","$rootElement",function($rootScope,$browser,$sniffer,$rootElement){var $location,LocationMode,baseHref=$browser.baseHref(),initialUrl=$browser.url(),appBase;if(html5Mode){appBase=serverBase(initialUrl)+(baseHref||"/");LocationMode=$sniffer.history?LocationHtml5Url:LocationHashbangInHtml5Url}else{appBase=stripHash(initialUrl);LocationMode=LocationHashbangUrl}$location=new LocationMode(appBase,"#"+hashPrefix);$location.$$parse($location.$$rewrite(initialUrl));$rootElement.on("click",function(event){if(event.ctrlKey||event.metaKey||event.which==2)return;var elm=jqLite(event.target);while(lowercase(elm[0].nodeName)!=="a"){if(elm[0]===$rootElement[0]||!(elm=elm.parent())[0])return}var absHref=elm.prop("href");if(isObject(absHref)&&absHref.toString()==="[object SVGAnimatedString]"){absHref=urlResolve(absHref.animVal).href}var rewrittenUrl=$location.$$rewrite(absHref);if(absHref&&!elm.attr("target")&&rewrittenUrl&&!event.isDefaultPrevented()){event.preventDefault();if(rewrittenUrl!=$browser.url()){$location.$$parse(rewrittenUrl);$rootScope.$apply();window.angular["ff-684208-preventDefault"]=true}}});if($location.absUrl()!=initialUrl){$browser.url($location.absUrl(),true)}$browser.onUrlChange(function(newUrl){if($location.absUrl()!=newUrl){if($rootScope.$broadcast("$locationChangeStart",newUrl,$location.absUrl()).defaultPrevented){$browser.url($location.absUrl());return}$rootScope.$evalAsync(function(){var oldUrl=$location.absUrl();$location.$$parse(newUrl);afterLocationChange(oldUrl)});if(!$rootScope.$$phase)$rootScope.$digest()}});var changeCounter=0;$rootScope.$watch(function $locationWatch(){var oldUrl=$browser.url();var currentReplace=$location.$$replace;if(!changeCounter||oldUrl!=$location.absUrl()){changeCounter++;$rootScope.$evalAsync(function(){if($rootScope.$broadcast("$locationChangeStart",$location.absUrl(),oldUrl).defaultPrevented){$location.$$parse(oldUrl)}else{$browser.url($location.absUrl(),currentReplace);afterLocationChange(oldUrl)}})}$location.$$replace=false;return changeCounter});return $location;function afterLocationChange(oldUrl){$rootScope.$broadcast("$locationChangeSuccess",$location.absUrl(),oldUrl)}}]}function $LogProvider(){var debug=true,self=this;this.debugEnabled=function(flag){if(isDefined(flag)){debug=flag;return this}else{return debug}};this.$get=["$window",function($window){return{log:consoleLog("log"),info:consoleLog("info"),warn:consoleLog("warn"),error:consoleLog("error"),debug:function(){var fn=consoleLog("debug");return function(){if(debug){fn.apply(self,arguments)}}}()};function formatError(arg){if(arg instanceof Error){if(arg.stack){arg=arg.message&&arg.stack.indexOf(arg.message)===-1?"Error: "+arg.message+"\n"+arg.stack:arg.stack}else if(arg.sourceURL){arg=arg.message+"\n"+arg.sourceURL+":"+arg.line}}return arg}function consoleLog(type){var console=$window.console||{},logFn=console[type]||console.log||noop,hasApply=false;try{hasApply=!!logFn.apply}catch(e){}if(hasApply){return function(){var args=[];forEach(arguments,function(arg){args.push(formatError(arg))});return logFn.apply(console,args)}}return function(arg1,arg2){logFn(arg1,arg2==null?"":arg2)}}}]}var $parseMinErr=minErr("$parse");var promiseWarningCache={};var promiseWarning;function ensureSafeMemberName(name,fullExpression){if(name==="constructor"){throw $parseMinErr("isecfld",'Referencing "constructor" field in Angular expressions is disallowed! Expression: {0}',fullExpression)}return name}function ensureSafeObject(obj,fullExpression){if(obj){if(obj.constructor===obj){throw $parseMinErr("isecfn","Referencing Function in Angular expressions is disallowed! Expression: {0}",fullExpression)}else if(obj.document&&obj.location&&obj.alert&&obj.setInterval){throw $parseMinErr("isecwindow","Referencing the Window in Angular expressions is disallowed! Expression: {0}",fullExpression)}else if(obj.children&&(obj.nodeName||obj.on&&obj.find)){throw $parseMinErr("isecdom","Referencing DOM nodes in Angular expressions is disallowed! Expression: {0}",fullExpression)}}return obj}var OPERATORS={"null":function(){return null},"true":function(){return true},"false":function(){return false},undefined:noop,"+":function(self,locals,a,b){a=a(self,locals);b=b(self,locals);if(isDefined(a)){if(isDefined(b)){return a+b}return a}return isDefined(b)?b:undefined},"-":function(self,locals,a,b){a=a(self,locals);b=b(self,locals);return(isDefined(a)?a:0)-(isDefined(b)?b:0)},"*":function(self,locals,a,b){return a(self,locals)*b(self,locals)},"/":function(self,locals,a,b){return a(self,locals)/b(self,locals)},"%":function(self,locals,a,b){return a(self,locals)%b(self,locals)},"^":function(self,locals,a,b){return a(self,locals)^b(self,locals)},"=":noop,"===":function(self,locals,a,b){return a(self,locals)===b(self,locals)},"!==":function(self,locals,a,b){return a(self,locals)!==b(self,locals)},"==":function(self,locals,a,b){return a(self,locals)==b(self,locals)},"!=":function(self,locals,a,b){return a(self,locals)!=b(self,locals)},"<":function(self,locals,a,b){return a(self,locals)<b(self,locals)},">":function(self,locals,a,b){return a(self,locals)>b(self,locals)},"<=":function(self,locals,a,b){return a(self,locals)<=b(self,locals)},">=":function(self,locals,a,b){return a(self,locals)>=b(self,locals)},"&&":function(self,locals,a,b){return a(self,locals)&&b(self,locals)},"||":function(self,locals,a,b){return a(self,locals)||b(self,locals)},"&":function(self,locals,a,b){return a(self,locals)&b(self,locals)},"|":function(self,locals,a,b){return b(self,locals)(self,locals,a(self,locals))},"!":function(self,locals,a){return!a(self,locals)}};var ESCAPE={n:"\n",f:"\f",r:"\r",t:"	",v:"","'":"'",'"':'"'};var Lexer=function(options){this.options=options};Lexer.prototype={constructor:Lexer,lex:function(text){this.text=text;this.index=0;this.ch=undefined;this.lastCh=":";this.tokens=[];var token;var json=[];while(this.index<this.text.length){this.ch=this.text.charAt(this.index);if(this.is("\"'")){this.readString(this.ch)}else if(this.isNumber(this.ch)||this.is(".")&&this.isNumber(this.peek())){this.readNumber()}else if(this.isIdent(this.ch)){this.readIdent();if(this.was("{,")&&json[0]==="{"&&(token=this.tokens[this.tokens.length-1])){token.json=token.text.indexOf(".")===-1}}else if(this.is("(){}[].,;:?")){this.tokens.push({index:this.index,text:this.ch,json:this.was(":[,")&&this.is("{[")||this.is("}]:,")});if(this.is("{["))json.unshift(this.ch);if(this.is("}]"))json.shift();this.index++}else if(this.isWhitespace(this.ch)){this.index++;continue}else{var ch2=this.ch+this.peek();var ch3=ch2+this.peek(2);var fn=OPERATORS[this.ch];var fn2=OPERATORS[ch2];var fn3=OPERATORS[ch3];if(fn3){this.tokens.push({index:this.index,text:ch3,fn:fn3});this.index+=3}else if(fn2){this.tokens.push({index:this.index,text:ch2,fn:fn2});this.index+=2}else if(fn){this.tokens.push({index:this.index,text:this.ch,fn:fn,json:this.was("[,:")&&this.is("+-")});this.index+=1}else{this.throwError("Unexpected next character ",this.index,this.index+1)}}this.lastCh=this.ch}return this.tokens},is:function(chars){return chars.indexOf(this.ch)!==-1},was:function(chars){return chars.indexOf(this.lastCh)!==-1},peek:function(i){var num=i||1;return this.index+num<this.text.length?this.text.charAt(this.index+num):false},isNumber:function(ch){return"0"<=ch&&ch<="9"},isWhitespace:function(ch){return ch===" "||ch==="\r"||ch==="	"||ch==="\n"||ch===""||ch===" "},isIdent:function(ch){return"a"<=ch&&ch<="z"||"A"<=ch&&ch<="Z"||"_"===ch||ch==="$"},isExpOperator:function(ch){return ch==="-"||ch==="+"||this.isNumber(ch)},throwError:function(error,start,end){end=end||this.index;var colStr=isDefined(start)?"s "+start+"-"+this.index+" ["+this.text.substring(start,end)+"]":" "+end;throw $parseMinErr("lexerr","Lexer Error: {0} at column{1} in expression [{2}].",error,colStr,this.text)},readNumber:function(){var number="";var start=this.index;while(this.index<this.text.length){var ch=lowercase(this.text.charAt(this.index));if(ch=="."||this.isNumber(ch)){number+=ch}else{var peekCh=this.peek();if(ch=="e"&&this.isExpOperator(peekCh)){number+=ch}else if(this.isExpOperator(ch)&&peekCh&&this.isNumber(peekCh)&&number.charAt(number.length-1)=="e"){number+=ch}else if(this.isExpOperator(ch)&&(!peekCh||!this.isNumber(peekCh))&&number.charAt(number.length-1)=="e"){this.throwError("Invalid exponent")}else{break}}this.index++}number=1*number;this.tokens.push({index:start,text:number,json:true,fn:function(){return number}})},readIdent:function(){var parser=this;var ident="";var start=this.index;var lastDot,peekIndex,methodName,ch;while(this.index<this.text.length){ch=this.text.charAt(this.index);if(ch==="."||this.isIdent(ch)||this.isNumber(ch)){if(ch===".")lastDot=this.index;ident+=ch}else{break}this.index++}if(lastDot){peekIndex=this.index;while(peekIndex<this.text.length){ch=this.text.charAt(peekIndex);if(ch==="("){methodName=ident.substr(lastDot-start+1);ident=ident.substr(0,lastDot-start);this.index=peekIndex;break}if(this.isWhitespace(ch)){peekIndex++}else{break}}}var token={index:start,text:ident};if(OPERATORS.hasOwnProperty(ident)){token.fn=OPERATORS[ident];token.json=OPERATORS[ident]}else{var getter=getterFn(ident,this.options,this.text);token.fn=extend(function(self,locals){return getter(self,locals)},{assign:function(self,value){return setter(self,ident,value,parser.text,parser.options)}})}this.tokens.push(token);if(methodName){this.tokens.push({index:lastDot,text:".",json:false});this.tokens.push({index:lastDot+1,text:methodName,json:false})}},readString:function(quote){var start=this.index;this.index++;var string="";var rawString=quote;var escape=false;while(this.index<this.text.length){var ch=this.text.charAt(this.index);rawString+=ch;if(escape){if(ch==="u"){var hex=this.text.substring(this.index+1,this.index+5);if(!hex.match(/[\da-f]{4}/i))this.throwError("Invalid unicode escape [\\u"+hex+"]");this.index+=4;string+=String.fromCharCode(parseInt(hex,16))}else{var rep=ESCAPE[ch];if(rep){string+=rep}else{string+=ch}}escape=false}else if(ch==="\\"){escape=true}else if(ch===quote){this.index++;this.tokens.push({index:start,text:rawString,string:string,json:true,fn:function(){return string}});return}else{string+=ch}this.index++}this.throwError("Unterminated quote",start)}};var Parser=function(lexer,$filter,options){this.lexer=lexer;this.$filter=$filter;this.options=options};Parser.ZERO=function(){return 0};Parser.prototype={constructor:Parser,parse:function(text,json){this.text=text;this.json=json;this.tokens=this.lexer.lex(text);if(json){this.assignment=this.logicalOR;this.functionCall=this.fieldAccess=this.objectIndex=this.filterChain=function(){this.throwError("is not valid json",{text:text,index:0})}}var value=json?this.primary():this.statements();if(this.tokens.length!==0){this.throwError("is an unexpected token",this.tokens[0])}value.literal=!!value.literal;value.constant=!!value.constant;return value},primary:function(){var primary;if(this.expect("(")){primary=this.filterChain();this.consume(")")}else if(this.expect("[")){primary=this.arrayDeclaration()}else if(this.expect("{")){primary=this.object()}else{var token=this.expect();primary=token.fn;if(!primary){this.throwError("not a primary expression",token)}if(token.json){primary.constant=true;primary.literal=true}}var next,context;while(next=this.expect("(","[",".")){if(next.text==="("){primary=this.functionCall(primary,context);context=null}else if(next.text==="["){context=primary;primary=this.objectIndex(primary)}else if(next.text==="."){context=primary;primary=this.fieldAccess(primary)}else{this.throwError("IMPOSSIBLE")}}return primary},throwError:function(msg,token){throw $parseMinErr("syntax","Syntax Error: Token '{0}' {1} at column {2} of the expression [{3}] starting at [{4}].",token.text,msg,token.index+1,this.text,this.text.substring(token.index))},peekToken:function(){if(this.tokens.length===0)throw $parseMinErr("ueoe","Unexpected end of expression: {0}",this.text);return this.tokens[0]},peek:function(e1,e2,e3,e4){if(this.tokens.length>0){var token=this.tokens[0];var t=token.text;if(t===e1||t===e2||t===e3||t===e4||!e1&&!e2&&!e3&&!e4){return token}}return false},expect:function(e1,e2,e3,e4){var token=this.peek(e1,e2,e3,e4);if(token){if(this.json&&!token.json){this.throwError("is not valid json",token)}this.tokens.shift();return token}return false},consume:function(e1){if(!this.expect(e1)){this.throwError("is unexpected, expecting ["+e1+"]",this.peek())}},unaryFn:function(fn,right){return extend(function(self,locals){return fn(self,locals,right)},{constant:right.constant})},ternaryFn:function(left,middle,right){return extend(function(self,locals){return left(self,locals)?middle(self,locals):right(self,locals)},{constant:left.constant&&middle.constant&&right.constant})},binaryFn:function(left,fn,right){return extend(function(self,locals){return fn(self,locals,left,right)},{constant:left.constant&&right.constant})},statements:function(){var statements=[];while(true){if(this.tokens.length>0&&!this.peek("}",")",";","]"))statements.push(this.filterChain());if(!this.expect(";")){return statements.length===1?statements[0]:function(self,locals){var value;for(var i=0;i<statements.length;i++){var statement=statements[i];if(statement){value=statement(self,locals)}}return value}}}},filterChain:function(){var left=this.expression();var token;while(true){if(token=this.expect("|")){left=this.binaryFn(left,token.fn,this.filter())}else{return left}}},filter:function(){var token=this.expect();var fn=this.$filter(token.text);var argsFn=[];while(true){if(token=this.expect(":")){argsFn.push(this.expression())}else{var fnInvoke=function(self,locals,input){var args=[input];for(var i=0;i<argsFn.length;i++){args.push(argsFn[i](self,locals))}return fn.apply(self,args)};return function(){return fnInvoke}}}},expression:function(){return this.assignment()},assignment:function(){var left=this.ternary();var right;var token;if(token=this.expect("=")){if(!left.assign){this.throwError("implies assignment but ["+this.text.substring(0,token.index)+"] can not be assigned to",token)}right=this.ternary();return function(scope,locals){return left.assign(scope,right(scope,locals),locals)}}return left},ternary:function(){var left=this.logicalOR();var middle;var token;if(token=this.expect("?")){middle=this.ternary();if(token=this.expect(":")){return this.ternaryFn(left,middle,this.ternary())}else{this.throwError("expected :",token)}}else{return left}},logicalOR:function(){var left=this.logicalAND();var token;while(true){if(token=this.expect("||")){left=this.binaryFn(left,token.fn,this.logicalAND())}else{return left}}},logicalAND:function(){var left=this.equality();var token;if(token=this.expect("&&")){left=this.binaryFn(left,token.fn,this.logicalAND())}return left},equality:function(){var left=this.relational();var token;if(token=this.expect("==","!=","===","!==")){left=this.binaryFn(left,token.fn,this.equality())}return left},relational:function(){var left=this.additive();var token;if(token=this.expect("<",">","<=",">=")){left=this.binaryFn(left,token.fn,this.relational())}return left},additive:function(){var left=this.multiplicative();var token;while(token=this.expect("+","-")){left=this.binaryFn(left,token.fn,this.multiplicative())}return left},multiplicative:function(){var left=this.unary();var token;while(token=this.expect("*","/","%")){left=this.binaryFn(left,token.fn,this.unary())}return left},unary:function(){var token;if(this.expect("+")){return this.primary()}else if(token=this.expect("-")){return this.binaryFn(Parser.ZERO,token.fn,this.unary())}else if(token=this.expect("!")){return this.unaryFn(token.fn,this.unary())}else{return this.primary()}},fieldAccess:function(object){var parser=this;var field=this.expect().text;var getter=getterFn(field,this.options,this.text);return extend(function(scope,locals,self){return getter(self||object(scope,locals),locals)},{assign:function(scope,value,locals){return setter(object(scope,locals),field,value,parser.text,parser.options)}})},objectIndex:function(obj){var parser=this;var indexFn=this.expression();this.consume("]");return extend(function(self,locals){var o=obj(self,locals),i=indexFn(self,locals),v,p;if(!o)return undefined;v=ensureSafeObject(o[i],parser.text);if(v&&v.then&&parser.options.unwrapPromises){p=v;if(!("$$v"in v)){p.$$v=undefined;p.then(function(val){p.$$v=val})}v=v.$$v}return v},{assign:function(self,value,locals){var key=indexFn(self,locals);var safe=ensureSafeObject(obj(self,locals),parser.text);return safe[key]=value}})},functionCall:function(fn,contextGetter){var argsFn=[];if(this.peekToken().text!==")"){do{argsFn.push(this.expression())}while(this.expect(","))}this.consume(")");var parser=this;return function(scope,locals){var args=[];var context=contextGetter?contextGetter(scope,locals):scope;for(var i=0;i<argsFn.length;i++){args.push(argsFn[i](scope,locals))}var fnPtr=fn(scope,locals,context)||noop;ensureSafeObject(context,parser.text);ensureSafeObject(fnPtr,parser.text);var v=fnPtr.apply?fnPtr.apply(context,args):fnPtr(args[0],args[1],args[2],args[3],args[4]);return ensureSafeObject(v,parser.text)}},arrayDeclaration:function(){var elementFns=[];var allConstant=true;if(this.peekToken().text!=="]"){do{var elementFn=this.expression();elementFns.push(elementFn);if(!elementFn.constant){allConstant=false}}while(this.expect(","))}this.consume("]");return extend(function(self,locals){var array=[];for(var i=0;i<elementFns.length;i++){array.push(elementFns[i](self,locals))}return array},{literal:true,constant:allConstant})},object:function(){var keyValues=[];var allConstant=true;if(this.peekToken().text!=="}"){do{var token=this.expect(),key=token.string||token.text;this.consume(":");var value=this.expression();keyValues.push({key:key,value:value});if(!value.constant){allConstant=false}}while(this.expect(","))}this.consume("}");return extend(function(self,locals){var object={};for(var i=0;i<keyValues.length;i++){var keyValue=keyValues[i];object[keyValue.key]=keyValue.value(self,locals)}return object},{literal:true,constant:allConstant})}};function setter(obj,path,setValue,fullExp,options){options=options||{};var element=path.split("."),key;for(var i=0;element.length>1;i++){key=ensureSafeMemberName(element.shift(),fullExp);var propertyObj=obj[key];if(!propertyObj){propertyObj={};obj[key]=propertyObj}obj=propertyObj;if(obj.then&&options.unwrapPromises){promiseWarning(fullExp);if(!("$$v"in obj)){(function(promise){promise.then(function(val){promise.$$v=val})})(obj)}if(obj.$$v===undefined){obj.$$v={}}obj=obj.$$v}}key=ensureSafeMemberName(element.shift(),fullExp);obj[key]=setValue;return setValue}var getterFnCache={};function cspSafeGetterFn(key0,key1,key2,key3,key4,fullExp,options){ensureSafeMemberName(key0,fullExp);ensureSafeMemberName(key1,fullExp);ensureSafeMemberName(key2,fullExp);ensureSafeMemberName(key3,fullExp);ensureSafeMemberName(key4,fullExp);return!options.unwrapPromises?function cspSafeGetter(scope,locals){var pathVal=locals&&locals.hasOwnProperty(key0)?locals:scope;if(pathVal==null)return pathVal;pathVal=pathVal[key0];if(pathVal==null)return key1?undefined:pathVal;pathVal=pathVal[key1];if(pathVal==null)return key2?undefined:pathVal;pathVal=pathVal[key2];if(pathVal==null)return key3?undefined:pathVal;pathVal=pathVal[key3];if(pathVal==null)return key4?undefined:pathVal;pathVal=pathVal[key4];return pathVal}:function cspSafePromiseEnabledGetter(scope,locals){var pathVal=locals&&locals.hasOwnProperty(key0)?locals:scope,promise;if(pathVal==null)return pathVal;pathVal=pathVal[key0];if(pathVal&&pathVal.then){promiseWarning(fullExp);if(!("$$v"in pathVal)){promise=pathVal;promise.$$v=undefined;promise.then(function(val){promise.$$v=val})}pathVal=pathVal.$$v}if(pathVal==null)return key1?undefined:pathVal;pathVal=pathVal[key1];if(pathVal&&pathVal.then){promiseWarning(fullExp);if(!("$$v"in pathVal)){promise=pathVal;promise.$$v=undefined;promise.then(function(val){promise.$$v=val})}pathVal=pathVal.$$v}if(pathVal==null)return key2?undefined:pathVal;pathVal=pathVal[key2];if(pathVal&&pathVal.then){promiseWarning(fullExp);if(!("$$v"in pathVal)){promise=pathVal;promise.$$v=undefined;promise.then(function(val){promise.$$v=val})}pathVal=pathVal.$$v}if(pathVal==null)return key3?undefined:pathVal;pathVal=pathVal[key3];if(pathVal&&pathVal.then){promiseWarning(fullExp);if(!("$$v"in pathVal)){promise=pathVal;promise.$$v=undefined;promise.then(function(val){promise.$$v=val})}pathVal=pathVal.$$v}if(pathVal==null)return key4?undefined:pathVal;pathVal=pathVal[key4];if(pathVal&&pathVal.then){promiseWarning(fullExp);if(!("$$v"in pathVal)){promise=pathVal;promise.$$v=undefined;promise.then(function(val){promise.$$v=val})}pathVal=pathVal.$$v}return pathVal}}function simpleGetterFn1(key0,fullExp){ensureSafeMemberName(key0,fullExp);return function simpleGetterFn1(scope,locals){if(scope==null)return undefined;return(locals&&locals.hasOwnProperty(key0)?locals:scope)[key0]}}function simpleGetterFn2(key0,key1,fullExp){ensureSafeMemberName(key0,fullExp);ensureSafeMemberName(key1,fullExp);return function simpleGetterFn2(scope,locals){if(scope==null)return undefined;scope=(locals&&locals.hasOwnProperty(key0)?locals:scope)[key0];return scope==null?undefined:scope[key1]}}function getterFn(path,options,fullExp){if(getterFnCache.hasOwnProperty(path)){return getterFnCache[path]}var pathKeys=path.split("."),pathKeysLength=pathKeys.length,fn;if(!options.unwrapPromises&&pathKeysLength===1){fn=simpleGetterFn1(pathKeys[0],fullExp)}else if(!options.unwrapPromises&&pathKeysLength===2){fn=simpleGetterFn2(pathKeys[0],pathKeys[1],fullExp)}else if(options.csp){if(pathKeysLength<6){fn=cspSafeGetterFn(pathKeys[0],pathKeys[1],pathKeys[2],pathKeys[3],pathKeys[4],fullExp,options)}else{fn=function(scope,locals){var i=0,val;do{val=cspSafeGetterFn(pathKeys[i++],pathKeys[i++],pathKeys[i++],pathKeys[i++],pathKeys[i++],fullExp,options)(scope,locals);locals=undefined;scope=val}while(i<pathKeysLength);return val}}}else{var code="var p;\n";forEach(pathKeys,function(key,index){ensureSafeMemberName(key,fullExp);code+="if(s == null) return undefined;\n"+"s="+(index?"s":'((k&&k.hasOwnProperty("'+key+'"))?k:s)')+'["'+key+'"]'+";\n"+(options.unwrapPromises?"if (s && s.then) {\n"+' pw("'+fullExp.replace(/(["\r\n])/g,"\\$1")+'");\n'+' if (!("$$v" in s)) {\n'+" p=s;\n"+" p.$$v = undefined;\n"+" p.then(function(v) {p.$$v=v;});\n"+"}\n"+" s=s.$$v\n"+"}\n":"")});code+="return s;";var evaledFnGetter=new Function("s","k","pw",code);evaledFnGetter.toString=valueFn(code);fn=options.unwrapPromises?function(scope,locals){return evaledFnGetter(scope,locals,promiseWarning)}:evaledFnGetter}if(path!=="hasOwnProperty"){getterFnCache[path]=fn}return fn}function $ParseProvider(){var cache={};var $parseOptions={csp:false,unwrapPromises:false,logPromiseWarnings:true};this.unwrapPromises=function(value){if(isDefined(value)){$parseOptions.unwrapPromises=!!value;return this}else{return $parseOptions.unwrapPromises}};this.logPromiseWarnings=function(value){if(isDefined(value)){$parseOptions.logPromiseWarnings=value;return this}else{return $parseOptions.logPromiseWarnings}};this.$get=["$filter","$sniffer","$log",function($filter,$sniffer,$log){$parseOptions.csp=$sniffer.csp;promiseWarning=function promiseWarningFn(fullExp){if(!$parseOptions.logPromiseWarnings||promiseWarningCache.hasOwnProperty(fullExp))return;promiseWarningCache[fullExp]=true;$log.warn("[$parse] Promise found in the expression `"+fullExp+"`. "+"Automatic unwrapping of promises in Angular expressions is deprecated.")};return function(exp){var parsedExpression;switch(typeof exp){case"string":if(cache.hasOwnProperty(exp)){return cache[exp]}var lexer=new Lexer($parseOptions);var parser=new Parser(lexer,$filter,$parseOptions);parsedExpression=parser.parse(exp,false);if(exp!=="hasOwnProperty"){cache[exp]=parsedExpression}return parsedExpression;case"function":return exp;default:return noop}}}]}function $QProvider(){this.$get=["$rootScope","$exceptionHandler",function($rootScope,$exceptionHandler){return qFactory(function(callback){$rootScope.$evalAsync(callback)},$exceptionHandler)}]}function qFactory(nextTick,exceptionHandler){var defer=function(){var pending=[],value,deferred;deferred={resolve:function(val){if(pending){var callbacks=pending;pending=undefined;value=ref(val);if(callbacks.length){nextTick(function(){var callback;for(var i=0,ii=callbacks.length;i<ii;i++){callback=callbacks[i];value.then(callback[0],callback[1],callback[2])}})}}},reject:function(reason){deferred.resolve(reject(reason))},notify:function(progress){if(pending){var callbacks=pending;if(pending.length){nextTick(function(){var callback;for(var i=0,ii=callbacks.length;i<ii;i++){callback=callbacks[i];callback[2](progress)}})}}},promise:{then:function(callback,errback,progressback){var result=defer();var wrappedCallback=function(value){try{result.resolve((isFunction(callback)?callback:defaultCallback)(value))}catch(e){result.reject(e);exceptionHandler(e)}};var wrappedErrback=function(reason){try{result.resolve((isFunction(errback)?errback:defaultErrback)(reason))}catch(e){result.reject(e);exceptionHandler(e)}};var wrappedProgressback=function(progress){try{result.notify((isFunction(progressback)?progressback:defaultCallback)(progress))}catch(e){exceptionHandler(e)}};if(pending){pending.push([wrappedCallback,wrappedErrback,wrappedProgressback])}else{value.then(wrappedCallback,wrappedErrback,wrappedProgressback)}return result.promise},"catch":function(callback){return this.then(null,callback)},"finally":function(callback){function makePromise(value,resolved){var result=defer();if(resolved){result.resolve(value)}else{result.reject(value)}return result.promise}function handleCallback(value,isResolved){var callbackOutput=null;try{callbackOutput=(callback||defaultCallback)()}catch(e){return makePromise(e,false)}if(callbackOutput&&isFunction(callbackOutput.then)){return callbackOutput.then(function(){return makePromise(value,isResolved)},function(error){return makePromise(error,false)})}else{return makePromise(value,isResolved)}}return this.then(function(value){return handleCallback(value,true)},function(error){return handleCallback(error,false)})}}};
return deferred};var ref=function(value){if(value&&isFunction(value.then))return value;return{then:function(callback){var result=defer();nextTick(function(){result.resolve(callback(value))});return result.promise}}};var reject=function(reason){return{then:function(callback,errback){var result=defer();nextTick(function(){try{result.resolve((isFunction(errback)?errback:defaultErrback)(reason))}catch(e){result.reject(e);exceptionHandler(e)}});return result.promise}}};var when=function(value,callback,errback,progressback){var result=defer(),done;var wrappedCallback=function(value){try{return(isFunction(callback)?callback:defaultCallback)(value)}catch(e){exceptionHandler(e);return reject(e)}};var wrappedErrback=function(reason){try{return(isFunction(errback)?errback:defaultErrback)(reason)}catch(e){exceptionHandler(e);return reject(e)}};var wrappedProgressback=function(progress){try{return(isFunction(progressback)?progressback:defaultCallback)(progress)}catch(e){exceptionHandler(e)}};nextTick(function(){ref(value).then(function(value){if(done)return;done=true;result.resolve(ref(value).then(wrappedCallback,wrappedErrback,wrappedProgressback))},function(reason){if(done)return;done=true;result.resolve(wrappedErrback(reason))},function(progress){if(done)return;result.notify(wrappedProgressback(progress))})});return result.promise};function defaultCallback(value){return value}function defaultErrback(reason){return reject(reason)}function all(promises){var deferred=defer(),counter=0,results=isArray(promises)?[]:{};forEach(promises,function(promise,key){counter++;ref(promise).then(function(value){if(results.hasOwnProperty(key))return;results[key]=value;if(!--counter)deferred.resolve(results)},function(reason){if(results.hasOwnProperty(key))return;deferred.reject(reason)})});if(counter===0){deferred.resolve(results)}return deferred.promise}return{defer:defer,reject:reject,when:when,all:all}}function $RootScopeProvider(){var TTL=10;var $rootScopeMinErr=minErr("$rootScope");var lastDirtyWatch=null;this.digestTtl=function(value){if(arguments.length){TTL=value}return TTL};this.$get=["$injector","$exceptionHandler","$parse","$browser",function($injector,$exceptionHandler,$parse,$browser){function Scope(){this.$id=nextUid();this.$$phase=this.$parent=this.$$watchers=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=null;this["this"]=this.$root=this;this.$$destroyed=false;this.$$asyncQueue=[];this.$$postDigestQueue=[];this.$$listeners={};this.$$isolateBindings={}}Scope.prototype={constructor:Scope,$new:function(isolate){var ChildScope,child;if(isolate){child=new Scope;child.$root=this.$root;child.$$asyncQueue=this.$$asyncQueue;child.$$postDigestQueue=this.$$postDigestQueue}else{ChildScope=function(){};ChildScope.prototype=this;child=new ChildScope;child.$id=nextUid()}child["this"]=child;child.$$listeners={};child.$parent=this;child.$$watchers=child.$$nextSibling=child.$$childHead=child.$$childTail=null;child.$$prevSibling=this.$$childTail;if(this.$$childHead){this.$$childTail.$$nextSibling=child;this.$$childTail=child}else{this.$$childHead=this.$$childTail=child}return child},$watch:function(watchExp,listener,objectEquality){var scope=this,get=compileToFn(watchExp,"watch"),array=scope.$$watchers,watcher={fn:listener,last:initWatchVal,get:get,exp:watchExp,eq:!!objectEquality};lastDirtyWatch=null;if(!isFunction(listener)){var listenFn=compileToFn(listener||noop,"listener");watcher.fn=function(newVal,oldVal,scope){listenFn(scope)}}if(typeof watchExp=="string"&&get.constant){var originalFn=watcher.fn;watcher.fn=function(newVal,oldVal,scope){originalFn.call(this,newVal,oldVal,scope);arrayRemove(array,watcher)}}if(!array){array=scope.$$watchers=[]}array.unshift(watcher);return function(){arrayRemove(array,watcher)}},$watchCollection:function(obj,listener){var self=this;var oldValue;var newValue;var changeDetected=0;var objGetter=$parse(obj);var internalArray=[];var internalObject={};var oldLength=0;function $watchCollectionWatch(){newValue=objGetter(self);var newLength,key;if(!isObject(newValue)){if(oldValue!==newValue){oldValue=newValue;changeDetected++}}else if(isArrayLike(newValue)){if(oldValue!==internalArray){oldValue=internalArray;oldLength=oldValue.length=0;changeDetected++}newLength=newValue.length;if(oldLength!==newLength){changeDetected++;oldValue.length=oldLength=newLength}for(var i=0;i<newLength;i++){if(oldValue[i]!==newValue[i]){changeDetected++;oldValue[i]=newValue[i]}}}else{if(oldValue!==internalObject){oldValue=internalObject={};oldLength=0;changeDetected++}newLength=0;for(key in newValue){if(newValue.hasOwnProperty(key)){newLength++;if(oldValue.hasOwnProperty(key)){if(oldValue[key]!==newValue[key]){changeDetected++;oldValue[key]=newValue[key]}}else{oldLength++;oldValue[key]=newValue[key];changeDetected++}}}if(oldLength>newLength){changeDetected++;for(key in oldValue){if(oldValue.hasOwnProperty(key)&&!newValue.hasOwnProperty(key)){oldLength--;delete oldValue[key]}}}}return changeDetected}function $watchCollectionAction(){listener(newValue,oldValue,self)}return this.$watch($watchCollectionWatch,$watchCollectionAction)},$digest:function(){var watch,value,last,watchers,asyncQueue=this.$$asyncQueue,postDigestQueue=this.$$postDigestQueue,length,dirty,ttl=TTL,next,current,target=this,watchLog=[],logIdx,logMsg,asyncTask;beginPhase("$digest");lastDirtyWatch=null;do{dirty=false;current=target;while(asyncQueue.length){try{asyncTask=asyncQueue.shift();asyncTask.scope.$eval(asyncTask.expression)}catch(e){clearPhase();$exceptionHandler(e)}lastDirtyWatch=null}traverseScopesLoop:do{if(watchers=current.$$watchers){length=watchers.length;while(length--){try{watch=watchers[length];if(watch){if((value=watch.get(current))!==(last=watch.last)&&!(watch.eq?equals(value,last):typeof value=="number"&&typeof last=="number"&&isNaN(value)&&isNaN(last))){dirty=true;lastDirtyWatch=watch;watch.last=watch.eq?copy(value):value;watch.fn(value,last===initWatchVal?value:last,current);if(ttl<5){logIdx=4-ttl;if(!watchLog[logIdx])watchLog[logIdx]=[];logMsg=isFunction(watch.exp)?"fn: "+(watch.exp.name||watch.exp.toString()):watch.exp;logMsg+="; newVal: "+toJson(value)+"; oldVal: "+toJson(last);watchLog[logIdx].push(logMsg)}}else if(watch===lastDirtyWatch){dirty=false;break traverseScopesLoop}}}catch(e){clearPhase();$exceptionHandler(e)}}}if(!(next=current.$$childHead||current!==target&&current.$$nextSibling)){while(current!==target&&!(next=current.$$nextSibling)){current=current.$parent}}}while(current=next);if(dirty&&!ttl--){clearPhase();throw $rootScopeMinErr("infdig","{0} $digest() iterations reached. Aborting!\n"+"Watchers fired in the last 5 iterations: {1}",TTL,toJson(watchLog))}}while(dirty||asyncQueue.length);clearPhase();while(postDigestQueue.length){try{postDigestQueue.shift()()}catch(e){$exceptionHandler(e)}}},$destroy:function(){if(this.$$destroyed)return;var parent=this.$parent;this.$broadcast("$destroy");this.$$destroyed=true;if(this===$rootScope)return;if(parent.$$childHead==this)parent.$$childHead=this.$$nextSibling;if(parent.$$childTail==this)parent.$$childTail=this.$$prevSibling;if(this.$$prevSibling)this.$$prevSibling.$$nextSibling=this.$$nextSibling;if(this.$$nextSibling)this.$$nextSibling.$$prevSibling=this.$$prevSibling;this.$parent=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=null},$eval:function(expr,locals){return $parse(expr)(this,locals)},$evalAsync:function(expr){if(!$rootScope.$$phase&&!$rootScope.$$asyncQueue.length){$browser.defer(function(){if($rootScope.$$asyncQueue.length){$rootScope.$digest()}})}this.$$asyncQueue.push({scope:this,expression:expr})},$$postDigest:function(fn){this.$$postDigestQueue.push(fn)},$apply:function(expr){try{beginPhase("$apply");return this.$eval(expr)}catch(e){$exceptionHandler(e)}finally{clearPhase();try{$rootScope.$digest()}catch(e){$exceptionHandler(e);throw e}}},$on:function(name,listener){var namedListeners=this.$$listeners[name];if(!namedListeners){this.$$listeners[name]=namedListeners=[]}namedListeners.push(listener);return function(){namedListeners[indexOf(namedListeners,listener)]=null}},$emit:function(name,args){var empty=[],namedListeners,scope=this,stopPropagation=false,event={name:name,targetScope:scope,stopPropagation:function(){stopPropagation=true},preventDefault:function(){event.defaultPrevented=true},defaultPrevented:false},listenerArgs=concat([event],arguments,1),i,length;do{namedListeners=scope.$$listeners[name]||empty;event.currentScope=scope;for(i=0,length=namedListeners.length;i<length;i++){if(!namedListeners[i]){namedListeners.splice(i,1);i--;length--;continue}try{namedListeners[i].apply(null,listenerArgs)}catch(e){$exceptionHandler(e)}}if(stopPropagation)return event;scope=scope.$parent}while(scope);return event},$broadcast:function(name,args){var target=this,current=target,next=target,event={name:name,targetScope:target,preventDefault:function(){event.defaultPrevented=true},defaultPrevented:false},listenerArgs=concat([event],arguments,1),listeners,i,length;do{current=next;event.currentScope=current;listeners=current.$$listeners[name]||[];for(i=0,length=listeners.length;i<length;i++){if(!listeners[i]){listeners.splice(i,1);i--;length--;continue}try{listeners[i].apply(null,listenerArgs)}catch(e){$exceptionHandler(e)}}if(!(next=current.$$childHead||current!==target&&current.$$nextSibling)){while(current!==target&&!(next=current.$$nextSibling)){current=current.$parent}}}while(current=next);return event}};var $rootScope=new Scope;return $rootScope;function beginPhase(phase){if($rootScope.$$phase){throw $rootScopeMinErr("inprog","{0} already in progress",$rootScope.$$phase)}$rootScope.$$phase=phase}function clearPhase(){$rootScope.$$phase=null}function compileToFn(exp,name){var fn=$parse(exp);assertArgFn(fn,name);return fn}function initWatchVal(){}}]}function $$SanitizeUriProvider(){var aHrefSanitizationWhitelist=/^\s*(https?|ftp|mailto|tel|file):/,imgSrcSanitizationWhitelist=/^\s*(https?|ftp|file):|data:image\//;this.aHrefSanitizationWhitelist=function(regexp){if(isDefined(regexp)){aHrefSanitizationWhitelist=regexp;return this}return aHrefSanitizationWhitelist};this.imgSrcSanitizationWhitelist=function(regexp){if(isDefined(regexp)){imgSrcSanitizationWhitelist=regexp;return this}return imgSrcSanitizationWhitelist};this.$get=function(){return function sanitizeUri(uri,isImage){var regex=isImage?imgSrcSanitizationWhitelist:aHrefSanitizationWhitelist;var normalizedVal;if(!msie||msie>=8){normalizedVal=urlResolve(uri).href;if(normalizedVal!==""&&!normalizedVal.match(regex)){return"unsafe:"+normalizedVal}}return uri}}}var $sceMinErr=minErr("$sce");var SCE_CONTEXTS={HTML:"html",CSS:"css",URL:"url",RESOURCE_URL:"resourceUrl",JS:"js"};function escapeForRegexp(s){return s.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")}function adjustMatcher(matcher){if(matcher==="self"){return matcher}else if(isString(matcher)){if(matcher.indexOf("***")>-1){throw $sceMinErr("iwcard","Illegal sequence *** in string matcher.  String: {0}",matcher)}matcher=escapeForRegexp(matcher).replace("\\*\\*",".*").replace("\\*","[^:/.?&;]*");return new RegExp("^"+matcher+"$")}else if(isRegExp(matcher)){return new RegExp("^"+matcher.source+"$")}else{throw $sceMinErr("imatcher",'Matchers may only be "self", string patterns or RegExp objects')}}function adjustMatchers(matchers){var adjustedMatchers=[];if(isDefined(matchers)){forEach(matchers,function(matcher){adjustedMatchers.push(adjustMatcher(matcher))})}return adjustedMatchers}function $SceDelegateProvider(){this.SCE_CONTEXTS=SCE_CONTEXTS;var resourceUrlWhitelist=["self"],resourceUrlBlacklist=[];this.resourceUrlWhitelist=function(value){if(arguments.length){resourceUrlWhitelist=adjustMatchers(value)}return resourceUrlWhitelist};this.resourceUrlBlacklist=function(value){if(arguments.length){resourceUrlBlacklist=adjustMatchers(value)}return resourceUrlBlacklist};this.$get=["$injector",function($injector){var htmlSanitizer=function htmlSanitizer(html){throw $sceMinErr("unsafe","Attempting to use an unsafe value in a safe context.")};if($injector.has("$sanitize")){htmlSanitizer=$injector.get("$sanitize")}function matchUrl(matcher,parsedUrl){if(matcher==="self"){return urlIsSameOrigin(parsedUrl)}else{return!!matcher.exec(parsedUrl.href)}}function isResourceUrlAllowedByPolicy(url){var parsedUrl=urlResolve(url.toString());var i,n,allowed=false;for(i=0,n=resourceUrlWhitelist.length;i<n;i++){if(matchUrl(resourceUrlWhitelist[i],parsedUrl)){allowed=true;break}}if(allowed){for(i=0,n=resourceUrlBlacklist.length;i<n;i++){if(matchUrl(resourceUrlBlacklist[i],parsedUrl)){allowed=false;break}}}return allowed}function generateHolderType(Base){var holderType=function TrustedValueHolderType(trustedValue){this.$$unwrapTrustedValue=function(){return trustedValue}};if(Base){holderType.prototype=new Base}holderType.prototype.valueOf=function sceValueOf(){return this.$$unwrapTrustedValue()};holderType.prototype.toString=function sceToString(){return this.$$unwrapTrustedValue().toString()};return holderType}var trustedValueHolderBase=generateHolderType(),byType={};byType[SCE_CONTEXTS.HTML]=generateHolderType(trustedValueHolderBase);byType[SCE_CONTEXTS.CSS]=generateHolderType(trustedValueHolderBase);byType[SCE_CONTEXTS.URL]=generateHolderType(trustedValueHolderBase);byType[SCE_CONTEXTS.JS]=generateHolderType(trustedValueHolderBase);byType[SCE_CONTEXTS.RESOURCE_URL]=generateHolderType(byType[SCE_CONTEXTS.URL]);function trustAs(type,trustedValue){var Constructor=byType.hasOwnProperty(type)?byType[type]:null;if(!Constructor){throw $sceMinErr("icontext","Attempted to trust a value in invalid context. Context: {0}; Value: {1}",type,trustedValue)}if(trustedValue===null||trustedValue===undefined||trustedValue===""){return trustedValue}if(typeof trustedValue!=="string"){throw $sceMinErr("itype","Attempted to trust a non-string value in a content requiring a string: Context: {0}",type)}return new Constructor(trustedValue)}function valueOf(maybeTrusted){if(maybeTrusted instanceof trustedValueHolderBase){return maybeTrusted.$$unwrapTrustedValue()}else{return maybeTrusted}}function getTrusted(type,maybeTrusted){if(maybeTrusted===null||maybeTrusted===undefined||maybeTrusted===""){return maybeTrusted}var constructor=byType.hasOwnProperty(type)?byType[type]:null;if(constructor&&maybeTrusted instanceof constructor){return maybeTrusted.$$unwrapTrustedValue()}if(type===SCE_CONTEXTS.RESOURCE_URL){if(isResourceUrlAllowedByPolicy(maybeTrusted)){return maybeTrusted}else{throw $sceMinErr("insecurl","Blocked loading resource from url not allowed by $sceDelegate policy.  URL: {0}",maybeTrusted.toString())}}else if(type===SCE_CONTEXTS.HTML){return htmlSanitizer(maybeTrusted)}throw $sceMinErr("unsafe","Attempting to use an unsafe value in a safe context.")}return{trustAs:trustAs,getTrusted:getTrusted,valueOf:valueOf}}]}function $SceProvider(){var enabled=true;this.enabled=function(value){if(arguments.length){enabled=!!value}return enabled};this.$get=["$parse","$sniffer","$sceDelegate",function($parse,$sniffer,$sceDelegate){if(enabled&&$sniffer.msie&&$sniffer.msieDocumentMode<8){throw $sceMinErr("iequirks","Strict Contextual Escaping does not support Internet Explorer version < 9 in quirks "+"mode.  You can fix this by adding the text <!doctype html> to the top of your HTML "+"document.  See http://docs.angularjs.org/api/ng.$sce for more information.")}var sce=copy(SCE_CONTEXTS);sce.isEnabled=function(){return enabled};sce.trustAs=$sceDelegate.trustAs;sce.getTrusted=$sceDelegate.getTrusted;sce.valueOf=$sceDelegate.valueOf;if(!enabled){sce.trustAs=sce.getTrusted=function(type,value){return value};sce.valueOf=identity}sce.parseAs=function sceParseAs(type,expr){var parsed=$parse(expr);if(parsed.literal&&parsed.constant){return parsed}else{return function sceParseAsTrusted(self,locals){return sce.getTrusted(type,parsed(self,locals))}}};var parse=sce.parseAs,getTrusted=sce.getTrusted,trustAs=sce.trustAs;forEach(SCE_CONTEXTS,function(enumValue,name){var lName=lowercase(name);sce[camelCase("parse_as_"+lName)]=function(expr){return parse(enumValue,expr)};sce[camelCase("get_trusted_"+lName)]=function(value){return getTrusted(enumValue,value)};sce[camelCase("trust_as_"+lName)]=function(value){return trustAs(enumValue,value)}});return sce}]}function $SnifferProvider(){this.$get=["$window","$document",function($window,$document){var eventSupport={},android=int((/android (\d+)/.exec(lowercase(($window.navigator||{}).userAgent))||[])[1]),boxee=/Boxee/i.test(($window.navigator||{}).userAgent),document=$document[0]||{},documentMode=document.documentMode,vendorPrefix,vendorRegex=/^(Moz|webkit|O|ms)(?=[A-Z])/,bodyStyle=document.body&&document.body.style,transitions=false,animations=false,match;if(bodyStyle){for(var prop in bodyStyle){if(match=vendorRegex.exec(prop)){vendorPrefix=match[0];vendorPrefix=vendorPrefix.substr(0,1).toUpperCase()+vendorPrefix.substr(1);break}}if(!vendorPrefix){vendorPrefix="WebkitOpacity"in bodyStyle&&"webkit"}transitions=!!("transition"in bodyStyle||vendorPrefix+"Transition"in bodyStyle);animations=!!("animation"in bodyStyle||vendorPrefix+"Animation"in bodyStyle);if(android&&(!transitions||!animations)){transitions=isString(document.body.style.webkitTransition);animations=isString(document.body.style.webkitAnimation)}}return{history:!!($window.history&&$window.history.pushState&&!(android<4)&&!boxee),hashchange:"onhashchange"in $window&&(!documentMode||documentMode>7),hasEvent:function(event){if(event=="input"&&msie==9)return false;if(isUndefined(eventSupport[event])){var divElm=document.createElement("div");eventSupport[event]="on"+event in divElm}return eventSupport[event]},csp:csp(),vendorPrefix:vendorPrefix,transitions:transitions,animations:animations,android:android,msie:msie,msieDocumentMode:documentMode}}]}function $TimeoutProvider(){this.$get=["$rootScope","$browser","$q","$exceptionHandler",function($rootScope,$browser,$q,$exceptionHandler){var deferreds={};function timeout(fn,delay,invokeApply){var deferred=$q.defer(),promise=deferred.promise,skipApply=isDefined(invokeApply)&&!invokeApply,timeoutId;timeoutId=$browser.defer(function(){try{deferred.resolve(fn())}catch(e){deferred.reject(e);$exceptionHandler(e)}finally{delete deferreds[promise.$$timeoutId]}if(!skipApply)$rootScope.$apply()},delay);promise.$$timeoutId=timeoutId;deferreds[timeoutId]=deferred;return promise}timeout.cancel=function(promise){if(promise&&promise.$$timeoutId in deferreds){deferreds[promise.$$timeoutId].reject("canceled");delete deferreds[promise.$$timeoutId];return $browser.defer.cancel(promise.$$timeoutId)}return false};return timeout}]}var urlParsingNode=document.createElement("a");var originUrl=urlResolve(window.location.href,true);function urlResolve(url,base){var href=url;if(msie){urlParsingNode.setAttribute("href",href);href=urlParsingNode.href}urlParsingNode.setAttribute("href",href);return{href:urlParsingNode.href,protocol:urlParsingNode.protocol?urlParsingNode.protocol.replace(/:$/,""):"",host:urlParsingNode.host,search:urlParsingNode.search?urlParsingNode.search.replace(/^\?/,""):"",hash:urlParsingNode.hash?urlParsingNode.hash.replace(/^#/,""):"",hostname:urlParsingNode.hostname,port:urlParsingNode.port,pathname:urlParsingNode.pathname.charAt(0)==="/"?urlParsingNode.pathname:"/"+urlParsingNode.pathname}}function urlIsSameOrigin(requestUrl){var parsed=isString(requestUrl)?urlResolve(requestUrl):requestUrl;return parsed.protocol===originUrl.protocol&&parsed.host===originUrl.host}function $WindowProvider(){this.$get=valueFn(window)}$FilterProvider.$inject=["$provide"];function $FilterProvider($provide){var suffix="Filter";function register(name,factory){if(isObject(name)){var filters={};forEach(name,function(filter,key){filters[key]=register(key,filter)});return filters}else{return $provide.factory(name+suffix,factory)}}this.register=register;this.$get=["$injector",function($injector){return function(name){return $injector.get(name+suffix)}}];register("currency",currencyFilter);register("date",dateFilter);register("filter",filterFilter);register("json",jsonFilter);register("limitTo",limitToFilter);register("lowercase",lowercaseFilter);register("number",numberFilter);register("orderBy",orderByFilter);register("uppercase",uppercaseFilter)}function filterFilter(){return function(array,expression,comparator){if(!isArray(array))return array;var comparatorType=typeof comparator,predicates=[];predicates.check=function(value){for(var j=0;j<predicates.length;j++){if(!predicates[j](value)){return false}}return true};if(comparatorType!=="function"){if(comparatorType==="boolean"&&comparator){comparator=function(obj,text){return angular.equals(obj,text)}}else{comparator=function(obj,text){text=(""+text).toLowerCase();return(""+obj).toLowerCase().indexOf(text)>-1}}}var search=function(obj,text){if(typeof text=="string"&&text.charAt(0)==="!"){return!search(obj,text.substr(1))}switch(typeof obj){case"boolean":case"number":case"string":return comparator(obj,text);case"object":switch(typeof text){case"object":return comparator(obj,text);default:for(var objKey in obj){if(objKey.charAt(0)!=="$"&&search(obj[objKey],text)){return true}}break}return false;case"array":for(var i=0;i<obj.length;i++){if(search(obj[i],text)){return true}}return false;default:return false}};switch(typeof expression){case"boolean":case"number":case"string":expression={$:expression};case"object":for(var key in expression){if(key=="$"){(function(){if(!expression[key])return;var path=key;predicates.push(function(value){return search(value,expression[path])})})()}else{(function(){if(typeof expression[key]=="undefined"){return}var path=key;predicates.push(function(value){return search(getter(value,path),expression[path])})})()}}break;case"function":predicates.push(expression);break;default:return array}var filtered=[];for(var j=0;j<array.length;j++){var value=array[j];if(predicates.check(value)){filtered.push(value)}}return filtered}}currencyFilter.$inject=["$locale"];function currencyFilter($locale){var formats=$locale.NUMBER_FORMATS;return function(amount,currencySymbol){if(isUndefined(currencySymbol))currencySymbol=formats.CURRENCY_SYM;return formatNumber(amount,formats.PATTERNS[1],formats.GROUP_SEP,formats.DECIMAL_SEP,2).replace(/\u00A4/g,currencySymbol)}}numberFilter.$inject=["$locale"];function numberFilter($locale){var formats=$locale.NUMBER_FORMATS;return function(number,fractionSize){return formatNumber(number,formats.PATTERNS[0],formats.GROUP_SEP,formats.DECIMAL_SEP,fractionSize)}}var DECIMAL_SEP=".";function formatNumber(number,pattern,groupSep,decimalSep,fractionSize){if(isNaN(number)||!isFinite(number))return"";var isNegative=number<0;number=Math.abs(number);var numStr=number+"",formatedText="",parts=[];var hasExponent=false;if(numStr.indexOf("e")!==-1){var match=numStr.match(/([\d\.]+)e(-?)(\d+)/);if(match&&match[2]=="-"&&match[3]>fractionSize+1){numStr="0"}else{formatedText=numStr;hasExponent=true}}if(!hasExponent){var fractionLen=(numStr.split(DECIMAL_SEP)[1]||"").length;if(isUndefined(fractionSize)){fractionSize=Math.min(Math.max(pattern.minFrac,fractionLen),pattern.maxFrac)}var pow=Math.pow(10,fractionSize);number=Math.round(number*pow)/pow;var fraction=(""+number).split(DECIMAL_SEP);var whole=fraction[0];fraction=fraction[1]||"";var i,pos=0,lgroup=pattern.lgSize,group=pattern.gSize;if(whole.length>=lgroup+group){pos=whole.length-lgroup;for(i=0;i<pos;i++){if((pos-i)%group===0&&i!==0){formatedText+=groupSep}formatedText+=whole.charAt(i)}}for(i=pos;i<whole.length;i++){if((whole.length-i)%lgroup===0&&i!==0){formatedText+=groupSep}formatedText+=whole.charAt(i)}while(fraction.length<fractionSize){fraction+="0"}if(fractionSize&&fractionSize!=="0")formatedText+=decimalSep+fraction.substr(0,fractionSize)}else{if(fractionSize>0&&number>-1&&number<1){formatedText=number.toFixed(fractionSize)}}parts.push(isNegative?pattern.negPre:pattern.posPre);parts.push(formatedText);parts.push(isNegative?pattern.negSuf:pattern.posSuf);return parts.join("")}function padNumber(num,digits,trim){var neg="";if(num<0){neg="-";num=-num}num=""+num;while(num.length<digits)num="0"+num;if(trim)num=num.substr(num.length-digits);return neg+num}function dateGetter(name,size,offset,trim){offset=offset||0;return function(date){var value=date["get"+name]();if(offset>0||value>-offset)value+=offset;if(value===0&&offset==-12)value=12;return padNumber(value,size,trim)}}function dateStrGetter(name,shortForm){return function(date,formats){var value=date["get"+name]();var get=uppercase(shortForm?"SHORT"+name:name);return formats[get][value]}}function timeZoneGetter(date){var zone=-1*date.getTimezoneOffset();var paddedZone=zone>=0?"+":"";paddedZone+=padNumber(Math[zone>0?"floor":"ceil"](zone/60),2)+padNumber(Math.abs(zone%60),2);return paddedZone}function ampmGetter(date,formats){return date.getHours()<12?formats.AMPMS[0]:formats.AMPMS[1]}var DATE_FORMATS={yyyy:dateGetter("FullYear",4),yy:dateGetter("FullYear",2,0,true),y:dateGetter("FullYear",1),MMMM:dateStrGetter("Month"),MMM:dateStrGetter("Month",true),MM:dateGetter("Month",2,1),M:dateGetter("Month",1,1),dd:dateGetter("Date",2),d:dateGetter("Date",1),HH:dateGetter("Hours",2),H:dateGetter("Hours",1),hh:dateGetter("Hours",2,-12),h:dateGetter("Hours",1,-12),mm:dateGetter("Minutes",2),m:dateGetter("Minutes",1),ss:dateGetter("Seconds",2),s:dateGetter("Seconds",1),sss:dateGetter("Milliseconds",3),EEEE:dateStrGetter("Day"),EEE:dateStrGetter("Day",true),a:ampmGetter,Z:timeZoneGetter};var DATE_FORMATS_SPLIT=/((?:[^yMdHhmsaZE']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z))(.*)/,NUMBER_STRING=/^\-?\d+$/;dateFilter.$inject=["$locale"];function dateFilter($locale){var R_ISO8601_STR=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/;function jsonStringToDate(string){var match;if(match=string.match(R_ISO8601_STR)){var date=new Date(0),tzHour=0,tzMin=0,dateSetter=match[8]?date.setUTCFullYear:date.setFullYear,timeSetter=match[8]?date.setUTCHours:date.setHours;if(match[9]){tzHour=int(match[9]+match[10]);tzMin=int(match[9]+match[11])}dateSetter.call(date,int(match[1]),int(match[2])-1,int(match[3]));var h=int(match[4]||0)-tzHour;var m=int(match[5]||0)-tzMin;var s=int(match[6]||0);var ms=Math.round(parseFloat("0."+(match[7]||0))*1e3);timeSetter.call(date,h,m,s,ms);return date}return string}return function(date,format){var text="",parts=[],fn,match;format=format||"mediumDate";format=$locale.DATETIME_FORMATS[format]||format;if(isString(date)){if(NUMBER_STRING.test(date)){date=int(date)}else{date=jsonStringToDate(date)}}if(isNumber(date)){date=new Date(date)}if(!isDate(date)){return date}while(format){match=DATE_FORMATS_SPLIT.exec(format);if(match){parts=concat(parts,match,1);format=parts.pop()}else{parts.push(format);format=null}}forEach(parts,function(value){fn=DATE_FORMATS[value];text+=fn?fn(date,$locale.DATETIME_FORMATS):value.replace(/(^'|'$)/g,"").replace(/''/g,"'")});return text}}function jsonFilter(){return function(object){return toJson(object,true)}}var lowercaseFilter=valueFn(lowercase);var uppercaseFilter=valueFn(uppercase);function limitToFilter(){return function(input,limit){if(!isArray(input)&&!isString(input))return input;limit=int(limit);if(isString(input)){if(limit){return limit>=0?input.slice(0,limit):input.slice(limit,input.length)}else{return""}}var out=[],i,n;if(limit>input.length)limit=input.length;else if(limit<-input.length)limit=-input.length;if(limit>0){i=0;n=limit}else{i=input.length+limit;n=input.length}for(;i<n;i++){out.push(input[i])}return out}}orderByFilter.$inject=["$parse"];function orderByFilter($parse){return function(array,sortPredicate,reverseOrder){if(!isArray(array))return array;if(!sortPredicate)return array;sortPredicate=isArray(sortPredicate)?sortPredicate:[sortPredicate];sortPredicate=map(sortPredicate,function(predicate){var descending=false,get=predicate||identity;if(isString(predicate)){if(predicate.charAt(0)=="+"||predicate.charAt(0)=="-"){descending=predicate.charAt(0)=="-";predicate=predicate.substring(1)}get=$parse(predicate)}return reverseComparator(function(a,b){return compare(get(a),get(b))},descending)});var arrayCopy=[];for(var i=0;i<array.length;i++){arrayCopy.push(array[i])}return arrayCopy.sort(reverseComparator(comparator,reverseOrder));function comparator(o1,o2){for(var i=0;i<sortPredicate.length;i++){var comp=sortPredicate[i](o1,o2);if(comp!==0)return comp}return 0}function reverseComparator(comp,descending){return toBoolean(descending)?function(a,b){return comp(b,a)}:comp}function compare(v1,v2){var t1=typeof v1;var t2=typeof v2;if(t1==t2){if(t1=="string"){v1=v1.toLowerCase();v2=v2.toLowerCase()}if(v1===v2)return 0;return v1<v2?-1:1}else{return t1<t2?-1:1}}}}function ngDirective(directive){if(isFunction(directive)){directive={link:directive}}directive.restrict=directive.restrict||"AC";return valueFn(directive)}var htmlAnchorDirective=valueFn({restrict:"E",compile:function(element,attr){if(msie<=8){if(!attr.href&&!attr.name){attr.$set("href","")}element.append(document.createComment("IE fix"))}if(!attr.href&&!attr.name){return function(scope,element){element.on("click",function(event){if(!element.attr("href")){event.preventDefault()}})}}}});var ngAttributeAliasDirectives={};forEach(BOOLEAN_ATTR,function(propName,attrName){if(propName=="multiple")return;var normalized=directiveNormalize("ng-"+attrName);ngAttributeAliasDirectives[normalized]=function(){return{priority:100,compile:function(){return function(scope,element,attr){scope.$watch(attr[normalized],function ngBooleanAttrWatchAction(value){attr.$set(attrName,!!value)})}}}}});forEach(["src","srcset","href"],function(attrName){var normalized=directiveNormalize("ng-"+attrName);ngAttributeAliasDirectives[normalized]=function(){return{priority:99,link:function(scope,element,attr){attr.$observe(normalized,function(value){if(!value)return;attr.$set(attrName,value);if(msie)element.prop(attrName,attr[attrName])})}}}});var nullFormCtrl={$addControl:noop,$removeControl:noop,$setValidity:noop,$setDirty:noop,$setPristine:noop};FormController.$inject=["$element","$attrs","$scope"];function FormController(element,attrs){var form=this,parentForm=element.parent().controller("form")||nullFormCtrl,invalidCount=0,errors=form.$error={},controls=[];form.$name=attrs.name||attrs.ngForm;form.$dirty=false;form.$pristine=true;form.$valid=true;form.$invalid=false;parentForm.$addControl(form);element.addClass(PRISTINE_CLASS);toggleValidCss(true);function toggleValidCss(isValid,validationErrorKey){validationErrorKey=validationErrorKey?"-"+snake_case(validationErrorKey,"-"):"";element.removeClass((isValid?INVALID_CLASS:VALID_CLASS)+validationErrorKey).addClass((isValid?VALID_CLASS:INVALID_CLASS)+validationErrorKey)}form.$addControl=function(control){assertNotHasOwnProperty(control.$name,"input");controls.push(control);if(control.$name){form[control.$name]=control}};form.$removeControl=function(control){if(control.$name&&form[control.$name]===control){delete form[control.$name]}forEach(errors,function(queue,validationToken){form.$setValidity(validationToken,true,control)});arrayRemove(controls,control)};form.$setValidity=function(validationToken,isValid,control){var queue=errors[validationToken];if(isValid){if(queue){arrayRemove(queue,control);if(!queue.length){invalidCount--;if(!invalidCount){toggleValidCss(isValid);form.$valid=true;form.$invalid=false}errors[validationToken]=false;toggleValidCss(true,validationToken);parentForm.$setValidity(validationToken,true,form)}}}else{if(!invalidCount){toggleValidCss(isValid)}if(queue){if(includes(queue,control))return}else{errors[validationToken]=queue=[];invalidCount++;toggleValidCss(false,validationToken);parentForm.$setValidity(validationToken,false,form)}queue.push(control);form.$valid=false;form.$invalid=true}};form.$setDirty=function(){element.removeClass(PRISTINE_CLASS).addClass(DIRTY_CLASS);form.$dirty=true;form.$pristine=false;parentForm.$setDirty()};form.$setPristine=function(){element.removeClass(DIRTY_CLASS).addClass(PRISTINE_CLASS);
form.$dirty=false;form.$pristine=true;forEach(controls,function(control){control.$setPristine()})}}var formDirectiveFactory=function(isNgForm){return["$timeout",function($timeout){var formDirective={name:"form",restrict:isNgForm?"EAC":"E",controller:FormController,compile:function(){return{pre:function(scope,formElement,attr,controller){if(!attr.action){var preventDefaultListener=function(event){event.preventDefault?event.preventDefault():event.returnValue=false};addEventListenerFn(formElement[0],"submit",preventDefaultListener);formElement.on("$destroy",function(){$timeout(function(){removeEventListenerFn(formElement[0],"submit",preventDefaultListener)},0,false)})}var parentFormCtrl=formElement.parent().controller("form"),alias=attr.name||attr.ngForm;if(alias){setter(scope,alias,controller,alias)}if(parentFormCtrl){formElement.on("$destroy",function(){parentFormCtrl.$removeControl(controller);if(alias){setter(scope,alias,undefined,alias)}extend(controller,nullFormCtrl)})}}}}};return formDirective}]};var formDirective=formDirectiveFactory();var ngFormDirective=formDirectiveFactory(true);var URL_REGEXP=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/;var EMAIL_REGEXP=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}$/;var NUMBER_REGEXP=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/;var inputType={text:textInputType,number:numberInputType,url:urlInputType,email:emailInputType,radio:radioInputType,checkbox:checkboxInputType,hidden:noop,button:noop,submit:noop,reset:noop};function textInputType(scope,element,attr,ctrl,$sniffer,$browser){if(!$sniffer.android){var composing=false;element.on("compositionstart",function(data){composing=true});element.on("compositionend",function(){composing=false})}var listener=function(){if(composing)return;var value=element.val();if(toBoolean(attr.ngTrim||"T")){value=trim(value)}if(ctrl.$viewValue!==value){scope.$apply(function(){ctrl.$setViewValue(value)})}};if($sniffer.hasEvent("input")){element.on("input",listener)}else{var timeout;var deferListener=function(){if(!timeout){timeout=$browser.defer(function(){listener();timeout=null})}};element.on("keydown",function(event){var key=event.keyCode;if(key===91||15<key&&key<19||37<=key&&key<=40)return;deferListener()});if($sniffer.hasEvent("paste")){element.on("paste cut",deferListener)}}element.on("change",listener);ctrl.$render=function(){element.val(ctrl.$isEmpty(ctrl.$viewValue)?"":ctrl.$viewValue)};var pattern=attr.ngPattern,patternValidator,match;var validate=function(regexp,value){if(ctrl.$isEmpty(value)||regexp.test(value)){ctrl.$setValidity("pattern",true);return value}else{ctrl.$setValidity("pattern",false);return undefined}};if(pattern){match=pattern.match(/^\/(.*)\/([gim]*)$/);if(match){pattern=new RegExp(match[1],match[2]);patternValidator=function(value){return validate(pattern,value)}}else{patternValidator=function(value){var patternObj=scope.$eval(pattern);if(!patternObj||!patternObj.test){throw minErr("ngPattern")("noregexp","Expected {0} to be a RegExp but was {1}. Element: {2}",pattern,patternObj,startingTag(element))}return validate(patternObj,value)}}ctrl.$formatters.push(patternValidator);ctrl.$parsers.push(patternValidator)}if(attr.ngMinlength){var minlength=int(attr.ngMinlength);var minLengthValidator=function(value){if(!ctrl.$isEmpty(value)&&value.length<minlength){ctrl.$setValidity("minlength",false);return undefined}else{ctrl.$setValidity("minlength",true);return value}};ctrl.$parsers.push(minLengthValidator);ctrl.$formatters.push(minLengthValidator)}if(attr.ngMaxlength){var maxlength=int(attr.ngMaxlength);var maxLengthValidator=function(value){if(!ctrl.$isEmpty(value)&&value.length>maxlength){ctrl.$setValidity("maxlength",false);return undefined}else{ctrl.$setValidity("maxlength",true);return value}};ctrl.$parsers.push(maxLengthValidator);ctrl.$formatters.push(maxLengthValidator)}}function numberInputType(scope,element,attr,ctrl,$sniffer,$browser){textInputType(scope,element,attr,ctrl,$sniffer,$browser);ctrl.$parsers.push(function(value){var empty=ctrl.$isEmpty(value);if(empty||NUMBER_REGEXP.test(value)){ctrl.$setValidity("number",true);return value===""?null:empty?value:parseFloat(value)}else{ctrl.$setValidity("number",false);return undefined}});ctrl.$formatters.push(function(value){return ctrl.$isEmpty(value)?"":""+value});if(attr.min){var minValidator=function(value){var min=parseFloat(attr.min);if(!ctrl.$isEmpty(value)&&value<min){ctrl.$setValidity("min",false);return undefined}else{ctrl.$setValidity("min",true);return value}};ctrl.$parsers.push(minValidator);ctrl.$formatters.push(minValidator)}if(attr.max){var maxValidator=function(value){var max=parseFloat(attr.max);if(!ctrl.$isEmpty(value)&&value>max){ctrl.$setValidity("max",false);return undefined}else{ctrl.$setValidity("max",true);return value}};ctrl.$parsers.push(maxValidator);ctrl.$formatters.push(maxValidator)}ctrl.$formatters.push(function(value){if(ctrl.$isEmpty(value)||isNumber(value)){ctrl.$setValidity("number",true);return value}else{ctrl.$setValidity("number",false);return undefined}})}function urlInputType(scope,element,attr,ctrl,$sniffer,$browser){textInputType(scope,element,attr,ctrl,$sniffer,$browser);var urlValidator=function(value){if(ctrl.$isEmpty(value)||URL_REGEXP.test(value)){ctrl.$setValidity("url",true);return value}else{ctrl.$setValidity("url",false);return undefined}};ctrl.$formatters.push(urlValidator);ctrl.$parsers.push(urlValidator)}function emailInputType(scope,element,attr,ctrl,$sniffer,$browser){textInputType(scope,element,attr,ctrl,$sniffer,$browser);var emailValidator=function(value){if(ctrl.$isEmpty(value)||EMAIL_REGEXP.test(value)){ctrl.$setValidity("email",true);return value}else{ctrl.$setValidity("email",false);return undefined}};ctrl.$formatters.push(emailValidator);ctrl.$parsers.push(emailValidator)}function radioInputType(scope,element,attr,ctrl){if(isUndefined(attr.name)){element.attr("name",nextUid())}element.on("click",function(){if(element[0].checked){scope.$apply(function(){ctrl.$setViewValue(attr.value)})}});ctrl.$render=function(){var value=attr.value;element[0].checked=value==ctrl.$viewValue};attr.$observe("value",ctrl.$render)}function checkboxInputType(scope,element,attr,ctrl){var trueValue=attr.ngTrueValue,falseValue=attr.ngFalseValue;if(!isString(trueValue))trueValue=true;if(!isString(falseValue))falseValue=false;element.on("click",function(){scope.$apply(function(){ctrl.$setViewValue(element[0].checked)})});ctrl.$render=function(){element[0].checked=ctrl.$viewValue};ctrl.$isEmpty=function(value){return value!==trueValue};ctrl.$formatters.push(function(value){return value===trueValue});ctrl.$parsers.push(function(value){return value?trueValue:falseValue})}var inputDirective=["$browser","$sniffer",function($browser,$sniffer){return{restrict:"E",require:"?ngModel",link:function(scope,element,attr,ctrl){if(ctrl){(inputType[lowercase(attr.type)]||inputType.text)(scope,element,attr,ctrl,$sniffer,$browser)}}}}];var VALID_CLASS="ng-valid",INVALID_CLASS="ng-invalid",PRISTINE_CLASS="ng-pristine",DIRTY_CLASS="ng-dirty";var NgModelController=["$scope","$exceptionHandler","$attrs","$element","$parse",function($scope,$exceptionHandler,$attr,$element,$parse){this.$viewValue=Number.NaN;this.$modelValue=Number.NaN;this.$parsers=[];this.$formatters=[];this.$viewChangeListeners=[];this.$pristine=true;this.$dirty=false;this.$valid=true;this.$invalid=false;this.$name=$attr.name;var ngModelGet=$parse($attr.ngModel),ngModelSet=ngModelGet.assign;if(!ngModelSet){throw minErr("ngModel")("nonassign","Expression '{0}' is non-assignable. Element: {1}",$attr.ngModel,startingTag($element))}this.$render=noop;this.$isEmpty=function(value){return isUndefined(value)||value===""||value===null||value!==value};var parentForm=$element.inheritedData("$formController")||nullFormCtrl,invalidCount=0,$error=this.$error={};$element.addClass(PRISTINE_CLASS);toggleValidCss(true);function toggleValidCss(isValid,validationErrorKey){validationErrorKey=validationErrorKey?"-"+snake_case(validationErrorKey,"-"):"";$element.removeClass((isValid?INVALID_CLASS:VALID_CLASS)+validationErrorKey).addClass((isValid?VALID_CLASS:INVALID_CLASS)+validationErrorKey)}this.$setValidity=function(validationErrorKey,isValid){if($error[validationErrorKey]===!isValid)return;if(isValid){if($error[validationErrorKey])invalidCount--;if(!invalidCount){toggleValidCss(true);this.$valid=true;this.$invalid=false}}else{toggleValidCss(false);this.$invalid=true;this.$valid=false;invalidCount++}$error[validationErrorKey]=!isValid;toggleValidCss(isValid,validationErrorKey);parentForm.$setValidity(validationErrorKey,isValid,this)};this.$setPristine=function(){this.$dirty=false;this.$pristine=true;$element.removeClass(DIRTY_CLASS).addClass(PRISTINE_CLASS)};this.$setViewValue=function(value){this.$viewValue=value;if(this.$pristine){this.$dirty=true;this.$pristine=false;$element.removeClass(PRISTINE_CLASS).addClass(DIRTY_CLASS);parentForm.$setDirty()}forEach(this.$parsers,function(fn){value=fn(value)});if(this.$modelValue!==value){this.$modelValue=value;ngModelSet($scope,value);forEach(this.$viewChangeListeners,function(listener){try{listener()}catch(e){$exceptionHandler(e)}})}};var ctrl=this;$scope.$watch(function ngModelWatch(){var value=ngModelGet($scope);if(ctrl.$modelValue!==value){var formatters=ctrl.$formatters,idx=formatters.length;ctrl.$modelValue=value;while(idx--){value=formatters[idx](value)}if(ctrl.$viewValue!==value){ctrl.$viewValue=value;ctrl.$render()}}return value})}];var ngModelDirective=function(){return{require:["ngModel","^?form"],controller:NgModelController,link:function(scope,element,attr,ctrls){var modelCtrl=ctrls[0],formCtrl=ctrls[1]||nullFormCtrl;formCtrl.$addControl(modelCtrl);scope.$on("$destroy",function(){formCtrl.$removeControl(modelCtrl)})}}};var ngChangeDirective=valueFn({require:"ngModel",link:function(scope,element,attr,ctrl){ctrl.$viewChangeListeners.push(function(){scope.$eval(attr.ngChange)})}});var requiredDirective=function(){return{require:"?ngModel",link:function(scope,elm,attr,ctrl){if(!ctrl)return;attr.required=true;var validator=function(value){if(attr.required&&ctrl.$isEmpty(value)){ctrl.$setValidity("required",false);return}else{ctrl.$setValidity("required",true);return value}};ctrl.$formatters.push(validator);ctrl.$parsers.unshift(validator);attr.$observe("required",function(){validator(ctrl.$viewValue)})}}};var ngListDirective=function(){return{require:"ngModel",link:function(scope,element,attr,ctrl){var match=/\/(.*)\//.exec(attr.ngList),separator=match&&new RegExp(match[1])||attr.ngList||",";var parse=function(viewValue){if(isUndefined(viewValue))return;var list=[];if(viewValue){forEach(viewValue.split(separator),function(value){if(value)list.push(trim(value))})}return list};ctrl.$parsers.push(parse);ctrl.$formatters.push(function(value){if(isArray(value)){return value.join(", ")}return undefined});ctrl.$isEmpty=function(value){return!value||!value.length}}}};var CONSTANT_VALUE_REGEXP=/^(true|false|\d+)$/;var ngValueDirective=function(){return{priority:100,compile:function(tpl,tplAttr){if(CONSTANT_VALUE_REGEXP.test(tplAttr.ngValue)){return function ngValueConstantLink(scope,elm,attr){attr.$set("value",scope.$eval(attr.ngValue))}}else{return function ngValueLink(scope,elm,attr){scope.$watch(attr.ngValue,function valueWatchAction(value){attr.$set("value",value)})}}}}};var ngBindDirective=ngDirective(function(scope,element,attr){element.addClass("ng-binding").data("$binding",attr.ngBind);scope.$watch(attr.ngBind,function ngBindWatchAction(value){element.text(value==undefined?"":value)})});var ngBindTemplateDirective=["$interpolate",function($interpolate){return function(scope,element,attr){var interpolateFn=$interpolate(element.attr(attr.$attr.ngBindTemplate));element.addClass("ng-binding").data("$binding",interpolateFn);attr.$observe("ngBindTemplate",function(value){element.text(value)})}}];var ngBindHtmlDirective=["$sce","$parse",function($sce,$parse){return function(scope,element,attr){element.addClass("ng-binding").data("$binding",attr.ngBindHtml);var parsed=$parse(attr.ngBindHtml);function getStringValue(){return(parsed(scope)||"").toString()}scope.$watch(getStringValue,function ngBindHtmlWatchAction(value){element.html($sce.getTrustedHtml(parsed(scope))||"")})}}];function classDirective(name,selector){name="ngClass"+name;return function(){return{restrict:"AC",link:function(scope,element,attr){var oldVal;scope.$watch(attr[name],ngClassWatchAction,true);attr.$observe("class",function(value){ngClassWatchAction(scope.$eval(attr[name]))});if(name!=="ngClass"){scope.$watch("$index",function($index,old$index){var mod=$index&1;if(mod!==old$index&1){var classes=flattenClasses(scope.$eval(attr[name]));mod===selector?attr.$addClass(classes):attr.$removeClass(classes)}})}function ngClassWatchAction(newVal){if(selector===true||scope.$index%2===selector){var newClasses=flattenClasses(newVal||"");if(!oldVal){attr.$addClass(newClasses)}else if(!equals(newVal,oldVal)){attr.$updateClass(newClasses,flattenClasses(oldVal))}}oldVal=copy(newVal)}function flattenClasses(classVal){if(isArray(classVal)){return classVal.join(" ")}else if(isObject(classVal)){var classes=[],i=0;forEach(classVal,function(v,k){if(v){classes.push(k)}});return classes.join(" ")}return classVal}}}}}var ngClassDirective=classDirective("",true);var ngClassOddDirective=classDirective("Odd",0);var ngClassEvenDirective=classDirective("Even",1);var ngCloakDirective=ngDirective({compile:function(element,attr){attr.$set("ngCloak",undefined);element.removeClass("ng-cloak")}});var ngControllerDirective=[function(){return{scope:true,controller:"@",priority:500}}];var ngEventDirectives={};forEach("click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup keypress submit focus blur copy cut paste".split(" "),function(name){var directiveName=directiveNormalize("ng-"+name);ngEventDirectives[directiveName]=["$parse",function($parse){return{compile:function($element,attr){var fn=$parse(attr[directiveName]);return function(scope,element,attr){element.on(lowercase(name),function(event){scope.$apply(function(){fn(scope,{$event:event})})})}}}}]});var ngIfDirective=["$animate",function($animate){return{transclude:"element",priority:600,terminal:true,restrict:"A",$$tlb:true,link:function($scope,$element,$attr,ctrl,$transclude){var block,childScope;$scope.$watch($attr.ngIf,function ngIfWatchAction(value){if(toBoolean(value)){if(!childScope){childScope=$scope.$new();$transclude(childScope,function(clone){clone[clone.length++]=document.createComment(" end ngIf: "+$attr.ngIf+" ");block={clone:clone};$animate.enter(clone,$element.parent(),$element)})}}else{if(childScope){childScope.$destroy();childScope=null}if(block){$animate.leave(getBlockElements(block.clone));block=null}}})}}}];var ngIncludeDirective=["$http","$templateCache","$anchorScroll","$animate","$sce",function($http,$templateCache,$anchorScroll,$animate,$sce){return{restrict:"ECA",priority:400,terminal:true,transclude:"element",controller:angular.noop,compile:function(element,attr){var srcExp=attr.ngInclude||attr.src,onloadExp=attr.onload||"",autoScrollExp=attr.autoscroll;return function(scope,$element,$attr,ctrl,$transclude){var changeCounter=0,currentScope,currentElement;var cleanupLastIncludeContent=function(){if(currentScope){currentScope.$destroy();currentScope=null}if(currentElement){$animate.leave(currentElement);currentElement=null}};scope.$watch($sce.parseAsResourceUrl(srcExp),function ngIncludeWatchAction(src){var afterAnimation=function(){if(isDefined(autoScrollExp)&&(!autoScrollExp||scope.$eval(autoScrollExp))){$anchorScroll()}};var thisChangeId=++changeCounter;if(src){$http.get(src,{cache:$templateCache}).success(function(response){if(thisChangeId!==changeCounter)return;var newScope=scope.$new();ctrl.template=response;var clone=$transclude(newScope,function(clone){cleanupLastIncludeContent();$animate.enter(clone,null,$element,afterAnimation)});currentScope=newScope;currentElement=clone;currentScope.$emit("$includeContentLoaded");scope.$eval(onloadExp)}).error(function(){if(thisChangeId===changeCounter)cleanupLastIncludeContent()});scope.$emit("$includeContentRequested")}else{cleanupLastIncludeContent();ctrl.template=null}})}}}}];var ngIncludeFillContentDirective=["$compile",function($compile){return{restrict:"ECA",priority:-400,require:"ngInclude",link:function(scope,$element,$attr,ctrl){$element.html(ctrl.template);$compile($element.contents())(scope)}}}];var ngInitDirective=ngDirective({priority:450,compile:function(){return{pre:function(scope,element,attrs){scope.$eval(attrs.ngInit)}}}});var ngNonBindableDirective=ngDirective({terminal:true,priority:1e3});var ngPluralizeDirective=["$locale","$interpolate",function($locale,$interpolate){var BRACE=/{}/g;return{restrict:"EA",link:function(scope,element,attr){var numberExp=attr.count,whenExp=attr.$attr.when&&element.attr(attr.$attr.when),offset=attr.offset||0,whens=scope.$eval(whenExp)||{},whensExpFns={},startSymbol=$interpolate.startSymbol(),endSymbol=$interpolate.endSymbol(),isWhen=/^when(Minus)?(.+)$/;forEach(attr,function(expression,attributeName){if(isWhen.test(attributeName)){whens[lowercase(attributeName.replace("when","").replace("Minus","-"))]=element.attr(attr.$attr[attributeName])}});forEach(whens,function(expression,key){whensExpFns[key]=$interpolate(expression.replace(BRACE,startSymbol+numberExp+"-"+offset+endSymbol))});scope.$watch(function ngPluralizeWatch(){var value=parseFloat(scope.$eval(numberExp));if(!isNaN(value)){if(!(value in whens))value=$locale.pluralCat(value-offset);return whensExpFns[value](scope,element,true)}else{return""}},function ngPluralizeWatchAction(newVal){element.text(newVal)})}}}];var ngRepeatDirective=["$parse","$animate",function($parse,$animate){var NG_REMOVED="$$NG_REMOVED";var ngRepeatMinErr=minErr("ngRepeat");return{transclude:"element",priority:1e3,terminal:true,$$tlb:true,link:function($scope,$element,$attr,ctrl,$transclude){var expression=$attr.ngRepeat;var match=expression.match(/^\s*(.+)\s+in\s+([\r\n\s\S]*?)\s*(\s+track\s+by\s+(.+)\s*)?$/),trackByExp,trackByExpGetter,trackByIdExpFn,trackByIdArrayFn,trackByIdObjFn,lhs,rhs,valueIdentifier,keyIdentifier,hashFnLocals={$id:hashKey};if(!match){throw ngRepeatMinErr("iexp","Expected expression in form of '_item_ in _collection_[ track by _id_]' but got '{0}'.",expression)}lhs=match[1];rhs=match[2];trackByExp=match[4];if(trackByExp){trackByExpGetter=$parse(trackByExp);trackByIdExpFn=function(key,value,index){if(keyIdentifier)hashFnLocals[keyIdentifier]=key;hashFnLocals[valueIdentifier]=value;hashFnLocals.$index=index;return trackByExpGetter($scope,hashFnLocals)}}else{trackByIdArrayFn=function(key,value){return hashKey(value)};trackByIdObjFn=function(key){return key}}match=lhs.match(/^(?:([\$\w]+)|\(([\$\w]+)\s*,\s*([\$\w]+)\))$/);if(!match){throw ngRepeatMinErr("iidexp","'_item_' in '_item_ in _collection_' should be an identifier or '(_key_, _value_)' expression, but got '{0}'.",lhs)}valueIdentifier=match[3]||match[1];keyIdentifier=match[2];var lastBlockMap={};$scope.$watchCollection(rhs,function ngRepeatAction(collection){var index,length,previousNode=$element[0],nextNode,nextBlockMap={},arrayLength,childScope,key,value,trackById,trackByIdFn,collectionKeys,block,nextBlockOrder=[],elementsToRemove;if(isArrayLike(collection)){collectionKeys=collection;trackByIdFn=trackByIdExpFn||trackByIdArrayFn}else{trackByIdFn=trackByIdExpFn||trackByIdObjFn;collectionKeys=[];for(key in collection){if(collection.hasOwnProperty(key)&&key.charAt(0)!="$"){collectionKeys.push(key)}}collectionKeys.sort()}arrayLength=collectionKeys.length;length=nextBlockOrder.length=collectionKeys.length;for(index=0;index<length;index++){key=collection===collectionKeys?index:collectionKeys[index];value=collection[key];trackById=trackByIdFn(key,value,index);assertNotHasOwnProperty(trackById,"`track by` id");if(lastBlockMap.hasOwnProperty(trackById)){block=lastBlockMap[trackById];delete lastBlockMap[trackById];nextBlockMap[trackById]=block;nextBlockOrder[index]=block}else if(nextBlockMap.hasOwnProperty(trackById)){forEach(nextBlockOrder,function(block){if(block&&block.scope)lastBlockMap[block.id]=block});throw ngRepeatMinErr("dupes","Duplicates in a repeater are not allowed. Use 'track by' expression to specify unique keys. Repeater: {0}, Duplicate key: {1}",expression,trackById)}else{nextBlockOrder[index]={id:trackById};nextBlockMap[trackById]=false}}for(key in lastBlockMap){if(lastBlockMap.hasOwnProperty(key)){block=lastBlockMap[key];elementsToRemove=getBlockElements(block.clone);$animate.leave(elementsToRemove);forEach(elementsToRemove,function(element){element[NG_REMOVED]=true});block.scope.$destroy()}}for(index=0,length=collectionKeys.length;index<length;index++){key=collection===collectionKeys?index:collectionKeys[index];value=collection[key];block=nextBlockOrder[index];if(nextBlockOrder[index-1])previousNode=getBlockEnd(nextBlockOrder[index-1]);if(block.scope){childScope=block.scope;nextNode=previousNode;do{nextNode=nextNode.nextSibling}while(nextNode&&nextNode[NG_REMOVED]);if(getBlockStart(block)!=nextNode){$animate.move(getBlockElements(block.clone),null,jqLite(previousNode))}previousNode=getBlockEnd(block)}else{childScope=$scope.$new()}childScope[valueIdentifier]=value;if(keyIdentifier)childScope[keyIdentifier]=key;childScope.$index=index;childScope.$first=index===0;childScope.$last=index===arrayLength-1;childScope.$middle=!(childScope.$first||childScope.$last);childScope.$odd=!(childScope.$even=(index&1)===0);if(!block.scope){$transclude(childScope,function(clone){clone[clone.length++]=document.createComment(" end ngRepeat: "+expression+" ");$animate.enter(clone,null,jqLite(previousNode));previousNode=clone;block.scope=childScope;block.clone=clone;nextBlockMap[block.id]=block})}}lastBlockMap=nextBlockMap})}};function getBlockStart(block){return block.clone[0]}function getBlockEnd(block){return block.clone[block.clone.length-1]}}];var ngShowDirective=["$animate",function($animate){return function(scope,element,attr){scope.$watch(attr.ngShow,function ngShowWatchAction(value){$animate[toBoolean(value)?"removeClass":"addClass"](element,"ng-hide")})}}];var ngHideDirective=["$animate",function($animate){return function(scope,element,attr){scope.$watch(attr.ngHide,function ngHideWatchAction(value){$animate[toBoolean(value)?"addClass":"removeClass"](element,"ng-hide")})}}];var ngStyleDirective=ngDirective(function(scope,element,attr){scope.$watch(attr.ngStyle,function ngStyleWatchAction(newStyles,oldStyles){if(oldStyles&&newStyles!==oldStyles){forEach(oldStyles,function(val,style){element.css(style,"")})}if(newStyles)element.css(newStyles)},true)});var ngSwitchDirective=["$animate",function($animate){return{restrict:"EA",require:"ngSwitch",controller:["$scope",function ngSwitchController(){this.cases={}}],link:function(scope,element,attr,ngSwitchController){var watchExpr=attr.ngSwitch||attr.on,selectedTranscludes,selectedElements,selectedScopes=[];scope.$watch(watchExpr,function ngSwitchWatchAction(value){for(var i=0,ii=selectedScopes.length;i<ii;i++){selectedScopes[i].$destroy();$animate.leave(selectedElements[i])}selectedElements=[];selectedScopes=[];if(selectedTranscludes=ngSwitchController.cases["!"+value]||ngSwitchController.cases["?"]){scope.$eval(attr.change);forEach(selectedTranscludes,function(selectedTransclude){var selectedScope=scope.$new();selectedScopes.push(selectedScope);selectedTransclude.transclude(selectedScope,function(caseElement){var anchor=selectedTransclude.element;selectedElements.push(caseElement);$animate.enter(caseElement,anchor.parent(),anchor)})})}})}}}];var ngSwitchWhenDirective=ngDirective({transclude:"element",priority:800,require:"^ngSwitch",compile:function(element,attrs){return function(scope,element,attr,ctrl,$transclude){ctrl.cases["!"+attrs.ngSwitchWhen]=ctrl.cases["!"+attrs.ngSwitchWhen]||[];ctrl.cases["!"+attrs.ngSwitchWhen].push({transclude:$transclude,element:element})}}});var ngSwitchDefaultDirective=ngDirective({transclude:"element",priority:800,require:"^ngSwitch",link:function(scope,element,attr,ctrl,$transclude){ctrl.cases["?"]=ctrl.cases["?"]||[];ctrl.cases["?"].push({transclude:$transclude,element:element})}});var ngTranscludeDirective=ngDirective({controller:["$element","$transclude",function($element,$transclude){if(!$transclude){throw minErr("ngTransclude")("orphan","Illegal use of ngTransclude directive in the template! "+"No parent directive that requires a transclusion found. "+"Element: {0}",startingTag($element))}this.$transclude=$transclude}],link:function($scope,$element,$attrs,controller){controller.$transclude(function(clone){$element.empty();$element.append(clone)})}});var scriptDirective=["$templateCache",function($templateCache){return{restrict:"E",terminal:true,compile:function(element,attr){if(attr.type=="text/ng-template"){var templateUrl=attr.id,text=element[0].text;$templateCache.put(templateUrl,text)}}}}];var ngOptionsMinErr=minErr("ngOptions");var ngOptionsDirective=valueFn({terminal:true});var selectDirective=["$compile","$parse",function($compile,$parse){var NG_OPTIONS_REGEXP=/^\s*(.*?)(?:\s+as\s+(.*?))?(?:\s+group\s+by\s+(.*))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+(.*?)(?:\s+track\s+by\s+(.*?))?$/,nullModelCtrl={$setViewValue:noop};return{restrict:"E",require:["select","?ngModel"],controller:["$element","$scope","$attrs",function($element,$scope,$attrs){var self=this,optionsMap={},ngModelCtrl=nullModelCtrl,nullOption,unknownOption;self.databound=$attrs.ngModel;self.init=function(ngModelCtrl_,nullOption_,unknownOption_){ngModelCtrl=ngModelCtrl_;nullOption=nullOption_;unknownOption=unknownOption_};self.addOption=function(value){assertNotHasOwnProperty(value,'"option value"');optionsMap[value]=true;if(ngModelCtrl.$viewValue==value){$element.val(value);if(unknownOption.parent())unknownOption.remove()}};self.removeOption=function(value){if(this.hasOption(value)){delete optionsMap[value];if(ngModelCtrl.$viewValue==value){this.renderUnknownOption(value)}}};self.renderUnknownOption=function(val){var unknownVal="? "+hashKey(val)+" ?";unknownOption.val(unknownVal);$element.prepend(unknownOption);$element.val(unknownVal);unknownOption.prop("selected",true)};self.hasOption=function(value){return optionsMap.hasOwnProperty(value)};$scope.$on("$destroy",function(){self.renderUnknownOption=noop})}],link:function(scope,element,attr,ctrls){if(!ctrls[1])return;var selectCtrl=ctrls[0],ngModelCtrl=ctrls[1],multiple=attr.multiple,optionsExp=attr.ngOptions,nullOption=false,emptyOption,optionTemplate=jqLite(document.createElement("option")),optGroupTemplate=jqLite(document.createElement("optgroup")),unknownOption=optionTemplate.clone();for(var i=0,children=element.children(),ii=children.length;i<ii;i++){if(children[i].value===""){emptyOption=nullOption=children.eq(i);break}}selectCtrl.init(ngModelCtrl,nullOption,unknownOption);if(multiple){ngModelCtrl.$isEmpty=function(value){return!value||value.length===0}}if(optionsExp)setupAsOptions(scope,element,ngModelCtrl);else if(multiple)setupAsMultiple(scope,element,ngModelCtrl);else setupAsSingle(scope,element,ngModelCtrl,selectCtrl);function setupAsSingle(scope,selectElement,ngModelCtrl,selectCtrl){ngModelCtrl.$render=function(){var viewValue=ngModelCtrl.$viewValue;if(selectCtrl.hasOption(viewValue)){if(unknownOption.parent())unknownOption.remove();selectElement.val(viewValue);if(viewValue==="")emptyOption.prop("selected",true)}else{if(isUndefined(viewValue)&&emptyOption){selectElement.val("")}else{selectCtrl.renderUnknownOption(viewValue)}}};selectElement.on("change",function(){scope.$apply(function(){if(unknownOption.parent())unknownOption.remove();ngModelCtrl.$setViewValue(selectElement.val())})})}function setupAsMultiple(scope,selectElement,ctrl){var lastView;ctrl.$render=function(){var items=new HashMap(ctrl.$viewValue);forEach(selectElement.find("option"),function(option){option.selected=isDefined(items.get(option.value))})};scope.$watch(function selectMultipleWatch(){if(!equals(lastView,ctrl.$viewValue)){lastView=copy(ctrl.$viewValue);ctrl.$render()}});selectElement.on("change",function(){scope.$apply(function(){var array=[];forEach(selectElement.find("option"),function(option){if(option.selected){array.push(option.value)}});ctrl.$setViewValue(array)})})}function setupAsOptions(scope,selectElement,ctrl){var match;if(!(match=optionsExp.match(NG_OPTIONS_REGEXP))){throw ngOptionsMinErr("iexp","Expected expression in form of "+"'_select_ (as _label_)? for (_key_,)?_value_ in _collection_'"+" but got '{0}'. Element: {1}",optionsExp,startingTag(selectElement))}var displayFn=$parse(match[2]||match[1]),valueName=match[4]||match[6],keyName=match[5],groupByFn=$parse(match[3]||""),valueFn=$parse(match[2]?match[1]:valueName),valuesFn=$parse(match[7]),track=match[8],trackFn=track?$parse(match[8]):null,optionGroupsCache=[[{element:selectElement,label:""}]];if(nullOption){$compile(nullOption)(scope);nullOption.removeClass("ng-scope");nullOption.remove()}selectElement.empty();selectElement.on("change",function(){scope.$apply(function(){var optionGroup,collection=valuesFn(scope)||[],locals={},key,value,optionElement,index,groupIndex,length,groupLength,trackIndex;if(multiple){value=[];for(groupIndex=0,groupLength=optionGroupsCache.length;groupIndex<groupLength;groupIndex++){optionGroup=optionGroupsCache[groupIndex];for(index=1,length=optionGroup.length;index<length;index++){if((optionElement=optionGroup[index].element)[0].selected){key=optionElement.val();if(keyName)locals[keyName]=key;if(trackFn){for(trackIndex=0;trackIndex<collection.length;trackIndex++){locals[valueName]=collection[trackIndex];if(trackFn(scope,locals)==key)break}}else{locals[valueName]=collection[key]}value.push(valueFn(scope,locals))}}}}else{key=selectElement.val();if(key=="?"){value=undefined}else if(key===""){value=null}else{if(trackFn){for(trackIndex=0;trackIndex<collection.length;trackIndex++){locals[valueName]=collection[trackIndex];if(trackFn(scope,locals)==key){value=valueFn(scope,locals);break}}}else{locals[valueName]=collection[key];if(keyName)locals[keyName]=key;value=valueFn(scope,locals)}}}ctrl.$setViewValue(value)})});ctrl.$render=render;scope.$watch(render);function render(){var optionGroups={"":[]},optionGroupNames=[""],optionGroupName,optionGroup,option,existingParent,existingOptions,existingOption,modelValue=ctrl.$modelValue,values=valuesFn(scope)||[],keys=keyName?sortedKeys(values):values,key,groupLength,length,groupIndex,index,locals={},selected,selectedSet=false,lastElement,element,label;if(multiple){if(trackFn&&isArray(modelValue)){selectedSet=new HashMap([]);for(var trackIndex=0;trackIndex<modelValue.length;trackIndex++){locals[valueName]=modelValue[trackIndex];selectedSet.put(trackFn(scope,locals),modelValue[trackIndex])}}else{selectedSet=new HashMap(modelValue)}}for(index=0;length=keys.length,index<length;index++){key=index;if(keyName){key=keys[index];if(key.charAt(0)==="$")continue;locals[keyName]=key}locals[valueName]=values[key];optionGroupName=groupByFn(scope,locals)||"";if(!(optionGroup=optionGroups[optionGroupName])){optionGroup=optionGroups[optionGroupName]=[];optionGroupNames.push(optionGroupName)}if(multiple){selected=isDefined(selectedSet.remove(trackFn?trackFn(scope,locals):valueFn(scope,locals)))}else{if(trackFn){var modelCast={};modelCast[valueName]=modelValue;selected=trackFn(scope,modelCast)===trackFn(scope,locals)}else{selected=modelValue===valueFn(scope,locals)}selectedSet=selectedSet||selected}label=displayFn(scope,locals);label=isDefined(label)?label:"";optionGroup.push({id:trackFn?trackFn(scope,locals):keyName?keys[index]:index,label:label,selected:selected})}if(!multiple){if(nullOption||modelValue===null){optionGroups[""].unshift({id:"",label:"",selected:!selectedSet})}else if(!selectedSet){optionGroups[""].unshift({id:"?",label:"",selected:true})}}for(groupIndex=0,groupLength=optionGroupNames.length;groupIndex<groupLength;groupIndex++){optionGroupName=optionGroupNames[groupIndex];
optionGroup=optionGroups[optionGroupName];if(optionGroupsCache.length<=groupIndex){existingParent={element:optGroupTemplate.clone().attr("label",optionGroupName),label:optionGroup.label};existingOptions=[existingParent];optionGroupsCache.push(existingOptions);selectElement.append(existingParent.element)}else{existingOptions=optionGroupsCache[groupIndex];existingParent=existingOptions[0];if(existingParent.label!=optionGroupName){existingParent.element.attr("label",existingParent.label=optionGroupName)}}lastElement=null;for(index=0,length=optionGroup.length;index<length;index++){option=optionGroup[index];if(existingOption=existingOptions[index+1]){lastElement=existingOption.element;if(existingOption.label!==option.label){lastElement.text(existingOption.label=option.label)}if(existingOption.id!==option.id){lastElement.val(existingOption.id=option.id)}if(lastElement[0].selected!==option.selected){lastElement.prop("selected",existingOption.selected=option.selected)}}else{if(option.id===""&&nullOption){element=nullOption}else{(element=optionTemplate.clone()).val(option.id).attr("selected",option.selected).text(option.label)}existingOptions.push(existingOption={element:element,label:option.label,id:option.id,selected:option.selected});if(lastElement){lastElement.after(element)}else{existingParent.element.append(element)}lastElement=element}}index++;while(existingOptions.length>index){existingOptions.pop().element.remove()}}while(optionGroupsCache.length>groupIndex){optionGroupsCache.pop()[0].element.remove()}}}}}}];var optionDirective=["$interpolate",function($interpolate){var nullSelectCtrl={addOption:noop,removeOption:noop};return{restrict:"E",priority:100,compile:function(element,attr){if(isUndefined(attr.value)){var interpolateFn=$interpolate(element.text(),true);if(!interpolateFn){attr.$set("value",element.text())}}return function(scope,element,attr){var selectCtrlName="$selectController",parent=element.parent(),selectCtrl=parent.data(selectCtrlName)||parent.parent().data(selectCtrlName);if(selectCtrl&&selectCtrl.databound){element.prop("selected",false)}else{selectCtrl=nullSelectCtrl}if(interpolateFn){scope.$watch(interpolateFn,function interpolateWatchAction(newVal,oldVal){attr.$set("value",newVal);if(newVal!==oldVal)selectCtrl.removeOption(oldVal);selectCtrl.addOption(newVal)})}else{selectCtrl.addOption(attr.value)}element.on("$destroy",function(){selectCtrl.removeOption(attr.value)})}}}}];var styleDirective=valueFn({restrict:"E",terminal:true});bindJQuery();publishExternalAPI(angular);jqLite(document).ready(function(){angularInit(document,bootstrap)})})(window,document);!angular.$$csp()&&angular.element(document).find("head").prepend('<style type="text/css">@charset "UTF-8";[ng\\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide{display:none !important;}ng\\:form{display:block;}</style>');(function(m,g,n){"use strict";function h(a){var d={};a=a.split(",");var c;for(c=0;c<a.length;c++)d[a[c]]=!0;return d}function D(a,d){function c(a,b,c,f){b=g.lowercase(b);if(r[b])for(;e.last()&&s[e.last()];)k("",e.last());t[b]&&e.last()==b&&k("",b);(f=u[b]||!!f)||e.push(b);var l={};c.replace(E,function(a,b,d,c,e){l[b]=p(d||c||e||"")});d.start&&d.start(b,l,f)}function k(a,b){var c=0,k;if(b=g.lowercase(b))for(c=e.length-1;0<=c&&e[c]!=b;c--);if(0<=c){for(k=e.length-1;k>=c;k--)d.end&&d.end(e[k]);e.length=c}}var b,f,e=[],l=a;for(e.last=function(){return e[e.length-1]};a;){f=!0;if(e.last()&&v[e.last()])a=a.replace(RegExp("(.*)<\\s*\\/\\s*"+e.last()+"[^>]*>","i"),function(a,b){b=b.replace(F,"$1").replace(G,"$1");d.chars&&d.chars(p(b));return""}),k("",e.last());else{if(0===a.indexOf("<!--"))b=a.indexOf("--",4),0<=b&&a.lastIndexOf("-->",b)===b&&(d.comment&&d.comment(a.substring(4,b)),a=a.substring(b+3),f=!1);else if(w.test(a)){if(b=a.match(w))a=a.replace(b[0],""),f=!1}else if(H.test(a)){if(b=a.match(x))a=a.substring(b[0].length),b[0].replace(x,k),f=!1}else I.test(a)&&(b=a.match(y))&&(a=a.substring(b[0].length),b[0].replace(y,c),f=!1);f&&(b=a.indexOf("<"),f=0>b?a:a.substring(0,b),a=0>b?"":a.substring(b),d.chars&&d.chars(p(f)))}if(a==l)throw J("badparse",a);l=a}k()}function p(a){q.innerHTML=a.replace(/</g,"&lt;");return q.innerText||q.textContent||""}function z(a){return a.replace(/&/g,"&amp;").replace(K,function(a){return"&#"+a.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function A(a){var d=!1,c=g.bind(a,a.push);return{start:function(a,b,f){a=g.lowercase(a);!d&&v[a]&&(d=a);d||!0!==B[a]||(c("<"),c(a),g.forEach(b,function(a,b){var d=g.lowercase(b);!0!==L[d]||!0===C[d]&&!a.match(M)||(c(" "),c(b),c('="'),c(z(a)),c('"'))}),c(f?"/>":">"))},end:function(a){a=g.lowercase(a);d||!0!==B[a]||(c("</"),c(a),c(">"));a==d&&(d=!1)},chars:function(a){d||c(z(a))}}}var J=g.$$minErr("$sanitize"),y=/^<\s*([\w:-]+)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*>/,x=/^<\s*\/\s*([\w:-]+)[^>]*>/,E=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,I=/^</,H=/^<\s*\//,F=/\x3c!--(.*?)--\x3e/g,w=/<!DOCTYPE([^>]*?)>/i,G=/<!\[CDATA\[(.*?)]]\x3e/g,M=/^((ftp|https?):\/\/|mailto:|tel:|#)/i,K=/([^\#-~| |!])/g,u=h("area,br,col,hr,img,wbr");m=h("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr");n=h("rp,rt");var t=g.extend({},n,m),r=g.extend({},m,h("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),s=g.extend({},n,h("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),v=h("script,style"),B=g.extend({},u,r,s,t),C=h("background,cite,href,longdesc,src,usemap"),L=g.extend({},C,h("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,span,start,summary,target,title,type,valign,value,vspace,width")),q=document.createElement("pre");g.module("ngSanitize",[]).value("$sanitize",function(a){var d=[];D(a,A(d));return d.join("")});g.module("ngSanitize").filter("linky",function(){var a=/((ftp|https?):\/\/|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>]/,d=/^mailto:/;return function(c,k){if(!c)return c;var b,f=c,e=[],l=A(e),h,m,n={};g.isDefined(k)&&(n.target=k);for(;b=f.match(a);)h=b[0],b[2]==b[3]&&(h="mailto:"+h),m=b.index,l.chars(f.substr(0,m)),n.href=h,l.start("a",n),l.chars(b[0].replace(d,"")),l.end("a"),f=f.substring(m+b[0].length);l.chars(f);return e.join("")}})})(window,window.angular);(function(window,angular,undefined){"use strict";var ngRouteModule=angular.module("ngRoute",["ng"]).provider("$route",$RouteProvider);function $RouteProvider(){function inherit(parent,extra){return angular.extend(new(angular.extend(function(){},{prototype:parent})),extra)}var routes={};this.when=function(path,route){routes[path]=angular.extend({reloadOnSearch:true},route,path&&pathRegExp(path,route));if(path){var redirectPath=path[path.length-1]=="/"?path.substr(0,path.length-1):path+"/";routes[redirectPath]=angular.extend({redirectTo:path},pathRegExp(redirectPath,route))}return this};function pathRegExp(path,opts){var insensitive=opts.caseInsensitiveMatch,ret={originalPath:path,regexp:path},keys=ret.keys=[];path=path.replace(/([().])/g,"\\$1").replace(/(\/)?:(\w+)([\?|\*])?/g,function(_,slash,key,option){var optional=option==="?"?option:null;var star=option==="*"?option:null;keys.push({name:key,optional:!!optional});slash=slash||"";return""+(optional?"":slash)+"(?:"+(optional?slash:"")+(star&&"(.+?)"||"([^/]+)")+(optional||"")+")"+(optional||"")}).replace(/([\/$\*])/g,"\\$1");ret.regexp=new RegExp("^"+path+"$",insensitive?"i":"");return ret}this.otherwise=function(params){this.when(null,params);return this};this.$get=["$rootScope","$location","$routeParams","$q","$injector","$http","$templateCache","$sce",function($rootScope,$location,$routeParams,$q,$injector,$http,$templateCache,$sce){var forceReload=false,$route={routes:routes,reload:function(){forceReload=true;$rootScope.$evalAsync(updateRoute)}};$rootScope.$on("$locationChangeSuccess",updateRoute);return $route;function switchRouteMatcher(on,route){var keys=route.keys,params={};if(!route.regexp)return null;var m=route.regexp.exec(on);if(!m)return null;for(var i=1,len=m.length;i<len;++i){var key=keys[i-1];var val="string"==typeof m[i]?decodeURIComponent(m[i]):m[i];if(key&&val){params[key.name]=val}}return params}function updateRoute(){var next=parseRoute(),last=$route.current;if(next&&last&&next.$$route===last.$$route&&angular.equals(next.pathParams,last.pathParams)&&!next.reloadOnSearch&&!forceReload){last.params=next.params;angular.copy(last.params,$routeParams);$rootScope.$broadcast("$routeUpdate",last)}else if(next||last){forceReload=false;$rootScope.$broadcast("$routeChangeStart",next,last);$route.current=next;if(next){if(next.redirectTo){if(angular.isString(next.redirectTo)){$location.path(interpolate(next.redirectTo,next.params)).search(next.params).replace()}else{$location.url(next.redirectTo(next.pathParams,$location.path(),$location.search())).replace()}}}$q.when(next).then(function(){if(next){var locals=angular.extend({},next.resolve),template,templateUrl;angular.forEach(locals,function(value,key){locals[key]=angular.isString(value)?$injector.get(value):$injector.invoke(value)});if(angular.isDefined(template=next.template)){if(angular.isFunction(template)){template=template(next.params)}}else if(angular.isDefined(templateUrl=next.templateUrl)){if(angular.isFunction(templateUrl)){templateUrl=templateUrl(next.params)}templateUrl=$sce.getTrustedResourceUrl(templateUrl);if(angular.isDefined(templateUrl)){next.loadedTemplateUrl=templateUrl;template=$http.get(templateUrl,{cache:$templateCache}).then(function(response){return response.data})}}if(angular.isDefined(template)){locals["$template"]=template}return $q.all(locals)}}).then(function(locals){if(next==$route.current){if(next){next.locals=locals;angular.copy(next.params,$routeParams)}$rootScope.$broadcast("$routeChangeSuccess",next,last)}},function(error){if(next==$route.current){$rootScope.$broadcast("$routeChangeError",next,last,error)}})}}function parseRoute(){var params,match;angular.forEach(routes,function(route,path){if(!match&&(params=switchRouteMatcher($location.path(),route))){match=inherit(route,{params:angular.extend({},$location.search(),params),pathParams:params});match.$$route=route}});return match||routes[null]&&inherit(routes[null],{params:{},pathParams:{}})}function interpolate(string,params){var result=[];angular.forEach((string||"").split(":"),function(segment,i){if(i===0){result.push(segment)}else{var segmentMatch=segment.match(/(\w+)(.*)/);var key=segmentMatch[1];result.push(params[key]);result.push(segmentMatch[2]||"");delete params[key]}});return result.join("")}}]}ngRouteModule.provider("$routeParams",$RouteParamsProvider);function $RouteParamsProvider(){this.$get=function(){return{}}}ngRouteModule.directive("ngView",ngViewFactory);ngRouteModule.directive("ngView",ngViewFillContentFactory);ngViewFactory.$inject=["$route","$anchorScroll","$animate"];function ngViewFactory($route,$anchorScroll,$animate){return{restrict:"ECA",terminal:true,priority:400,transclude:"element",link:function(scope,$element,attr,ctrl,$transclude){var currentScope,currentElement,autoScrollExp=attr.autoscroll,onloadExp=attr.onload||"";scope.$on("$routeChangeSuccess",update);update();function cleanupLastView(){if(currentScope){currentScope.$destroy();currentScope=null}if(currentElement){$animate.leave(currentElement);currentElement=null}}function update(){var locals=$route.current&&$route.current.locals,template=locals&&locals.$template;if(template){var newScope=scope.$new();var current=$route.current;var clone=$transclude(newScope,function(clone){$animate.enter(clone,null,currentElement||$element,function onNgViewEnter(){if(angular.isDefined(autoScrollExp)&&(!autoScrollExp||scope.$eval(autoScrollExp))){$anchorScroll()}});cleanupLastView()});currentElement=clone;currentScope=current.scope=newScope;currentScope.$emit("$viewContentLoaded");currentScope.$eval(onloadExp)}else{cleanupLastView()}}}}}ngViewFillContentFactory.$inject=["$compile","$controller","$route"];function ngViewFillContentFactory($compile,$controller,$route){return{restrict:"ECA",priority:-400,link:function(scope,$element){var current=$route.current,locals=current.locals;$element.html(locals.$template);var link=$compile($element.contents());if(current.controller){locals.$scope=scope;var controller=$controller(current.controller,locals);if(current.controllerAs){scope[current.controllerAs]=controller}$element.data("$ngControllerController",controller);$element.children().data("$ngControllerController",controller)}link(scope)}}}})(window,window.angular);(function(root,factory){if(typeof exports=="object")module.exports=factory();else if(typeof define=="function"&&define.amd)define(factory);else root.Spinner=factory()})(this,function(){"use strict";var prefixes=["webkit","Moz","ms","O"],animations={},useCssAnimations;function createEl(tag,prop){var el=document.createElement(tag||"div"),n;for(n in prop)el[n]=prop[n];return el}function ins(parent){for(var i=1,n=arguments.length;i<n;i++)parent.appendChild(arguments[i]);return parent}var sheet=function(){var el=createEl("style",{type:"text/css"});ins(document.getElementsByTagName("head")[0],el);return el.sheet||el.styleSheet}();function addAnimation(alpha,trail,i,lines){var name=["opacity",trail,~~(alpha*100),i,lines].join("-"),start=.01+i/lines*100,z=Math.max(1-(1-alpha)/trail*(100-start),alpha),prefix=useCssAnimations.substring(0,useCssAnimations.indexOf("Animation")).toLowerCase(),pre=prefix&&"-"+prefix+"-"||"";if(!animations[name]){sheet.insertRule("@"+pre+"keyframes "+name+"{"+"0%{opacity:"+z+"}"+start+"%{opacity:"+alpha+"}"+(start+.01)+"%{opacity:1}"+(start+trail)%100+"%{opacity:"+alpha+"}"+"100%{opacity:"+z+"}"+"}",sheet.cssRules.length);animations[name]=1}return name}function vendor(el,prop){var s=el.style,pp,i;prop=prop.charAt(0).toUpperCase()+prop.slice(1);for(i=0;i<prefixes.length;i++){pp=prefixes[i]+prop;if(s[pp]!==undefined)return pp}if(s[prop]!==undefined)return prop}function css(el,prop){for(var n in prop)el.style[vendor(el,n)||n]=prop[n];return el}function merge(obj){for(var i=1;i<arguments.length;i++){var def=arguments[i];for(var n in def)if(obj[n]===undefined)obj[n]=def[n]}return obj}function pos(el){var o={x:el.offsetLeft,y:el.offsetTop};while(el=el.offsetParent)o.x+=el.offsetLeft,o.y+=el.offsetTop;return o}function getColor(color,idx){return typeof color=="string"?color:color[idx%color.length]}var defaults={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:1/4,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};function Spinner(o){if(typeof this=="undefined")return new Spinner(o);this.opts=merge(o||{},Spinner.defaults,defaults)}Spinner.defaults={};merge(Spinner.prototype,{spin:function(target){this.stop();var self=this,o=self.opts,el=self.el=css(createEl(0,{className:o.className}),{position:o.position,width:0,zIndex:o.zIndex}),mid=o.radius+o.length+o.width,ep,tp;if(target){target.insertBefore(el,target.firstChild||null);tp=pos(target);ep=pos(el);css(el,{left:(o.left=="auto"?tp.x-ep.x+(target.offsetWidth>>1):parseInt(o.left,10)+mid)+"px",top:(o.top=="auto"?tp.y-ep.y+(target.offsetHeight>>1):parseInt(o.top,10)+mid)+"px"})}el.setAttribute("role","progressbar");self.lines(el,self.opts);if(!useCssAnimations){var i=0,start=(o.lines-1)*(1-o.direction)/2,alpha,fps=o.fps,f=fps/o.speed,ostep=(1-o.opacity)/(f*o.trail/100),astep=f/o.lines;(function anim(){i++;for(var j=0;j<o.lines;j++){alpha=Math.max(1-(i+(o.lines-j)*astep)%f*ostep,o.opacity);self.opacity(el,j*o.direction+start,alpha,o)}self.timeout=self.el&&setTimeout(anim,~~(1e3/fps))})()}return self},stop:function(){var el=this.el;if(el){clearTimeout(this.timeout);if(el.parentNode)el.parentNode.removeChild(el);this.el=undefined}return this},lines:function(el,o){var i=0,start=(o.lines-1)*(1-o.direction)/2,seg;function fill(color,shadow){return css(createEl(),{position:"absolute",width:o.length+o.width+"px",height:o.width+"px",background:color,boxShadow:shadow,transformOrigin:"left",transform:"rotate("+~~(360/o.lines*i+o.rotate)+"deg) translate("+o.radius+"px"+",0)",borderRadius:(o.corners*o.width>>1)+"px"})}for(;i<o.lines;i++){seg=css(createEl(),{position:"absolute",top:1+~(o.width/2)+"px",transform:o.hwaccel?"translate3d(0,0,0)":"",opacity:o.opacity,animation:useCssAnimations&&addAnimation(o.opacity,o.trail,start+i*o.direction,o.lines)+" "+1/o.speed+"s linear infinite"});if(o.shadow)ins(seg,css(fill("#000","0 0 4px "+"#000"),{top:2+"px"}));ins(el,ins(seg,fill(getColor(o.color,i),"0 0 1px rgba(0,0,0,.1)")))}return el},opacity:function(el,i,val){if(i<el.childNodes.length)el.childNodes[i].style.opacity=val}});function initVML(){function vml(tag,attr){return createEl("<"+tag+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',attr)}sheet.addRule(".spin-vml","behavior:url(#default#VML)");Spinner.prototype.lines=function(el,o){var r=o.length+o.width,s=2*r;function grp(){return css(vml("group",{coordsize:s+" "+s,coordorigin:-r+" "+-r}),{width:s,height:s})}var margin=-(o.width+o.length)*2+"px",g=css(grp(),{position:"absolute",top:margin,left:margin}),i;function seg(i,dx,filter){ins(g,ins(css(grp(),{rotation:360/o.lines*i+"deg",left:~~dx}),ins(css(vml("roundrect",{arcsize:o.corners}),{width:r,height:o.width,left:o.radius,top:-o.width>>1,filter:filter}),vml("fill",{color:getColor(o.color,i),opacity:o.opacity}),vml("stroke",{opacity:0}))))}if(o.shadow)for(i=1;i<=o.lines;i++)seg(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=o.lines;i++)seg(i);return ins(el,g)};Spinner.prototype.opacity=function(el,i,val,o){var c=el.firstChild;o=o.shadow&&o.lines||0;if(c&&i+o<c.childNodes.length){c=c.childNodes[i+o];c=c&&c.firstChild;c=c&&c.firstChild;if(c)c.opacity=val}}}var probe=css(createEl("group"),{behavior:"url(#default#VML)"});if(!vendor(probe,"transform")&&probe.adj)initVML();else useCssAnimations=vendor(probe,"animation");return Spinner});var iosOverlay=function(e){"use strict";var t,n=function(){},r={onbeforeshow:n,onshow:n,onbeforehide:n,onhide:n,text:"",icon:null,spinner:null,duration:null,id:null,parentEl:null},i=function(e,t){var n={};for(var r in e)n[r]=e[r];for(var i in t)n[i]=t[i];return n},s=function(){var e=document.body||document.documentElement,t=e.style,n="transition";if(typeof t[n]=="string")return!0;var r=["Moz","Webkit","Khtml","O","ms"];n=n.charAt(0).toUpperCase()+n.substr(1);for(var i=0;i<r.length;i++)if(typeof t[r[i]+n]=="string")return!0;return!1}(),o=i(r,e),u=function(e){e.animationName==="ios-overlay-show"&&o.onshow();if(e.animationName==="ios-overlay-hide"){l();o.onhide()}},a=function(){t=document.createElement("div");t.className="ui-ios-overlay";t.innerHTML+='<span class="title">'+o.text+"</span";e.icon?t.innerHTML+='<img src="'+e.icon+'">':e.spinner&&t.appendChild(e.spinner.el);if(s){t.addEventListener("webkitAnimationEnd",u,!1);t.addEventListener("msAnimationEnd",u,!1);t.addEventListener("oAnimationEnd",u,!1);t.addEventListener("animationend",u,!1)}e.parentEl?document.getElementById(e.parentEl).appendChild(t):document.body.appendChild(t);o.onbeforeshow();s?t.className+=" ios-overlay-show":typeof $=="function"&&$(t).fadeIn({duration:200},function(){o.onshow()});o.duration&&window.setTimeout(function(){f()},o.duration)}(),f=function(){o.onbeforehide();s?t.className=t.className.replace("show","hide"):typeof $=="function"&&$(t).fadeOut({duration:200},function(){l();o.onhide()})},l=function(){e.parentEl?document.getElementById(e.parentEl).removeChild(t):document.body.removeChild(t)},c=function(e){e.text&&(t.getElementsByTagName("span")[0].innerHTML=e.text);if(e.icon){o.spinner&&o.spinner.el.parentNode.removeChild(o.spinner.el);t.innerHTML+='<img src="'+e.icon+'">'}};return{hide:f,destroy:l,update:c}};(function(){"use strict";var atob,b64chars,b64tab,btoa,btou,buffer,cb_btou,cb_decode,cb_encode,cb_utob,decode,encode,encodeURI,fromCharCode,global,noEnum,re_btou,re_utob,utob,version,_decode,_encode;global=this;if(global.Base64){return}version="2.1.2";buffer=void 0;if(typeof module!=="undefined"&&module.exports){buffer=require("buffer").Buffer}b64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";b64tab=function(bin){var i,l,t;t={};i=0;l=bin.length;while(i<l){t[bin.charAt(i)]=i;i++}return t};b64chars;fromCharCode=String.fromCharCode;cb_utob=function(c){var cc;if(c.length<2){cc=c.charCodeAt(0);if(cc<128){return c}else{if(cc<2048){return fromCharCode(192|cc>>>6)+fromCharCode(128|cc&63)}else{return fromCharCode(224|cc>>>12&15)+fromCharCode(128|cc>>>6&63)+fromCharCode(128|cc&63)}}}else{cc=65536+(c.charCodeAt(0)-55296)*1024+(c.charCodeAt(1)-56320);return fromCharCode(240|cc>>>18&7)+fromCharCode(128|cc>>>12&63)+fromCharCode(128|cc>>>6&63)+fromCharCode(128|cc&63)}};re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g;utob=function(u){return u.replace(re_utob,cb_utob)};cb_encode=function(ccc){var chars,ord,padlen;padlen=[0,2,1][ccc.length%3];ord=ccc.charCodeAt(0)<<16|(ccc.length>1?ccc.charCodeAt(1):0)<<8|(ccc.length>2?ccc.charCodeAt(2):0);chars=[b64chars.charAt(ord>>>18),b64chars.charAt(ord>>>12&63),padlen>=2?"=":b64chars.charAt(ord>>>6&63),padlen>=1?"=":b64chars.charAt(ord&63)];return chars.join("")};btoa=global.btoa||function(b){return b.replace(/[\s\S]{1,3}/g,cb_encode)};_encode=buffer?function(u){return new buffer(u).toString("base64")}:function(u){return btoa(utob(u))};encode=function(u,urisafe){if(!urisafe){return _encode(u)}else{return _encode(u).replace(/[+\/]/g,function(m0){if(m0==="+"){return"-"}else{return"_"}}).replace(RegExp("=","g"),"")}};encodeURI=function(u){return encode(u,true)};re_btou=re_btou=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g");cb_btou=function(cccc){var cp,offset;switch(cccc.length){case 4:cp=(7&cccc.charCodeAt(0))<<18|(63&cccc.charCodeAt(1))<<12|(63&cccc.charCodeAt(2))<<6|63&cccc.charCodeAt(3);offset=cp-65536;return fromCharCode((offset>>>10)+55296)+fromCharCode((offset&1023)+56320);case 3:return fromCharCode((15&cccc.charCodeAt(0))<<12|(63&cccc.charCodeAt(1))<<6|63&cccc.charCodeAt(2));default:return fromCharCode((31&cccc.charCodeAt(0))<<6|63&cccc.charCodeAt(1))}};btou=function(b){return b.replace(re_btou,cb_btou)};cb_decode=function(cccc){var chars,len,n,padlen;len=cccc.length;padlen=len%4;n=(len>0?b64tab[cccc.charAt(0)]<<18:0)|(len>1?b64tab[cccc.charAt(1)]<<12:0)|(len>2?b64tab[cccc.charAt(2)]<<6:0)|(len>3?b64tab[cccc.charAt(3)]:0);chars=[fromCharCode(n>>>16),fromCharCode(n>>>8&255),fromCharCode(n&255)];chars.length-=[0,0,2,1][padlen];return chars.join("")};atob=global.atob||function(a){return a.replace(/[\s\S]{1,4}/g,cb_decode)};_decode=buffer?function(a){return new buffer(a,"base64").toString()}:function(a){return btou(atob(a))};decode=function(a){return _decode(a.replace(/[-_]/g,function(m0){if(m0==="-"){return"+"}else{return"/"}}).replace(/[^A-Za-z0-9\+\/]/g,""))};global.Base64={VERSION:version,atob:atob,btoa:btoa,fromBase64:decode,toBase64:encode,utob:utob,encode:encode,encodeURI:encodeURI,btou:btou,decode:decode};if(typeof Object.defineProperty==="function"){noEnum=function(v){return{value:v,enumerable:false,writable:true,configurable:true}};global.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",noEnum(function(){return decode(this)}));Object.defineProperty(String.prototype,"toBase64",noEnum(function(urisafe){return encode(this,urisafe)}));return Object.defineProperty(String.prototype,"toBase64URI",noEnum(function(){return encode(this,true)}))}}}).call(this);!function(e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):"undefined"!=typeof window?window.PouchDB=e():"undefined"!=typeof global?global.PouchDB=e():"undefined"!=typeof self&&(self.PouchDB=e())}(function(){var define,module,exports;return function e(t,n,r){function o(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+a+"'")}var c=n[a]={exports:{}};t[a][0].call(c.exports,function(e){var n=t[a][1][e];return o(n?n:e)},c,c.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(require,module,exports){"use strict";function arrayFirst(e,t){for(var n=0;n<e.length;n++)if(t(e[n],n)===!0)return e[n];return!1}function yankError(e){return function(t,n){t||n[0].error?call(e,t||n[0]):call(e,null,n[0])}}function computeHeight(e){var t={},n=[];return merge.traverseRevTree(e,function(e,r,o,i){var a=r+"-"+o;return e&&(t[a]=0),void 0!==i&&n.push({from:i,to:a}),a}),n.reverse(),n.forEach(function(e){t[e.from]=void 0===t[e.from]?1+t[e.to]:Math.min(t[e.from],1+t[e.to])}),t}var utils=require("./utils"),merge=require("./merge"),errors=require("./deps/errors"),call=utils.call;module.exports=function(Pouch){return function(opts,callback){function autoCompact(e){return auto_compaction?function(t,n){if(t)call(e,t);else{var r=n.length,o=function(){r--,r||call(e,null,n)};n.forEach(function(e){e.ok?compactDocument(e.id,1,o):o()})}}:e}function compactDocument(e,t,n){customApi._getRevisionTree(e,function(r,o){if(r)return call(n);var i=computeHeight(o),a=[],s=[];Object.keys(i).forEach(function(e){i[e]>t&&a.push(e)}),merge.traverseRevTree(o,function(e,t,n,r,o){var i=t+"-"+n;"available"===o.status&&-1!==a.indexOf(i)&&(o.status="missing",s.push(i))}),customApi._doCompaction(e,o,s,n)})}function processChange(e,t,n){var r=[{rev:e._rev}];"all_docs"===n.style&&(r=merge.collectLeaves(t.rev_tree).map(function(e){return{rev:e.rev}}));var o={id:t.id,changes:r,doc:e};return utils.isDeleted(t,e._rev)&&(o.deleted=!0),n.conflicts&&(o.doc._conflicts=merge.collectConflicts(t),o.doc._conflicts.length||delete o.doc._conflicts),o}var api={},customApi=Pouch.adapters[opts.adapter](opts,function(e,t){if(e)return callback&&callback(e),void 0;for(var n in api)t.hasOwnProperty(n)||(t[n]=api[n]);opts.name===Pouch.prefix+Pouch.ALL_DBS?callback(e,t):Pouch.open(opts,function(e){callback(e,t)})}),auto_compaction=opts.auto_compaction===!0;api.post=function(e,t,n){return"function"==typeof t&&(n=t,t={}),"object"!=typeof e||Array.isArray(e)?call(n,errors.NOT_AN_OBJECT):customApi.bulkDocs({docs:[e]},t,autoCompact(yankError(n)))},api.put=function(e,t,n){return"function"==typeof t&&(n=t,t={}),"object"!=typeof e?call(n,errors.NOT_AN_OBJECT):utils.isValidId(e._id)?customApi.bulkDocs({docs:[e]},t,autoCompact(yankError(n))):call(n,errors.MISSING_ID)},api.putAttachment=function(e,t,n,r,o,i){function a(e){e._attachments=e._attachments||{},e._attachments[t]={content_type:o,data:r},api.put(e,i)}return api.taskqueue.ready()?("function"==typeof o&&(i=o,o=r,r=n,n=null),"undefined"==typeof o&&(o=r,r=n,n=null),api.get(e,function(t,r){return t&&t.error===errors.MISSING_DOC.error?(a({_id:e}),void 0):t?(call(i,t),void 0):r._rev!==n?(call(i,errors.REV_CONFLICT),void 0):(a(r),void 0)}),void 0):(api.taskqueue.addTask("putAttachment",arguments),void 0)},api.removeAttachment=function(e,t,n,r){api.get(e,function(e,o){return e?(call(r,e),void 0):o._rev!==n?(call(r,errors.REV_CONFLICT),void 0):o._attachments?(delete o._attachments[t],0===Object.keys(o._attachments).length&&delete o._attachments,api.put(o,r),void 0):call(r,null)})},api.remove=function(e,t,n){"function"==typeof t&&(n=t,t={}),void 0===t&&(t={}),t.was_delete=!0;var r={_id:e._id,_rev:e._rev};return r._deleted=!0,customApi.bulkDocs({docs:[r]},t,yankError(n))},api.revsDiff=function(e,t,n){function r(e,t){s[e]||(s[e]={missing:[]}),s[e].missing.push(t)}function o(t,n){var o=e[t].slice(0);merge.traverseRevTree(n,function(e,n,i,a,s){var u=n+"-"+i,c=o.indexOf(u);-1!==c&&(o.splice(c,1),"available"!==s.status&&r(t,u))}),o.forEach(function(e){r(t,e)})}"function"==typeof t&&(n=t,t={});var i=Object.keys(e),a=0,s={};i.map(function(t){customApi._getRevisionTree(t,function(r,u){if(r&&"not_found"===r.name&&"missing"===r.message)s[t]={missing:e[t]};else{if(r)return call(n,r);o(t,u)}return++a===i.length?call(n,null,s):void 0})})},api.compact=function(e,t){"function"==typeof e&&(t=e,e={}),api.changes({complete:function(e,n){if(e)return call(t),void 0;var r=n.results.length;return r?(n.results.forEach(function(e){compactDocument(e.id,0,function(){r--,r||call(t)})}),void 0):(call(t),void 0)}})},api.get=function(e,t,n){function r(){var r=[],i=o.length;return i?(o.forEach(function(o){api.get(e,{rev:o,revs:t.revs},function(e,t){e?r.push({missing:o}):r.push({ok:t}),i--,i||call(n,null,r)})}),void 0):call(n,null,r)}if(!api.taskqueue.ready())return api.taskqueue.addTask("get",arguments),void 0;"function"==typeof t&&(n=t,t={});var o=[];{if(!t.open_revs)return customApi._get(e,t,function(e,r){if(e)return call(n,e);var o=r.doc,i=r.metadata,a=r.ctx;if(t.conflicts){var s=merge.collectConflicts(i);s.length&&(o._conflicts=s)}if(t.revs||t.revs_info){var u=merge.rootToLeaf(i.rev_tree),c=arrayFirst(u,function(e){return-1!==e.ids.map(function(e){return e.id}).indexOf(o._rev.split("-")[1])});if(c.ids.splice(c.ids.map(function(e){return e.id}).indexOf(o._rev.split("-")[1])+1),c.ids.reverse(),t.revs&&(o._revisions={start:c.pos+c.ids.length-1,ids:c.ids.map(function(e){return e.id})}),t.revs_info){var d=c.pos+c.ids.length;o._revs_info=c.ids.map(function(e){return d--,{rev:d+"-"+e.id,status:e.opts.status}})}}if(t.local_seq&&(o._local_seq=r.metadata.seq),t.attachments&&o._attachments){var l=o._attachments,f=Object.keys(l).length;if(0===f)return call(n,null,o);Object.keys(l).forEach(function(e){customApi._getAttachment(l[e],{encode:!0,ctx:a},function(t,r){o._attachments[e].data=r,--f||call(n,null,o)})})}else{if(o._attachments)for(var p in o._attachments)o._attachments[p].stub=!0;call(n,null,o)}});if("all"===t.open_revs)customApi._getRevisionTree(e,function(e,t){e&&(t=[]),o=merge.collectLeaves(t).map(function(e){return e.rev}),r()});else{if(!Array.isArray(t.open_revs))return call(n,errors.error(errors.UNKNOWN_ERROR,"function_clause"));o=t.open_revs;for(var i=0;i<o.length;i++){var a=o[i];if("string"!=typeof a||!/^\d+-/.test(a))return call(n,errors.error(errors.BAD_REQUEST,"Invalid rev format"))}r()}}},api.getAttachment=function(e,t,n,r){return api.taskqueue.ready()?(n instanceof Function&&(r=n,n={}),customApi._get(e,n,function(e,o){return e?call(r,e):o.doc._attachments&&o.doc._attachments[t]?(n.ctx=o.ctx,customApi._getAttachment(o.doc._attachments[t],n,r),void 0):call(r,errors.MISSING_DOC)}),void 0):(api.taskqueue.addTask("getAttachment",arguments),void 0)},api.allDocs=function(e,t){if(!api.taskqueue.ready())return api.taskqueue.addTask("allDocs",arguments),void 0;if("function"==typeof e&&(t=e,e={}),"keys"in e){if("startkey"in e)return call(t,errors.error(errors.QUERY_PARSE_ERROR,"Query parameter `start_key` is not compatible with multi-get")),void 0;if("endkey"in e)return call(t,errors.error(errors.QUERY_PARSE_ERROR,"Query parameter `end_key` is not compatible with multi-get")),void 0}return"undefined"==typeof e.skip&&(e.skip=0),customApi._allDocs(e,t)},api.changes=function(opts){if(!api.taskqueue.ready()){var task=api.taskqueue.addTask("changes",arguments);return{cancel:function(){return task.task?task.task.cancel():(Pouch.DEBUG,task.parameters[0].aborted=!0,void 0)}}}if(opts=utils.extend(!0,{},opts),opts.processChange=processChange,opts.since||(opts.since=0),"latest"===opts.since){var changes;return api.info(function(e,t){opts.aborted||(opts.since=t.update_seq-1,api.changes(opts))}),{cancel:function(){return changes?changes.cancel():(Pouch.DEBUG,opts.aborted=!0,void 0)}}}if(opts.filter&&"string"==typeof opts.filter){if("_view"===opts.filter)if(opts.view&&"string"==typeof opts.view){var viewName=opts.view.split("/");api.get("_design/"+viewName[0],function(err,ddoc){if(ddoc&&ddoc.views&&ddoc.views[viewName[1]]){var filter=eval("(function () {  return function (doc) {    var emitted = false;    var emit = function (a, b) {      emitted = true;    };    var view = "+ddoc.views[viewName[1]].map+";    view(doc);    if (emitted) {      return true;    }  }})()");
opts.aborted||(opts.filter=filter,api.changes(opts))}else{var msg=ddoc.views?"missing json key: "+viewName[1]:"missing json key: views";err=err||errors.error(errors.MISSING_DOC,msg),utils.call(opts.complete,err)}})}else{var err=errors.error(errors.BAD_REQUEST,"`view` filter parameter is not provided.");utils.call(opts.complete,err)}else{var filterName=opts.filter.split("/");api.get("_design/"+filterName[0],function(err,ddoc){if(ddoc&&ddoc.filters&&ddoc.filters[filterName[1]]){var filter=eval("(function () { return "+ddoc.filters[filterName[1]]+" })()");opts.aborted||(opts.filter=filter,api.changes(opts))}else{var msg=ddoc&&ddoc.filters?"missing json key: "+filterName[1]:"missing json key: filters";err=err||errors.error(errors.MISSING_DOC,msg),utils.call(opts.complete,err)}})}return{cancel:function(){Pouch.DEBUG&&console.log("Cancel Changes Feed"),opts.aborted=!0}}}return"descending"in opts||(opts.descending=!1),opts.limit=0===opts.limit?1:opts.limit,customApi._changes(opts)},api.close=function(e){return api.taskqueue.ready()?customApi._close(e):(api.taskqueue.addTask("close",arguments),void 0)},api.info=function(e){return api.taskqueue.ready()?customApi._info(e):(api.taskqueue.addTask("info",arguments),void 0)},api.id=function(){return customApi._id()},api.type=function(){return"function"==typeof customApi._type?customApi._type():opts.adapter},api.bulkDocs=function(e,t,n){if(!api.taskqueue.ready())return api.taskqueue.addTask("bulkDocs",arguments),void 0;if("function"==typeof t&&(n=t,t={}),t=t?utils.extend(!0,{},t):{},!e||!e.docs||e.docs.length<1)return call(n,errors.MISSING_BULK_DOCS);if(!Array.isArray(e.docs))return call(n,errors.QUERY_PARSE_ERROR);for(var r=0;r<e.docs.length;++r)if("object"!=typeof e.docs[r]||Array.isArray(e.docs[r]))return call(n,errors.NOT_AN_OBJECT);return e=utils.extend(!0,{},e),"new_edits"in t||(t.new_edits=!0),customApi._bulkDocs(e,t,autoCompact(n))};var taskqueue={};taskqueue.ready=!1,taskqueue.queue=[],api.taskqueue={},api.taskqueue.execute=function(e){taskqueue.ready&&taskqueue.queue.forEach(function(t){t.task=e[t.name].apply(null,t.parameters)})},api.taskqueue.ready=function(){return 0===arguments.length?taskqueue.ready:(taskqueue.ready=arguments[0],void 0)},api.taskqueue.addTask=function(e,t){var n={name:e,parameters:t};return taskqueue.queue.push(n),n},api.replicate={},api.replicate.from=function(e,t,n){return"function"==typeof t&&(n=t,t={}),Pouch.replicate(e,customApi,t,n)},api.replicate.to=function(e,t,n){return"function"==typeof t&&(n=t,t={}),Pouch.replicate(customApi,e,t,n)};for(var j in api)customApi.hasOwnProperty(j)||(customApi[j]=api[j]);return opts.skipSetup&&(api.taskqueue.ready(!0),api.taskqueue.execute(api)),utils.isCordova()&&cordova.fireWindowEvent(opts.name+"_pouch",{}),customApi}}},{"./deps/errors":8,"./merge":13,"./utils":16}],2:[function(e,t){"use strict";function n(e){for(var t=n.options,r=t.parser[t.strictMode?"strict":"loose"].exec(e),o={},i=14;i--;)o[t.key[i]]=r[i]||"";return o[t.q.name]={},o[t.key[12]].replace(t.q.parser,function(e,n,r){n&&(o[t.q.name][n]=r)}),o}function r(e){return/^_(design|local)/.test(e)?e:encodeURIComponent(e)}function o(e,t){if(/http(s?):/.test(e)){var r=n(e);r.remote=!0,(r.user||r.password)&&(r.auth={username:r.user,password:r.password});var o=r.path.replace(/(^\/|\/$)/g,"").split("/");if(r.db=o.pop(),r.path=o.join("/"),t=t||{},r.headers=t.headers||{},t.auth||r.auth){var i=t.auth||r.auth,a=u.btoa(i.username+":"+i.password);r.headers.Authorization="Basic "+a}return t.headers&&(r.headers=t.headers),r}return{host:"",path:"/",db:e,auth:!1}}function i(e,t){if(e.remote){var n=e.path?"/":"";return e.protocol+"://"+e.host+":"+e.port+"/"+e.path+n+e.db+"/"+t}return"/"+e.db+"/"+t}function a(e,t){if(e.remote){var n=e.path?"/":"";return e.protocol+"://"+e.host+":"+e.port+"/"+e.path+n+t}return"/"+t}function s(e,t){function n(e,t){return u.ajax(u.extend({},f,e),t)}var s=o(e.name,e),d=i(s,""),l={},f=e.ajax||{},p={list:[],get:function(e,t){"function"==typeof e&&(t=e,e={count:10});var r=function(e,n){!e&&"uuids"in n?(p.list=p.list.concat(n.uuids),u.call(t,null,"OK")):u.call(t,e||c.UNKNOWN_ERROR)},o="?count="+e.count;n({headers:s.headers,method:"GET",url:a(s,"_uuids")+o},r)}},v=function(){n({headers:s.headers,method:"PUT",url:d},function(e){e&&401===e.status?n({headers:s.headers,method:"HEAD",url:d},function(e){e?u.call(t,e):u.call(t,null,l)}):e&&412!==e.status?u.call(t,c.UNKNOWN_ERROR):u.call(t,null,l)})};return e.skipSetup||n({headers:s.headers,method:"GET",url:d},function(e){e?404===e.status?v():u.call(t,e):u.call(t,null,l)}),l.type=function(){return"http"},l.id=function(){return i(s,"")},l.request=function(e,t){return l.taskqueue.ready()?(e.headers=s.headers,e.url=i(s,e.url),n(e,t),void 0):(l.taskqueue.addTask("request",arguments),void 0)},l.compact=function(e,t){return l.taskqueue.ready()?("function"==typeof e&&(t=e,e={}),n({headers:s.headers,url:i(s,"_compact"),method:"POST"},function(){function n(){l.info(function(r,o){o.compact_running?setTimeout(n,e.interval||200):u.call(t,null)})}"function"==typeof t&&n()}),void 0):(l.taskqueue.addTask("compact",arguments),void 0)},l.info=function(e){return l.taskqueue.ready()?(n({headers:s.headers,method:"GET",url:i(s,"")},e),void 0):(l.taskqueue.addTask("info",arguments),void 0)},l.get=function(e,t,o){if(!l.taskqueue.ready())return l.taskqueue.addTask("get",arguments),void 0;"function"==typeof t&&(o=t,t={}),void 0===t.auto_encode&&(t.auto_encode=!0);var a=[];t.revs&&a.push("revs=true"),t.revs_info&&a.push("revs_info=true"),t.local_seq&&a.push("local_seq=true"),t.open_revs&&("all"!==t.open_revs&&(t.open_revs=JSON.stringify(t.open_revs)),a.push("open_revs="+t.open_revs)),t.attachments&&a.push("attachments=true"),t.rev&&a.push("rev="+t.rev),t.conflicts&&a.push("conflicts="+t.conflicts),a=a.join("&"),a=""===a?"":"?"+a,t.auto_encode&&(e=r(e));var c={headers:s.headers,method:"GET",url:i(s,e+a)},d=e.split("/");(d.length>1&&"_design"!==d[0]&&"_local"!==d[0]||d.length>2&&"_design"===d[0]&&"_local"!==d[0])&&(c.binary=!0),n(c,function(e,t,n){return e?u.call(o,e):(u.call(o,null,t,n),void 0)})},l.remove=function(e,t,o){return l.taskqueue.ready()?("function"==typeof t&&(o=t,t={}),n({headers:s.headers,method:"DELETE",url:i(s,r(e._id))+"?rev="+e._rev},o),void 0):(l.taskqueue.addTask("remove",arguments),void 0)},l.getAttachment=function(e,t,n,o){"function"==typeof n&&(o=n,n={}),void 0===n.auto_encode&&(n.auto_encode=!0),n.auto_encode&&(e=r(e)),n.auto_encode=!1,l.get(e+"/"+t,n,o)},l.removeAttachment=function(e,t,o,a){return l.taskqueue.ready()?(n({headers:s.headers,method:"DELETE",url:i(s,r(e)+"/"+t)+"?rev="+o},a),void 0):(l.taskqueue.addTask("removeAttachment",arguments),void 0)},l.putAttachment=function(e,t,o,a,u,c){if(!l.taskqueue.ready())return l.taskqueue.addTask("putAttachment",arguments),void 0;"function"==typeof u&&(c=u,u=a,a=o,o=null),"undefined"==typeof u&&(u=a,a=o,o=null);var d=r(e)+"/"+t,f=i(s,d);o&&(f+="?rev="+o);var p={headers:s.headers,method:"PUT",url:f,processData:!1,body:a,timeout:6e4};p.headers["Content-Type"]=u,n(p,c)},l.put=function(e,t,o){if(!l.taskqueue.ready())return l.taskqueue.addTask("put",arguments),void 0;if("function"==typeof t&&(o=t,t={}),"object"!=typeof e)return u.call(o,c.NOT_AN_OBJECT);if(!u.isValidId(e._id))return u.call(o,c.MISSING_ID);var a=[];t&&"undefined"!=typeof t.new_edits&&a.push("new_edits="+t.new_edits),a=a.join("&"),""!==a&&(a="?"+a),n({headers:s.headers,method:"PUT",url:i(s,r(e._id))+a,body:e},o)},l.post=function(e,t,n){return l.taskqueue.ready()?("function"==typeof t&&(n=t,t={}),"object"!=typeof e?u.call(n,c.NOT_AN_OBJECT):("_id"in e?l.put(e,t,n):p.list.length>0?(e._id=p.list.pop(),l.put(e,t,n)):p.get(function(r){return r?u.call(n,c.UNKNOWN_ERROR):(e._id=p.list.pop(),l.put(e,t,n),void 0)}),void 0)):(l.taskqueue.addTask("post",arguments),void 0)},l.bulkDocs=function(e,t,r){return l.taskqueue.ready()?("function"==typeof t&&(r=t,t={}),t||(t={}),"undefined"!=typeof t.new_edits&&(e.new_edits=t.new_edits),n({headers:s.headers,method:"POST",url:i(s,"_bulk_docs"),body:e},r),void 0):(l.taskqueue.addTask("bulkDocs",arguments),void 0)},l.allDocs=function(e,t){if(!l.taskqueue.ready())return l.taskqueue.addTask("allDocs",arguments),void 0;"function"==typeof e&&(t=e,e={});var r,o=[],a="GET";e.conflicts&&o.push("conflicts=true"),e.descending&&o.push("descending=true"),e.include_docs&&o.push("include_docs=true"),e.startkey&&o.push("startkey="+encodeURIComponent(JSON.stringify(e.startkey))),e.endkey&&o.push("endkey="+encodeURIComponent(JSON.stringify(e.endkey))),e.limit&&o.push("limit="+e.limit),"undefined"!=typeof e.skip&&o.push("skip="+e.skip),o=o.join("&"),""!==o&&(o="?"+o),"undefined"!=typeof e.keys&&(a="POST",r=JSON.stringify({keys:e.keys})),n({headers:s.headers,method:a,url:i(s,"_all_docs"+o),body:r},t)},l.changes=function(e){var t=25;if(!l.taskqueue.ready()){var r=l.taskqueue.addTask("changes",arguments);return{cancel:function(){return r.task?r.task.cancel():(r.parameters[0].aborted=!0,void 0)}}}if("latest"===e.since){var o;return l.info(function(t,n){e.aborted||(e.since=n.update_seq,o=l.changes(e))}),{cancel:function(){return o?o.cancel():(e.aborted=!0,void 0)}}}var a={},d="undefined"!=typeof e.limit?e.limit:!1;0===d&&(d=1);var f=d;if(e.style&&(a.style=e.style),(e.include_docs||e.filter&&"function"==typeof e.filter)&&(a.include_docs=!0),e.continuous&&(a.feed="longpoll"),e.conflicts&&(a.conflicts=!0),e.descending&&(a.descending=!0),e.filter&&"string"==typeof e.filter&&(a.filter=e.filter,"_view"===e.filter&&e.view&&"string"==typeof e.view&&(a.view=e.view)),e.query_params&&"object"==typeof e.query_params)for(var p in e.query_params)e.query_params.hasOwnProperty(p)&&(a[p]=e.query_params[p]);var v,_,h,m,g=function(r,o){a.since=r,e.continuous||m||(m=h),a.limit=!d||f>t?t:f;var u="?"+Object.keys(a).map(function(e){return e+"="+a[e]}).join("&"),c={headers:s.headers,method:"GET",url:i(s,"_changes"+u),timeout:null};_=r,e.aborted||(v=n(c,o))},y=10,b=0,w={results:[]},k=function(n,r){if(r&&r.results){w.last_seq=r.last_seq;var o={};o.query=e.query_params,r.results=r.results.filter(function(t){f--;var n=u.filterChange(e)(t);return n&&(w.results.push(t),u.call(e.onChange,t)),n})}else n&&(e.aborted=!0,u.call(e.complete,n,null));r&&r.last_seq&&(_=r.last_seq);var i=r&&r.results.length||0;m-=t;var a=d&&0>=f||r&&!i&&0>=m||i&&r.last_seq===h||e.descending&&0!==_;if(e.continuous||!a){n?b+=1:b=0;var s=1<<b,l=y*s,p=e.maximumWait||3e4;l>p&&u.call(e.complete,n||c.UNKNOWN_ERROR,null),setTimeout(function(){g(_,k)},l)}else u.call(e.complete,null,w)};return e.continuous?g(e.since||0,k):l.info(function(t,n){return t?u.call(e.complete,t):(h=n.update_seq,g(e.since||0,k),void 0)}),{cancel:function(){e.aborted=!0,v.abort()}}},l.revsDiff=function(e,t,r){return l.taskqueue.ready()?("function"==typeof t&&(r=t,t={}),n({headers:s.headers,method:"POST",url:i(s,"_revs_diff"),body:e},function(e,t){u.call(r,e,t)}),void 0):(l.taskqueue.addTask("revsDiff",arguments),void 0)},l.close=function(e){return l.taskqueue.ready()?(u.call(e,null),void 0):(l.taskqueue.addTask("close",arguments),void 0)},l.replicateOnServer=function(e,r,i){if(!l.taskqueue.ready())return l.taskqueue.addTask("replicateOnServer",arguments),i;var a=o(e.id()),c={source:s.db,target:a.protocol===s.protocol&&a.authority===s.authority?a.db:a.source};r.continuous&&(c.continuous=!0),r.create_target&&(c.create_target=!0),r.doc_ids&&(c.doc_ids=r.doc_ids),r.filter&&"string"==typeof r.filter&&(c.filter=r.filter),r.query_params&&(c.query_params=r.query_params);var d,f={},p={headers:s.headers,method:"POST",url:s.protocol+"://"+s.host+(80===s.port?"":":"+s.port)+"/_replicate",body:c};i.cancel=function(){this.cancelled=!0,d&&!f.ok&&d.abort(),f._local_id&&(p.body={replication_id:f._local_id}),p.body.cancel=!0,n(p,function(e,n,o){return e?u.call(t,e):(u.call(r.complete,null,f,o),void 0)})},i.cancelled||(d=n(p,function(e,n,o){return e?u.call(t,e):(f.ok=!0,n._local_id&&(f._local_id=n._local_id),u.call(r.complete,null,n,o),void 0)}))},l}var u=e("../utils"),c=e("../deps/errors");n.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},s.destroy=function(e,t,n){var r=o(e,t);t=t||{},"function"==typeof t&&(n=t,t={}),t.headers=r.headers,t.method="DELETE",t.url=i(r,""),u.ajax(t,n)},s.valid=function(){return!0},t.exports=s},{"../deps/errors":8,"../utils":16}],3:[function(e,t){"use strict";function n(e){return function(t){o.call(e,a.error(a.IDB_ERROR,t.target,t.type))}}function r(e,t){function s(e){e.createObjectStore(l,{keyPath:"id"}).createIndex("seq","seq",{unique:!0}),e.createObjectStore(f,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),e.createObjectStore(p,{keyPath:"digest"}),e.createObjectStore(v,{keyPath:"id",autoIncrement:!1}),e.createObjectStore(_)}function u(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),o=0;t>o;o++)r[o]=e.charCodeAt(o);return n}function c(e,t){return e._bulk_seq-t._bulk_seq}var d=1,l="document-store",f="by-sequence",p="attach-store",v="meta-store",_="detect-blob-support",h=e.name,m=window.indexedDB.open(h,d);"openReqList"in r||(r.openReqList={}),r.openReqList[h]=m;var g=null,y=null,b={},w=null;return m.onupgradeneeded=function(e){for(var t=e.target.result,n=e.oldVersion;n!==e.newVersion;)0===n&&s(t),n++},m.onsuccess=function(e){w=e.target.result,w.onversionchange=function(){w.close()};var n=w.transaction([v,_],"readwrite"),r=n.objectStore(v).get(v);r.onsuccess=function(e){var r=e.target.result||{id:v};h+"_id"in r?y=r[h+"_id"]:(y=o.uuid(),r[h+"_id"]=y,n.objectStore(v).put(r));try{n.objectStore(_).put(o.createBlob(),"key"),g=!0}catch(i){g=!1}finally{o.call(t,null,b)}}},m.onerror=n(t),b.type=function(){return"idb"},b.id=function(){return y},b._bulkDocs=function(e,t,s){function d(e){var t=e.target.result;t.updateSeq=(t.updateSeq||0)+A,N.objectStore(v).put(t)}function _(){if(!C.length)return N.objectStore(v).get(v).onsuccess=d,void 0;var e=C.shift(),t=N.objectStore(l).get(e.metadata.id);t.onsuccess=function(t){var n=t.target.result;n?q(n,e):S(e)}}function m(){var e=[];I.sort(c),I.forEach(function(t){if(delete t._bulk_seq,t.error)return e.push(t),void 0;var n=t.metadata,a=i.winningRev(n);e.push({ok:!0,id:n.id,rev:a}),o.isLocalId(n.id)||(r.Changes.notify(h),r.Changes.notifyLocalWindows(h))}),o.call(s,null,e)}function y(e,t){if(e.stub)return t();if("string"==typeof e.data){var n;try{n=atob(e.data)}catch(r){var i=a.error(a.BAD_ARG,"Attachments need to be base64 encoded");return o.call(s,i)}if(e.digest="md5-"+o.Crypto.MD5(n),g){var c=e.content_type;n=u(n),e.data=o.createBlob([n],{type:c})}return t()}var d=new FileReader;d.onloadend=function(){e.digest="md5-"+o.Crypto.MD5(this.result),g||(e.data=btoa(this.result)),t()},d.readAsBinaryString(e.data)}function b(e){function t(){n++,C.length===n&&e()}if(!C.length)return e();var n=0;C.forEach(function(e){function n(){o++,o===r.length&&t()}var r=e.data&&e.data._attachments?Object.keys(e.data._attachments):[];if(!r.length)return t();var o=0;for(var i in e.data._attachments)y(e.data._attachments[i],n)})}function k(e,t){function n(e){a||(e?(a=e,o.call(t,a)):s===u.length&&i())}function r(e){s++,n(e)}function i(){e.data._doc_id_rev=e.data._id+"::"+e.data._rev;var n=N.objectStore(f).put(e.data);n.onsuccess=function(n){e.metadata.seq=n.target.result,delete e.metadata.rev;var r=N.objectStore(l).put(e.metadata);r.onsuccess=function(){I.push(e),o.call(t)}}}var a=null,s=0;e.data._id=e.metadata.id,e.data._rev=e.metadata.rev,A++,o.isDeleted(e.metadata,e.metadata.rev)&&(e.data._deleted=!0);var u=e.data._attachments?Object.keys(e.data._attachments):[];for(var c in e.data._attachments)if(e.data._attachments[c].stub)s++,n();else{var d=e.data._attachments[c].data;delete e.data._attachments[c].data;var p=e.data._attachments[c].digest;R(e,p,d,r)}u.length||i()}function q(e,t){var n=i.merge(e.rev_tree,t.metadata.rev_tree[0],1e3),r=o.isDeleted(e),s=r&&o.isDeleted(t.metadata)||!r&&O&&"new_leaf"!==n.conflicts;return s?(I.push(E(a.REV_CONFLICT,t._bulk_seq)),_()):(t.metadata.rev_tree=n.tree,k(t,_),void 0)}function S(e){return"was_delete"in t&&o.isDeleted(e.metadata)?(I.push(a.MISSING_DOC),_()):(k(e,_),void 0)}function E(e,t){return e._bulk_seq=t,e}function R(e,t,n,r){{var i=N.objectStore(p);i.get(t).onsuccess=function(a){var s=a.target.result&&a.target.result.refs||{},u=[e.metadata.id,e.metadata.rev].join("@"),c={digest:t,body:n,refs:s};c.refs[u]=!0;i.put(c).onsuccess=function(){o.call(r)}}}}var O=t.new_edits,T=e.docs,C=T.map(function(e,t){var n=o.parseDoc(e,O);return n._bulk_seq=t,n}),D=C.filter(function(e){return e.error});if(D.length)return o.call(s,D[0]);var N,I=[],A=0;b(function(){N=w.transaction([l,f,p,v],"readwrite"),N.onerror=n(s),N.ontimeout=n(s),N.oncomplete=m,_()})},b._get=function(e,t,n){function r(){o.call(n,c,{doc:s,metadata:u,ctx:d})}var s,u,c,d;d=t.ctx?t.ctx:w.transaction([l,f,p],"readonly"),d.objectStore(l).get(e).onsuccess=function(e){if(u=e.target.result,!u)return c=a.MISSING_DOC,r();if(o.isDeleted(u)&&!t.rev)return c=a.error(a.MISSING_DOC,"deleted"),r();var n=i.winningRev(u),l=u.id+"::"+(t.rev?t.rev:n),p=d.objectStore(f).index("_doc_id_rev");p.get(l).onsuccess=function(e){return s=e.target.result,s&&s._doc_id_rev&&delete s._doc_id_rev,s?(r(),void 0):(c=a.MISSING_DOC,r())}}},b._getAttachment=function(e,t,n){var r,i;i=t.ctx?t.ctx:w.transaction([l,f,p],"readonly");var a=e.digest,s=e.content_type;i.objectStore(p).get(a).onsuccess=function(e){var i=e.target.result.body;if(t.encode)if(g){var a=new FileReader;a.onloadend=function(){r=btoa(this.result),o.call(n,null,r)},a.readAsBinaryString(i)}else r=i,o.call(n,null,r);else g?r=i:(i=u(atob(i)),r=o.createBlob([i],{type:s})),o.call(n,null,r)}},b._allDocs=function(e,t){var n="startkey"in e?e.startkey:!1,r="endkey"in e?e.endkey:!1,a="descending"in e?e.descending:!1;a=a?"prev":null;var s=n&&r?window.IDBKeyRange.bound(n,r):n?window.IDBKeyRange.lowerBound(n):r?window.IDBKeyRange.upperBound(r):null,u=w.transaction([l,f],"readonly");u.oncomplete=function(){"keys"in e&&(e.keys.forEach(function(e){e in v?p.push(v[e]):p.push({key:e,error:"not_found"})}),e.descending&&p.reverse()),o.call(t,null,{total_rows:p.length,offset:e.skip,rows:"limit"in e?p.slice(e.skip,e.limit+e.skip):e.skip>0?p.slice(e.skip):p})};var c=u.objectStore(l),d=a?c.openCursor(s,a):c.openCursor(s),p=[],v={};d.onsuccess=function(t){function n(t,n){if(o.isLocalId(t.id))return r["continue"]();var a={id:t.id,key:t.id,value:{rev:i.winningRev(t)}};if(e.include_docs){a.doc=n,a.doc._rev=i.winningRev(t),a.doc._doc_id_rev&&delete a.doc._doc_id_rev,e.conflicts&&(a.doc._conflicts=i.collectConflicts(t));for(var s in a.doc._attachments)a.doc._attachments[s].stub=!0}"keys"in e?e.keys.indexOf(t.id)>-1&&(o.isDeleted(t)&&(a.value.deleted=!0,a.doc=null),v[a.id]=a):o.isDeleted(t)||p.push(a),r["continue"]()}if(t.target.result){var r=t.target.result,a=r.value;if(e.include_docs){var s=u.objectStore(f).index("_doc_id_rev"),c=i.winningRev(a),d=a.id+"::"+c;s.get(d).onsuccess=function(e){n(r.value,e.target.result)}}else n(a)}}},b._info=function(e){function t(e){o=e.target.result&&e.target.result.updateSeq||0}function n(e){var n=e.target.result;return n?(n.value.deleted!==!0&&r++,n["continue"](),void 0):(i.objectStore(v).get(v).onsuccess=t,void 0)}var r=0,o=0,i=w.transaction([l,v],"readonly");i.oncomplete=function(){e(null,{db_name:h,doc_count:r,update_seq:o})},i.objectStore(l).openCursor().onsuccess=n},b._changes=function(e){function t(){p=w.transaction([l,f]),p.oncomplete=a;var t;t=c?p.objectStore(f).openCursor(window.IDBKeyRange.lowerBound(e.since,!0),c):p.objectStore(f).openCursor(window.IDBKeyRange.lowerBound(e.since,!0)),t.onsuccess=n,t.onerror=s}function n(t){if(!t.target.result){for(var n=0,r=v.length;r>n;n++){var a=v[n];a&&m.push(a)}return!1}var s=t.target.result,u=s.value._id,c=_[u];if(void 0!==c)return v[c].seq=s.key,v.push(v[c]),v[c]=null,_[u]=v.length-1,s["continue"]();var h=p.objectStore(l);h.get(s.value._id).onsuccess=function(t){var n=t.target.result;if(o.isLocalId(n.id))return s["continue"]();d<n.seq&&(d=n.seq);var r=i.winningRev(n),a=n.id+"::"+r,u=p.objectStore(f).index("_doc_id_rev");u.get(a).onsuccess=function(t){var o=t.target.result;delete o._doc_id_rev,o._rev=r;var i=e.processChange(o,n,e);i.seq=s.key;var a=i.id,u=_[a];void 0!==u&&(v[u]=null),v.push(i),_[a]=v.length-1,s["continue"]()}}}function a(){o.processChanges(e,m,d)}function s(){o.call(e.complete)}if(e.continuous){var u=h+":"+o.uuid();return e.cancelled=!1,r.Changes.addListener(h,u,b,e),r.Changes.notify(h),{cancel:function(){e.cancelled=!0,r.Changes.removeListener(h,u)}}}var c=e.descending?"prev":null,d=0;e.since=e.since&&!c?e.since:0;var p,v=[],_={},m=[];t()},b._close=function(e){return null===w?o.call(e,a.NOT_OPEN):(w.close(),o.call(e,null),void 0)},b._getRevisionTree=function(e,t){var n=w.transaction([l],"readonly"),r=n.objectStore(l).get(e);r.onsuccess=function(e){var n=e.target.result;n?o.call(t,null,n.rev_tree):o.call(t,a.MISSING_DOC)}},b._doCompaction=function(e,t,n,r){var i=w.transaction([l,f],"readwrite"),a=i.objectStore(l);a.get(e).onsuccess=function(r){var o=r.target.result;o.rev_tree=t;var a=n.length;n.forEach(function(t){var n=i.objectStore(f).index("_doc_id_rev"),r=e+"::"+t;n.getKey(r).onsuccess=function(e){var t=e.target.result;if(t){{i.objectStore(f)["delete"](t)}a--,a||i.objectStore(l).put(o)}}})},i.oncomplete=function(){o.call(r)}},b}var o=e("../utils"),i=e("../merge"),a=e("../deps/errors");r.valid=function(){return"undefined"!=typeof window&&!!window.indexedDB},r.destroy=function(e,t,i){"openReqList"in r||(r.openReqList={}),r.Changes.clearListeners(e),r.openReqList[e]&&r.openReqList[e].result&&r.openReqList[e].result.close();var a=window.indexedDB.deleteDatabase(e);a.onsuccess=function(){r.openReqList[e]&&(r.openReqList[e]=null),o.call(i,null)},a.onerror=n(i)},r.Changes=new o.Changes,t.exports=r},{"../deps/errors":8,"../merge":13,"../utils":16}],4:[function(e,t){"use strict";function n(e){return"'"+e+"'"}function r(){return"undefined"!=typeof window?window.navigator&&window.navigator.sqlitePlugin&&window.navigator.sqlitePlugin.openDatabase?navigator.sqlitePlugin.openDatabase.apply(navigator.sqlitePlugin,arguments):window.sqlitePlugin&&window.sqlitePlugin.openDatabase?window.sqlitePlugin.openDatabase.apply(window.sqlitePlugin,arguments):window.openDatabase.apply(window,arguments):void 0}function o(e){return function(t){a.call(e,{status:500,error:t.type,reason:t.target})}}function i(e,t){function _(){t(null,m)}function h(){b.transaction(function(e){var t="CREATE TABLE IF NOT EXISTS "+v+" (update_seq, dbid)",n="CREATE TABLE IF NOT EXISTS "+p+" (digest, json, body BLOB)",r="CREATE TABLE IF NOT EXISTS "+l+" (id unique, seq, json, winningseq)",o="CREATE TABLE IF NOT EXISTS "+f+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, doc_id_rev UNIQUE, json)";e.executeSql(n),e.executeSql(r),e.executeSql(o),e.executeSql(t);var i="SELECT update_seq FROM "+v;e.executeSql(i,[],function(e,t){if(!t.rows.length){var n="INSERT INTO "+v+" (update_seq) VALUES (?)";return e.executeSql(n,[0]),void 0}});var s="SELECT dbid FROM "+v+" WHERE dbid IS NOT NULL";e.executeSql(s,[],function(e,t){if(!t.rows.length){var n="UPDATE "+v+" SET dbid=?";return g=a.uuid(),e.executeSql(n,[g]),void 0}g=t.rows.item(0).dbid})},o(t),_)}var m={},g=null,y=e.name,b=r(y,c,y,d);return b?(a.isCordova()&&"undefined"!=typeof window?window.addEventListener(y+"_pouch",function w(){window.removeEventListener(y+"_pouch",w,!1),h()},!1):h(),m.type=function(){return"websql"},m.id=function(){return g},m._info=function(e){b.transaction(function(t){var n="SELECT COUNT(id) AS count FROM "+l;t.executeSql(n,[],function(t,n){var r=n.rows.item(0).count,o="SELECT update_seq FROM "+v;t.executeSql(o,[],function(t,n){var o=n.rows.item(0).update_seq;e(null,{db_name:y,doc_count:r,update_seq:o})})})})},m._bulkDocs=function(e,t,r){function c(e,t){return e._bulk_seq-t._bulk_seq}function d(){var e=[];I.sort(c),I.forEach(function(t){if(delete t._bulk_seq,t.error)return e.push(t),void 0;var n=t.metadata,r=s.winningRev(n);e.push({ok:!0,id:n.id,rev:r}),a.isLocalId(n.id)||(T++,i.Changes.notify(y),i.Changes.notifyLocalWindows(y))});var t="SELECT update_seq FROM "+v;N.executeSql(t,[],function(t,n){var o=n.rows.item(0).update_seq+T,i="UPDATE "+v+" SET update_seq=?";t.executeSql(i,[o],function(){a.call(r,null,e)})})}function _(e,t){if(e.stub)return t();if("string"==typeof e.data){try{e.data=atob(e.data)}catch(n){var o=u.error(u.BAD_ARG,"Attachments need to be base64 encoded");return a.call(r,o)}return e.digest="md5-"+a.Crypto.MD5(e.data),t()}var i=new FileReader;i.onloadend=function(){e.data=this.result,e.digest="md5-"+a.Crypto.MD5(this.result),t()},i.readAsBinaryString(e.data)}function h(e){function t(){n++,C.length===n&&e()}if(!C.length)return e();var n=0,r=0;C.forEach(function(e){function n(){r++,r===o.length&&t()}var o=e.data&&e.data._attachments?Object.keys(e.data._attachments):[];if(!o.length)return t();for(var i in e.data._attachments)_(e.data._attachments[i],n)})}function m(e,t,n){function r(){var t=e.data,n="INSERT INTO "+f+" (doc_id_rev, json) VALUES (?, ?);";N.executeSql(n,[t._id+"::"+t._rev,JSON.stringify(t)],u)}function o(e){c||(e?(c=e,a.call(t,c)):d===p.length&&r())}function i(e){d++,o(e)}function u(r,o){var i=e.metadata.seq=o.insertId;delete e.metadata.rev;var u=s.winningRev(e.metadata),c=n?"UPDATE "+l+" SET seq=?, json=?, winningseq=(SELECT seq FROM "+f+" WHERE doc_id_rev=?) WHERE id=?":"INSERT INTO "+l+" (id, seq, winningseq, json) VALUES (?, ?, ?, ?);",d=JSON.stringify(e.metadata),p=e.metadata.id+"::"+u,v=n?[i,d,p,e.metadata.id]:[e.metadata.id,i,i,d];r.executeSql(c,v,function(){I.push(e),a.call(t,null)})}var c=null,d=0;e.data._id=e.metadata.id,e.data._rev=e.metadata.rev,a.isDeleted(e.metadata,e.metadata.rev)&&(e.data._deleted=!0);var p=e.data._attachments?Object.keys(e.data._attachments):[];for(var v in e.data._attachments)if(e.data._attachments[v].stub)d++,o();else{var _=e.data._attachments[v].data;delete e.data._attachments[v].data;var h=e.data._attachments[v].digest;S(e,h,_,i)}p.length||r()}function g(e,t){var n=s.merge(e.rev_tree,t.metadata.rev_tree[0],1e3),r=a.isDeleted(e)&&a.isDeleted(t.metadata)||!a.isDeleted(e)&&R&&"new_leaf"!==n.conflicts;return r?(I.push(q(u.REV_CONFLICT,t._bulk_seq)),k()):(t.metadata.rev_tree=n.tree,m(t,k,!0),void 0)}function w(e){return"was_delete"in t&&a.isDeleted(e.metadata)?(I.push(u.MISSING_DOC),k()):(m(e,k,!1),void 0)}function k(){if(!C.length)return d();var e=C.shift(),t=e.metadata.id;t in A?g(A[t],e):(A[t]=e.metadata,w(e))}function q(e,t){return e._bulk_seq=t,e}function S(e,t,n,r){var o=[e.metadata.id,e.metadata.rev].join("@"),i={digest:t},s="SELECT digest, json FROM "+p+" WHERE digest=?";N.executeSql(s,[t],function(e,u){u.rows.length?(i.refs=JSON.parse(u.rows.item(0).json).refs,s="UPDATE "+p+" SET json=?, body=? WHERE digest=?",e.executeSql(s,[JSON.stringify(i),n,t],function(){a.call(r,null)})):(i.refs={},i.refs[o]=!0,s="INSERT INTO "+p+"(digest, json, body) VALUES (?, ?, ?)",e.executeSql(s,[t,JSON.stringify(i),n],function(){a.call(r,null)}))})}function E(e,t){for(var n=0;n<t.rows.length;n++){var r=t.rows.item(n);A[r.id]=JSON.parse(r.json)}k()}var R=t.new_edits,O=e.docs,T=0,C=O.map(function(e,t){var n=a.parseDoc(e,R);return n._bulk_seq=t,n}),D=C.filter(function(e){return e.error});if(D.length)return a.call(r,D[0]);var N,I=[],A={};h(function(){b.transaction(function(e){N=e;var t="("+C.map(function(e){return n(e.metadata.id)}).join(",")+")",r="SELECT * FROM "+l+" WHERE id IN "+t;N.executeSql(r,[],E)},o(r))})},m._get=function(e,t,n){function r(){a.call(n,c,{doc:o,metadata:i,ctx:d})}var o,i,c;if(!t.ctx)return b.transaction(function(r){t.ctx=r,m._get(e,t,n)}),void 0;var d=t.ctx,p="SELECT * FROM "+l+" WHERE id=?";d.executeSql(p,[e],function(e,n){if(!n.rows.length)return c=u.MISSING_DOC,r();if(i=JSON.parse(n.rows.item(0).json),a.isDeleted(i)&&!t.rev)return c=u.error(u.MISSING_DOC,"deleted"),r();var l=s.winningRev(i),p=t.rev?t.rev:l;p=i.id+"::"+p;var v="SELECT * FROM "+f+" WHERE doc_id_rev=?";d.executeSql(v,[p],function(e,t){return t.rows.length?(o=JSON.parse(t.rows.item(0).json),r(),void 0):(c=u.MISSING_DOC,r())})})},m._allDocs=function(e,t){var n=[],r={},i="startkey"in e?e.startkey:!1,u="endkey"in e?e.endkey:!1,c="descending"in e?e.descending:!1,d="SELECT "+l+".id, "+f+".seq, "+f+".json AS data, "+l+".json AS metadata FROM "+f+" JOIN "+l+" ON "+f+".seq = "+l+".winningseq",p=[];"keys"in e?(d+=" WHERE "+l+".id IN ("+e.keys.map(function(){return"?"}).join(",")+")",p=p.concat(e.keys)):(i&&(d+=" WHERE "+l+".id >= ?",p.push(i)),u&&(d+=(i?" AND ":" WHERE ")+l+".id <= ?",p.push(u)),d+=" ORDER BY "+l+".id "+(c?"DESC":"ASC")),b.transaction(function(t){t.executeSql(d,p,function(t,o){for(var i=0,u=o.rows.length;u>i;i++){var c=o.rows.item(i),d=JSON.parse(c.metadata),l=JSON.parse(c.data);if(!a.isLocalId(d.id)){if(c={id:d.id,key:d.id,value:{rev:s.winningRev(d)}},e.include_docs){c.doc=l,c.doc._rev=s.winningRev(d),e.conflicts&&(c.doc._conflicts=s.collectConflicts(d));for(var f in c.doc._attachments)c.doc._attachments[f].stub=!0}"keys"in e?e.keys.indexOf(d.id)>-1&&(a.isDeleted(d)&&(c.value.deleted=!0,c.doc=null),r[c.id]=c):a.isDeleted(d)||n.push(c)}}})},o(t),function(){"keys"in e&&(e.keys.forEach(function(e){e in r?n.push(r[e]):n.push({key:e,error:"not_found"})}),e.descending&&n.reverse()),a.call(t,null,{total_rows:n.length,offset:e.skip,rows:"limit"in e?n.slice(e.skip,e.limit+e.skip):e.skip>0?n.slice(e.skip):n})})},m._changes=function(e){function t(){var t="SELECT "+l+".id, "+f+".seq, "+f+".json AS data, "+l+".json AS metadata FROM "+f+" JOIN "+l+" ON "+f+".seq = "+l+".winningseq WHERE "+l+".seq > "+e.since+" ORDER BY "+l+".seq "+(r?"DESC":"ASC");b.transaction(function(n){n.executeSql(t,[],function(t,n){for(var r=0,i=0,s=n.rows.length;s>i;i++){var u=n.rows.item(i),c=JSON.parse(u.metadata);if(!a.isLocalId(c.id)){r<u.seq&&(r=u.seq);var d=JSON.parse(u.data),l=e.processChange(d,c,e);l.seq=u.seq,o.push(l)}}a.processChanges(e,o,r)})})}if(e.continuous){var n=y+":"+a.uuid();return e.cancelled=!1,i.Changes.addListener(y,n,m,e),i.Changes.notify(y),{cancel:function(){e.cancelled=!0,i.Changes.removeListener(y,n)}}}var r=e.descending;e.since=e.since&&!r?e.since:0;var o=[];t()},m._close=function(e){a.call(e,null)},m._getAttachment=function(e,t,n){var r,o=t.ctx,i=e.digest,s=e.content_type,u="SELECT body FROM "+p+" WHERE digest=?";o.executeSql(u,[i],function(e,o){var i=o.rows.item(0).body;r=t.encode?btoa(i):a.createBlob([i],{type:s}),a.call(n,null,r)})},m._getRevisionTree=function(e,t){b.transaction(function(n){var r="SELECT json AS metadata FROM "+l+" WHERE id = ?";n.executeSql(r,[e],function(e,n){if(n.rows.length){var r=JSON.parse(n.rows.item(0).metadata);a.call(t,null,r.rev_tree)}else a.call(t,u.MISSING_DOC)})})},m._doCompaction=function(e,t,r,o){b.transaction(function(i){var s="SELECT json AS metadata FROM "+l+" WHERE id = ?";i.executeSql(s,[e],function(i,s){if(!s.rows.length)return a.call(o);var u=JSON.parse(s.rows.item(0).metadata);u.rev_tree=t;var c="DELETE FROM "+f+" WHERE doc_id_rev IN ("+r.map(function(t){return n(e+"::"+t)}).join(",")+")";i.executeSql(c,[],function(t){var n="UPDATE "+l+" SET json = ? WHERE id = ?";t.executeSql(n,[JSON.stringify(u),e],function(){o()})})})})},m):a.call(t,u.UNKNOWN_ERROR)}var a=e("../utils"),s=e("../merge"),u=e("../deps/errors"),c=1,d=5242880,l=n("document-store"),f=n("by-sequence"),p=n("attach-store"),v=n("metadata-store");i.valid=function(){if("undefined"!=typeof window){if(window.navigator&&window.navigator.sqlitePlugin&&window.navigator.sqlitePlugin.openDatabase)return!0;
if(window.sqlitePlugin&&window.sqlitePlugin.openDatabase)return!0;if(window.openDatabase)return!0}return!1},i.destroy=function(e,t,n){var i=r(e,c,e,d);i.transaction(function(e){e.executeSql("DROP TABLE IF EXISTS "+l,[]),e.executeSql("DROP TABLE IF EXISTS "+f,[]),e.executeSql("DROP TABLE IF EXISTS "+p,[]),e.executeSql("DROP TABLE IF EXISTS "+v,[])},o(n),function(){a.call(n,null)})},i.Changes=new a.Changes,t.exports=i},{"../deps/errors":8,"../merge":13,"../utils":16}],5:[function(e,t){"use strict";function n(e,t,o){if(!(this instanceof n))return new n(e,t,o);("function"==typeof t||"undefined"==typeof t)&&(o=t,t={}),"object"==typeof e&&(t=e,e=void 0),"undefined"==typeof o&&(o=function(){});var i=t.name||e,a=n.parseAdapter(i);if(t.originalName=i,t.name=a.name,t.adapter=t.adapter||a.adapter,!n.adapters[t.adapter])throw"Adapter is missing";if(!n.adapters[t.adapter].valid())throw"Invalid Adapter";var s=new r(t,function(e,t){if(e)return o&&o(e),void 0;for(var r in n.plugins){var i=n.plugins[r](t);for(var a in i)a in t||(t[a]=i[a])}t.taskqueue.ready(!0),t.taskqueue.execute(t),o(null,t)});for(var u in s)this[u]=s[u];for(var c in n.plugins){var d=n.plugins[c](this);for(var l in d)l in this||(this[l]=d[l])}}var r=e("./adapter")(n);t.exports=n},{"./adapter":1}],6:[function(e,t){function n(e,t){function n(e){var t=Array.prototype.slice.call(arguments,1);typeof e==typeof Function&&e.apply(this,t)}function u(t,r,o){if(e.binary||e.json||!e.processData||"string"==typeof t){if(!e.binary&&e.json&&"string"==typeof t)try{t=JSON.parse(t)}catch(i){return n(o,i),void 0}}else t=JSON.stringify(t);Array.isArray(t)&&(t=t.map(function(e){var t;return e.ok?e:e.error&&"conflict"===e.error?(t=s.REV_CONFLICT,t.id=e.id,t):e.missing?(t=s.MISSING_DOC,t.missing=e.missing,t):void 0})),n(o,null,t,r)}function c(e,t){var r,o,i,a;try{r=JSON.parse(e.responseText);for(a in s)if(s[a].name===r.error){i=s[a];break}i=i||s.UNKNOWN_ERROR,o=s.error(i,r.reason)}catch(u){o=s.error(s.UNKNOWN_ERROR)}n(t,o)}"function"==typeof e&&(t=e,e={});var d={method:"GET",headers:{},json:!0,processData:!0,timeout:1e4};if(e=i(!0,d,e),r.browser&&"undefined"!=typeof XMLHttpRequest){var l,f=!1,p=new XMLHttpRequest;p.open(e.method,e.url),p.withCredentials=!0,e.json&&(e.headers.Accept="application/json",e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.body&&e.processData&&"string"!=typeof e.body&&(e.body=JSON.stringify(e.body))),e.binary&&(p.responseType="arraybuffer");var v=function(e,t,n){var r="";if(n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3),r="; expires="+o.toGMTString()}document.cookie=e+"="+t+r+"; path=/"};for(var _ in e.headers)if("Cookie"===_){var h=e.headers[_].split("=");v(h[0],h[1],10)}else p.setRequestHeader(_,e.headers[_]);"body"in e||(e.body=null);var m=function(){f=!0,p.abort(),n(c,p,t)};return p.onreadystatechange=function(){if(4===p.readyState&&!f)if(clearTimeout(l),p.status>=200&&p.status<300){var r;r=e.binary?a([p.response||""],{type:p.getResponseHeader("Content-Type")}):p.responseText,n(u,r,p,t)}else n(c,p,t)},e.timeout>0&&(l=setTimeout(m,e.timeout),p.upload.onprogress=p.onprogress=function(){clearTimeout(l),l=setTimeout(m,e.timeout)}),p.send(e.body),{abort:m}}return e.json&&(e.binary||(e.headers.Accept="application/json"),e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json"),e.binary&&(e.encoding=null,e.json=!1),e.processData||(e.json=!1),o(e,function(r,o,i){if(r)return r.status=o?o.statusCode:400,n(c,r,t);var a,d=o.headers["content-type"],l=i||"";e.binary||!e.json&&e.processData||"object"==typeof l||!(/json/.test(d)||/^[\s]*\{/.test(l)&&/\}[\s]*$/.test(l))||(l=JSON.parse(l)),o.statusCode>=200&&o.statusCode<300?n(u,l,o,t):(e.binary&&(l=JSON.parse(l.toString())),a="missing"===l.reason?s.MISSING_DOC:"no_db_file"===l.reason?s.error(s.DB_MISSING,l.reason):"conflict"===l.error?s.REV_CONFLICT:s.error(s.UNKNOWN_ERROR,l.reason,l.error),a.status=o.statusCode,n(t,a))})}var r=e("__browserify_process"),o=e("request"),i=e("./extend.js"),a=e("./blob.js"),s=e("./errors");t.exports=n},{"./blob.js":7,"./errors":8,"./extend.js":9,__browserify_process:19,request:18}],7:[function(e,t){"use strict";function n(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(n){if("TypeError"!==n.name)throw n;for(var r=window.BlobBuilder||window.MSBlobBuilder||window.MozBlobBuilder||window.WebKitBlobBuilder,o=new r,i=0;i<e.length;i+=1)o.append(e[i]);return o.getBlob(t.type)}}t.exports=n},{}],8:[function(e,t,n){"use strict";function r(e){this.status=e.status,this.name=e.error,this.message=e.reason,this.error=!0}r.prototype=new Error,n.MISSING_BULK_DOCS=new r({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),n.MISSING_DOC=new r({status:404,error:"not_found",reason:"missing"}),n.REV_CONFLICT=new r({status:409,error:"conflict",reason:"Document update conflict"}),n.INVALID_ID=new r({status:400,error:"invalid_id",reason:"_id field must contain a string"}),n.MISSING_ID=new r({status:412,error:"missing_id",reason:"_id is required for puts"}),n.RESERVED_ID=new r({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),n.NOT_OPEN=new r({status:412,error:"precondition_failed",reason:"Database not open so cannot close"}),n.UNKNOWN_ERROR=new r({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),n.BAD_ARG=new r({status:500,error:"badarg",reason:"Some query argument is invalid"}),n.INVALID_REQUEST=new r({status:400,error:"invalid_request",reason:"Request was invalid"}),n.QUERY_PARSE_ERROR=new r({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),n.DOC_VALIDATION=new r({status:500,error:"doc_validation",reason:"Bad special document member"}),n.BAD_REQUEST=new r({status:400,error:"bad_request",reason:"Something wrong with the request"}),n.NOT_AN_OBJECT=new r({status:400,error:"bad_request",reason:"Document must be a JSON object"}),n.DB_MISSING=new r({status:404,error:"not_found",reason:"Database not found"}),n.IDB_ERROR=new r({status:500,error:"indexed_db_went_bad",reason:"unknown"}),n.WSQ_ERROR=new r({status:500,error:"web_sql_went_bad",reason:"unknown"}),n.LDB_ERROR=new r({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),n.error=function(e,t,n){function r(){this.message=t,n&&(this.name=n)}return r.prototype=e,new r(t)}},{}],9:[function(e,t){"use strict";function n(e){return null===e?String(e):"object"==typeof e||"function"==typeof e?s[l.call(e)]||"object":typeof e}function r(e){return null!==e&&e===e.window}function o(e){if(!e||"object"!==n(e)||e.nodeType||r(e))return!1;try{if(e.constructor&&!f.call(e,"constructor")&&!f.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}var o;for(o in e);return void 0===o||f.call(e,o)}function i(e){return"function"===n(e)}function a(){var e,t,n,r,s,u,c=arguments[0]||{},d=1,l=arguments.length,f=!1;for("boolean"==typeof c&&(f=c,c=arguments[1]||{},d=2),"object"==typeof c||i(c)||(c={}),l===d&&(c=this,--d);l>d;d++)if(null!=(e=arguments[d]))for(t in e)n=c[t],r=e[t],c!==r&&(f&&r&&(o(r)||(s=p(r)))?(s?(s=!1,u=n&&p(n)?n:[]):u=n&&o(n)?n:{},c[t]=a(f,u,r)):void 0!==r&&(p(e)&&i(r)||(c[t]=r)));return c}for(var s={},u=["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"],c=0;c<u.length;c++){var d=u[c];s["[object "+d+"]"]=d.toLowerCase()}var l=s.toString,f=s.hasOwnProperty,p=Array.isArray||function(e){return"array"===n(e)};t.exports=a},{}],10:[function(e,t,n){var r=e("__browserify_process"),o=e("crypto");n.MD5=function(e){function t(e,t){return e<<t|e>>>32-t}function n(e,t){var n,r,o,i,a;return o=2147483648&e,i=2147483648&t,n=1073741824&e,r=1073741824&t,a=(1073741823&e)+(1073741823&t),n&r?2147483648^a^o^i:n|r?1073741824&a?3221225472^a^o^i:1073741824^a^o^i:a^o^i}function i(e,t,n){return e&t|~e&n}function a(e,t,n){return e&n|t&~n}function s(e,t,n){return e^t^n}function u(e,t,n){return t^(e|~n)}function c(e,r,o,a,s,u,c){return e=n(e,n(n(i(r,o,a),s),c)),n(t(e,u),r)}function d(e,r,o,i,s,u,c){return e=n(e,n(n(a(r,o,i),s),c)),n(t(e,u),r)}function l(e,r,o,i,a,u,c){return e=n(e,n(n(s(r,o,i),a),c)),n(t(e,u),r)}function f(e,r,o,i,a,s,c){return e=n(e,n(n(u(r,o,i),a),c)),n(t(e,s),r)}function p(e){for(var t,n=e.length,r=n+8,o=(r-r%64)/64,i=16*(o+1),a=new Array(i-1),s=0,u=0;n>u;)t=(u-u%4)/4,s=u%4*8,a[t]=a[t]|e.charCodeAt(u)<<s,u++;return t=(u-u%4)/4,s=u%4*8,a[t]=a[t]|128<<s,a[i-2]=n<<3,a[i-1]=n>>>29,a}function v(e){var t,n,r="",o="";for(n=0;3>=n;n++)t=e>>>8*n&255,o="0"+t.toString(16),r+=o.substr(o.length-2,2);return r}if(!r.browser)return o.createHash("md5").update(e).digest("hex");var _,h,m,g,y,b,w,k,q,S=[],E=7,R=12,O=17,T=22,C=5,D=9,N=14,I=20,A=4,x=11,j=16,L=23,B=6,M=10,P=15,U=21;for(S=p(e),b=1732584193,w=4023233417,k=2562383102,q=271733878,_=0;_<S.length;_+=16)h=b,m=w,g=k,y=q,b=c(b,w,k,q,S[_+0],E,3614090360),q=c(q,b,w,k,S[_+1],R,3905402710),k=c(k,q,b,w,S[_+2],O,606105819),w=c(w,k,q,b,S[_+3],T,3250441966),b=c(b,w,k,q,S[_+4],E,4118548399),q=c(q,b,w,k,S[_+5],R,1200080426),k=c(k,q,b,w,S[_+6],O,2821735955),w=c(w,k,q,b,S[_+7],T,4249261313),b=c(b,w,k,q,S[_+8],E,1770035416),q=c(q,b,w,k,S[_+9],R,2336552879),k=c(k,q,b,w,S[_+10],O,4294925233),w=c(w,k,q,b,S[_+11],T,2304563134),b=c(b,w,k,q,S[_+12],E,1804603682),q=c(q,b,w,k,S[_+13],R,4254626195),k=c(k,q,b,w,S[_+14],O,2792965006),w=c(w,k,q,b,S[_+15],T,1236535329),b=d(b,w,k,q,S[_+1],C,4129170786),q=d(q,b,w,k,S[_+6],D,3225465664),k=d(k,q,b,w,S[_+11],N,643717713),w=d(w,k,q,b,S[_+0],I,3921069994),b=d(b,w,k,q,S[_+5],C,3593408605),q=d(q,b,w,k,S[_+10],D,38016083),k=d(k,q,b,w,S[_+15],N,3634488961),w=d(w,k,q,b,S[_+4],I,3889429448),b=d(b,w,k,q,S[_+9],C,568446438),q=d(q,b,w,k,S[_+14],D,3275163606),k=d(k,q,b,w,S[_+3],N,4107603335),w=d(w,k,q,b,S[_+8],I,1163531501),b=d(b,w,k,q,S[_+13],C,2850285829),q=d(q,b,w,k,S[_+2],D,4243563512),k=d(k,q,b,w,S[_+7],N,1735328473),w=d(w,k,q,b,S[_+12],I,2368359562),b=l(b,w,k,q,S[_+5],A,4294588738),q=l(q,b,w,k,S[_+8],x,2272392833),k=l(k,q,b,w,S[_+11],j,1839030562),w=l(w,k,q,b,S[_+14],L,4259657740),b=l(b,w,k,q,S[_+1],A,2763975236),q=l(q,b,w,k,S[_+4],x,1272893353),k=l(k,q,b,w,S[_+7],j,4139469664),w=l(w,k,q,b,S[_+10],L,3200236656),b=l(b,w,k,q,S[_+13],A,681279174),q=l(q,b,w,k,S[_+0],x,3936430074),k=l(k,q,b,w,S[_+3],j,3572445317),w=l(w,k,q,b,S[_+6],L,76029189),b=l(b,w,k,q,S[_+9],A,3654602809),q=l(q,b,w,k,S[_+12],x,3873151461),k=l(k,q,b,w,S[_+15],j,530742520),w=l(w,k,q,b,S[_+2],L,3299628645),b=f(b,w,k,q,S[_+0],B,4096336452),q=f(q,b,w,k,S[_+7],M,1126891415),k=f(k,q,b,w,S[_+14],P,2878612391),w=f(w,k,q,b,S[_+5],U,4237533241),b=f(b,w,k,q,S[_+12],B,1700485571),q=f(q,b,w,k,S[_+3],M,2399980690),k=f(k,q,b,w,S[_+10],P,4293915773),w=f(w,k,q,b,S[_+1],U,2240044497),b=f(b,w,k,q,S[_+8],B,1873313359),q=f(q,b,w,k,S[_+15],M,4264355552),k=f(k,q,b,w,S[_+6],P,2734768916),w=f(w,k,q,b,S[_+13],U,1309151649),b=f(b,w,k,q,S[_+4],B,4149444226),q=f(q,b,w,k,S[_+11],M,3174756917),k=f(k,q,b,w,S[_+2],P,718787259),w=f(w,k,q,b,S[_+9],U,3951481745),b=n(b,h),w=n(w,m),k=n(k,g),q=n(q,y);var F=v(b)+v(w)+v(k)+v(q);return F.toLowerCase()}},{__browserify_process:19,crypto:18}],11:[function(e,t){"use strict";function n(e,t){var r,o=n.CHARS,i=[];if(t=t||o.length,e)for(r=0;e>r;r++)i[r]=o[0|Math.random()*t];else{var a;for(i[8]=i[13]=i[18]=i[23]="-",i[14]="4",r=0;36>r;r++)i[r]||(a=0|16*Math.random(),i[r]=o[19===r?3&a|8:a])}return i.join("")}n.CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),t.exports=n},{}],12:[function(e,t){var n=e("__browserify_process"),r=e("./setup");t.exports=r,r.ajax=e("./deps/ajax"),r.extend=e("./deps/extend"),r.utils=e("./utils"),r.Errors=e("./deps/errors"),r.replicate=e("./replicate").replicate,r.version=e("./version");var o=e("./adapters/http");if(r.adapter("http",o),r.adapter("https",o),r.adapter("idb",e("./adapters/idb")),r.adapter("websql",e("./adapters/websql")),r.plugin("mapreduce",e("pouchdb-mapreduce")),!n.browser){var i=e("./adapters/leveldb");r.adapter("ldb",i),r.adapter("leveldb",i)}},{"./adapters/http":2,"./adapters/idb":3,"./adapters/leveldb":18,"./adapters/websql":4,"./deps/ajax":6,"./deps/errors":8,"./deps/extend":9,"./replicate":14,"./setup":15,"./utils":16,"./version":17,__browserify_process:19,"pouchdb-mapreduce":20}],13:[function(e,t){"use strict";function n(e){for(var t,n=e.shift(),r=[n.id,n.opts,[]],o=r;e.length;)n=e.shift(),t=[n.id,n.opts,[]],o[2].push(t),o=t;return r}function r(e,t){for(var n=[{tree1:e,tree2:t}],r=!1;n.length>0;){var o=n.pop(),i=o.tree1,a=o.tree2;(i[1].status||a[1].status)&&(i[1].status="available"===i[1].status||"available"===a[1].status?"available":"missing");for(var s=0;s<a[2].length;s++)if(i[2][0]){for(var u=!1,c=0;c<i[2].length;c++)i[2][c][0]===a[2][s][0]&&(n.push({tree1:i[2][c],tree2:a[2][s]}),u=!0);u||(r="new_branch",i[2].push(a[2][s]),i[2].sort())}else r="new_leaf",i[2][0]=a[2][s]}return{conflicts:r,tree:e}}function o(e,t,n){var o,i=[],a=!1,s=!1;return e.length?(e.forEach(function(e){if(e.pos===t.pos&&e.ids[0]===t.ids[0])o=r(e.ids,t.ids),i.push({pos:e.pos,ids:o.tree}),a=a||o.conflicts,s=!0;else if(n!==!0){var u=e.pos<t.pos?e:t,c=e.pos<t.pos?t:e,d=c.pos-u.pos,l=[],f=[];for(f.push({ids:u.ids,diff:d,parent:null,parentIdx:null});f.length>0;){var p=f.pop();0!==p.diff?p.ids&&p.ids[2].forEach(function(e,t){f.push({ids:e,diff:p.diff-1,parent:p.ids,parentIdx:t})}):p.ids[0]===c.ids[0]&&l.push(p)}var v=l[0];v?(o=r(v.ids,c.ids),v.parent[2][v.parentIdx]=o.tree,i.push({pos:u.pos,ids:u.ids}),a=a||o.conflicts,s=!0):i.push(e)}else i.push(e)}),s||i.push(t),i.sort(function(e,t){return e.pos-t.pos}),{tree:i,conflicts:a||"internal_node"}):{tree:[t],conflicts:"new_leaf"}}function i(e,t){var r=s.rootToLeaf(e).map(function(e){var r=e.ids.slice(-t);return{pos:e.pos+(e.ids.length-r.length),ids:n(r)}});return r.reduce(function(e,t){return o(e,t,!0).tree},[r.shift()])}var a=e("./deps/extend"),s={};s.merge=function(e,t,n){e=a(!0,[],e),t=a(!0,{},t);var r=o(e,t);return{tree:i(r.tree,n),conflicts:r.conflicts}},s.winningRev=function(e){var t=[];return s.traverseRevTree(e.rev_tree,function(e,n,r,o,i){e&&t.push({pos:n,id:r,deleted:!!i.deleted})}),t.sort(function(e,t){return e.deleted!==t.deleted?e.deleted>t.deleted?1:-1:e.pos!==t.pos?t.pos-e.pos:e.id<t.id?1:-1}),t[0].pos+"-"+t[0].id},s.traverseRevTree=function(e,t){var n=[];for(e.forEach(function(e){n.push({pos:e.pos,ids:e.ids})});n.length>0;){var r=n.pop(),o=r.pos,i=r.ids,a=t(0===i[2].length,o,i[0],r.ctx,i[1]);i[2].forEach(function(e){n.push({pos:o+1,ids:e,ctx:a})})}},s.collectLeaves=function(e){var t=[];return s.traverseRevTree(e,function(e,n,r,o,i){e&&t.unshift({rev:n+"-"+r,pos:n,opts:i})}),t.sort(function(e,t){return t.pos-e.pos}),t.map(function(e){delete e.pos}),t},s.collectConflicts=function(e){var t=s.winningRev(e),n=s.collectLeaves(e.rev_tree),r=[];return n.forEach(function(e){e.rev===t||e.opts.deleted||r.push(e.rev)}),r},s.rootToLeaf=function(e){var t=[];return s.traverseRevTree(e,function(e,n,r,o,i){if(o=o?o.slice(0):[],o.push({id:r,opts:i}),e){var a=n+1-o.length;t.unshift({pos:a,ids:o})}return o}),t},t.exports=s},{"./deps/extend":9}],14:[function(e,t,n){function r(){var e=this;this.cancelled=!1,this.cancel=function(){e.cancelled=!0}}function o(e){var t=[],n={},r=!1;return n.enqueue=function(e,o){t.push({fun:e,args:o}),r||n.process()},n.process=function(){if(!r&&t.length&&!e.cancelled){r=!0;var n=t.shift();d.nextTick(function(){n.fun.apply(null,n.args)})}},n.notifyRequestComplete=function(){r=!1,n.process()},n}function i(e,t,n){var r=n.filter?n.filter.toString():"";return"_local/"+l.Crypto.MD5(e.id()+t.id()+r)}function a(e,t,n,r){t.get(n,function(t,o){t&&404===t.status?r(null,0):t?r(t):e.get(n,function(e,t){e&&404===e.status||!e&&o.last_seq!==t.last_seq?r(null,0):e?r(e):r(null,t.last_seq)})})}function s(e,t,n,r,o){function i(e,t){e.get(n,function(o,i){o&&404===o.status&&(i={_id:n}),i.last_seq=r,e.put(i,t)})}i(t,function(){i(e,function(){o()})})}function u(e,t,n,r){function u(r,o,i){if(n.onChange)for(var a=0;i>a;a++)n.onChange.apply(this,[R]);k-=i,R.docs_written+=i,s(e,t,y,q,function(){m.notifyRequestComplete(),h()})}function c(){if(!g.length)return m.notifyRequestComplete();var e=g.length;t.bulkDocs({docs:g},{new_edits:!1},function(t,n){u(t,n,e)}),g=[]}function d(t,n){e.get(t,{revs:!0,rev:n,attachments:!0},function(e,t){R.docs_read++,m.notifyRequestComplete(),g.push(t),m.enqueue(c)})}function f(e){return function(t,o){if(m.notifyRequestComplete(),t)return S&&r.cancel(),l.call(n.complete,t,null),void 0;if(0===Object.keys(o).length){for(var i in e)k-=e[i];return h(),void 0}var a=function(e){m.enqueue(d,[s,e])};for(var s in o){var u=e[s]-o[s].missing.length;k-=u,o[s].missing.forEach(a)}}}function p(e,n){t.revsDiff(e,f(n))}function v(e){q=e.seq,b.push(e);var t={};t[e.id]=e.changes.map(function(e){return e.rev});var n={};n[e.id]=e.changes.length,k+=e.changes.length,m.enqueue(p,[t,n])}function _(){w=!0,h()}function h(){w&&0===k&&(R.end_time=new Date,l.call(n.complete,null,R))}var m=new o(r),g=[],y=i(e,t,n),b=[],w=!1,k=0,q=0,S=n.continuous||!1,E=n.doc_ids,R={ok:!0,start_time:new Date,docs_read:0,docs_written:0};a(e,t,y,function(t,o){if(t)return l.call(n.complete,t);if(q=o,!r.cancelled){var i={continuous:S,since:q,style:"all_docs",onChange:v,complete:_,doc_ids:E};n.filter&&(i.filter=n.filter),n.query_params&&(i.query_params=n.query_params);var a=e.changes(i);if(n.continuous){var s=r.cancel;r.cancel=function(){s(),a.cancel()}}}})}function c(e,t){return"string"==typeof e?new f(e,t):(t(null,e),void 0)}var d=e("__browserify_process"),l=e("./utils"),f=e("./index");n.replicate=function(e,t,n,o){n instanceof Function&&(o=n,n={}),void 0===n&&(n={}),n.complete||(n.complete=o);var i=new r;return c(e,function(e,r){return e?l.call(o,e):(c(t,function(e,t){if(e)return l.call(o,e);if(n.server){if("function"!=typeof r.replicateOnServer)return l.call(o,{error:"Server replication not supported for "+r.type()+" adapter"});if(r.type()!==t.type())return l.call(o,{error:"Server replication for different adapter types ("+r.type()+" and "+t.type()+") is not supported"});r.replicateOnServer(t,n,i)}else u(r,t,n,i)}),void 0)}),i}},{"./index":12,"./utils":16,__browserify_process:19}],15:[function(e,t){"use strict";var n=e("./constructor");n.adapters={},n.plugins={},n.prefix="_pouch_",n.parseAdapter=function(e){var t,r=e.match(/([a-z\-]*):\/\/(.*)/);if(r){if(e=/http(s?)/.test(r[1])?r[1]+"://"+r[2]:r[2],t=r[1],!n.adapters[t].valid())throw"Invalid adapter";return{name:e,adapter:r[1]}}for(var o=["idb","leveldb","websql"],i=0;i<o.length;++i)if(o[i]in n.adapters){t=n.adapters[o[i]];var a="use_prefix"in t?t.use_prefix:!0;return{name:a?n.prefix+e:e,adapter:o[i]}}throw"No valid adapter found"},n.destroy=function(e,t,r){("function"==typeof t||"undefined"==typeof t)&&(r=t,t={}),"object"==typeof e&&(t=e,e=void 0),"undefined"==typeof r&&(r=function(){});var o=n.parseAdapter(t.name||e),i=o.name,a=function(e){if(e)return r(e),void 0;for(var a in n.plugins)n.plugins[a]._delete(i);n.adapters[o.adapter].destroy(i,t,r)};n.removeFromAllDbs(o,a)},n.removeFromAllDbs=function(e,t){if(!n.enableAllDbs)return t(),void 0;var r=e.adapter;return"http"===r||"https"===r?(t(),void 0):(new n(n.allDBName(e.adapter),function(r,o){if(r)return t(),void 0;var i=n.dbName(e.adapter,e.name);o.get(i,function(e,n){e?t():o.remove(n,function(e){t()})})}),void 0)},n.adapter=function(e,t){t.valid()&&(n.adapters[e]=t)},n.plugin=function(e,t){n.plugins[e]=t},n.enableAllDbs=!1,n.ALL_DBS="_allDbs",n.dbName=function(e,t){return[e,"-",t].join("")},n.realDBName=function(e,t){return[e,"://",t].join("")},n.allDBName=function(e){return[e,"://",n.prefix+n.ALL_DBS].join("")},n.open=function(e,t){if(!n.enableAllDbs)return t(),void 0;var r=e.adapter;return"http"===r||"https"===r?(t(),void 0):(new n(n.allDBName(r),function(o,i){if(o)return t(),void 0;var a=n.dbName(r,e.name);i.get(a,function(n){n&&404===n.status?i.put({_id:a,dbname:e.originalName},function(e){t()}):t()})}),void 0)},n.allDbs=function(e){var t=function(r,o){if(0===r.length){var i=[];return o.forEach(function(e){var t=i.some(function(t){return t.id===e.id});t||i.push(e)}),e(null,i.map(function(e){return e.doc.dbname})),void 0}var a=r.shift();return"http"===a||"https"===a?(t(r,o),void 0):(new n(n.allDBName(a),function(n,i){return n?(e(n),void 0):(i.allDocs({include_docs:!0},function(n,i){return n?(e(n),void 0):(o.unshift.apply(o,i.rows),t(r,o),void 0)}),void 0)}),void 0)},r=Object.keys(n.adapters);t(r,[])},t.exports=n},{"./constructor":5}],16:[function(e,t,n){function r(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}var o=e("./merge");n.extend=e("./deps/extend"),n.ajax=e("./deps/ajax"),n.createBlob=e("./deps/blob");var i=e("./deps/uuid");n.Crypto=e("./deps/md5.js");var a=e("./deps/buffer"),s=e("./deps/errors"),u=["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree"];n.uuids=function(e,t){"object"!=typeof t&&(t={});for(var n=t.length,r=t.radix,o=[];o.push(i(n,r))<e;);return o},n.uuid=function(e){return n.uuids(1,e)[0]},n.isValidId=function(e){return e&&"string"==typeof e?/^_/.test(e)?/^_(design|local)/.test(e):!0:!1},n.call=function(e){if(typeof e==typeof Function){var t=Array.prototype.slice.call(arguments,1);e.apply(this,t)}},n.isLocalId=function(e){return/^_local/.test(e)},n.isDeleted=function(e,t){t||(t=o.winningRev(e)),t.indexOf("-")>=0&&(t=t.split("-")[1]);var n=!1;return o.traverseRevTree(e.rev_tree,function(e,r,o,i,a){o===t&&(n=!!a.deleted)}),n},n.filterChange=function(e){return function(t){var n={},r=e.filter&&"function"==typeof e.filter;if(n.query=e.query_params,e.filter&&r&&!e.filter.call(this,t.doc,n))return!1;if(e.doc_ids&&-1===e.doc_ids.indexOf(t.id))return!1;if(e.include_docs)for(var o in t.doc._attachments)t.doc._attachments[o].stub=!0;else delete t.doc;return!0}},n.processChanges=function(e,t,r){t=t.filter(n.filterChange(e)),e.limit&&e.limit<t.length&&(t.length=e.limit),t.forEach(function(t){n.call(e.onChange,t)}),n.call(e.complete,null,{results:t,last_seq:r})},n.parseDoc=function(e,t){var r,o,i,a=null,c={status:"available"};if(e._deleted&&(c.deleted=!0),t)if(e._id||(e._id=n.uuid()),o=n.uuid({length:32,radix:16}).toLowerCase(),e._rev){if(i=/^(\d+)-(.+)$/.exec(e._rev),!i)throw"invalid value for property '_rev'";e._rev_tree=[{pos:parseInt(i[1],10),ids:[i[2],{status:"missing"},[[o,c,[]]]]}],r=parseInt(i[1],10)+1}else e._rev_tree=[{pos:1,ids:[o,c,[]]}],r=1;else if(e._revisions&&(e._rev_tree=[{pos:e._revisions.start-e._revisions.ids.length+1,ids:e._revisions.ids.reduce(function(e,t){return null===e?[t,c,[]]:[t,{status:"missing"},[e]]},null)}],r=e._revisions.start,o=e._revisions.ids[0]),!e._rev_tree){if(i=/^(\d+)-(.+)$/.exec(e._rev),!i)return s.BAD_ARG;r=parseInt(i[1],10),o=i[2],e._rev_tree=[{pos:parseInt(i[1],10),ids:[i[2],c,[]]}]}"string"!=typeof e._id?a=s.INVALID_ID:n.isValidId(e._id)||(a=s.RESERVED_ID);for(var d in e)e.hasOwnProperty(d)&&"_"===d[0]&&-1===u.indexOf(d)&&(a=n.extend({},s.DOC_VALIDATION),a.reason+=": "+d);return e._id=decodeURIComponent(e._id),e._rev=[r,o].join("-"),a?a:Object.keys(e).reduce(function(t,n){return/^_/.test(n)&&"_attachments"!==n?t.metadata[n.slice(1)]=e[n]:t.data[n]=e[n],t},{metadata:{},data:{}})},n.isCordova=function(){return"undefined"!=typeof cordova||"undefined"!=typeof PhoneGap||"undefined"!=typeof phonegap},n.Changes=function(){var e={},t={};return r()?chrome.storage.onChanged.addListener(function(t){null!=t.db_name&&e.notify(t.db_name.newValue)}):"undefined"!=typeof window&&window.addEventListener("storage",function(t){e.notify(t.key)}),e.addListener=function(e,n,r,o){t[e]||(t[e]={}),t[e][n]={db:r,opts:o}},e.removeListener=function(e,n){t[e]&&delete t[e][n]},e.clearListeners=function(e){delete t[e]},e.notifyLocalWindows=function(e){r()?chrome.storage.local.set({db_name:e}):localStorage[e]="a"===localStorage[e]?"b":"a"},e.notify=function(e){t[e]&&Object.keys(t[e]).forEach(function(r){var o=t[e][r].opts;t[e][r].db.changes({include_docs:o.include_docs,conflicts:o.conflicts,continuous:!1,descending:!1,filter:o.filter,view:o.view,since:o.since,query_params:o.query_params,onChange:function(e){e.seq>o.since&&!o.cancelled&&(o.since=e.seq,n.call(o.onChange,e))}})})},e},n.atob="undefined"!=typeof window&&"atob"in window?function(e){return atob(e)}:function(e){var t=new a(e,"base64");if(t.toString("base64")!==e)throw"Cannot base64 encode full string";return t.toString("binary")},n.btoa="undefined"!=typeof window&&"btoa"in window?function(e){return btoa(e)}:function(e){return new a(e,"binary").toString("base64")},t.exports=n},{"./deps/ajax":6,"./deps/blob":7,"./deps/buffer":18,"./deps/errors":8,"./deps/extend":9,"./deps/md5.js":10,"./deps/uuid":11,"./merge":13}],17:[function(e,t){t.exports="1.1.0"},{}],18:[function(){},{}],19:[function(e,t){var n=t.exports={};n.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var n=[];return window.addEventListener("message",function(e){var t=e.source;if((t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),n.length>0)){var r=n.shift();r()}},!0),function(e){n.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),n.title="browser",n.browser=!0,n.env={},n.argv=[],n.binding=function(){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(){throw new Error("process.chdir is not supported")}},{}],20:[function(require,module,exports){"use strict";function MapReduce(db){function viewQuery(fun,options){function sum(e){return e.reduce(function(e,t){return e+t},0)}function emit(e,t){var n={id:current.doc._id,key:e,value:t};if(!(options.startkey&&pouchCollate(e,options.startkey)<0||options.endkey&&pouchCollate(e,options.endkey)>0||"undefined"!=typeof options.key&&0!==pouchCollate(e,options.key))){if(num_started++,options.include_docs){if(t&&"object"==typeof t&&t._id)return db.get(t._id,function(e,t){t&&(n.doc=t),results.push(n),checkComplete()}),void 0;n.doc=current.doc}results.push(n)}}function checkComplete(){if(completed&&results.length==num_started){if(results.sort(function(e,t){return pouchCollate(e.key,t.key)}),options.descending&&results.reverse(),options.reduce===!1)return options.complete(null,{total_rows:results.length,offset:options.skip,rows:"limit"in options?results.slice(options.skip,options.limit+options.skip):options.skip>0?results.slice(options.skip):results});var e=[];results.forEach(function(t){var n=e[e.length-1]||null;return n&&0===pouchCollate(n.key[0][0],t.key)?(n.key.push([t.key,t.id]),n.value.push(t.value),void 0):(e.push({key:[[t.key,t.id]],value:[t.value]}),void 0)}),e.forEach(function(e){e.value=fun.reduce(e.key,e.value),e.value="undefined"==typeof e.value?null:e.value,e.key=e.key[0][0]}),options.complete(null,{total_rows:e.length,offset:options.skip,rows:"limit"in options?e.slice(options.skip,options.limit+options.skip):options.skip>0?e.slice(options.skip):e})}}if(options.complete){options.skip||(options.skip=0),fun.reduce||(options.reduce=!1);var builtInReduce={_sum:function(e,t){return sum(t)},_count:function(e,t,n){return n?sum(t):t.length},_stats:function(e,t){return{sum:sum(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:function(){var e=0;for(var n in t)"number"==typeof t[n]&&(e+=t[n]*t[n]);return e}()}}},results=[],current=null,num_started=0,completed=!1;eval("fun.map = "+fun.map.toString()+";"),fun.reduce&&(builtInReduce[fun.reduce]&&(fun.reduce=builtInReduce[fun.reduce]),eval("fun.reduce = "+fun.reduce.toString()+";")),db.changes({conflicts:!0,include_docs:!0,onChange:function(e){"deleted"in e||(current={doc:e.doc},fun.map.call(this,e.doc))},complete:function(){completed=!0,checkComplete()}})}}function httpQuery(e,t,n){var r=[],o=void 0,i="GET";if("undefined"!=typeof t.reduce&&r.push("reduce="+t.reduce),"undefined"!=typeof t.include_docs&&r.push("include_docs="+t.include_docs),"undefined"!=typeof t.limit&&r.push("limit="+t.limit),"undefined"!=typeof t.descending&&r.push("descending="+t.descending),"undefined"!=typeof t.startkey&&r.push("startkey="+encodeURIComponent(JSON.stringify(t.startkey))),"undefined"!=typeof t.endkey&&r.push("endkey="+encodeURIComponent(JSON.stringify(t.endkey))),"undefined"!=typeof t.key&&r.push("key="+encodeURIComponent(JSON.stringify(t.key))),"undefined"!=typeof t.group&&r.push("group="+t.group),"undefined"!=typeof t.group_level&&r.push("group_level="+t.group_level),"undefined"!=typeof t.skip&&r.push("skip="+t.skip),"undefined"!=typeof t.keys&&(i="POST",o=JSON.stringify({keys:t.keys})),r=r.join("&"),r=""===r?"":"?"+r,"string"==typeof e){var a=e.split("/");return db.request({method:i,url:"_design/"+a[0]+"/_view/"+a[1]+r,body:o},n),void 0}var s=JSON.parse(JSON.stringify(e,function(e,t){return"function"==typeof t?t+"":t}));db.request({method:"POST",url:"_temp_view"+r,body:s},n)}return this instanceof MapReduce?(this.query=function(e,t,n){if("function"==typeof t&&(n=t,t={}),n&&(t.complete=n),"http"===db.type())return"function"==typeof e?httpQuery({map:e},t,n):httpQuery(e,t,n);if("object"==typeof e)return viewQuery(e,t);if("function"==typeof e)return viewQuery({map:e},t);var r=e.split("/");db.get("_design/"+r[0],function(e,o){return e?(n&&n(e),void 0):o.views[r[1]]?(viewQuery({map:o.views[r[1]].map,reduce:o.views[r[1]].reduce},t),void 0):(n&&n({error:"not_found",reason:"missing_named_view"}),void 0)})},void 0):new MapReduce(db)}var pouchCollate=require("pouchdb-collate");MapReduce._delete=function(){},module.exports=MapReduce},{"pouchdb-collate":21}],21:[function(e,t){"use strict";function n(e,t){for(var n=Math.min(e.length,t.length),r=0;n>r;r++){var o=a(e[r],t[r]);if(0!==o)return o}return e.length===t.length?0:e.length>t.length?1:-1}function r(e,t){return e===t?0:e>t?1:-1}function o(e,t){for(var n=Object.keys(e),r=Object.keys(t),o=Math.min(n.length,r.length),i=0;o>i;i++){var s=a(n[i],r[i]);if(0!==s)return s;if(s=a(e[n[i]],t[r[i]]),0!==s)return s}return n.length===r.length?0:n.length>r.length?1:-1}function i(e){var t=["boolean","number","string","object"];return-1!==t.indexOf(typeof e)?null===e?1:t.indexOf(typeof e)+2:Array.isArray(e)?4.5:"undefined"==typeof e?1:void 0}function a(e,t){var a=i(e),s=i(t);return a-s!==0?a-s:null===e||"undefined"==typeof e?0:"number"==typeof e?e-t:"boolean"==typeof e?e===t?0:t>e?-1:1:"string"==typeof e?r(e,t):Array.isArray(e)?n(e,t):"object"==typeof e?o(e,t):void 0}t.exports=a},{}]},{},[12])(12)});(function(){var DelayedOp,DelayedSyncAnimation,Dropbox,DropboxClient,DropboxOauth,DropboxXhr,DropboxXhrCanSendForms,DropboxXhrIeMode,DropboxXhrRequest,OneOp,REALTIME_MIMETYPE,Set,add32,arrayToBase64,atob,atobNibble,base64Digits,base64HmacSha1,base64Sha1,baseUrl,btoa,btoaNibble,crypto,dropboxEncodeKey,exports,handleErrors,hmacSha1,mixpanel_token,realTimeEvents,rotateLeft32,sha1,stringToArray,_base64Digits,__hasProp={}.hasOwnProperty,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__slice=[].slice,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};(function(){var Nimbus,headID,newScript;if(window.Nimbus==null){window.Nimbus={}}Nimbus=window.Nimbus;window.handle_initialization=null;Nimbus.loaded=false;window.handleClientLoad=function(){console.log("loaded CALLED");Nimbus.loaded=true;if(Nimbus.gdrive_initialized){return Nimbus.Auth.initialize()}};headID=document.getElementsByTagName("head")[0];newScript=document.createElement("script");newScript.type="text/javascript";newScript.src="https://apis.google.com/js/client.js?onload=handleClientLoad";return headID.appendChild(newScript)})();Dropbox=function(){function Dropbox(options){this.client=new DropboxClient(options)}return Dropbox}();Dropbox.ApiError=function(){function ApiError(xhr,method,url){var e,text;this.method=method;this.url=url;this.status=xhr.status;if(xhr.responseType){text=xhr.response||xhr.responseText}else{text=xhr.responseText}if(text){try{this.responseText=text.toString();
this.response=JSON.parse(text)}catch(_error){e=_error;this.response=null}}else{this.responseText="(no response)";this.response=null}}ApiError.prototype.toString=function(){return"Dropbox API error "+this.status+" from "+this.method+" "+this.url+" :: "+this.responseText};ApiError.prototype.inspect=function(){return this.toString()};return ApiError}();if(typeof window!=="undefined"&&window!==null){if(window.atob&&window.btoa){atob=function(string){return window.atob(string)};btoa=function(base64){return window.btoa(base64)}}else{base64Digits="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";btoaNibble=function(accumulator,bytes,result){var i,limit;limit=3-bytes;accumulator<<=limit*8;i=3;while(i>=limit){result.push(base64Digits.charAt(accumulator>>i*6&63));i-=1}i=bytes;while(i<3){result.push("=");i+=1}return null};atobNibble=function(accumulator,digits,result){var i,limit;limit=4-digits;accumulator<<=limit*6;i=2;while(i>=limit){result.push(String.fromCharCode(accumulator>>8*i&255));i-=1}return null};btoa=function(string){var accumulator,bytes,i,result,_i,_ref;result=[];accumulator=0;bytes=0;for(i=_i=0,_ref=string.length;0<=_ref?_i<_ref:_i>_ref;i=0<=_ref?++_i:--_i){accumulator=accumulator<<8|string.charCodeAt(i);bytes+=1;if(bytes===3){btoaNibble(accumulator,bytes,result);accumulator=bytes=0}}if(bytes>0){btoaNibble(accumulator,bytes,result)}return result.join("")};atob=function(base64){var accumulator,digit,digits,i,result,_i,_ref;result=[];accumulator=0;digits=0;for(i=_i=0,_ref=base64.length;0<=_ref?_i<_ref:_i>_ref;i=0<=_ref?++_i:--_i){digit=base64.charAt(i);if(digit==="="){break}accumulator=accumulator<<6|base64Digits.indexOf(digit);digits+=1;if(digits===4){atobNibble(accumulator,digits,result);accumulator=digits=0}}if(digits>0){atobNibble(accumulator,digits,result)}return result.join("")}}}else{atob=function(arg){var buffer,i;buffer=new Buffer(arg,"base64");return function(){var _i,_ref,_results;_results=[];for(i=_i=0,_ref=buffer.length;0<=_ref?_i<_ref:_i>_ref;i=0<=_ref?++_i:--_i){_results.push(String.fromCharCode(buffer[i]))}return _results}().join("")};btoa=function(arg){var buffer,i;buffer=new Buffer(function(){var _i,_ref,_results;_results=[];for(i=_i=0,_ref=arg.length;0<=_ref?_i<_ref:_i>_ref;i=0<=_ref?++_i:--_i){_results.push(arg.charCodeAt(i))}return _results}());return buffer.toString("base64")}}Dropbox.Client=function(){function Client(options){this.sandbox=options.sandbox||false;this.apiServer=options.server||this.defaultApiServer();this.authServer=options.authServer||this.defaultAuthServer();this.fileServer=options.fileServer||this.defaultFileServer();this.oauth=new DropboxOauth(options);this.uid=null;this.authState=null;this.authError=null;this._credentials=null;this.setCredentials(options);this.setupUrls()}Client.prototype.authDriver=function(driver){this.driver=driver;return this};Client.prototype.dropboxUid=function(){return this.uid};Client.prototype.credentials=function(){if(!this._credentials){this.computeCredentials()}return this._credentials};Client.prototype.authenticate=function(callback){var oldAuthState,_fsmStep;oldAuthState=null;_fsmStep=function(_this){return function(){var authUrl;if(oldAuthState!==_this.authState){oldAuthState=_this.authState;if(_this.driver.onAuthStateChange){return _this.driver.onAuthStateChange(_this,_fsmStep)}}switch(_this.authState){case DropboxClient.RESET:return _this.requestToken(function(error,data){var token,tokenSecret;if(error){_this.authError=error;_this.authState=DropboxClient.ERROR}else{token=data.oauth_token;tokenSecret=data.oauth_token_secret;_this.oauth.setToken(token,tokenSecret);_this.authState=DropboxClient.REQUEST}_this._credentials=null;return _fsmStep()});case DropboxClient.REQUEST:authUrl=_this.authorizeUrl(_this.oauth.token);return _this.driver.doAuthorize(authUrl,_this.oauth.token,_this.oauth.tokenSecret,function(){_this.authState=DropboxClient.AUTHORIZED;_this._credentials=null;return _fsmStep()});case DropboxClient.AUTHORIZED:return _this.getAccessToken(function(error,data){if(error){_this.authError=error;_this.authState=DropboxClient.ERROR}else{_this.oauth.setToken(data.oauth_token,data.oauth_token_secret);_this.uid=data.uid;_this.authState=DropboxClient.DONE}_this._credentials=null;return _fsmStep()});case DropboxClient.DONE:return callback(null,_this);case Dropbox.SIGNED_OFF:_this.reset();return _fsmStep();case DropboxClient.ERROR:return callback(_this.authError)}}}(this);_fsmStep();return this};Client.prototype.signOut=function(callback){var params,url;url=this.urls.signOut;params=this.oauth.addAuthParams("POST",url,{});return Dropbox.Xhr.request("POST",url,params,null,function(_this){return function(error){if(error){return callback(error)}_this.reset();_this.authState=DropboxClient.SIGNED_OFF;if(_this.driver.onAuthStateChange){return _this.driver.onAuthStateChange(_this,function(){return callback(error)})}else{return callback(error)}}}(this))};Client.prototype.signOff=function(callback){return this.signOut(callback)};Client.prototype.getUserInfo=function(callback){var params,url;url=this.urls.accountInfo;params=this.oauth.addAuthParams("GET",url,{});return Dropbox.Xhr.request("GET",url,params,null,function(error,userData){return callback(error,Dropbox.UserInfo.parse(userData),userData)})};Client.prototype.readFile=function(path,options,callback){var params,responseType,url;if(!callback&&typeof options==="function"){callback=options;options=null}url=""+this.urls.getFile+"/"+this.urlEncodePath(path);params={};responseType=null;if(options){if(options.versionTag){params.rev=options.versionTag}else if(options.rev){params.rev=options.rev}if(options.blob){responseType="blob"}if(options.binary){responseType="b"}}this.oauth.addAuthParams("GET",url,params);return Dropbox.Xhr.request2("GET",url,params,null,null,responseType,function(error,data,metadata){return callback(error,data,Dropbox.Stat.parse(metadata))})};Client.prototype.writeFile=function(path,data,options,callback){var useForm;if(!callback&&typeof options==="function"){callback=options;options=null}useForm=Dropbox.Xhr.canSendForms&&typeof data==="object";if(useForm){return this.writeFileUsingForm(path,data,options,callback)}else{return this.writeFileUsingPut(path,data,options,callback)}};Client.prototype.writeFileUsingForm=function(path,data,options,callback){var fileField,fileName,params,slashIndex,url;slashIndex=path.lastIndexOf("/");if(slashIndex===-1){fileName=path;path=""}else{fileName=path.substring(slashIndex);path=path.substring(0,slashIndex)}url=""+this.urls.postFile+"/"+this.urlEncodePath(path);params={file:fileName};if(options){if(options.noOverwrite){params.overwrite="false"}if(options.lastVersionTag){params.parent_rev=options.lastVersionTag}else if(options.parentRev||options.parent_rev){params.parent_rev=options.parentRev||options.parent_rev}}this.oauth.addAuthParams("POST",url,params);delete params.file;fileField={name:"file",value:data,fileName:fileName,contentType:"application/octet-stream"};return Dropbox.Xhr.multipartRequest(url,fileField,params,null,function(error,metadata){return callback(error,Dropbox.Stat.parse(metadata))})};Client.prototype.writeFileUsingPut=function(path,data,options,callback){var params,url;url=""+this.urls.putFile+"/"+this.urlEncodePath(path);params={};if(options){if(options.noOverwrite){params.overwrite="false"}if(options.lastVersionTag){params.parent_rev=options.lastVersionTag}else if(options.parentRev||options.parent_rev){params.parent_rev=options.parentRev||options.parent_rev}}this.oauth.addAuthParams("POST",url,params);return Dropbox.Xhr.request2("POST",url,params,null,data,null,function(error,metadata){return callback(error,Dropbox.Stat.parse(metadata))})};Client.prototype.stat=function(path,options,callback){var params,url;if(!callback&&typeof options==="function"){callback=options;options=null}url=""+this.urls.metadata+"/"+this.urlEncodePath(path);params={};if(options){if(options.version!=null){params.rev=options.version}if(options.removed||options.deleted){params.include_deleted="true"}if(options.readDir){params.list="true";if(options.readDir!==true){params.file_limit=options.readDir.toString()}}if(options.cacheHash){params.hash=options.cacheHash}}params.include_deleted||(params.include_deleted="false");params.list||(params.list="false");this.oauth.addAuthParams("GET",url,params);return Dropbox.Xhr.request("GET",url,params,null,function(error,metadata){var entries,entry,stat;stat=Dropbox.Stat.parse(metadata);if(metadata!=null?metadata.contents:void 0){entries=function(){var _i,_len,_ref,_results;_ref=metadata.contents;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){entry=_ref[_i];_results.push(Dropbox.Stat.parse(entry))}return _results}()}else{entries=void 0}return callback(error,stat,entries)})};Client.prototype.readdir=function(path,options,callback){var statOptions;if(!callback&&typeof options==="function"){callback=options;options=null}statOptions={readDir:true};if(options){if(options.limit!=null){statOptions.readDir=options.limit}if(options.versionTag){statOptions.versionTag=options.versionTag}}return this.stat(path,statOptions,function(error,stat,entry_stats){var entries,entry_stat;if(entry_stats){entries=function(){var _i,_len,_results;_results=[];for(_i=0,_len=entry_stats.length;_i<_len;_i++){entry_stat=entry_stats[_i];_results.push(entry_stat.name)}return _results}()}else{entries=null}return callback(error,entries,stat,entry_stats)})};Client.prototype.metadata=function(path,options,callback){return this.stat(path,options,callback)};Client.prototype.makeUrl=function(path,options,callback){var isDirect,params,url;if(!callback&&typeof options==="function"){callback=options;options=null}path=this.urlEncodePath(path);if(options&&options.download){isDirect=true;url=""+this.urls.media+"/"+path}else{isDirect=false;url=""+this.urls.shares+"/"+path}if(options&&(options["long"]||options.longUrl)){params={short_url:"false"}}else{params={}}this.oauth.addAuthParams("POST",url,params);return Dropbox.Xhr.request("POST",url,params,null,function(error,urlData){return callback(error,Dropbox.PublicUrl.parse(urlData,isDirect))})};Client.prototype.history=function(path,options,callback){var params,url;if(!callback&&typeof options==="function"){callback=options;options=null}url=""+this.urls.revisions+"/"+this.urlEncodePath(path);params={};if(options&&options.limit!=null){params.rev_limit=options.limit}this.oauth.addAuthParams("GET",url,params);return Dropbox.Xhr.request("GET",url,params,null,function(error,versions){var metadata,stats;if(versions){stats=function(){var _i,_len,_results;_results=[];for(_i=0,_len=versions.length;_i<_len;_i++){metadata=versions[_i];_results.push(Dropbox.Stat.parse(metadata))}return _results}()}else{stats=void 0}return callback(error,stats)})};Client.prototype.revisions=function(path,options,callback){return this.history(path,options,callback)};Client.prototype.thumbnailUrl=function(path,options){var params,url;url=""+this.urls.thumbnails+"/"+this.urlEncodePath(path);params={};if(options){if(options.format){params.format=options.format}else if(options.png){params.format="png"}if(options.size){params.size=options.size}}this.oauth.addAuthParams("GET",url,params);return""+url+"?"+Dropbox.Xhr.urlEncode(params)};Client.prototype.readThumbnail=function(path,options,callback){var responseType,url;if(!callback&&typeof options==="function"){callback=options;options=null}url=this.thumbnailUrl(path,options);responseType="b";if(options){if(options.blob){responseType="blob"}}return Dropbox.Xhr.request2("GET",url,{},null,null,responseType,function(error,data,metadata){return callback(error,data,Dropbox.Stat.parse(metadata))})};Client.prototype.revertFile=function(path,versionTag,callback){var params,url;url=""+this.urls.restore+"/"+this.urlEncodePath(path);params={rev:versionTag};this.oauth.addAuthParams("POST",url,params);return Dropbox.Xhr.request("POST",url,params,null,function(error,metadata){return callback(error,Dropbox.Stat.parse(metadata))})};Client.prototype.restore=function(path,versionTag,callback){return this.revertFile(path,versionTag,callback)};Client.prototype.findByName=function(path,namePattern,options,callback){var params,url;if(!callback&&typeof options==="function"){callback=options;options=null}url=""+this.urls.search+"/"+this.urlEncodePath(path);params={query:namePattern};if(options){if(options.limit!=null){params.file_limit=options.limit}if(options.removed||options.deleted){params.include_deleted=true}}this.oauth.addAuthParams("GET",url,params);return Dropbox.Xhr.request("GET",url,params,null,function(error,results){var metadata,stats;if(results){stats=function(){var _i,_len,_results;_results=[];for(_i=0,_len=results.length;_i<_len;_i++){metadata=results[_i];_results.push(Dropbox.Stat.parse(metadata))}return _results}()}else{stats=void 0}return callback(error,stats)})};Client.prototype.search=function(path,namePattern,options,callback){return this.findByName(path,namePattern,options,callback)};Client.prototype.makeCopyReference=function(path,callback){var params,url;url=""+this.urls.copyRef+"/"+this.urlEncodePath(path);params=this.oauth.addAuthParams("GET",url,{});return Dropbox.Xhr.request("GET",url,params,null,function(error,refData){return callback(error,Dropbox.CopyReference.parse(refData))})};Client.prototype.copyRef=function(path,callback){return this.makeCopyReference(path,callback)};Client.prototype.pullChanges=function(cursor,callback){var params,url;if(!callback&&typeof cursor==="function"){callback=cursor;cursor=null}url=this.urls.delta;params={};if(cursor){if(cursor.cursorTag){params={cursor:cursor.cursorTag}}else{params={cursor:cursor}}}else{params={}}this.oauth.addAuthParams("POST",url,params);return Dropbox.Xhr.request("POST",url,params,null,function(error,deltaInfo){return callback(error,Dropbox.PulledChanges.parse(deltaInfo))})};Client.prototype.delta=function(cursor,callback){return this.pullChanges(cursor,callback)};Client.prototype.mkdir=function(path,callback){var params,url;url=this.urls.fileopsCreateFolder;params={root:this.fileRoot,path:this.normalizePath(path)};this.oauth.addAuthParams("POST",url,params);return Dropbox.Xhr.request("POST",url,params,null,function(error,metadata){return callback(error,Dropbox.Stat.parse(metadata))})};Client.prototype.remove=function(path,callback){var params,url;url=this.urls.fileopsDelete;params={root:this.fileRoot,path:this.normalizePath(path)};this.oauth.addAuthParams("POST",url,params);return Dropbox.Xhr.request("POST",url,params,null,function(error,metadata){return callback(error,Dropbox.Stat.parse(metadata))})};Client.prototype.unlink=function(path,callback){return this.remove(path,callback)};Client.prototype["delete"]=function(path,callback){return this.remove(path,callback)};Client.prototype.copy=function(from,toPath,callback){var options,params,url;if(!callback&&typeof options==="function"){callback=options;options=null}params={root:this.fileRoot,to_path:this.normalizePath(toPath)};if(from instanceof Dropbox.CopyReference){params.from_copy_ref=from.tag}else{params.from_path=this.normalizePath(from)}url=this.urls.fileopsCopy;this.oauth.addAuthParams("POST",url,params);return Dropbox.Xhr.request("POST",url,params,null,function(error,metadata){return callback(error,Dropbox.Stat.parse(metadata))})};Client.prototype.move=function(fromPath,toPath,callback){var options,params,url;if(!callback&&typeof options==="function"){callback=options;options=null}fromPath=this.normalizePath(fromPath);toPath=this.normalizePath(toPath);url=this.urls.fileopsMove;params={root:this.fileRoot,from_path:fromPath,to_path:toPath};this.oauth.addAuthParams("POST",url,params);return Dropbox.Xhr.request("POST",url,params,null,function(error,metadata){return callback(error,Dropbox.Stat.parse(metadata))})};Client.prototype.reset=function(){this.uid=null;this.oauth.setToken(null,"");this.authState=DropboxClient.RESET;this.authError=null;this._credentials=null;return this};Client.prototype.setCredentials=function(credentials){this.oauth.reset(credentials);this.uid=credentials.uid||null;if(credentials.authState){this.authState=credentials.authState}else{if(credentials.token){this.authState=DropboxClient.DONE}else{this.authState=DropboxClient.RESET}}this.authError=null;this._credentials=null;return this};Client.prototype.appHash=function(){return this.oauth.appHash()};Client.prototype.setupUrls=function(){this.fileRoot=this.sandbox?"sandbox":"dropbox";return this.urls={requestToken:""+this.apiServer+"/1/oauth/request_token",authorize:""+this.authServer+"/1/oauth/authorize",accessToken:""+this.apiServer+"/1/oauth/access_token",signOut:""+this.apiServer+"/1/unlink_access_token",accountInfo:""+this.apiServer+"/1/account/info",getFile:""+this.fileServer+"/1/files/"+this.fileRoot,postFile:""+this.fileServer+"/1/files/"+this.fileRoot,putFile:""+this.fileServer+"/1/files_put/"+this.fileRoot,metadata:""+this.apiServer+"/1/metadata/"+this.fileRoot,delta:""+this.apiServer+"/1/delta",revisions:""+this.apiServer+"/1/revisions/"+this.fileRoot,restore:""+this.apiServer+"/1/restore/"+this.fileRoot,search:""+this.apiServer+"/1/search/"+this.fileRoot,shares:""+this.apiServer+"/1/shares/"+this.fileRoot,media:""+this.apiServer+"/1/media/"+this.fileRoot,copyRef:""+this.apiServer+"/1/copy_ref/"+this.fileRoot,thumbnails:""+this.fileServer+"/1/thumbnails/"+this.fileRoot,fileopsCopy:""+this.apiServer+"/1/fileops/copy",fileopsCreateFolder:""+this.apiServer+"/1/fileops/create_folder",fileopsDelete:""+this.apiServer+"/1/fileops/delete",fileopsMove:""+this.apiServer+"/1/fileops/move"}};Client.ERROR=0;Client.RESET=1;Client.REQUEST=2;Client.AUTHORIZED=3;Client.DONE=4;Client.SIGNED_OFF=5;Client.prototype.urlEncodePath=function(path){return Dropbox.Xhr.urlEncodeValue(this.normalizePath(path)).replace(/%2F/gi,"/")};Client.prototype.normalizePath=function(path){var i;if(path.substring(0,1)==="/"){i=1;while(path.substring(i,i+1)==="/"){i+=1}return path.substring(i)}else{return path}};Client.prototype.requestToken=function(callback){var params;params=this.oauth.addAuthParams("POST",this.urls.requestToken,{});return Dropbox.Xhr.request("POST",this.urls.requestToken,params,null,callback)};Client.prototype.authorizeUrl=function(token){var params;params={oauth_token:token,oauth_callback:this.driver.url()};return""+this.urls.authorize+"?"+Dropbox.Xhr.urlEncode(params)};Client.prototype.getAccessToken=function(callback){var params;params=this.oauth.addAuthParams("POST",this.urls.accessToken,{});return Dropbox.Xhr.request("POST",this.urls.accessToken,params,null,callback)};Client.prototype.defaultApiServer=function(){return"https://api.dropbox.com"};Client.prototype.defaultAuthServer=function(){return this.apiServer.replace("api.","www.")};Client.prototype.defaultFileServer=function(){return this.apiServer.replace("api.","api-content.")};Client.prototype.computeCredentials=function(){var value;value={key:this.oauth.key,sandbox:this.sandbox};if(this.oauth.secret){value.secret=this.oauth.secret}if(this.oauth.token){value.token=this.oauth.token;value.tokenSecret=this.oauth.tokenSecret}if(this.uid){value.uid=this.uid}if(this.authState!==DropboxClient.ERROR&&this.authState!==DropboxClient.RESET&&this.authState!==DropboxClient.DONE&&this.authState!==DropboxClient.SIGNED_OFF){value.authState=this.authState}if(this.apiServer!==this.defaultApiServer()){value.server=this.apiServer}if(this.authServer!==this.defaultAuthServer()){value.authServer=this.authServer}if(this.fileServer!==this.defaultFileServer()){value.fileServer=this.fileServer}return this._credentials=value};return Client}();DropboxClient=Dropbox.Client;Dropbox.AuthDriver=function(){function AuthDriver(){}AuthDriver.prototype.url=function(){return"https://some.url"};AuthDriver.prototype.doAuthorize=function(authUrl,token,tokenSecret,callback){return callback("oauth-token")};AuthDriver.prototype.onAuthStateChange=function(client,done){return done()};return AuthDriver}();Dropbox.Drivers={};Dropbox.Drivers.Redirect=function(){function Redirect(options){this.rememberUser=(options!=null?options.rememberUser:void 0)||false;this.scope=(options!=null?options.scope:void 0)||"default";this.useQuery=(options!=null?options.useQuery:void 0)||false;this.receiverUrl=this.computeUrl(options);this.tokenRe=new RegExp("(#|\\?|&)oauth_token=([^&#]+)(&|#|$)")}Redirect.prototype.url=function(){return this.receiverUrl};Redirect.prototype.doAuthorize=function(authUrl){return window.location.assign(authUrl)};Redirect.prototype.onAuthStateChange=function(client,done){var credentials;this.storageKey="dropbox-auth:"+this.scope+":"+client.appHash();switch(client.authState){case DropboxClient.RESET:if(!(credentials=this.loadCredentials())){return done()}if(credentials.authState){if(credentials.token===this.locationToken()){if(credentials.authState===DropboxClient.REQUEST){this.forgetCredentials();credentials.authState=DropboxClient.AUTHORIZED}client.setCredentials(credentials)}return done()}if(!this.rememberUser){this.forgetCredentials();return done()}client.setCredentials(credentials);return client.getUserInfo(function(_this){return function(error){if(error){client.reset();_this.forgetCredentials()}return done()}}(this));case DropboxClient.REQUEST:this.storeCredentials(client.credentials());return done();case DropboxClient.DONE:if(this.rememberUser){this.storeCredentials(client.credentials())}return done();case DropboxClient.SIGNED_OFF:this.forgetCredentials();return done();case DropboxClient.ERROR:this.forgetCredentials();return done();default:return done()}};Redirect.prototype.computeUrl=function(){var fragment,location,locationPair,querySuffix;querySuffix="_dropboxjs_scope="+encodeURIComponent(this.scope);location=Dropbox.Drivers.Redirect.currentLocation();if(location.indexOf("#")===-1){fragment=null}else{locationPair=location.split("#",2);location=locationPair[0];fragment=locationPair[1]}if(this.useQuery){if(location.indexOf("?")===-1){location+="?"+querySuffix}else{location+="&"+querySuffix}}else{fragment="?"+querySuffix}if(fragment){return location+"#"+fragment}else{return location}};Redirect.prototype.locationToken=function(){var location,match,scopePattern;location=Dropbox.Drivers.Redirect.currentLocation();scopePattern="_dropboxjs_scope="+encodeURIComponent(this.scope)+"&";if((typeof location.indexOf==="function"?location.indexOf(scopePattern):void 0)===-1){return null}match=this.tokenRe.exec(location);if(match){return decodeURIComponent(match[2])}else{return null}};Redirect.currentLocation=function(){return window.location.href};Redirect.prototype.storeCredentials=function(credentials){return localStorage.setItem(this.storageKey,JSON.stringify(credentials))};Redirect.prototype.loadCredentials=function(){var e,jsonString;jsonString=localStorage.getItem(this.storageKey);if(!jsonString){return null}try{return JSON.parse(jsonString)}catch(_error){e=_error;return null}};Redirect.prototype.forgetCredentials=function(){return localStorage.removeItem(this.storageKey)};return Redirect}();Dropbox.Drivers.Popup=function(){function Popup(options){this.receiverUrl=this.computeUrl(options);this.tokenRe=new RegExp("(#|\\?|&)oauth_token=([^&#]+)(&|#|$)")}Popup.prototype.doAuthorize=function(authUrl,token,tokenSecret,callback){this.listenForMessage(token,callback);return this.openWindow(authUrl)};Popup.prototype.url=function(){return this.receiverUrl};Popup.prototype.computeUrl=function(options){var fragments;if(options){if(options.receiverUrl){if(options.noFragment||options.receiverUrl.indexOf("#")!==-1){return options.receiverUrl}else{return options.receiverUrl+"#"}}else if(options.receiverFile){fragments=Dropbox.Drivers.Popup.currentLocation().split("/");fragments[fragments.length-1]=options.receiverFile;if(options.noFragment){return fragments.join("/")}else{return fragments.join("/")+"#"}}}return Dropbox.Drivers.Popup.currentLocation()};Popup.currentLocation=function(){return window.location.href};Popup.prototype.openWindow=function(url){return window.open(url,"_dropboxOauthSigninWindow",this.popupWindowSpec(980,980))};Popup.prototype.popupWindowSpec=function(popupWidth,popupHeight){var height,popupLeft,popupTop,width,x0,y0,_ref,_ref1,_ref2,_ref3;x0=(_ref=window.screenX)!=null?_ref:window.screenLeft;y0=(_ref1=window.screenY)!=null?_ref1:window.screenTop;width=(_ref2=window.outerWidth)!=null?_ref2:document.documentElement.clientWidth;height=(_ref3=window.outerHeight)!=null?_ref3:document.documentElement.clientHeight;popupLeft=Math.round(x0+(width-popupWidth)/2);popupTop=Math.round(y0+(height-popupHeight)/2.5);return"width="+popupWidth+",height="+popupHeight+","+("left="+popupLeft+",top="+popupTop)+"dialog=yes,dependent=yes,scrollbars=yes,location=yes"};Popup.prototype.listenForMessage=function(token,callback){var listener,tokenRe;tokenRe=this.tokenRe;listener=function(event){var match;match=tokenRe.exec(event.data.toString());if(match&&decodeURIComponent(match[2])===token){window.removeEventListener("message",listener);return callback()}};return window.addEventListener("message",listener,false)};return Popup}();Dropbox.Drivers.NodeServer=function(){function NodeServer(options){this.port=(options!=null?options.port:void 0)||8912;this.faviconFile=(options!=null?options.favicon:void 0)||null;this.fs=require("fs");this.http=require("http");this.open=require("open");this.callbacks={};this.urlRe=new RegExp("^/oauth_callback\\?");this.tokenRe=new RegExp("(\\?|&)oauth_token=([^&]+)(&|$)");this.createApp()}NodeServer.prototype.url=function(){return"http://localhost:"+this.port+"/oauth_callback"};NodeServer.prototype.doAuthorize=function(authUrl,token,tokenSecret,callback){this.callbacks[token]=callback;return this.openBrowser(authUrl)};NodeServer.prototype.openBrowser=function(url){if(!url.match(/^https?:\/\//)){throw new Error("Not a http/https URL: "+url)}return this.open(url)};NodeServer.prototype.createApp=function(){this.app=this.http.createServer(function(_this){return function(request,response){return _this.doRequest(request,response)}}(this));return this.app.listen(this.port)};NodeServer.prototype.closeServer=function(){return this.app.close()};NodeServer.prototype.doRequest=function(request,response){var data,match,token;if(this.urlRe.exec(request.url)){match=this.tokenRe.exec(request.url);if(match){token=decodeURIComponent(match[2]);if(this.callbacks[token]){this.callbacks[token]();delete this.callbacks[token]}}}data="";request.on("data",function(dataFragment){return data+=dataFragment});return request.on("end",function(_this){return function(){if(_this.faviconFile&&request.url==="/favicon.ico"){return _this.sendFavicon(response)}else{return _this.closeBrowser(response)}}}(this))};NodeServer.prototype.closeBrowser=function(response){var closeHtml;closeHtml='<!doctype html>\n<script type="text/javascript">window.close();</script>\n<p>Please close this window.</p>';response.writeHead(200,{"Content-Length":closeHtml.length,"Content-Type":"text/html"});response.write(closeHtml);return response.end};NodeServer.prototype.sendFavicon=function(response){return this.fs.readFile(this.faviconFile,function(error,data){response.writeHead(200,{"Content-Length":data.length,"Content-Type":"image/x-icon"});response.write(data);return response.end})};return NodeServer}();base64HmacSha1=function(string,key){return arrayToBase64(hmacSha1(stringToArray(string),stringToArray(key),string.length,key.length))};base64Sha1=function(string){return arrayToBase64(sha1(stringToArray(string),string.length))};if(typeof window==="undefined"||window===null){crypto=require("crypto");base64HmacSha1=function(string,key){var hmac;hmac=crypto.createHmac("sha1",key);hmac.update(string);return hmac.digest("base64")};base64Sha1=function(string){var hash;hash=crypto.createHash("sha1");hash.update(string);return hash.digest("base64")}}hmacSha1=function(string,key,length,keyLength){var hash1,i,ipad,opad;if(key.length>16){key=sha1(key,keyLength)}ipad=function(){var _i,_results;_results=[];for(i=_i=0;_i<16;i=++_i){_results.push(key[i]^909522486)}return _results}();opad=function(){var _i,_results;_results=[];for(i=_i=0;_i<16;i=++_i){_results.push(key[i]^1549556828)}return _results}();hash1=sha1(ipad.concat(string),64+length);return sha1(opad.concat(hash1),64+20)};sha1=function(string,length){var a,a0,b,b0,c,c0,d,d0,e,e0,ft,i,j,kt,limit,state,t,_i;string[length>>2]|=1<<31-((length&3)<<3);string[(length+8>>6<<4)+15]=length<<3;state=Array(80);a=1732584193;b=-271733879;c=-1732584194;d=271733878;e=-1009589776;i=0;limit=string.length;while(i<limit){a0=a;b0=b;c0=c;d0=d;e0=e;for(j=_i=0;_i<80;j=++_i){if(j<16){state[j]=string[i+j]}else{state[j]=rotateLeft32(state[j-3]^state[j-8]^state[j-14]^state[j-16],1)}if(j<20){ft=b&c|~b&d;kt=1518500249}else if(j<40){ft=b^c^d;kt=1859775393}else if(j<60){ft=b&c|b&d|c&d;kt=-1894007588}else{ft=b^c^d;kt=-899497514}t=add32(add32(rotateLeft32(a,5),ft),add32(add32(e,state[j]),kt));e=d;d=c;c=rotateLeft32(b,30);b=a;a=t}a=add32(a,a0);b=add32(b,b0);c=add32(c,c0);d=add32(d,d0);e=add32(e,e0);i+=16}return[a,b,c,d,e]};rotateLeft32=function(value,count){return value<<count|value>>>32-count};add32=function(a,b){var high,low;low=(a&65535)+(b&65535);high=(a>>16)+(b>>16)+(low>>16);return high<<16|low&65535};arrayToBase64=function(array){var i,i2,limit,string,trit;string="";i=0;limit=array.length*4;while(i<limit){i2=i;trit=(array[i2>>2]>>(3-(i2&3)<<3)&255)<<16;i2+=1;trit|=(array[i2>>2]>>(3-(i2&3)<<3)&255)<<8;i2+=1;trit|=array[i2>>2]>>(3-(i2&3)<<3)&255;string+=_base64Digits[trit>>18&63];string+=_base64Digits[trit>>12&63];i+=1;if(i>=limit){string+="="}else{string+=_base64Digits[trit>>6&63]}i+=1;if(i>=limit){string+="="}else{string+=_base64Digits[trit&63]}i+=1}return string};_base64Digits="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";stringToArray=function(string){var array,i,mask,_i,_ref;array=[];mask=255;for(i=_i=0,_ref=string.length;0<=_ref?_i<_ref:_i>_ref;i=0<=_ref?++_i:--_i){array[i>>2]|=(string.charCodeAt(i)&mask)<<(3-(i&3)<<3)}return array};Dropbox.Oauth=function(){function Oauth(options){this.key=this.k=null;this.secret=this.s=null;this.token=null;this.tokenSecret=null;this._appHash=null;this.reset(options)}Oauth.prototype.reset=function(options){var k,s,secret,_ref;if(options.secret){this.k=this.key=options.key;this.s=this.secret=options.secret;this._appHash=null}else if(options.key){this.key=options.key;this.secret=null;secret=atob(dropboxEncodeKey(this.key).split("|",2)[1]);_ref=secret.split("?",2),k=_ref[0],s=_ref[1];this.k=decodeURIComponent(k);this.s=decodeURIComponent(s);this._appHash=null}else{if(!this.k){throw new Error("No API key supplied")}}if(options.token){return this.setToken(options.token,options.tokenSecret)}else{return this.setToken(null,"")}};Oauth.prototype.setToken=function(token,tokenSecret){if(token&&!tokenSecret){throw new Error("No secret supplied with the user token")}this.token=token;this.tokenSecret=tokenSecret||"";this.hmacKey=DropboxXhr.urlEncodeValue(this.s)+"&"+DropboxXhr.urlEncodeValue(tokenSecret);return null};Oauth.prototype.authHeader=function(method,url,params){var header,oauth_params,param,value,_i,_len;this.addAuthParams(method,url,params);oauth_params=[];for(param in params){value=params[param];if(param.substring(0,6)==="oauth_"){oauth_params.push(param)}}oauth_params.sort();header=[];for(_i=0,_len=oauth_params.length;_i<_len;_i++){param=oauth_params[_i];header.push(DropboxXhr.urlEncodeValue(param)+'="'+DropboxXhr.urlEncodeValue(params[param])+'"');delete params[param]}return"OAuth "+header.join(",")};Oauth.prototype.addAuthParams=function(method,url,params){this.boilerplateParams(params);params.oauth_signature=this.signature(method,url,params);return params};Oauth.prototype.boilerplateParams=function(params){params.oauth_consumer_key=this.k;params.oauth_nonce=this.nonce();params.oauth_signature_method="HMAC-SHA1";if(this.token){params.oauth_token=this.token}params.oauth_timestamp=Math.floor(Date.now()/1e3);params.oauth_version="1.0";return params};Oauth.prototype.nonce=function(){return Date.now().toString(36)+Math.random().toString(36)
};Oauth.prototype.signature=function(method,url,params){var string;string=method.toUpperCase()+"&"+DropboxXhr.urlEncodeValue(url)+"&"+DropboxXhr.urlEncodeValue(DropboxXhr.urlEncode(params));return base64HmacSha1(string,this.hmacKey)};Oauth.prototype.appHash=function(){if(this._appHash){return this._appHash}return this._appHash=base64Sha1(this.k).replace(/\=/g,"")};return Oauth}();if(Date.now==null){Date.now=function(){return(new Date).getTime()}}DropboxOauth=Dropbox.Oauth;dropboxEncodeKey=function(key,secret){var i,k,result,s,x,y,z,_i,_j,_ref,_ref1,_results;if(secret){secret=[encodeURIComponent(key),encodeURIComponent(secret)].join("?");key=function(){var _i,_ref,_results;_results=[];for(i=_i=0,_ref=key.length/2;0<=_ref?_i<_ref:_i>_ref;i=0<=_ref?++_i:--_i){_results.push((key.charCodeAt(i*2)&15)*16+(key.charCodeAt(i*2+1)&15))}return _results}()}else{_ref=key.split("|",2),key=_ref[0],secret=_ref[1];key=atob(key);key=function(){var _i,_ref1,_results;_results=[];for(i=_i=0,_ref1=key.length;0<=_ref1?_i<_ref1:_i>_ref1;i=0<=_ref1?++_i:--_i){_results.push(key.charCodeAt(i))}return _results}();secret=atob(secret)}s=function(){_results=[];for(_i=0;_i<256;_i++){_results.push(_i)}return _results}.apply(this);y=0;for(x=_j=0;_j<256;x=++_j){y=(y+s[i]+key[x%key.length])%256;_ref1=[s[y],s[x]],s[x]=_ref1[0],s[y]=_ref1[1]}x=y=0;result=function(){var _k,_ref2,_ref3,_results1;_results1=[];for(z=_k=0,_ref2=secret.length;0<=_ref2?_k<_ref2:_k>_ref2;z=0<=_ref2?++_k:--_k){x=(x+1)%256;y=(y+s[x])%256;_ref3=[s[y],s[x]],s[x]=_ref3[0],s[y]=_ref3[1];k=s[(s[x]+s[y])%256];_results1.push(String.fromCharCode((k^secret.charCodeAt(z))%256))}return _results1}();key=function(){var _k,_ref2,_results1;_results1=[];for(i=_k=0,_ref2=key.length;0<=_ref2?_k<_ref2:_k>_ref2;i=0<=_ref2?++_k:--_k){_results1.push(String.fromCharCode(key[i]))}return _results1}();return[btoa(key.join("")),btoa(result.join(""))].join("|")};Dropbox.PulledChanges=function(){PulledChanges.parse=function(deltaInfo){if(deltaInfo&&typeof deltaInfo==="object"){return new Dropbox.PulledChanges(deltaInfo)}else{return deltaInfo}};PulledChanges.prototype.blankSlate=void 0;PulledChanges.prototype.cursorTag=void 0;PulledChanges.prototype.changes=void 0;PulledChanges.prototype.shouldPullAgain=void 0;PulledChanges.prototype.shouldBackOff=void 0;function PulledChanges(deltaInfo){var entry;this.blankSlate=deltaInfo.reset||false;this.cursorTag=deltaInfo.cursor;this.shouldPullAgain=deltaInfo.has_more;this.shouldBackOff=!this.shouldPullAgain;if(deltaInfo.cursor&&deltaInfo.cursor.length){this.changes=function(){var _i,_len,_ref,_results;_ref=deltaInfo.entries;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){entry=_ref[_i];_results.push(Dropbox.PullChange.parse(entry))}return _results}()}else{this.changes=[]}}return PulledChanges}();Dropbox.PullChange=function(){PullChange.parse=function(entry){if(entry&&typeof entry==="object"){return new Dropbox.PullChange(entry)}else{return entry}};PullChange.prototype.path=void 0;PullChange.prototype.wasRemoved=void 0;PullChange.prototype.stat=void 0;function PullChange(entry){this.path=entry[0];this.stat=Dropbox.Stat.parse(entry[1]);if(this.stat){this.wasRemoved=false}else{this.stat=null;this.wasRemoved=true}}return PullChange}();Dropbox.PublicUrl=function(){PublicUrl.parse=function(urlData,isDirect){if(urlData&&typeof urlData==="object"){return new Dropbox.PublicUrl(urlData,isDirect)}else{return urlData}};PublicUrl.prototype.url=void 0;PublicUrl.prototype.expiresAt=void 0;PublicUrl.prototype.isDirect=void 0;PublicUrl.prototype.isPreview=void 0;function PublicUrl(urlData,isDirect){this.url=urlData.url;this.expiresAt=new Date(Date.parse(urlData.expires));if(isDirect===true){this.isDirect=true}else if(isDirect===false){this.isDirect=false}else{this.isDirect=Date.now()-this.expiresAt<=864e5}this.isPreview=!this.isDirect}return PublicUrl}();Dropbox.CopyReference=function(){CopyReference.parse=function(refData){if(refData&&(typeof refData==="object"||typeof refData==="string")){return new Dropbox.CopyReference(refData)}else{return refData}};CopyReference.prototype.tag=void 0;CopyReference.prototype.expiresAt=void 0;function CopyReference(refData){if(typeof refData==="object"){this.tag=refData.copy_ref;this.expiresAt=new Date(Date.parse(refData.expires))}else{this.tag=refData;this.expiresAt=new Date}}return CopyReference}();Dropbox.Stat=function(){Stat.parse=function(metadata){if(metadata&&typeof metadata==="object"){return new Dropbox.Stat(metadata)}else{return metadata}};Stat.prototype.path=null;Stat.prototype.name=null;Stat.prototype.inAppFolder=null;Stat.prototype.isFolder=null;Stat.prototype.isFile=null;Stat.prototype.isRemoved=null;Stat.prototype.typeIcon=null;Stat.prototype.versionTag=null;Stat.prototype.mimeType=null;Stat.prototype.size=null;Stat.prototype.humanSize=null;Stat.prototype.hasThumbnail=null;Stat.prototype.modifiedAt=null;Stat.prototype.clientModifiedAt=null;function Stat(metadata){var lastIndex,nameSlash,_ref,_ref1;this.path=metadata.path;if(this.path.substring(0,1)!=="/"){this.path="/"+this.path}lastIndex=this.path.length-1;if(lastIndex>=0&&this.path.substring(lastIndex)==="/"){this.path=this.path.substring(0,lastIndex)}nameSlash=this.path.lastIndexOf("/");this.name=this.path.substring(nameSlash+1);this.isFolder=metadata.is_dir||false;this.isFile=!this.isFolder;this.isRemoved=metadata.is_deleted||false;this.typeIcon=metadata.icon;if((_ref=metadata.modified)!=null?_ref.length:void 0){this.modifiedAt=new Date(Date.parse(metadata.modified))}else{this.modifiedAt=null}if((_ref1=metadata.client_mtime)!=null?_ref1.length:void 0){this.clientModifiedAt=new Date(Date.parse(metadata.client_mtime))}else{this.clientModifiedAt=null}switch(metadata.root){case"dropbox":this.inAppFolder=false;break;case"app_folder":this.inAppFolder=true;break;default:this.inAppFolder=null}this.size=metadata.bytes||0;this.humanSize=metadata.size||"";this.hasThumbnail=metadata.thumb_exists||false;if(this.isFolder){this.versionTag=metadata.hash;this.mimeType=metadata.mime_type||"inode/directory"}else{this.versionTag=metadata.rev;this.mimeType=metadata.mime_type||"application/octet-stream"}}return Stat}();Dropbox.UserInfo=function(){UserInfo.parse=function(userInfo){if(userInfo&&typeof userInfo==="object"){return new Dropbox.UserInfo(userInfo)}else{return userInfo}};UserInfo.prototype.name=null;UserInfo.prototype.email=null;UserInfo.prototype.countryCode=null;UserInfo.prototype.uid=null;UserInfo.prototype.referralUrl=null;UserInfo.prototype.publicAppUrl=null;UserInfo.prototype.quota=null;UserInfo.prototype.usedQuota=null;UserInfo.prototype.privateBytes=null;UserInfo.prototype.sharedBytes=null;function UserInfo(userInfo){var lastIndex;this.name=userInfo.display_name;this.email=userInfo.email;this.countryCode=userInfo.country||null;this.uid=userInfo.uid.toString();if(userInfo.public_app_url){this.publicAppUrl=userInfo.public_app_url;lastIndex=this.publicAppUrl.length-1;if(lastIndex>=0&&this.publicAppUrl.substring(lastIndex)==="/"){this.publicAppUrl=this.publicAppUrl.substring(0,lastIndex)}}else{this.publicAppUrl=null}this.referralUrl=userInfo.referral_link;this.quota=userInfo.quota_info.quota;this.privateBytes=userInfo.quota_info.normal||0;this.sharedBytes=userInfo.quota_info.shared||0;this.usedQuota=this.privateBytes+this.sharedBytes}return UserInfo}();if(typeof window!=="undefined"&&window!==null){if(window.XDomainRequest&&!("withCredentials"in new XMLHttpRequest)){DropboxXhrRequest=window.XDomainRequest;DropboxXhrIeMode=true;DropboxXhrCanSendForms=false}else{DropboxXhrRequest=window.XMLHttpRequest;DropboxXhrIeMode=false;DropboxXhrCanSendForms=window.navigator.userAgent.indexOf("Firefox")===-1}}else{DropboxXhrRequest=require("xmlhttprequest").XMLHttpRequest;DropboxXhrIeMode=false;DropboxXhrCanSendForms=false}Dropbox.Xhr=function(){function Xhr(){}Xhr.Request=DropboxXhrRequest;Xhr.ieMode=DropboxXhrIeMode;Xhr.canSendForms=DropboxXhrCanSendForms;Xhr.request=function(method,url,params,authHeader,callback){return this.request2(method,url,params,authHeader,null,null,callback)};Xhr.request2=function(method,url,params,authHeader,body,responseType,callback){var headers,paramsInUrl,queryString;paramsInUrl=method==="GET"||body!=null||this.ieMode;if(paramsInUrl){queryString=DropboxXhr.urlEncode(params);if(queryString.length!==0){url=[url,"?",DropboxXhr.urlEncode(params)].join("")}}headers={};if(authHeader){headers["Authorization"]=authHeader}if(body!=null){if(typeof body==="string"){headers["Content-Type"]="text/plain; charset=utf8"}}else if(!paramsInUrl){headers["Content-Type"]="application/x-www-form-urlencoded";body=DropboxXhr.urlEncode(params)}return DropboxXhr.xhrRequest(method,url,headers,body,responseType,callback)};Xhr.multipartRequest=function(url,fileField,params,authHeader,callback){var body,boundary,fileData,fileType,headers,useFormData;url=[url,"?",DropboxXhr.urlEncode(params)].join("");fileData=fileField.value;useFormData=typeof fileData==="object"&&(typeof Blob!=="undefined"&&Blob!==null&&fileField.value instanceof Blob||typeof File!=="undefined"&&File!==null&&fileField.value instanceof File);if(useFormData){headers={};body=new FormData;body.append(fileField.name,fileData,fileField.fileName)}else{fileType=fileField.contentType||"application/octet-stream";boundary=this.multipartBoundary();headers={"Content-Type":"multipart/form-data; boundary="+boundary};body=["--",boundary,"\r\n",'Content-Disposition: form-data; name="',fileField.name,'"; filename="',fileField.fileName,'"\r\n',"Content-Type: ",fileType,"\r\n","Content-Transfer-Encoding: binary\r\n\r\n",fileData,"\r\n","--",boundary,"--","\r\n"].join("")}if(authHeader){headers["Authorization"]=authHeader}return DropboxXhr.xhrRequest("POST",url,headers,body,null,callback)};Xhr.multipartBoundary=function(){return[Date.now().toString(36),Math.random().toString(36)].join("----")};Xhr.xhrRequest=function(method,url,headers,body,responseType,callback){var header,value,xhr;xhr=new this.Request;if(this.ieMode){xhr.onload=function(){return DropboxXhr.onLoad(xhr,method,url,callback)};xhr.onerror=function(){return DropboxXhr.onError(xhr,method,url,callback)}}else{xhr.onreadystatechange=function(){return DropboxXhr.onReadyStateChange(xhr,method,url,responseType,callback)}}xhr.open(method,url,true);if(responseType){if(responseType==="b"){if(xhr.overrideMimeType){xhr.overrideMimeType("text/plain; charset=x-user-defined")}}else{xhr.responseType=responseType}}if(!this.ieMode){for(header in headers){if(!__hasProp.call(headers,header))continue;value=headers[header];xhr.setRequestHeader(header,value)}}if(body!=null){xhr.send(body)}else{xhr.send()}return xhr};Xhr.urlEncode=function(object){var chunks,key,value;chunks=[];for(key in object){value=object[key];chunks.push(this.urlEncodeValue(key)+"="+this.urlEncodeValue(value))}return chunks.sort().join("&")};Xhr.urlEncodeValue=function(object){return encodeURIComponent(object.toString()).replace(/\!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A")};Xhr.urlDecode=function(string){var kvp,result,token,_i,_len,_ref;result={};_ref=string.split("&");for(_i=0,_len=_ref.length;_i<_len;_i++){token=_ref[_i];kvp=token.split("=");result[decodeURIComponent(kvp[0])]=decodeURIComponent(kvp[1])}return result};Xhr.onReadyStateChange=function(xhr,method,url,responseType,callback){var apiError,bytes,dirtyText,e,i,metadata,metadataJson,text,_i,_ref;if(xhr.readyState!==4){return true}if(xhr.status<200||xhr.status>=300){apiError=new Dropbox.ApiError(xhr,method,url);callback(apiError);return true}metadataJson=xhr.getResponseHeader("x-dropbox-metadata");if(metadataJson!=null?metadataJson.length:void 0){try{metadata=JSON.parse(metadataJson)}catch(_error){e=_error;metadata=void 0}}else{metadata=void 0}if(responseType){if(responseType==="b"){dirtyText=xhr.responseText!=null?xhr.responseText:xhr.response;bytes=[];for(i=_i=0,_ref=dirtyText.length;0<=_ref?_i<_ref:_i>_ref;i=0<=_ref?++_i:--_i){bytes.push(String.fromCharCode(dirtyText.charCodeAt(i)&255))}text=bytes.join("");callback(null,text,metadata)}else{callback(null,xhr.response,metadata)}return true}text=xhr.responseText!=null?xhr.responseText:xhr.response;switch(xhr.getResponseHeader("Content-Type")){case"application/x-www-form-urlencoded":callback(null,DropboxXhr.urlDecode(text),metadata);break;case"application/json":case"text/javascript":callback(null,JSON.parse(text),metadata);break;default:callback(null,text,metadata)}return true};Xhr.onLoad=function(xhr,method,url,callback){var text;text=xhr.responseText;switch(xhr.contentType){case"application/x-www-form-urlencoded":callback(null,DropboxXhr.urlDecode(text),void 0);break;case"application/json":case"text/javascript":callback(null,JSON.parse(text),void 0);break;default:callback(null,text,void 0)}return true};Xhr.onError=function(xhr,method,url,callback){var apiError;apiError=new Dropbox.ApiError(xhr,method,url);callback(apiError);return true};return Xhr}();DropboxXhr=Dropbox.Xhr;if((typeof module!=="undefined"&&module!==null?module.exports:void 0)!=null){module.exports=Dropbox}else if(typeof window!=="undefined"&&window!==null){window.Dropbox=Dropbox}else{throw new Error("This library only supports node.js and modern browsers.")}Dropbox.atob=atob;Dropbox.btoa=btoa;Dropbox.hmac=base64HmacSha1;Dropbox.sha1=base64Sha1;Dropbox.encodeKey=dropboxEncodeKey;(function(){var $,Auth,Binary,Class,Client,DB,Events,Model,Nimbus,Share,isArray,makeArray,moduleKeywords;if(window.Nimbus==null){Nimbus=winodw.Nimbus={}}Nimbus=window.Nimbus;Nimbus.version="0.0.1";$=Nimbus.$=this.jQuery||this.Zepto||function(){return arguments[0]};Nimbus.dictModel={};makeArray=function(args){return Array.prototype.slice.call(args,0)};isArray=function(value){return Object.prototype.toString.call(value)==="[object Array]"};if(typeof Array.prototype.indexOf==="undefined"){Array.prototype.indexOf=function(value){var i;i=0;while(i<this.length){if(this[i]===value){return i}i++}return-1}}Events={bind:function(ev,callback){var calls,evs,i;evs=ev.split(" ");calls=this._callbacks||(this._callbacks={});i=0;while(i<evs.length){(this._callbacks[evs[i]]||(this._callbacks[evs[i]]=[])).push(callback);i++}return this},trigger:function(){var args,calls,ev,i,l,list;args=makeArray(arguments);ev=args.shift();if(!(calls=this._callbacks)){return false}if(!(list=this._callbacks[ev])){return false}i=0;l=list.length;while(i<l){if(list[i].apply(this,args)===false){return false}i++}return true},unbind:function(ev,callback){var calls,i,l,list;if(!ev){this._callbacks={};return this}if(!(calls=this._callbacks)){return this}if(!(list=calls[ev])){return this}if(!callback){delete this._callbacks[ev];return this}i=0;l=list.length;while(i<l){if(callback===list[i]){list=list.slice();list.splice(i,1);calls[ev]=list;break}i++}return this}};if(typeof Object.create!=="function"){Object.create=function(o){var F;F=function(){};F.prototype=o;return new F}}moduleKeywords=["included","extended"];Class={inherited:function(){},created:function(){},prototype:{initialize:function(){},init:function(){}},create:function(include,extend){var object;object=Object.create(this);object.parent=this;object.prototype=object.fn=Object.create(this.prototype);if(include){object.include(include)}if(extend){object.extend(extend)}object.created();this.inherited(object);return object},init:function(){var instance;instance=Object.create(this.prototype);instance.parent=this;instance.initialize.apply(instance,arguments);instance.init.apply(instance,arguments);return instance},proxy:function(func){var thisObject;thisObject=this;return function(){return func.apply(thisObject,arguments)}},proxyAll:function(){var functions,i,_results;functions=makeArray(arguments);i=0;_results=[];while(i<functions.length){this[functions[i]]=this.proxy(this[functions[i]]);_results.push(i++)}return _results},include:function(obj){var included,key;for(key in obj){if(moduleKeywords.indexOf(key)===-1){this.fn[key]=obj[key]}}included=obj.included;if(included){included.apply(this)}return this},extend:function(obj){var extended,key;for(key in obj){if(moduleKeywords.indexOf(key)===-1){this[key]=obj[key]}}extended=obj.extended;if(extended){extended.apply(this)}return this}};Class.prototype.proxy=Class.proxy;Class.prototype.proxyAll=Class.proxyAll;Class.inst=Class.init;Class.sub=Class.create;Nimbus.guid=function(){var id,verified,verify_guide;verify_guide=function(g_id){var x,y,_ref;_ref=Nimbus.dictModel;for(x in _ref){y=_ref[x];if(y.exists(g_id)){return false}}return true};verified=false;while(!verified){id="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r,v;r=Math.random()*16|0;v=c==="x"?r:r&3|8;return v.toString(16)}).toUpperCase();verified=verify_guide(id)}return id};Auth=Nimbus.Auth=Class.create();Auth.extend({reinitialize:function(){var cloud,service,sync_service;log("reintialize called");if(localStorage["last_sync_object"]!=null){log("the service exists",localStorage["service"]);sync_service=JSON.parse(localStorage["last_sync_object"]);if(Nimbus.Auth.sync_services==null){Nimbus.Auth.sync_services={};Nimbus.Auth.sync_services.synchronous=sync_service.synchronous}else{service=Nimbus.Auth.sync_services[sync_service.service];if(service.app_id!==sync_service.app_id){cloud=sync_service.service;sync_service=service;sync_service.service=cloud;localStorage.clear()}}this.setup(sync_service);return this.initialize()}},setup:function(sync_service){var item,key,service,value;if(typeof sync_service==="string"){console.log("Current sync service",sync_service);sync_service=JSON.parse(Base64.decode(sync_service))}if(!this.app_name){this.app_name=sync_service.app_name}if(!this.app_name){for(item in sync_service){if(sync_service[item].app_name){this.app_name=sync_service[item].app_name;if(this.app_name){break}}}}if(sync_service.service!=null){log("setup called on a service",sync_service.service);log("setup object",sync_service);for(key in sync_service){value=sync_service[key];this[key]=value}if(Nimbus.Auth.sync_services!=null&&Nimbus.Auth.sync_services.synchronous!=null){sync_service.synchronous=Nimbus.Auth.sync_services.synchronous}else{sync_service.synchronous=true}sync_service.app_name=this.app_name;localStorage["last_sync_object"]=JSON.stringify(sync_service);if(!sync_service.synchronous){Nimbus.Model.Local.async_doc_setup()}switch(this.service){case"Dropbox":this.extend(Nimbus.Auth.Dropbox_auth);this._authorize=this.proxy(this.authenticate_dropbox);this.initialize=this.proxy(this.initialize_dropbox);this.authorized=this.proxy(this.dropbox_authorized);this.logout=function(){this.proxy(this.logout_dropbox);this.clear_storage()};Nimbus.Binary.setup(this.service);log("service is dropbox");break;case"GDrive":this.extend(Nimbus.Auth.GDrive);this.init_scope();this._authorize=this.proxy(this.authenticate_gdrive);this.initialize=this.proxy(this.initialize_gdrive);this.authorized=this.proxy(this.gdrive_authorized);this.logout=function(){this.proxy(this.logout_gdrive);this.clear_storage()};Nimbus.Binary.setup(this.service);log("service is GDrive");Nimbus.Share.setup(this.service);break;case"Realtime":startRealtime(key,app_name);break;default:log("Invalid service name")}}else{log("new method for setup, the service is there");this.sync_services=this.sync_object=sync_service;this.models={};if(localStorage["service"]!=null){if(localStorage["service"]==="GDrive"){service=this.sync_services["GDrive"];service["service"]="GDrive";this.setup(service)}else{service=this.sync_services["Dropbox"];service["service"]="Dropbox";this.setup(service)}}else{this.extend(Nimbus.Auth.Multi);this._authorize=this.proxy(this.authenticate_service);this.initialize=this.proxy(this.initialize_service)}}this.authorize=function(type){var obj;if(this.service&&type&&type!==this.service){localStorage.clear();obj=this.sync_object[type];obj.service=type;this.setup(obj)}return this._authorize(type)}},clear_storage:function(){log("Will clear localStorage or indexedDB");localStorage.clear();PouchDB.destroy(this.app_name)},authorized:function(){return log("authorized not yet setup")},state:function(){return localStorage["state"]},authorize:function(){return log("authorize not yet setup")},initialize:function(){return log("initialize not setup")},authorized_callback:function(){return log("authorized callback undefined")},app_ready_func:function(){log("app_ready");return this.app_ready=true},set_app_ready:function(callback){var cb;log("set app ready");if(this.app_ready!=null&&this.app_ready){if(this.service==="GDrive"){return window.folder_initialize(callback)}else{return callback()}}else{cb=function(){if(this.service==="GDrive"){return window.folder_initialize(callback)}else{return callback()}};return this.app_ready_func=cb}},logout:function(){return log("logout not implemented")}});Client=Nimbus.Client=Class.create();Share=Nimbus.Share=Class.create();Share.extend({setup:function(sync_service){switch(sync_service){case"GDrive":log("share api with GDrive");this.extend(Nimbus.Client.GDrive);this.get_users=this.proxy(this.get_shared_users);this.add_user=this.proxy(this.add_share_user);this.remove_user=this.proxy(this.remove_share_user);this.get_me=this.proxy(this.get_current_user);this.get_spaces=this.proxy(this.get_app_folders);this.switch_spaces=this.proxy(this.switch_to_app_folder);return this.switch_file_real=this.proxy(this.switch_to_app_file_real);default:return log("share not supported with this service")}},get_users:function(){return log("users not implemented")},add_user:function(email){return log("add a user")},remove_user:function(id){return log("removed user")},get_me:function(){return log("get currently logged user")},get_spaces:function(){return log("get current spaces")},switch_spaces:function(id){return log("switch space")}});Binary=Nimbus.Binary=Class.create();Binary.extend({setup:function(sync_service){log("binary setup called");switch(sync_service){case"Dropbox":this.extend(Nimbus.Client.Dropbox.Binary);Nimbus.Client.Dropbox.Binary.binary_setup();return log("service is dropbox");case"GDrive":this.extend(Nimbus.Client.GDrive.Binary);Nimbus.Client.GDrive.Binary.binary_setup();return log("service is GDrive");case"Realtime":return log("service is  Realtime");default:return log("Invalid service name")}},upload_blob:function(blob,name,callback){return log("upload blob")},upload_file:function(file,callback){return log("upload blob")},read_file:function(binary,callback){return log("read file")},share_link:function(binary,callback){return log("share link")},direct_link:function(binary,callback){return log("direct link")},delete_file:function(binary){return log("delete file")}});DB=Nimbus.DB=Class.create();DB.extend(Events);DB.extend({setup_db:function(type){log("setup db");switch(type){case"localStorage":return Storage.prototype.setItem=function(key,value){if(this===window.localStorage){return log("local storage called")}else{return _setItem.apply(this,arguments)}}}}});Model=Nimbus.Model=Class.create();Model.extend(Events);Model.extend({loaded:false,check_loaded:function(){if(this.loaded){return true}else{console.log("The model is not loaded yet! Wait for the model to be done with setup.");return false}},service_setup:function(model){var atts;log("service setup model",model);atts=model.attributes;switch(Nimbus.Auth.service){case"Dropbox":log("extend as Dropbox");model.extend(Nimbus.Model.general_sync);model.extend(Nimbus.Model.Dropbox);atts.push("synced");atts.push("time");model.attributes=atts;break;case"GDrive":log("extend as GDrive");model.extend(Nimbus.Model.general_sync);model.extend(Nimbus.Model.Realtime);atts.push("gid");atts.push("synced");atts.push("time");atts.push("type");model.attributes=atts;break;default:log("Invalid service name")}return model},setup:function(name,atts,callback){var Deletion,model;log("model setup");model=Model.sub();if(name){model.name=name}if(atts){model.attributes=atts}if(Nimbus.Auth.sync_services.synchronous!=null&&Nimbus.Auth.sync_services.synchronous){model.extend(Nimbus.Model.LocalSync)}else{model.extend(Nimbus.Model.Local)}Nimbus.dictModel[name]=model;if(Nimbus.Auth.service!=null||Nimbus.Auth.sync_services!=null||name==="binary"||name==="binary_Deletion"){log("model 1",model);if(name.indexOf("_Deletion")<0){model=this.service_setup(model)}}else{log("name:",name);log("Please setup Nimbus.Auth first before creating models")}if(name.indexOf("_Deletion")<0){Deletion=Nimbus.Model.setup(name+"_"+"Deletion",["deletion_id","listid"]);Deletion.extend(Nimbus.Model.Local);Deletion.fetch();model.DeletionStorage=Deletion}log(model);model.fetch();if(name.indexOf("_Deletion")<0){Nimbus.dictModel[name]=model}else{delete Nimbus.dictModel[name]}return model},created:function(sub){this.records={};return this.attributes=this.attributes?makeArray(this.attributes):[]},find:function(id){var record;record=this.records[id];if(!record){throw"Unknown record"}return record.clone()},exists:function(id){var e;try{return this.find(id)}catch(_error){e=_error;return false}},refresh:function(values){var i,il,record;values=this.fromJSON(values);this.records={};i=0;il=values.length;while(i<il){record=values[i];record.newRecord=false;this.records[record.id]=record;i++}this.trigger("refresh");return this},select:function(callback){var key,result;result=[];for(key in this.records){if(callback(this.records[key])){result.push(this.records[key])}}return this.cloneArray(result)},findByAttribute:function(name,value){var key;for(key in this.records){if(this.records[key][name]===value){return this.records[key].clone()}}},findAllByAttribute:function(name,value){return this.select(function(item){return item[name]===value})},each:function(callback){var key,_results;_results=[];for(key in this.records){_results.push(callback(this.records[key]))}return _results},all:function(){return this.cloneArray(this.recordsValues())},first:function(){var record;record=this.recordsValues()[0];return record&&record.clone()},last:function(){var record,values;values=this.recordsValues();record=values[values.length-1];return record&&record.clone()},count:function(){return this.recordsValues().length},deleteAll:function(){var key,_results;_results=[];for(key in this.records){_results.push(delete this.records[key])}return _results},destroyAll:function(){var key,_results;_results=[];for(key in this.records){_results.push(this.records[key].destroy())}return _results},update:function(id,atts){return this.find(id).updateAttributes(atts)},create:function(atts){var record;record=this.init(atts);return record.save()},destroy:function(id){return this.find(id).destroy()},sync:function(callback){return this.bind("change",callback)},fetch:function(callbackOrParams){if(!this.loaded&&callbackOrParams!=null){this.loadLocal(callbackOrParams)}if(typeof callbackOrParams==="function"){return this.bind("fetch",callbackOrParams)}else{return this.trigger.apply(this,["fetch"].concat(makeArray(arguments)))}},toJSON:function(){return this.recordsValues()},fromJSON:function(objects){var i,results;if(!objects){return}if(typeof objects==="string"){objects=JSON.parse(objects)}if(isArray(objects)){results=[];i=0;while(i<objects.length){results.push(this.init(objects[i]));i++}return results}else{return this.init(objects)}},recordsValues:function(){var key,result;result=[];for(key in this.records){result.push(this.records[key])}return result},cloneArray:function(array){var i,result;result=[];i=0;while(i<array.length){result.push(array[i].clone());i++}return result}});return Model.include({model:true,newRecord:true,init:function(atts){var parent_type;if(atts){this.load(atts)}parent_type=this.parent.name;this.parent=function(){return Nimbus.dictModel[parent_type]};return this.trigger("init",this)},isNew:function(){return this.newRecord},isValid:function(){return!this.validate()},validate:function(){},load:function(atts){var name,_results;_results=[];for(name in atts){_results.push(this[name]=atts[name])}return _results},attributes:function(){var attr,i,result;result={};i=0;while(i<this.parent().attributes.length){attr=this.parent().attributes[i];result[attr]=this[attr];i++}result.id=this.id;return result},eql:function(rec){return rec&&rec.id===this.id&&rec.parent()===this.parent()},save:function(){var error;error=this.validate();if(error){this.trigger("error",this,error);return false}this.trigger("beforeSave",this);if(this.newRecord){this.create()}else{this.update()}this.trigger("save",this);return this},updateAttribute:function(name,value){this[name]=value;return this.save()},updateAttributes:function(atts){this.load(atts);return this.save()},destroy:function(){this.trigger("beforeDestroy",this);delete this.parent().records[this.id];this.destroyed=true;this.trigger("destroy",this);return this.trigger("change",this,"destroy")},dup:function(){var result;result=this.parent().init(this.attributes());result.newRecord=this.newRecord;return result},clone:function(){return Object.create(this)},reload:function(){var original;if(this.newRecord){return this}original=this.parent().find(this.id);this.load(original.attributes());return original},toJSON:function(){return this.attributes()},exists:function(){return this.id&&this.id in this.parent().records},update:function(){var clone,records;this.trigger("beforeUpdate",this);records=this.parent().records;records[this.id].load(this.attributes());clone=records[this.id].clone();this.trigger("update",clone);return this.trigger("change",clone,"update")},create:function(){var clone,records;this.trigger("beforeCreate",this);if(!this.id){this.id=Nimbus.guid()}this.newRecord=false;records=this.parent().records;records[this.id]=this.dup();clone=records[this.id].clone();this.trigger("create",clone);return this.trigger("change",clone,"create")},bind:function(events,callback){return this.parent().bind(events,this.proxy(function(record){if(record&&this.eql(record)){return callback.apply(this,arguments)}}))},trigger:function(){var e;try{return this.parent().trigger.apply(this.parent(),arguments)}catch(_error){e=_error;return log(e)}}})})();Set=function(){function Set(set){this._set=set===void 0?[]:set;this.length=this._set.length;this.contains=function(element){return this._set.indexOf(element)!==-1}}Set.prototype.union=function(s){var A,B,i,set;A=s.length>this.length?s:this;B=s.length>this.length?this:s;set=A.copy();i=0;while(i<B.length){set.add(B._set[i]);i++}return set};Set.prototype.intersection=function(s){var A,B,element,i,set;set=new Set;A=s.length>this.length?s:this;B=s.length>this.length?this:s;i=0;while(i<B.length){element=B._set[i];if(A.contains(element)){set.add(element)}i++}return set};Set.prototype.difference=function(s){var element,i,set;set=new Set;i=0;while(i<this.length){element=this._set[i];if(!s.contains(element)){set.add(element)}i++}return set};Set.prototype.symmetricDifference=function(s){return this.union(s).difference(this.intersection(s))};Set.prototype.isSuperSet=function(s){var i;i=0;while(i<s.length){if(!this.contains(s._set[i])){return false}i++}return true};Set.prototype.isSubSet=function(s){var i;i=0;while(i<this.length){if(!s.contains(this._set[i])){return false}i++}return true};Set.prototype.add=function(element){if(this._set.indexOf(element)===-1){this._set.push(element);this.length++}return this.length};Set.prototype.remove=function(element){var i;i=this._set.indexOf(element);if(i!==-1){this.length--;return this._set.splice(i,1)[0]}else{return null}};Set.prototype.copy=function(){return new Set(this._set.slice())};Set.prototype.asArray=function(){return this._set};return Set}();exports=this;exports.Set=Set;DelayedOp=function(){function DelayedOp(callback){this.callback=callback;this.ready=__bind(this.ready,this);this.ok=__bind(this.ok,this);this.wait=__bind(this.wait,this);this.count=1}DelayedOp.prototype.wait=function(){return this.count++};DelayedOp.prototype.ok=function(){if(!--this.count){return this.callback()}};DelayedOp.prototype.ready=function(){return this.ok()};return DelayedOp}();OneOp=function(){function OneOp(){this.execute_callback=__bind(this.execute_callback,this);this.add_last_call=__bind(this.add_last_call,this);
this.add_call=__bind(this.add_call,this);this.running=false;this.callbacks=[]}OneOp.prototype.add_call=function(callback){this.running=true;return this.callbacks.push(callback)};OneOp.prototype.add_last_call=function(callback){return this.last_callback=callback};OneOp.prototype.execute_callback=function(){var func,_i,_len,_ref;_ref=this.callbacks;for(_i=0,_len=_ref.length;_i<_len;_i++){func=_ref[_i];func()}this.callbacks=[];if(this.last_callback!=null){this.last_callback()}return this.running=false};return OneOp}();DelayedSyncAnimation=function(){function DelayedSyncAnimation(){this.ready=__bind(this.ready,this);this.ok=__bind(this.ok,this);this.wait=__bind(this.wait,this);this.count=1}DelayedSyncAnimation.prototype.wait=function(){return this.count++};DelayedSyncAnimation.prototype.ok=function(){if(!--this.count){return log("ok executed")}};DelayedSyncAnimation.prototype.ready=function(){return this.ok()};return DelayedSyncAnimation}();exports=this;exports.DelayedOp=DelayedOp;exports.OneOp=OneOp;exports.DelayedSyncAnimation=DelayedSyncAnimation;window.debug=false;window.log=function(){var stuff;stuff=1<=arguments.length?__slice.call(arguments,0):[];if(window.debug){return console.log(stuff)}};window.one_time_sync=false;window.keys=function(item){var key,keys,value;keys=[];for(key in item){value=item[key];keys.push(key)}return keys};Nimbus.Model.general_sync={cloudcache:{},create_object_dictionary:function(){var dict,obj,_i,_len,_ref;dict={};log("object:",this);_ref=this.all();for(_i=0,_len=_ref.length;_i<_len;_i++){obj=_ref[_i];dict[obj.id]=obj}return dict},sync_model_base_algo:function(){var cloud,cloud_set,cloud_time,d_array,deleted_set,dlist,eq,id,local,local_item,local_set,local_time,utc,utl,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref,_ref1,_ref2,_ref3;if(!navigator.onLine||this.is_cloud_available===false){return}log("#ONE TIME SYNC ALGO RUNNING",this.name);window.one_time_sync=true;window.currently_syncing=true;local=this.create_object_dictionary();cloud=this.cloudcache;local_set=new Set(keys(local));cloud_set=new Set(keys(cloud));log("local_set",local_set);log("cloud_set",cloud_set);d_array=[];_ref=this.DeletionStorage.all();for(_i=0,_len=_ref.length;_i<_len;_i++){dlist=_ref[_i];this.delete_from_cloud(dlist.id);d_array.push(dlist.id);dlist.destroy()}deleted_set=new Set(d_array);log("deleted set",deleted_set);log("#the set of ids that are there locally but not there on the cloud",local_set.difference(cloud_set)._set);_ref1=local_set.difference(cloud_set)._set;for(_j=0,_len1=_ref1.length;_j<_len1;_j++){id=_ref1[_j];local_item=local[id];if(local_item["synced"]!=null&&local_item.synced){log("id for deletion",id);local[id].destroy()}else{this.add_to_cloud(local_item)}}log("#the set of ids that are there on the cloud but not there locally minus deletions",cloud_set.difference(local_set).difference(deleted_set)._set);_ref2=cloud_set.difference(local_set).difference(deleted_set)._set;for(_k=0,_len2=_ref2.length;_k<_len2;_k++){id=_ref2[_k];this.add_from_cloud(id)}log("#the set of ids that are there in the cloud and locally",cloud_set.intersection(local_set)._set);utc=[];utl=[];eq=[];_ref3=cloud_set.intersection(local_set)._set;for(_l=0,_len3=_ref3.length;_l<_len3;_l++){id=_ref3[_l];local_time=new Date(local[id].time);cloud_time=new Date(cloud[id].time);log("local_time",local_time.toString());log("cloud_time",cloud_time.toString());if(local_time-cloud_time===0){log("equal time stamp do nothin",cloud[id].title);eq.push(id)}else if(local_time-cloud_time>0){this.update_to_cloud(local[id]);utc.push(id)}else{this.update_to_local(local[id]);utl.push(id)}}window.currently_syncing=false;window.one_time_sync=false;log("updated to cloud",utc.length,utc);log("updated to local",utl.length,utl);return log("equal timestamp",eq.length,eq)},real_time_sync:function(record,method,e){var d,syncable;log("method",method);log("record",record);this.saveLocal(record,method);if(window.currently_syncing){return true}else{if(method==="update"){this.records[record.id].time=(new Date).toString()}}syncable=navigator.onLine&&(localStorage["state"]==="Working"||Nimbus.Client.GDrive.check_auth());if(!syncable){console.log("syncing is not setup correctly or the instance is not online");return true}switch(method){case"destroy":if(record.synced){if(syncable){log("deletion in cloud");return this.delete_from_cloud(record.id)}else{d=Deletion.init({id:record.id});return d.save()}}break;case"create":return this.add_to_cloud(record,function(){});case"update":return this.update_to_cloud(record,function(){});case"read":return this.update_to_local(record,function(){});default:return log("REAL TIME SYNCING FAILED, THIS METHOD NOT IMPLEMENTED")}},delta_update:function(){var change;return change=this.get_delta}};Nimbus.Model.Local={classname:"Nimbus.Model.Local",extended:function(){this.sync(this.proxy(this.saveLocal));return this.fetch(this.proxy(this.loadLocal))},async_doc_setup:function(){if(!window._indexdb&&Nimbus.Auth.app_name){window._indexdb=new PouchDB(Nimbus.Auth.app_name);Nimbus.Storage={};Nimbus.is_async_done=false;_indexdb.allDocs({include_docs:true},function(err,response){var doc,one,rows,_i,_len;if(!err){rows=response.rows;for(_i=0,_len=rows.length;_i<_len;_i++){one=rows[_i];doc=one.doc;if(doc["type"]&&doc.data){if(!Nimbus.Storage[doc["type"]]){Nimbus.Storage[doc["type"]]=[]}Nimbus.Storage[doc["type"]].push(JSON.parse(doc.data))}}return Nimbus.is_async_done=true}})}},saveLocal:function(record,method){var db,result,self,_data,_i,_len,_ref;if(!window._indexdb&&Nimbus.Auth.app_name){window._indexdb=new PouchDB(Nimbus.Auth.app_name)}if(!window._indexdb){result=JSON.stringify(this);localStorage[this.name]=result;return}db=window._indexdb;self=this;if(record){_data={_id:record.id,type:this.name,data:JSON.stringify(record)};db.get(record.id,function(err,res){if(!err){return db.remove(res,function(e,r){if(method==="destroy"){return}return db.put(_data)})}else{return db.put(_data)}})}else{_ref=this.records;for(_i=0,_len=_ref.length;_i<_len;_i++){record=_ref[_i];_data={_id:key,type:this.name,data:JSON.stringify(record)};db.get(key,function(err,res){if(!err){_data._rev=res._rev}return db.put(_data)})}}},loadLocal:function(callback){var db,name,result,self;if(!window._indexdb&&Nimbus.Auth.app_name){window._indexdb=new PouchDB(Nimbus.Auth.app_name)}if(!window._indexdb){result=localStorage[this.name];if(!result){return}result=JSON.parse(result);this.refresh(result);return}self=this;db=window._indexdb;name=self.type;if(Nimbus.is_async_done){if(Nimbus.Storage[name]){self.refresh(Nimbus.Storage[name])}else{self.refresh([])}}else{self.refresh([])}}};Nimbus.Model.LocalSync={classname:"Nimbus.Model.LocalSync",extended:function(){this.sync(this.proxy(this.saveLocal));return this.fetch(this.proxy(this.loadLocal))},saveLocal:function(){var result;result=JSON.stringify(this);return localStorage[this.name]=result},loadLocal:function(callback){var result;result=localStorage[this.name];if(!result){return}result=JSON.parse(result);this.refresh(result);if(callback!=null){return callback()}}};Nimbus.Model.Dropbox={cloudcache:{},last_hash:"",hash:"",toCloudStructure:function(object){log("local to cloud structure");return JSON.stringify(object)},fromCloudStructure:function(value){log("changes cloud to local data in the form a dictionary");return value},diff_objects:function(previous,current){var diff,f,v;diff={};for(f in previous){v=previous[f];if(current[f]!==previous[f]){diff[f]=[current[f],previous[f]]}}if(previous["parent_id"]!=null!==(current["parent_id"]!=null)){diff["parent_id"]=["one of them is null"]}return diff},add_to_cloud:function(object,callback){log("add to cloud",object.name);return Nimbus.Client.Dropbox.putFileContents("/"+Nimbus.Auth.app_name+("/"+this.name+"/"+object.id+".txt"),this.toCloudStructure(object),function(resp){log(object.name,"finished being added to cloud");log("resp",resp);window.currently_syncing=true;object.time=resp.modified;object.synced=true;object.save();window.currently_syncing=false;if(callback!=null){return callback(resp)}})},delete_from_cloud:function(object_id,callback){log("delete from cloud",object_id);log("delete route","/"+Nimbus.Auth.app_name+("/"+this.name+"/"+object_id+".txt"));return Nimbus.Client.Dropbox.deletePath("/"+Nimbus.Auth.app_name+("/"+this.name+"/"+object_id+".txt"),function(){log("finished delete from cloud",object_id);if(callback!=null){return callback()}})},update_to_cloud:function(object,callback){log("updated to cloud",object.name);return Nimbus.Client.Dropbox.putFileContents("/"+Nimbus.Auth.app_name+("/"+this.name+"/"+object.id+".txt"),this.toCloudStructure(object),function(resp){log(object.name,"finished being updated to cloud");window.currently_syncing=true;object.time=resp.modified;object.synced=true;object.save();window.currently_syncing=false;if(callback!=null){return callback(resp)}})},add_from_cloud:function(object_id,callback){log("add from cloud",object_id);return Nimbus.Client.Dropbox.getFileContents("/"+Nimbus.Auth.app_name+("/"+this.name+"/"+object_id+".txt"),function(_this){return function(data){var converted,x;log("cloud read data",data);window.currently_syncing=true;converted=_this.fromCloudStructure(data);x=_this.init(converted);x.synced=true;x.time=_this.cloudcache[object_id].time;x.save();window.currently_syncing=false;if(callback!=null){return callback(data)}}}(this))},update_to_local:function(object,callback){log("update to local",object.name);return Nimbus.Client.Dropbox.getFileContents("/"+Nimbus.Auth.app_name+("/"+this.name+"/"+object.id+".txt"),function(_this){return function(data){var converted,x;log("cloud read data",data);window.currently_syncing=true;converted=_this.fromCloudStructure(data);x=_this.find(object.id);converted.time=_this.cloudcache[object.id].time;x.updateAttributes(converted);return window.currently_syncing=false}}(this))},sync_all:function(cb){log("syncs all the data, normally happens at the start of a program or coming back from offline");window.current_syncing=new DelayedOp(function(_this){return function(){log("call back sync called");window.current_syncing=new DelayedOp(function(){window.current_syncing=null;if(cb!=null){return cb()}});_this.sync_model_base_algo();return window.current_syncing.ready()}}(this));this.load_all_from_cloud();return window.current_syncing.ready()},load_all_from_cloud:function(){var error;log("loads all the data from the cloud locally, probably not feasible with dropbox and changes need to happen");this.cloudcache={};try{return Nimbus.Client.Dropbox.getMetadataList("/"+Nimbus.Auth.app_name+"/"+this.name,function(_this){return function(data){var id,title,x,_i,_len,_ref;log("call back load called");log("data",data);_ref=data.contents;for(_i=0,_len=_ref.length;_i<_len;_i++){x=_ref[_i];title=x.path;id=title.replace("/"+Nimbus.Auth.app_name+"/"+(""+_this.name+"/"),"").replace(".txt","");_this.cloudcache[id]={id:id,time:x.modified}}return _this.is_cloud_available=true}}(this),function(_this){return function(error){console.log("ERROR: error called for metadataList, folder should be created");_this.is_cloud_available=false;Nimbus.Client.Dropbox.createFolder("/"+Nimbus.Auth.app_name+"/"+_this.name,function(data){return log("call back create folder called",data)});return _this.cloudcache={}}}(this))}catch(_error){error=_error;_this.is_cloud_available=false;return log("trying to get the folder failed, probably cuz it don't exist",error)}},get_delta:function(){return log("get the delta for ",this.name," since last synced")},extended:function(){this.sync(this.proxy(this.real_time_sync));return this.fetch(this.proxy(this.loadLocal))}};Nimbus.Auth.Dropbox_auth={authenticate_dropbox:function(){localStorage["key"]=this.key;localStorage["secret"]=this.secret;localStorage["state"]="Auth";return Nimbus.Client.Dropbox.get_request_token(this.key,this.secret,Nimbus.Client.Dropbox.authorize_token)},initialize_dropbox:function(){log("initialization called");if(location.protocol==="chrome-extension:"){log("Chrome edition authentication");chrome.tabs.onUpdated.addListener(function(tabId,changeInfo,tab){if(tab.title==="API Request Authorized"){chrome.tabs.remove(tabId);return Nimbus.Client.Dropbox.get_access_token(function(data){localStorage["state"]="Working";if(Nimbus.Auth.authorized_callback!=null){Nimbus.Auth.authorized_callback()}Nimbus.Auth.app_ready_func();console.log("NimbusBase is working! Chrome edition.");return Nimbus.track.google.registered_user()})}})}if(localStorage["state"]!=null&&localStorage["state"]==="Auth"){return Nimbus.Client.Dropbox.get_access_token(function(data){localStorage["state"]="Working";if(Nimbus.Auth.authorized_callback!=null){Nimbus.Auth.authorized_callback()}Nimbus.Auth.app_ready_func();console.log("NimbusBase is working!");return Nimbus.track.google.registered_user()})}else{return Nimbus.Auth.app_ready_func()}},dropbox_authorized:function(){if(Nimbus.Auth.service==="Dropbox"){if(localStorage["state"]==="Working"){return true}else{return false}}else{return false}},logout_dropbox:function(callback){var k,v,_ref;localStorage.clear();if(Nimbus.dictModel!=null){_ref=Nimbus.dictModel;for(k in _ref){v=_ref[k];v.records={}}}if(this.sync_services!=null){Nimbus.Auth.setup(this.sync_services)}if(callback!=null){return callback()}}};REALTIME_MIMETYPE="application/vnd.google-apps.drive-sdk";realTimeEvents={};Nimbus.Model.Realtime={cloudcache:{},callback:[],toCloudStructure:function(object){log("local to cloud structure");object["type"]=this.name;return JSON.stringify(object)},fromCloudStructure:function(value){log("changes cloud to local data in the form a dictionary");return JSON.parse(value)},diff_objects:function(previous,current){var diff,f,v;diff={};for(f in previous){v=previous[f];if(current[f]!==previous[f]){diff[f]=[current[f],previous[f]]}}if(previous["parent_id"]!=null!==(current["parent_id"]!=null)){diff["parent_id"]=["one of them is null"]}return diff},add_to_cloud:function(object,callback){var content;log("add to cloud",object);window.currently_syncing=true;object.time=(new Date).toString();object.type=this.name;object.synced=true;object.save();window.currently_syncing=false;content=this.toCloudStructure(object);return window.todo.set(object.id,content)},delete_from_cloud:function(object_id,callback){log("delete from cloud",object_id,window.todo.has(object_id));if(window.todo.has(object_id)){return window.todo["delete"](object_id)}},update_to_cloud:function(object,callback){var content;log("updated to cloud",object.id);content=this.toCloudStructure(object);return window.todo.set(object.id,content)},add_from_cloud:function(object_id,callback){var converted,data,x;log("add from cloud GDrive",object_id);data=window.todo.get(object_id);window.currently_syncing=true;converted=this.fromCloudStructure(data);x=this.init(converted);x.synced=true;x.save();return window.currently_syncing=false},update_to_local:function(object,callback){var converted,data,x;log("update to local",object);data=window.todo.get(object.id);window.currently_syncing=true;converted=this.fromCloudStructure(data);x=this.init(converted);x.synced=true;x.save();return window.currently_syncing=false},sync_all:function(cb){log("syncs all the data, normally happens at the start of a program or coming back from offline");this.load_all_from_cloud();this.sync_model_base_algo();window.current_syncing=new DelayedOp(function(_this){return function(){log("call back sync called");window.current_syncing=new DelayedOp(function(){window.current_syncing=null;if(cb!=null){return cb()}});_this.sync_model_base_algo();return window.current_syncing.ready()}}(this));this.load_all_from_cloud();return window.current_syncing.ready()},load_all_from_cloud:function(){var content,x,_i,_len,_ref,_results;log("loads all the data from the cloud locally");this.cloudcache={};_ref=window.todo.keys();_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){x=_ref[_i];content=this.fromCloudStructure(window.todo.get(x));if(content.type===this.name){_results.push(this.cloudcache[x]=content)}else{_results.push(void 0)}}return _results},get_delta:function(){return log("get the delta for ",this.name," since last synced")},add_realtime_callback:function(callback){return log("filler")},process_callback_chain:function(mode,obj,isLocal){var handler,index,_ref;log("filler");_ref=realTimeEvents[this.name];for(index in _ref){handler=_ref[index];handler(mode,obj,isLocal)}},extended:function(){this.sync(this.proxy(this.real_time_sync));return this.fetch(this.proxy(this.loadLocal))},onUpdate:function(callback){if(!realTimeEvents[this.name]){realTimeEvents[this.name]=[]}return realTimeEvents[this.name].push(callback)}};window.initializeModel=function(model){var field;log("model initialization",model);field=model.createMap({});return model.getRoot().set("todo",field)};window.onFileLoaded=function(doc){var process_event,todo;log("file loaded",doc);window.doc=doc;process_event=function(event){var a,current_event,model,obj;log("PROCESS EVENT");log(event);current_event="NONE";if(event.oldValue!=null){obj=JSON.parse(event.oldValue)}if(event.newValue!=null){obj=JSON.parse(event.newValue)}log("object",obj);window.obj=obj;model=Nimbus.dictModel[obj.type];if(event.oldValue===null){log("add event");model.add_from_cloud(obj.id);current_event="CREATE"}else if(event.newValue===null){log("delete event");window.currently_syncing=true;if(model.exists(obj.id)){a=model.find(obj.id);a.destroy()}window.currently_syncing=false;current_event="DELETE"}else{log("changing the data inside a entry event");model.update_to_local(obj);current_event="UPDATE"}model.process_callback_chain(current_event,obj,event.isLocal);log("EVENT: ",current_event," OBJ: ",obj);if(window.realtime_update_handler!=null){return window.realtime_update_handler(current_event,obj,event.isLocal)}};todo=doc.getModel().getRoot().get("todo");window.todo=todo;if(window.real_time_callback!=null){window.real_time_callback()}return todo.addEventListener(gapi.drive.realtime.EventType.VALUE_CHANGED,process_event)};window.create_share_client=function(){var share_client;share_client=new gapi.drive.share.ShareClient(Nimbus.Auth.app_id);share_client.setItemIds(c_file.id);share_client.showSettingsDialog();return window.share_client=share_client};window.handleErrors=handleErrors=function(e){if(e.type===gapi.drive.realtime.ErrorType.TOKEN_REFRESH_REQUIRED){return gapi.auth.authorize({client_id:Nimbus.Auth.key,scope:Nimbus.Auth.scope,immediate:true,authuser:localStorage.authuser||0},function(data){return console.log("authorize the app after error")})}else if(e.type===gapi.drive.realtime.ErrorType.CLIENT_ERROR){return alert("An Error happened: "+e.message)}else if(e.type===gapi.drive.realtime.ErrorType.NOT_FOUND){return alert("The file was not found. It does not exist or you do not have read access to the file.")}};window.startRealtime=function(callback){var current_user_account;current_user_account=Nimbus.Share.get_user_email();if(!localStorage.current_user_account||localStorage.current_user_account!==current_user_account){delete localStorage.last_opened_workspace}localStorage.current_user_account=current_user_account;if(callback!=null){window.real_time_callback=callback}return gapi.load("auth:client,drive-realtime,drive-share",function(){log("gapi for everything loaded");return Nimbus.Client.GDrive.getMetadataList("mimeType = 'application/vnd.google-apps.drive-sdk."+Nimbus.Auth.app_id+"'",function(data){var c_file,i,index,workspace,x,_ref;console.log("drive apps",data);window.app_files=data.items;i=[];workspace=0;_ref=data.items;for(index in _ref){x=_ref[index];log(x.mimeType);if(x.mimeType.indexOf("application/vnd.google-apps.drive-sdk")>=0){if(localStorage.last_opened_workspace&&x.id===localStorage.last_opened_workspace){workspace=index}i.push(x)}}log("index",i);if(i.length>0){log("file there");c_file=i[workspace];window.c_file=c_file;return gapi.drive.realtime.load(c_file.id,onFileLoaded,initializeModel,handleErrors)}else{log("file not there");Nimbus.Client.GDrive.insertFile("",Nimbus.Auth.app_name,"application/vnd.google-apps.drive-sdk",null,function(data){log("finished insertFile",data);window.c_file=data;window.app_files.push(data);return gapi.drive.realtime.load(data.id,onFileLoaded,initializeModel,handleErrors)});return log("need to create file for app")}})})};window.load_new_file=function(file_id,callback,exception_handle){if(callback!=null){window.real_time_callback=callback}return Nimbus.Share.getFile(file_id,function(data){window.c_file=data;if(!data.id){return}if(exception_handle&&exception_handle instanceof Function){return gapi.drive.realtime.load(file_id,onFileLoaded,initializeModel,exception_handle)}else{return gapi.drive.realtime.load(file_id,onFileLoaded,initializeModel,handleErrors)}})};Nimbus.Client.Dropbox={get_request_token:function(key,secret,callback){var header,xhr;xhr=new XMLHttpRequest;xhr.open("POST","https://api.dropbox.com/1/oauth/request_token",true);header='OAuth oauth_version="1.0",oauth_signature_method="PLAINTEXT",oauth_consumer_key="'+key+'",oauth_signature="'+secret+'&"';log(header);xhr.setRequestHeader("Authorization",header);xhr.onreadystatechange=function(){var data,i,k,pair,pairs,request_token,result,v,_i,_len;if(this.readyState===4){if(this.status===200){data=this.response;log(data);pairs=data.split(/&/);request_token={};for(_i=0,_len=pairs.length;_i<_len;_i++){i=pairs[_i];pair=i.split(RegExp("="),2);request_token[pair[0]]=pair[1]}log("Token result",request_token);for(k in request_token){v=request_token[k];localStorage[k]=v}window.request_token=request_token;if(callback!=null){return callback(request_token)}}else{try{result=JSON.parse(result)}catch(_error){}return error(result,this.status,this)}}};return xhr.send()},authorize_token:function(request_token){var auth_url,ref,return_url;log("authorize url",document.URL);if(document.URL.slice(0,4)==="file"&&typeof cordova!=="undefined"&&cordova!==null){log("Phonegap login");auth_url="https://www.dropbox.com/1/oauth/authorize?oauth_token="+request_token.oauth_token;ref=window.open(auth_url,"_blank","location=yes");window.ref=ref;window.auth_count=0;ref.addEventListener("loadstop",function(event){console.log(event);console.log("event",event.url.indexOf("https://www.dropbox.com/1/oauth/authorize"));if(event.url.indexOf("https://www.dropbox.com/1/oauth/authorize")>=0){window.auth_count=window.auth_count+1;if(window.auth_count===2){Nimbus.Auth.Dropbox_auth.initialize_dropbox();return window.ref.close()}}});return ref.addEventListener("exit",function(event){return Nimbus.Auth.logout_dropbox()})}else if(document.URL.slice(0,4)==="http"){return_url="&oauth_callback="+encodeURIComponent(document.URL);auth_url="https://www.dropbox.com/1/oauth/authorize?oauth_token="+request_token.oauth_token+return_url;return location.replace(auth_url)}else if(document.URL.slice(0,6)==="chrome"){log("chrome app!");auth_url="https://www.dropbox.com/1/oauth/authorize?oauth_token="+request_token.oauth_token;return chrome.tabs.create({url:auth_url,selected:true},function(tab){return log("tab created",tab.id)})}else{auth_url="https://www.dropbox.com/1/oauth/authorize?oauth_token="+request_token.oauth_token;return location.replace(auth_url)}},get_access_token:function(callback){var auth_string,oauth_token,oauth_token_secret,xhr;oauth_token=localStorage["oauth_token"];oauth_token_secret=localStorage["oauth_token_secret"];auth_string='OAuth oauth_version="1.0",oauth_signature_method="PLAINTEXT",oauth_consumer_key="'+Nimbus.Auth.key+'",oauth_token="'+oauth_token+'",oauth_signature="'+Nimbus.Auth.secret+"&"+oauth_token_secret+'"';log("auth_string:",auth_string);xhr=new XMLHttpRequest;xhr.open("POST","https://api.dropbox.com/1/oauth/access_token",true);xhr.setRequestHeader("Authorization",auth_string);xhr.onreadystatechange=function(){var access_token,data,i,k,pair,pairs,result,v,_i,_len;if(this.readyState===4){if(this.status===200){data=this.response;log(data);pairs=data.split(/&/);access_token={};for(_i=0,_len=pairs.length;_i<_len;_i++){i=pairs[_i];pair=i.split(RegExp("="),2);access_token[pair[0]]=pair[1]}log("Access result",access_token);for(k in access_token){v=access_token[k];localStorage[k]=v}window.access_token=access_token;if(callback!=null){return callback(access_token)}}else{try{result=JSON.parse(result)}catch(_error){}return log(result,this.status,this)}}};return xhr.send()},send_request:function(method,url,body,success,failure){var auth_string,key,oauth_token,oauth_token_secret,pList,xhr;oauth_token=localStorage["oauth_token"];oauth_token_secret=localStorage["oauth_token_secret"];auth_string='OAuth oauth_version="1.0",oauth_signature_method="PLAINTEXT",oauth_consumer_key="'+Nimbus.Auth.key+'",oauth_token="'+oauth_token+'",oauth_signature="'+Nimbus.Auth.secret+"&"+oauth_token_secret+'"';log("auth_string:",auth_string);xhr=new XMLHttpRequest;xhr.open(method,url,true);xhr.setRequestHeader("Authorization",auth_string);xhr.onreadystatechange=function(){var result;if(this.readyState===4){if(this.status===200){result=this.response;try{result=JSON.parse(result)}catch(_error){}log("REQUEST RESULT",result);if(success!=null){success(result)}}else{try{result=JSON.parse(result)}catch(_error){}log(result,this.status,this);if(failure!=null){failure(result)}}if(window.current_syncing!=null){return window.current_syncing.ok()}}};if(method==="POST"){xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");if(body){pList=[];for(key in body){pList.push(encodeURIComponent(key)+"="+encodeURIComponent(body[key]))}body=pList.length>0?pList.join("&").replace(/%20/g,"+"):null}log(body)}log("send request params",method,url,body,success,failure);if(window.current_syncing!=null){window.current_syncing.wait()}xhr.send(body);return window.xhr=xhr},send_request_without_delay:function(method,url,body,success,failure){var auth_string,key,oauth_token,oauth_token_secret,pList,xhr;oauth_token=localStorage["oauth_token"];oauth_token_secret=localStorage["oauth_token_secret"];auth_string='OAuth oauth_version="1.0",oauth_signature_method="PLAINTEXT",oauth_consumer_key="'+Nimbus.Auth.key+'",oauth_token="'+oauth_token+'",oauth_signature="'+Nimbus.Auth.secret+"&"+oauth_token_secret+'"';log("auth_string:",auth_string);xhr=new XMLHttpRequest;xhr.open(method,url,true);xhr.setRequestHeader("Authorization",auth_string);xhr.onreadystatechange=function(){var result;if(this.readyState===4){if(this.status===200){result=this.response;try{result=JSON.parse(result)}catch(_error){}log("REQUEST RESULT",result);if(success!=null){return success(result)}}else{try{result=JSON.parse(result)}catch(_error){}log(result,this.status,this);if(failure!=null){return failure(result)}}}};if(method==="POST"){xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");if(body){pList=[];for(key in body){pList.push(encodeURIComponent(key)+"="+encodeURIComponent(body[key]))}body=pList.length>0?pList.join("&").replace(/%20/g,"+"):null}log(body)}log("send request params",method,url,body,success,failure);return xhr.send(body)},putFileContents:function(path,content,success,error){log("putFileContents");return Nimbus.Client.Dropbox.send_request("PUT","https://api-content.dropbox.com/1/files_put/sandbox"+path,content,success,error)},createFolder:function(path,success,error){log("createFolder");return Nimbus.Client.Dropbox.send_request("POST","https://api.dropbox.com/1/fileops/create_folder",{root:"sandbox",path:path},success,error)},deletePath:function(path,success,error){log("deletePath");return Nimbus.Client.Dropbox.send_request("POST","https://api.dropbox.com/1/fileops/delete",{root:"sandbox",path:path},success,error)},getFileContents:function(path,success,error){log("getFileContents");return Nimbus.Client.Dropbox.send_request("GET","https://api-content.dropbox.com/1/files/sandbox"+path,"",success,error)},getMetadataList:function(path,success,error){log("getMetadataList");return Nimbus.Client.Dropbox.send_request("GET","https://api.dropbox.com/1/metadata/sandbox"+path,"",success,error)},getAccountInfo:function(success,error){log("getAccountInfo");return Nimbus.Client.Dropbox.send_request_without_delay("GET","https://api.dropbox.com/1/account/info","",success,error)}};window.client=null;Nimbus.Client.Dropbox.Binary={binary_setup:function(){return window.binary=Nimbus.Model.setup("binary",["name","path","copied","directlink","sharelink","expiration"])},initialize_client:function(){log("initializing second client");if(Nimbus.Auth.key!=null){if(window.client==null){window.client=new Dropbox.Client({key:Nimbus.Auth.key,secret:Nimbus.Auth.secret,sandbox:true});return window.client.oauth.setToken(localStorage["oauth_token"],localStorage["oauth_token_secret"])}else{}}else{return log("can't upload file with no dropbox credentials")}},upload_blob:function(blob,name,callback){var come_back,new_file;log("upload new blob");Nimbus.Client.Dropbox.Binary.initialize_client();if(window.client!=null){new_file=binary.create({name:name,copied:false});come_back=function(error,stat){console.log("wrote file to cloud");console.log(error,stat);new_file.copied=true;new_file.path=stat.path;new_file.save();if(callback!=null){return callback(new_file)}};log("file name",name);return window.client.writeFile(name,blob,come_back)}else{return log("client won't initialize")}},upload_file:function(file,callback){var come_back,new_file;log("upload new file");Nimbus.Client.Dropbox.Binary.initialize_client();if(window.client!=null){new_file=binary.create({name:file.name,copied:false});come_back=function(error,stat){console.log("wrote file to cloud");console.log(error,stat);new_file.copied=true;new_file.path=stat.path;new_file.save();if(callback!=null){return callback(new_file)}};log("file name",file.name);return window.client.writeFile(file.name,file,come_back)}else{return log("client won't initialize")}},read_file:function(binary,callback){var come_back;log("read a binary file from the server");Nimbus.Client.Dropbox.Binary.initialize_client();if(window.client!=null){come_back=function(error,data,stat){console.log(error,data,stat);return callback(data)};return window.client.readFile(binary.path,{blob:true},come_back)}else{return log("client won't initialize")}},share_link:function(binary,callback){var come_back;log("get the share link");Nimbus.Client.Dropbox.Binary.initialize_client();if(window.client!=null){come_back=function(error,data){console.log(error,data);binary.sharelink=data.url;binary.save();return callback(data)};console.log(binary.path);return window.client.makeUrl(binary.path,{},come_back)}},direct_link:function(binary,callback){var come_back;log("get the share link");Nimbus.Client.Dropbox.Binary.initialize_client();if(window.client!=null){if(binary.directlink!=null&&new Date(binary.expiration)>new Date){return callback({url:binary.directlink,expiresAt:binary.expiration})}else{come_back=function(error,url){console.log(error,url);binary.directlink=url.url;binary.expiration=url.expiresAt.toString();binary.save();return callback(url)};return window.client.makeUrl(binary.path,{download:true,downloadHack:true},come_back)}}},delete_file:function(binary){var come_back;log("delete file");Nimbus.Client.Dropbox.Binary.initialize_client();if(window.client!=null){come_back=function(error,stat){return binary.destroy()};return window.client.remove(binary.path,come_back)}else{return log("client won't initialize")}}};Nimbus.Client.GDrive={check_auth:function(){var token;log("checking if this is authenticated");if(location.protocol==="chrome-extension:"){if(typeof gapi!=="undefined"&&gapi!==null&&gapi.auth!=null&&gapi.auth.getToken()===null&&window.todo!=null){token=Nimbus.Auth.GDrive.getLocalOauth2Token();if(token==null||Nimbus.Auth.GDrive.isTokenExpires(token)){return false}else{gapi.auth.setToken(token);return true}}}return typeof gapi!=="undefined"&&gapi!==null&&gapi.auth!=null&&gapi.auth.getToken()!==null&&Object.keys(gapi.auth.getToken()).length!==0&&window.todo!=null},authorize:function(client_id,scopes,callback){log("authorized called");return gapi.auth.authorize({client_id:client_id,scope:scopes,immediate:false,authuser:localStorage.authuser||0,prompt:"select_account"},callback)
},insertFile:function(content,title,contentType,parent,callback,properties){var base64Data,boundary,close_delim,delimiter,metadata,multipartRequestBody,params;log("putFileContents");boundary="-------314159265358979323846";delimiter="\r\n--"+boundary+"\r\n";close_delim="\r\n--"+boundary+"--";base64Data=btoa(content);metadata={title:title,mimeType:contentType};if(parent!=null){metadata["parents"]=[{kind:"drive#fileLink",id:parent}]}if(properties){metadata.properties=properties}multipartRequestBody=delimiter+"Content-Type: application/json\r\n\r\n"+JSON.stringify(metadata)+delimiter+"Content-Type: "+contentType+"\r\n"+"Content-Transfer-Encoding: base64\r\n"+"\r\n"+base64Data+close_delim;log("MULTI: ",multipartRequestBody);if(!callback){callback=function(file){return log("Update Complete ",file)}}params={path:"/upload/drive/v2/files",method:"POST",params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/mixed; boundary="'+boundary+'"'},body:multipartRequestBody};return this.make_request(params,callback)},deleteFile:function(file_id,callback){var params;log("deletePath");if(!callback){callback=function(_this){return function(resp){var params;params={path:"/drive/v2/files/"+file_id,method:"DELETE"};_this.make_request(params,function(data){return log("delete complete",data)});return log("Delete Complete ",resp)}}(this)}params={path:"/drive/v2/files/"+file_id+"/trash",method:"POST"};return this.make_request(params,callback)},getFile:function(file_id,callback){var params;log("getFileContents");if(!callback){callback=function(resp){return log("Read Complete ",resp)}}params={path:"/drive/v2/files/"+file_id,method:"GET"};return this.make_request(params,callback)},readFile:function(url,callback){var accessToken,xhr;if(!callback){callback=function(resp){return log("Read Complete ",resp)}}accessToken=gapi.auth.getToken().access_token;xhr=new XMLHttpRequest;xhr.open("GET",url);xhr.setRequestHeader("Authorization","Bearer "+accessToken);xhr.onload=function(){callback(xhr.responseText);if(window.current_syncing!=null){return window.current_syncing.ok()}};xhr.onerror=function(){return callback(null)};if(window.current_syncing!=null){window.current_syncing.wait()}return xhr.send()},updateFile:function(content,title,contentType,file_id,folder_id,callback){var base64Data,boundary,close_delim,delimiter,metadata,multipartRequestBody,params;log("updateFileContents");boundary="-------314159265358979323846";delimiter="\r\n--"+boundary+"\r\n";close_delim="\r\n--"+boundary+"--";contentType="text/html";metadata={mimeType:contentType};base64Data=btoa(content);metadata={title:title,mimeType:contentType};multipartRequestBody=delimiter+"Content-Type: application/json\r\n\r\n"+JSON.stringify(metadata)+delimiter+"Content-Type: "+contentType+"\r\n"+"Content-Transfer-Encoding: base64\r\n"+"\r\n"+base64Data+close_delim;if(!callback){callback=function(file){return log("Update Complete ",file)}}params={path:"/upload/drive/v2/files/"+file_id,method:"PUT",params:{fileId:file_id,uploadType:"multipart"},headers:{"Content-Type":'multipart/mixed; boundary="'+boundary+'"'},body:multipartRequestBody};return this.make_request(params,callback)},getMetadataList:function(query,callback){var params;log("getMetadataList");if(!callback){callback=function(file){return log("List of files",file)}}params={path:"/drive/v2/files",method:"GET",params:{q:query}};return this.make_request(params,callback)},make_request:function(params,callback){params["callback"]=function(data){if(callback!=null){callback(data)}if(window.current_syncing!=null){return window.current_syncing.ok()}};if(window.current_syncing!=null){window.current_syncing.wait()}return gapi.client.request(params)},get_current_user:function(callback){var params,process;log("get current user");process=function(_this){return function(file){var user;log("About called ",file);user={};user.name=file["user"].displayName;user.id=file["user"].permissionId;if(file["user"].picture!=null){user.pic=file["user"].picture.url}if(callback!=null){return callback(user)}}}(this);params={path:"/drive/v2/about",method:"GET"};return this.make_request(params,process)},get_current_user_info:function(callback){var params,process;log("get current user");process=function(_this){return function(user){if(callback!=null){return callback(user)}}}(this);params={path:"/plus/v1/people/me",method:"GET"};return this.make_request(params,process)},add_share_user:function(email,callback){var app_folder_id,params,process;log("&&& add share user");process=function(_this){return function(person){var p;log("Add Share user Complete ",person);p={id:person.id,name:person.name,role:person.role};if(person.photoLink!=null){p["pic"]=person.photoLink}if(callback!=null){return callback(p)}}}(this);app_folder_id=window.folder["binary_files"].id;params={path:"/drive/v2/files/"+app_folder_id+"/permissions",method:"POST",params:{fileId:app_folder_id},body:{role:"writer",type:"user",value:email}};return this.make_request(params,process)},add_share_user_real:function(email,callback,file_id){var fid,params,process;log("&&& add share user");fid=file_id?file_id:window.c_file.id;process=function(_this){return function(person){var p;log("Add Share user Complete ",person);p={id:person.id,name:person.name,role:person.role};if(person.photoLink!=null){p["pic"]=person.photoLink}if(callback!=null){return callback(p)}}}(this);params={path:"/drive/v2/files/"+fid+"/permissions",method:"POST",params:{fileId:fid},body:{role:"writer",type:"user",value:email}};return this.make_request(params,process)},remove_share_user:function(id,callback){var app_folder_id,params;log("&&& remove a user from sharing this app");app_folder_id=window.folder["binary_files"].id;if(!callback){callback=function(file){return log("Permission Removal Complete ",file)}}params={path:"/drive/v2/files/"+app_folder_id+"/permissions/"+id,method:"DELETE"};return this.make_request(params,callback)},remove_share_user_real:function(id,callback,file_id){var params;log("&&& remove a user from sharing this app");if(!callback){callback=function(file){return log("Permission Removal Complete ",file)}}file_id=file_id?file_id:window.c_file.id;params={path:"/drive/v2/files/"+file_id+"/permissions/"+id,method:"DELETE"};return this.make_request(params,callback)},get_user_email:function(){var access_token,data,xhr;if(window.user_email!=null){return window.user_email}access_token=gapi.auth.getToken().access_token;data=null;xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){if(xhr.readyState===4){if(xhr.status===200){return data=JSON.parse(xhr.responseText)}else{return log("get user email failed with status "+xhr.status)}}};xhr.open("GET","https://www.googleapis.com/oauth2/v1/tokeninfo?access_token="+access_token,false);xhr.send(null);if((data!=null?data.email:void 0)!=null){window.user_email=data.email;return data.email}return null},get_shared_users_real:function(callback){var params,process;log("&&& get shared users");process=function(_this){return function(file){var p,perm,permissions,_i,_len,_ref;log("Update Complete ",file);permissions=[];_ref=file.items;for(_i=0,_len=_ref.length;_i<_len;_i++){p=_ref[_i];perm={id:p.id,name:p.name,role:p.role};if(p.photoLink!=null){perm["pic"]=p.photoLink}permissions.push(perm)}log("permissions",permissions);if(callback!=null){return callback(permissions)}}}(this);params={path:"/drive/v2/files/"+window.c_file.id+"/permissions",method:"GET"};return this.make_request(params,process)},get_shared_users:function(callback){var app_folder_id,params,process;log("&&& get shared users");app_folder_id=window.folder["binary_files"].id;process=function(_this){return function(file){var p,perm,permissions,_i,_len,_ref;log("Update Complete ",file);permissions=[];_ref=file.items;for(_i=0,_len=_ref.length;_i<_len;_i++){p=_ref[_i];perm={id:p.id,name:p.name,role:p.role};if(p.photoLink!=null){perm["pic"]=p.photoLink}permissions.push(perm)}log("permissions",permissions);if(callback!=null){return callback(permissions)}}}(this);params={path:"/drive/v2/files/"+app_folder_id+"/permissions",method:"GET"};return this.make_request(params,process)},get_app_folders:function(callback){log("&&& get app folders");return Nimbus.Client.GDrive.getMetadataList("mimeType = 'application/vnd.google-apps.folder' and title = '"+Nimbus.Auth.app_name+"'",function(data){var f,folders,s,spaces,_i,_len;log(data);folders=data.items;spaces=[];if(data.items!=null){for(_i=0,_len=folders.length;_i<_len;_i++){f=folders[_i];s={};s.id=f.id;s.owner=f.ownerNames[0];spaces.push(s)}}log(spaces);if(callback!=null){return callback(spaces)}})},switch_to_app_folder:function(id,callback){log("###switch to app folder");window.folder={};window.folder[Nimbus.Auth.app_name]={title:Nimbus.Auth.app_name,id:id};window.current_syncing=new DelayedOp(function(_this){return function(){if(callback!=null){return callback()}}}(this));localStorage["main_folder_id"]=id;Nimbus.Client.GDrive.getMetadataList("mimeType = 'application/vnd.google-apps.folder'",function(data){var a,k,v,x,_i,_len,_ref,_results;a=data.items;log("###rewriting folders",a);for(_i=0,_len=a.length;_i<_len;_i++){x=a[_i];log(x);if(x.parents.length>0&&x.parents[0].id===id){window.folder[x.title]=x}}if(Nimbus.dictModel!=null){_ref=Nimbus.dictModel;_results=[];for(k in _ref){v=_ref[k];_results.push(v.records={})}return _results}});return window.current_syncing.ready()},switch_to_app_file_real:function(id,callback){localStorage.last_opened_workspace=id;window.current_syncing=new DelayedOp(function(_this){return function(){if(callback!=null){return callback()}}}(this));if(window._indexdb){_indexdb.allDocs({include_docs:true},function(err,res){var row,_i,_len,_ref,_results;if(!err){_ref=res.rows;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){row=_ref[_i];_results.push(_indexdb.remove(row.doc,function(e,r){return log("ok",e,r)}))}return _results}})}Nimbus.Share.getFile(id,function(data){var k,v,_ref;if(!data.id){return}window.c_file=data;if(Nimbus.dictModel!=null){_ref=Nimbus.dictModel;for(k in _ref){v=_ref[k];v.records={};if(Nimbus.Storage){Nimbus.Storage[v.name]=[]}}}return gapi.drive.realtime.load(id,onFileLoaded,initializeModel,handleErrors)});return window.current_syncing.ready()},build_params:function(obj){var k,params_arr,v;params_arr=function(){var _results;_results=[];for(k in obj){v=obj[k];_results.push(""+encodeURIComponent(k)+"="+encodeURIComponent(v))}return _results}();return params_arr.join("&")},extract_params_from_url:function(){var m,params,queryString,regex;params={};queryString=location.hash.substring(1);regex=/([^&=]+)=([^&]*)/g;while(m=regex.exec(queryString)){params[decodeURIComponent(m[1])]=decodeURIComponent(m[2])}return params},request_access_token:function(){var params,params_str,redirect_uri,url;redirect_uri=Nimbus.Auth.redirect_uri||window.location.protocol+"//"+window.location.host+window.location.pathname;params={response_type:"token",client_id:Nimbus.Auth.key,redirect_uri:redirect_uri,scope:Nimbus.Auth.scope,state:"gdrive_get_access_token",prompt:"select_account"};params_str=Nimbus.Client.GDrive.build_params(params);url="https://accounts.google.com/o/oauth2/auth?"+params_str;return window.open(url,"_self")},request_validate_token:function(token){var data,xhr;xhr=new XMLHttpRequest;data=null;xhr.onreadystatechange=function(){var _ref;if(xhr.readyState===4){if((_ref=xhr.status)===200||_ref===400){return data=JSON.parse(xhr.responseText)}else{return log("validate access token failed with status "+xhr.status)}}};xhr.open("GET","https://www.googleapis.com/oauth2/v1/tokeninfo?access_token="+token,false);xhr.send(null);return data},is_token_validate:function(token){var data,result;result=false;data=this.request_validate_token(token);if(data==null){return false}if(!("error"in data)&&(data!=null?data.audience:void 0)===Nimbus.Auth.key){result=true}return result},handle_auth_redirected:function(){return typeof history.replaceState==="function"?history.replaceState("",document.title,window.location.pathname):void 0},is_auth_redirected:function(){var params;params=this.extract_params_from_url();if(params.state==="gdrive_get_access_token"&&"token_type"in params&&params.token_type==="Bearer"){if(params.authuser){localStorage.authuser=params.authuser}return true}return false}};Nimbus.Client.GDrive.Binary={binary_setup:function(){return window.binary=Nimbus.Model.setup("binary",["name","path","copied","directlink","sharelink","expiration","file_id"])},initialize_client:function(run){log("initializing client");if(Nimbus.Auth.key!=null&&Nimbus.Auth.scope!=null){if(!Nimbus.Client.GDrive.check_auth()){return Nimbus.Client.GDrive.authorize(Nimbus.Auth.key,Nimbus.Auth.scope,function(){log("GDrive authorized");if(run){return run()}})}else{if(run){return run()}}}else{return log("can't upload file with no GDrive credentials")}},upload_blob:function(blob,name,callback){return Nimbus.Client.GDrive.Binary.initialize_client(function(){var reader;log("upload new blob");reader=new FileReader;reader.readAsBinaryString(blob);return reader.onload=function(){var come_back,content,contentType,new_file,parent;content=reader.result;contentType=blob.type||"application/octet-stream";parent=window.folder["binary_files"].id;new_file=binary.create({name:name});come_back=function(file){console.log("upload file to cloud");console.log(file);new_file.copied=true;new_file.file_id=file.id;new_file.directlink=file.webContentLink;new_file.save();if(callback!=null){return callback(new_file)}};return Nimbus.Client.GDrive.insertFile(content,name,contentType,parent,come_back)}})},upload_file:function(file,callback){return Nimbus.Client.GDrive.Binary.initialize_client(function(){var reader;log("upload new file");reader=new FileReader;reader.readAsBinaryString(file);return reader.onload=function(){var come_back,content,contentType,name,new_file,parent;name=file.name;content=reader.result;contentType=file.type||"application/octet-stream";parent=window.folder["binary_files"].id;new_file=binary.create({name:name});come_back=function(file){console.log("upload file to cloud");console.log(file);new_file.copied=true;new_file.file_id=file.id;new_file.directlink=file.webContentLink;new_file.save();new_file._file=file;if(callback!=null){return callback(new_file)}};return Nimbus.Client.GDrive.insertFile(content,name,contentType,parent,come_back)}})},read_file:function(binary,callback){return Nimbus.Client.GDrive.Binary.initialize_client(function(){var param;log("read metadata of a file from the server");param={path:"/drive/v2/files/"+binary.file_id};return Nimbus.Client.GDrive.make_request(param,function(data){console.log(data);if(callback){return callback(data)}})})},share_link:function(binary,callback){return Nimbus.Client.GDrive.Binary.initialize_client(function(){log("get the share link");if(callback){return callback("")}})},direct_link:function(binary,callback){return Nimbus.Client.GDrive.Binary.initialize_client(function(){log("get the direct link");if(callback){return callback(binary.directlink)}})},delete_file:function(binary){return Nimbus.Client.GDrive.Binary.initialize_client(function(){log("delete file",binary);return Nimbus.Client.GDrive.deleteFile(binary.file_id,function(){return binary.destroy()})})}};window.nimbus_error=[];Nimbus.Model.GDrive={cloudcache:{},last_hash:"",hash:"",toCloudStructure:function(object){log("local to cloud structure");return JSON.stringify(object)},fromCloudStructure:function(value){log("changes cloud to local data in the form a dictionary");return JSON.parse(value)},diff_objects:function(previous,current){var diff,f,v;diff={};for(f in previous){v=previous[f];if(current[f]!==previous[f]){diff[f]=[current[f],previous[f]]}}if(previous["parent_id"]!=null!==(current["parent_id"]!=null)){diff["parent_id"]=["one of them is null"]}return diff},add_to_cloud:function(object,callback){var parent,parent_name;log("add to cloud",object);parent_name=object.parent.name;parent=window.folder[parent_name].id;return Nimbus.Client.GDrive.insertFile(this.toCloudStructure(object),object.id,"text/plain",parent,function(data){log("logging data inserted",data);window.currently_syncing=true;object.gid=data.id;object.time=data.modifiedDate;object.synced=true;object.save();return window.currently_syncing=false})},delete_from_cloud:function(object_id,callback){log("delete from cloud",object_id);return Nimbus.Client.GDrive.getMetadataList("title = '"+object_id+"'",function(data){var id;log("data",data);if(data.items.length>0){id=data.items[0].id;Nimbus.Client.GDrive.deleteFile(id);if(callback!=null){return callback()}}else{return log("file to be deleted not there")}})},update_to_cloud:function(object,callback){var comeback,parent,parent_name,update_comback;log("updated to cloud",object.name);parent_name=object.parent.name;parent=window.folder[parent_name].id;update_comback=function(_this){return function(data){log("logging data inserted",data);window.currently_syncing=true;object.time=data.modifiedDate;object.save();object.synced=true;return window.currently_syncing=false}}(this);comeback=function(_this){return function(data){var id;id=data.items[0].id;return Nimbus.Client.GDrive.updateFile(_this.toCloudStructure(object),object.id,"text/plain",id,parent,function(data){log("logging data inserted",data);window.currently_syncing=true;object.time=data.modifiedDate;object.save();return window.currently_syncing=false})}}(this);if(object.gid!=null){return Nimbus.Client.GDrive.updateFile(this.toCloudStructure(object),object.id,"text/plain",object.gid,parent,function(data){log("logging data updated",data);window.currently_syncing=true;object.time=data.modifiedDate;object.save();return window.currently_syncing=false})}else{return Nimbus.Client.GDrive.getMetadataList("title = '"+object.id+"'",comeback)}},add_from_cloud:function(object_id,callback){var process_data;log("add from cloud GDrive",object_id);process_data=function(_this){return function(data){var converted,x;log("cloud url data",JSON.parse(data));window.currently_syncing=true;converted=_this.fromCloudStructure(data);x=_this.init(converted);x.synced=true;x.time=_this.cloudcache[object_id].time;x.save();return window.currently_syncing=false}}(this);return Nimbus.Client.GDrive.getMetadataList("title = '"+object_id+"'",function(data){var url;log("cloud read data",data);window.data=data;if(data.items!=null&&data.items.length>=1){url=window.data.items[0].downloadUrl;return Nimbus.Client.GDrive.readFile(url,process_data)}else{return log("This data is not there")}})},update_to_local:function(object,callback){var process_data;log("update to local",object);process_data=function(_this){return function(data){var converted,x;log("cloud url data",JSON.parse(data));window.currently_syncing=true;converted=_this.fromCloudStructure(data);x=_this.find(object.id);converted.time=_this.cloudcache[object.id].time;x.updateAttributes(converted);return window.currently_syncing=false}}(this);return Nimbus.Client.GDrive.getMetadataList("title = '"+object.id+"'",function(data){var url;log("cloud read data",data);window.data=data;if(data.error!=null){window.nimbus_error.push({error:data.error,object:object});return console.log("##ERROR writing back to local",data.error,"object: ",object)}else{if(data.items.length>=1){url=window.data.items[0].downloadUrl;return Nimbus.Client.GDrive.readFile(url,process_data)}else{return log("This data is not there")}}})},sync_all:function(cb){log("syncs all the data, normally happens at the start of a program or coming back from offline");window.current_syncing=new DelayedOp(function(_this){return function(){log("call back sync called");window.current_syncing=new DelayedOp(function(){window.current_syncing=null;if(cb!=null){return cb()}});_this.sync_model_base_algo();return window.current_syncing.ready()}}(this));this.load_all_from_cloud();return window.current_syncing.ready()},load_all_from_cloud:function(){var fill_cache,folder_id,object_name;log("loads all the data from the cloud locally");this.cloudcache={};object_name=this.name;log("object name",object_name);if(window.folder!=null&&window.folder[object_name]!=null){folder_id=window.folder[object_name].id;fill_cache=function(_this){return function(data){var x,_i,_len,_ref,_results;log("cloud read data",object_name,data);window.data=data;if(data.items!=null){_ref=data.items;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){x=_ref[_i];_this.cloudcache[x.title]={id:x.title,time:x.modifiedDate};if(x.labels.trashed){_results.push(console.log("##### this is trashed #####",x))}else{_results.push(void 0)}}return _results}else{return log("###ERROR, no return data")}}}(this);Nimbus.Client.GDrive.getMetadataList("'"+folder_id+"' in parents",fill_cache);return _this.is_cloud_available=true}else{log("############################BIG ERROR no folder there for load from cloud");return _this.is_cloud_available=false}},get_delta:function(){return log("get the delta for ",this.name," since last synced")},extended:function(){this.sync(this.proxy(this.real_time_sync));return this.fetch(this.proxy(this.loadLocal))}};window.folder=null;window.folder_creation=new OneOp;window.creating={};window.handle_initialization=new OneOp;window.gdrive_initialized=false;window.folder_initialize=function(callback){var get_app_folder,properties,query,space_folder_name;space_folder_name=c_file.title+" files";query="mimeType = 'application/vnd.google-apps.folder' and title = '"+space_folder_name+"' and properties has { key='space' and value='"+c_file.id+"' and visibility='PRIVATE' }";properties=[{key:"space",value:c_file.id,visibility:"PRIVATE"}];get_app_folder=function(handle){return Nimbus.Client.GDrive.getMetadataList(query,function(data){if(handle){return handle(data)}})};log("&&& folder initialize");log("Nimbus.Client.GDrive.check_auth()",Nimbus.Client.GDrive.check_auth(),"Nimbus.Auth.service",Nimbus.Auth.service);if(Nimbus.Client.GDrive.check_auth()&&Nimbus.Auth.service==="GDrive"){log("this is authenticated and a GDrive app");return Nimbus.Client.GDrive.getMetadataList(query,function(data){var a,x,_i,_len;log("#data: ",data);window.folder={};a=data.items;if(localStorage["main_folder_id"]!=null){return window.folder[Nimbus.Auth.app_name]={title:Nimbus.Auth.app_name,id:localStorage["main_folder_id"]}}else if(!a.error){for(_i=0,_len=a.length;_i<_len;_i++){x=a[_i];if(x.owners[0].permissionId===c_file.owners[0].permissionId){window.folder.binary_files=x;break}}if(window.folder["binary_files"]==null){return Nimbus.Client.GDrive.insertFile("",c_file.title+" files","application/vnd.google-apps.folder",null,function(data){log("binary_files folder data",data);log("binary ready callback",binary_ready_callback);window.folder["binary_files"]=data;if(window.binary_ready_callback){window.binary_ready_callback()}if(callback!=null){return callback()}},properties)}else{log("binary ready callback",binary_ready_callback);if(window.binary_ready_callback){window.binary_ready_callback()}if(callback!=null){return callback()}}}else{return console.log("error")}})}};Nimbus.Auth.GDrive={init_scope:function(){var isArray,user_email_scope,x;x=this.scope;isArray=Array.isArray||function(value){return{}.toString.call(value)==="[object Array]"};user_email_scope="https://www.googleapis.com/auth/userinfo.email";if(isArray(x)){if(__indexOf.call(x,user_email_scope)<0){x.push(user_email_scope)}}else{x=[x,user_email_scope]}if(x.indexOf("openid")===-1){x.push("openid")}return this.scope=x.join(" ")},get_token_from_code:function(code){var data,xhr;xhr=new XMLHttpRequest;data="code="+code+"&client_id="+this.key+"&client_secret="+this.client_secret+"&grant_type=authorization_code&redirect_uri=urn%3Aietf%3Awg%3Aoauth%3A2.0%3Aoob";window.data=data;xhr.open("POST","https://accounts.google.com/o/oauth2/token");xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xhr.onreadystatechange=function(_this){return function(status,response){var e,result;if(xhr.readyState===4){try{result=JSON.parse(xhr.response);if(result["error"]){return console.log("error")}else{window.plugins.childBrowser.close();localStorage["phonegap_token"]=JSON.stringify(result);localStorage["state"]="Working";gapi.auth.setToken(result);_this.prepare_gdrive();return Nimbus.track.google.registered_user()}}catch(_error){e=_error;return console.log(e)}}}}(this);xhr.send(data);return window.xhr=xhr},authenticate_gdrive:function(){var auth_url,cb,url;log("this should bring up a prompt to initialize into GDrive");localStorage["d_key"]=this.key;localStorage["secret"]=this.scope;localStorage["state"]="Auth";if(document.URL.slice(0,4)==="file"&&typeof cordova!=="undefined"&&cordova!==null){log("Phonegap google login");auth_url="https://accounts.google.com/o/oauth2/auth?response_type=code&client_id="+this.key+"&scope="+encodeURIComponent(this.scope)+"&approval_prompt=auto&redirect_uri=urn:ietf:wg:oauth:2.0:oob";window.auth_url=auth_url;cb=window.plugins.childBrowser;if(cb!==null){cb.onLocationChange=function(loc){return locChanged(loc)};cb.onClose=function(){return onCloseBrowser()};cb.onOpenExternal=function(){return onOpenExternal()};url=auth_url+"###var sendToApp = function(_key, _val) {var iframe = document.createElement('IFRAME');iframe.setAttribute('src', _key + ':##sendToApp##' + _val);document.documentElement.appendChild(iframe);iframe.parentNode.removeChi(iframe);iframe = null;};var log=function(_mssg){sendToApp('ios-log',_mssg);}; var html = document.getElementById('code').value; log(html);";cb.onJSCallback=function(backStr){cb.code=backStr;if(backStr&&backStr!=null&&backStr!=="(null)"){cb.close();console.log("will get some toaken");return Nimbus.Auth.get_token_from_code(backStr)}};return cb.showWebPage(url)}}else if(location.protocol==="chrome-extension:"){log("chrome extension authorize");return this.oauth2_authorize()}else{return Nimbus.Client.GDrive.request_access_token()}},initialize_gdrive:function(){log("This part should reflect what initialization needs to be done for GDrive auth");Nimbus.gdrive_initialized=true;if(Nimbus.loaded){if(location.protocol==="chrome-extension:"){return this.oauth2_authorize_second_half()}else{if(Nimbus.Client.GDrive.is_auth_redirected()){Nimbus.Client.GDrive.handle_auth_redirected()}console.log("GDrive loaded");if(localStorage["phonegap_token"]){gapi.auth.setToken(JSON.parse(localStorage["phonegap_token"]));return _this.prepare_gdrive()}return gapi.auth.authorize({client_id:this.key,scope:this.scope,immediate:true,authuser:localStorage.authuser||0},function(_this){return function(data){log("client load handled GDrive");log(data);if(data!==null){return _this.prepare_gdrive()}}}(this))}}},gdrive_authorized:function(){return Nimbus.Client.GDrive.check_auth()},logout_gdrive:function(callback){var k,v,_ref;localStorage.clear();gapi.auth.setToken(null);if(Nimbus.dictModel!=null){_ref=Nimbus.dictModel;for(k in _ref){v=_ref[k];v.records={}}}if(this.sync_services!=null){Nimbus.Auth.setup(this.sync_services)}if(callback!=null){return callback()}},prepare_gdrive:function(){window.binary_ready_callback=function(){if(Nimbus.Auth.authorized_callback!=null){return Nimbus.Auth.authorized_callback()}};return window.startRealtime(function(){log("CURRENT SYNCING CALLBACK");Nimbus.Auth.app_ready_func();Nimbus.track.google.registered_user();return setInterval(function(){var is_token_expired,is_token_there;is_token_there=gapi.auth.getToken()!=null&&gapi.auth.getToken().access_token==null;if(gapi.auth.getToken()){is_token_expired=gapi.auth.getToken().expires_at-(new Date).getTime()/1e3<60*10}else{is_token_expired=true}if(is_token_there||is_token_expired){return gapi.auth.authorize({client_id:Nimbus.Auth.key,scope:Nimbus.Auth.scope,immediate:true,authuser:localStorage.authuser||0},function(data){return console.log("token refreshed")})}return null},6e4)})},oauth2_authorize:function(){var background,params,url;background=chrome.extension.getBackgroundPage();background.NimbusAuth2=function(background_window){var NimbusAuth2;NimbusAuth2={OAUTH2_REDIRECT_URI:"http://www.google.com/robots.txt",getExtensionId:function(){return background_window.chrome.i18n.getMessage("@@extension_id")},isOauth2AuthorizeRedirected:function(base,state){if(base===this.OAUTH2_REDIRECT_URI&&state===this.getExtensionId()){return true}return false},parseParamsString:function(queryString){var m,params,regex;params={};regex=/([^&=]+)=([^&]*)/g;while(m=regex.exec(queryString)){params[background_window.decodeURIComponent(m[1])]=background_window.decodeURIComponent(m[2])}return params},parseRedirectedURL:function(url){var base_url,hash,params,_ref;_ref=url.split("#"),base_url=_ref[0],hash=_ref[1];params=this.parseParamsString(hash);return{base_url:base_url,params:params}},generateRedirectListener:function(){var listener;listener=function(_this){return function(tab_id,change_info,tab){var entension_windows,url_obj,w,_i,_len;if(change_info.status!=="loading"){return}url_obj=_this.parseRedirectedURL(tab.url);if(_this.isOauth2AuthorizeRedirected(url_obj.base_url,url_obj.params.state)){background_window.chrome.tabs.onUpdated.removeListener(listener);background_window.chrome.tabs.remove(tab_id);url_obj["saved_time"]=(new background_window.Date).getTime();background_window.localStorage["_nimbusGDriveAuthObj"]=background_window.JSON.stringify(url_obj);if(_this.isPackagedApp()){background_window.console.log("in packaged app");entension_windows=background_window.chrome.extension.getViews({type:"tab"});for(_i=0,_len=entension_windows.length;_i<_len;_i++){w=entension_windows[_i];if(w.Nimbus.Auth.GDrive.oauth_status_flag==="ongoing"){w.Nimbus.Auth.GDrive.oauth2_authorize_second_half()}}}else if(_this.isBrowserAction()){background_window.console.log("in browser action")}return null}}}(this);return listener},installRedirectedListener:function(){return background_window.chrome.tabs.onUpdated.addListener(this.generateRedirectListener())},isBrowserAction:function(){return"browser_action"in background_window.chrome.runtime.getManifest()},isPackagedApp:function(){return"app"in background_window.chrome.runtime.getManifest()}};return NimbusAuth2}(background);Nimbus.Auth.GDrive.oauth_status_flag="ongoing";background.NimbusAuth2.installRedirectedListener();url="https://accounts.google.com/o/oauth2/auth?";params={client_id:this.key,scope:this.scope,redirect_uri:this.OAUTH2_REDIRECT_URI,state:this.getExtensionId(),response_type:"token",approval_prompt:"auto"};url+=this.buildParamsString(params);return chrome.tabs.create({url:url})},oauth2_authorize_second_half:function(){var issued_at,save_token,token,url_obj;if(localStorage._nimbusGDriveAuthObj!=null){url_obj=JSON.parse(localStorage["_nimbusGDriveAuthObj"]);if("error"in url_obj){throw new Error("authorization failed with error: "+url_obj.error)}save_token=url_obj.params;issued_at=Math.round(url_obj.saved_time/1e3);save_token.client_id=this.key;save_token.scope=this.scope;save_token.response_type="token";save_token.issued_at=issued_at.toString();save_token.expires_at=(issued_at+parseInt(save_token.expires_in)).toString();save_token.state="";delete localStorage["_nimbusGDriveAuthObj"];localStorage["_chromeExtensionAuth2Token"]=JSON.stringify(save_token)}if(localStorage["_chromeExtensionAuth2Token"]){token=JSON.parse(localStorage["_chromeExtensionAuth2Token"]);gapi.auth.setToken(token);Nimbus.Auth.GDrive.oauth_status_flag="finish";return this.prepare_gdrive()}},OAUTH2_REDIRECT_URI:"http://www.google.com/robots.txt",getExtensionId:function(){return chrome.i18n.getMessage("@@extension_id")},buildParamsString:function(obj){var k,params_arr,v;params_arr=function(){var _results;_results=[];for(k in obj){v=obj[k];_results.push(""+encodeURIComponent(k)+"="+encodeURIComponent(v))}return _results}();return params_arr.join("&")},getLocalOauth2Token:function(token){if(Nimbus.Auth.GDrive._cacheToken!=null){return Nimbus.Auth.GDrive._cacheToken}if(localStorage._chromeExtensionAuth2Token!=null){token=JSON.parse(localStorage._chromeExtensionAuth2Token);Nimbus.Auth.GDrive._cacheToken=token;return token}else{return null}},isTokenExpires:function(token){var expires_at,now;if((token!=null?token.expires_at:void 0)!=null){expires_at=parseInt(token.expires_at);
now=(new Date).getTime();if(expires_at*1e3>now){return true}else{return false}}return true}};Nimbus.Auth.Multi={authenticate_service:function(service){var isArray,key,user_email_scope,val,x,_ref;log("authenticate a single service",service);isArray=Array.isArray||function(value){return{}.toString.call(value)==="[object Array]"};if(this.sync_services!=null&&this.sync_services[service]!=null){x=this.sync_services[service];x["service"]=service;if(service==="Dropbox"){Nimbus.Auth.setup(x)}if(service==="GDrive"){user_email_scope="https://www.googleapis.com/auth/userinfo.email";if(isArray(x.scope)){if(__indexOf.call(x.scope,user_email_scope)<0){x.scope.push(user_email_scope)}}else{x.scope=[x.scope,user_email_scope]}if(x.scope.indexOf("openid")===-1){x.scope.push("openid")}x.scope=x.scope.join(" ");if(x.client_secret!=null){Nimbus.Auth.setup(x)}else{Nimbus.Auth.setup(x)}}_ref=Nimbus.dictModel;for(key in _ref){val=_ref[key];Nimbus.Model.service_setup(val)}Nimbus.Auth.initialize();return Nimbus.Auth.authorize()}},initialize_service:function(){log("initializing service");return Nimbus.Auth.reinitialize()}};Nimbus.Auth.reinitialize();Nimbus.backbone_store=function(name,model){var k,k_arr,m,nimbus_model,store,v,_ref;log("Model on creation",model);this.name=name;m=new model;k_arr=[];_ref=m.attributes;for(k in _ref){v=_ref[k];k_arr.push(k)}nimbus_model=Nimbus.Model.setup(name,k_arr);store=nimbus_model;this.data=nimbus_model.all()||{};return store};Nimbus.backbone_sync=function(method,model,options){var a,resp,s,store;resp=void 0;store=model.nimbus||model.collection.nimbus;window.model=model;switch(method){case"read":if(model.id){resp=store.find(model)}else{store.sync_all(function(){resp=store.all();return options.success(resp)});return}break;case"create":console.log("create called");a=store.init(model.attributes);a.id=model.id;a.save();resp=a;break;case"update":s=store.find(model.id);s.updateAttributes(model.attributes);s.save();resp=s;break;case"delete":console.log("deletion find",store.find(model.id));resp=store.find(model.id).destroy()}if(resp){return options.success(resp)}else{return options.error("Record not found")}};Nimbus.angularService=function(){var all_models,makeWatcher,setup;all_models={};setup=function(name,attrs,sync_callback){var store;store=Nimbus.Model.setup(name,attrs);store.sync_all(sync_callback);all_models["name"]=store;return store};makeWatcher=function(name){return function(){return localStorage[name]}};return{setup:setup,makeWatcher:makeWatcher}};mixpanel_token="57da9d172e8c2000bca77d9ebb935752";Nimbus.track={send_people_request:function(x){var encoded,xhr;xhr=new XMLHttpRequest;log(JSON.stringify(x));encoded=Base64.encode(JSON.stringify(x));window.data="data="+encoded;xhr.open("POST","http://api.mixpanel.com/engage");xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xhr.onreadystatechange=function(_this){return function(status,response){if(xhr.readyState===4){try{log("xhr",xhr);log("mixpanel response done");return log("response: ",xhr.response)}catch(_error){}}}}(this);xhr.send(data);return window.xhr=xhr},registered_user:function(){var email;log("registered user");if(Nimbus.Auth.service==="Dropbox"){Nimbus.Client.Dropbox.getAccountInfo(function(info){var email,first,last,n,x,_ref;n=info.display_name;_ref=n.split(" "),first=_ref[0],last=_ref[1];email="";if(info.email!=null){email=info.email}x={$set:{$first_name:first,$last_name:last,$app:Nimbus.Auth.app_name,$service:Nimbus.Auth.service,$email:email,$url:window.location.href},$token:mixpanel_token,$distinct_id:email};log(x);return Nimbus.track.send_people_request(x)})}if(Nimbus.Auth.service==="GDrive"){email=Nimbus.Client.GDrive.get_user_email();return Nimbus.Client.GDrive.get_current_user(function(info){var first,last,n,x,_ref;n=info.name;_ref=n.split(" "),first=_ref[0],last=_ref[1];x={$set:{$first_name:first,$last_name:last,$app:Nimbus.Auth.app_name,$service:Nimbus.Auth.service,$email:email,$url:window.location.href},$token:mixpanel_token,$distinct_id:email};log(x);return Nimbus.track.send_people_request(x)})}},report_storage_stat:function(){var last_reported_date,now;log("report storage stat");now=new Date;if(localStorage["last_reported_date"]!=null){last_reported_date=localStorage["last_reported_date"]}if(last_reported_date){if(now-last_reported_date>864e5){log("start sending data")}return localStorage["last_reported_date"]=now}else{return log("start sending data")}}};this.Nimbus=Nimbus;baseUrl="http://www.google-analytics.com/collect?v=1&tid=UA-46950334-1&cid=001";Nimbus.track.google={data:{page_url:"",app_name:"",cloudType:"",email:""},send_page_tracking:function(url){var path,xhr;path=baseUrl+"&t=pageview&dp="+encodeURI(url);xhr=new XMLHttpRequest;xhr.open("GET",path,true);xhr.send(null)},send_event_tracking:function(dom,action,id,value){var path,xhr;if(dom==null){dom=0}if(action==null){action=0}if(id==null){id=0}if(value==null){value=0}path=baseUrl+"&t=event&ec="+encodeURI(dom)+"&ea="+encodeURI(action)+"&ev="+encodeURI(value)+"&el="+encodeURI(id);xhr=new XMLHttpRequest;xhr.open("GET",path,true);return xhr.send(null)},registered_user:function(){this.data["page_url"]=window.location.href;this.data["app_name"]=Nimbus.Auth.app_name;this.data["cloudType"]=Nimbus.Auth.service;this.send_page_tracking(this.data.page_url);setTimeout(function(){var count,data,i,len;count=0;for(i in Nimbus.dictModel){len=Nimbus.dictModel[i].all().length;count=count+len}Nimbus.track.google.data["sum"]=count;data=Nimbus.track.google.data;log("send to gogole analytic :",data);Nimbus.track.google.send_event_tracking(data.app_name,data.email,data.cloudType,data.sum)},15e3);if(Nimbus.Auth.service==="Dropbox"){Nimbus.Client.Dropbox.getAccountInfo(function(info){if(info.email!=null){return Nimbus.track.google.data["email"]=info.email}})}if(Nimbus.Auth.service==="GDrive"){return Nimbus.track.google.data["email"]=Nimbus.Client.GDrive.get_user_email()}}};window.onerror=function(msg,url,line){var error,info;error={email:Nimbus.track.google.data.email,app_name:Nimbus.track.google.data.app_name,cloudType:Nimbus.track.google.data.cloudType,line_:line,url_:url,msg_:msg};info=JSON.stringify(error);info=info.replace(/"/g,"").replace(/{/g,"").replace(/}/g,"");info=encodeURI(info);info=info.replace(/%20/g,"_").replace(/#/g,"_");log("got error, send to  google analytic:",encodeURI(info));return Nimbus.track.google.send_event_tracking(error.app_name,"error",encodeURI(info),400)}}).call(this);var requirejs,require,define;(function(global){var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.1",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,aps=ap.slice,apsp=ap.splice,isBrowser=!!(typeof window!=="undefined"&&navigator&&document),isWebWorker=!isBrowser&&typeof importScripts!=="undefined",readyRegExp=isBrowser&&navigator.platform==="PLAYSTATION 3"?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera=typeof opera!=="undefined"&&opera.toString()==="[object Opera]",contexts={},cfg={},globalDefQueue=[],useInteractive=false;function isFunction(it){return ostring.call(it)==="[object Function]"}function isArray(it){return ostring.call(it)==="[object Array]"}function each(ary,func){if(ary){var i;for(i=0;i<ary.length;i+=1){if(ary[i]&&func(ary[i],i,ary)){break}}}}function eachReverse(ary,func){if(ary){var i;for(i=ary.length-1;i>-1;i-=1){if(ary[i]&&func(ary[i],i,ary)){break}}}}function hasProp(obj,prop){return hasOwn.call(obj,prop)}function eachProp(obj,func){var prop;for(prop in obj){if(obj.hasOwnProperty(prop)){if(func(obj[prop],prop)){break}}}}function mixin(target,source,force,deepStringMixin){if(source){eachProp(source,function(value,prop){if(force||!hasProp(target,prop)){if(deepStringMixin&&typeof value!=="string"){if(!target[prop]){target[prop]={}}mixin(target[prop],value,force,deepStringMixin)}else{target[prop]=value}}})}return target}function bind(obj,fn){return function(){return fn.apply(obj,arguments)}}function scripts(){return document.getElementsByTagName("script")}function getGlobal(value){if(!value){return value}var g=global;each(value.split("."),function(part){g=g[part]});return g}function makeError(id,msg,err,requireModules){var e=new Error(msg+"\nhttp://requirejs.org/docs/errors.html#"+id);e.requireType=id;e.requireModules=requireModules;if(err){e.originalError=err}return e}if(typeof define!=="undefined"){return}if(typeof requirejs!=="undefined"){if(isFunction(requirejs)){return}cfg=requirejs;requirejs=undefined}if(typeof require!=="undefined"&&!isFunction(require)){cfg=require;require=undefined}function newContext(contextName){var inCheckLoaded,Module,context,handlers,checkLoadedTimeoutId,config={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{},map:{},config:{}},registry={},undefEvents={},defQueue=[],defined={},urlFetched={},requireCounter=1,unnormalizedCounter=1;function trimDots(ary){var i,part;for(i=0;ary[i];i+=1){part=ary[i];if(part==="."){ary.splice(i,1);i-=1}else if(part===".."){if(i===1&&(ary[2]===".."||ary[0]==="..")){break}else if(i>0){ary.splice(i-1,2);i-=2}}}}function normalize(name,baseName,applyMap){var pkgName,pkgConfig,mapValue,nameParts,i,j,nameSegment,foundMap,foundI,foundStarMap,starI,baseParts=baseName&&baseName.split("/"),normalizedBaseParts=baseParts,map=config.map,starMap=map&&map["*"];if(name&&name.charAt(0)==="."){if(baseName){if(config.pkgs[baseName]){normalizedBaseParts=baseParts=[baseName]}else{normalizedBaseParts=baseParts.slice(0,baseParts.length-1)}name=normalizedBaseParts.concat(name.split("/"));trimDots(name);pkgConfig=config.pkgs[pkgName=name[0]];name=name.join("/");if(pkgConfig&&name===pkgName+"/"+pkgConfig.main){name=pkgName}}else if(name.indexOf("./")===0){name=name.substring(2)}}if(applyMap&&(baseParts||starMap)&&map){nameParts=name.split("/");for(i=nameParts.length;i>0;i-=1){nameSegment=nameParts.slice(0,i).join("/");if(baseParts){for(j=baseParts.length;j>0;j-=1){mapValue=map[baseParts.slice(0,j).join("/")];if(mapValue){mapValue=mapValue[nameSegment];if(mapValue){foundMap=mapValue;foundI=i;break}}}}if(foundMap){break}if(!foundStarMap&&starMap&&starMap[nameSegment]){foundStarMap=starMap[nameSegment];starI=i}}if(!foundMap&&foundStarMap){foundMap=foundStarMap;foundI=starI}if(foundMap){nameParts.splice(0,foundI,foundMap);name=nameParts.join("/")}}return name}function removeScript(name){if(isBrowser){each(scripts(),function(scriptNode){if(scriptNode.getAttribute("data-requiremodule")===name&&scriptNode.getAttribute("data-requirecontext")===context.contextName){scriptNode.parentNode.removeChild(scriptNode);return true}})}}function hasPathFallback(id){var pathConfig=config.paths[id];if(pathConfig&&isArray(pathConfig)&&pathConfig.length>1){removeScript(id);pathConfig.shift();context.require.undef(id);context.require([id]);return true}}function splitPrefix(name){var prefix,index=name?name.indexOf("!"):-1;if(index>-1){prefix=name.substring(0,index);name=name.substring(index+1,name.length)}return[prefix,name]}function makeModuleMap(name,parentModuleMap,isNormalized,applyMap){var url,pluginModule,suffix,nameParts,prefix=null,parentName=parentModuleMap?parentModuleMap.name:null,originalName=name,isDefine=true,normalizedName="";if(!name){isDefine=false;name="_@r"+(requireCounter+=1)}nameParts=splitPrefix(name);prefix=nameParts[0];name=nameParts[1];if(prefix){prefix=normalize(prefix,parentName,applyMap);pluginModule=defined[prefix]}if(name){if(prefix){if(pluginModule&&pluginModule.normalize){normalizedName=pluginModule.normalize(name,function(name){return normalize(name,parentName,applyMap)})}else{normalizedName=normalize(name,parentName,applyMap)}}else{normalizedName=normalize(name,parentName,applyMap);nameParts=splitPrefix(normalizedName);prefix=nameParts[0];normalizedName=nameParts[1];isNormalized=true;url=context.nameToUrl(normalizedName)}}suffix=prefix&&!pluginModule&&!isNormalized?"_unnormalized"+(unnormalizedCounter+=1):"";return{prefix:prefix,name:normalizedName,parentMap:parentModuleMap,unnormalized:!!suffix,url:url,originalName:originalName,isDefine:isDefine,id:(prefix?prefix+"!"+normalizedName:normalizedName)+suffix}}function getModule(depMap){var id=depMap.id,mod=registry[id];if(!mod){mod=registry[id]=new context.Module(depMap)}return mod}function on(depMap,name,fn){var id=depMap.id,mod=registry[id];if(hasProp(defined,id)&&(!mod||mod.defineEmitComplete)){if(name==="defined"){fn(defined[id])}}else{getModule(depMap).on(name,fn)}}function onError(err,errback){var ids=err.requireModules,notified=false;if(errback){errback(err)}else{each(ids,function(id){var mod=registry[id];if(mod){mod.error=err;if(mod.events.error){notified=true;mod.emit("error",err)}}});if(!notified){req.onError(err)}}}function takeGlobalQueue(){if(globalDefQueue.length){apsp.apply(defQueue,[defQueue.length-1,0].concat(globalDefQueue));globalDefQueue=[]}}handlers={require:function(mod){if(mod.require){return mod.require}else{return mod.require=context.makeRequire(mod.map)}},exports:function(mod){mod.usingExports=true;if(mod.map.isDefine){if(mod.exports){return mod.exports}else{return mod.exports=defined[mod.map.id]={}}}},module:function(mod){if(mod.module){return mod.module}else{return mod.module={id:mod.map.id,uri:mod.map.url,config:function(){return config.config&&config.config[mod.map.id]||{}},exports:defined[mod.map.id]}}}};function cleanRegistry(id){delete registry[id]}function breakCycle(mod,traced,processed){var id=mod.map.id;if(mod.error){mod.emit("error",mod.error)}else{traced[id]=true;each(mod.depMaps,function(depMap,i){var depId=depMap.id,dep=registry[depId];if(dep&&!mod.depMatched[i]&&!processed[depId]){if(traced[depId]){mod.defineDep(i,defined[depId]);mod.check()}else{breakCycle(dep,traced,processed)}}});processed[id]=true}}function checkLoaded(){var map,modId,err,usingPathFallback,waitInterval=config.waitSeconds*1e3,expired=waitInterval&&context.startTime+waitInterval<(new Date).getTime(),noLoads=[],reqCalls=[],stillLoading=false,needCycleCheck=true;if(inCheckLoaded){return}inCheckLoaded=true;eachProp(registry,function(mod){map=mod.map;modId=map.id;if(!mod.enabled){return}if(!map.isDefine){reqCalls.push(mod)}if(!mod.error){if(!mod.inited&&expired){if(hasPathFallback(modId)){usingPathFallback=true;stillLoading=true}else{noLoads.push(modId);removeScript(modId)}}else if(!mod.inited&&mod.fetched&&map.isDefine){stillLoading=true;if(!map.prefix){return needCycleCheck=false}}}});if(expired&&noLoads.length){err=makeError("timeout","Load timeout for modules: "+noLoads,null,noLoads);err.contextName=context.contextName;return onError(err)}if(needCycleCheck){each(reqCalls,function(mod){breakCycle(mod,{},{})})}if((!expired||usingPathFallback)&&stillLoading){if((isBrowser||isWebWorker)&&!checkLoadedTimeoutId){checkLoadedTimeoutId=setTimeout(function(){checkLoadedTimeoutId=0;checkLoaded()},50)}}inCheckLoaded=false}Module=function(map){this.events=undefEvents[map.id]||{};this.map=map;this.shim=config.shim[map.id];this.depExports=[];this.depMaps=[];this.depMatched=[];this.pluginMaps={};this.depCount=0};Module.prototype={init:function(depMaps,factory,errback,options){options=options||{};if(this.inited){return}this.factory=factory;if(errback){this.on("error",errback)}else if(this.events.error){errback=bind(this,function(err){this.emit("error",err)})}this.depMaps=depMaps&&depMaps.slice(0);this.errback=errback;this.inited=true;this.ignore=options.ignore;if(options.enabled||this.enabled){this.enable()}else{this.check()}},defineDep:function(i,depExports){if(!this.depMatched[i]){this.depMatched[i]=true;this.depCount-=1;this.depExports[i]=depExports}},fetch:function(){if(this.fetched){return}this.fetched=true;context.startTime=(new Date).getTime();var map=this.map;if(this.shim){context.makeRequire(this.map,{enableBuildCallback:true})(this.shim.deps||[],bind(this,function(){return map.prefix?this.callPlugin():this.load()}))}else{return map.prefix?this.callPlugin():this.load()}},load:function(){var url=this.map.url;if(!urlFetched[url]){urlFetched[url]=true;context.load(this.map.id,url)}},check:function(){if(!this.enabled||this.enabling){return}var err,cjsModule,id=this.map.id,depExports=this.depExports,exports=this.exports,factory=this.factory;if(!this.inited){this.fetch()}else if(this.error){this.emit("error",this.error)}else if(!this.defining){this.defining=true;if(this.depCount<1&&!this.defined){if(isFunction(factory)){if(this.events.error){try{exports=context.execCb(id,factory,depExports,exports)}catch(e){err=e}}else{exports=context.execCb(id,factory,depExports,exports)}if(this.map.isDefine){cjsModule=this.module;if(cjsModule&&cjsModule.exports!==undefined&&cjsModule.exports!==this.exports){exports=cjsModule.exports}else if(exports===undefined&&this.usingExports){exports=this.exports}}if(err){err.requireMap=this.map;err.requireModules=[this.map.id];err.requireType="define";return onError(this.error=err)}}else{exports=factory}this.exports=exports;if(this.map.isDefine&&!this.ignore){defined[id]=exports;if(req.onResourceLoad){req.onResourceLoad(context,this.map,this.depMaps)}}delete registry[id];this.defined=true}this.defining=false;if(this.defined&&!this.defineEmitted){this.defineEmitted=true;this.emit("defined",this.exports);this.defineEmitComplete=true}}},callPlugin:function(){var map=this.map,id=map.id,pluginMap=makeModuleMap(map.prefix);this.depMaps.push(pluginMap);on(pluginMap,"defined",bind(this,function(plugin){var load,normalizedMap,normalizedMod,name=this.map.name,parentName=this.map.parentMap?this.map.parentMap.name:null,localRequire=context.makeRequire(map.parentMap,{enableBuildCallback:true,skipMap:true});if(this.map.unnormalized){if(plugin.normalize){name=plugin.normalize(name,function(name){return normalize(name,parentName,true)})||""}normalizedMap=makeModuleMap(map.prefix+"!"+name,this.map.parentMap);on(normalizedMap,"defined",bind(this,function(value){this.init([],function(){return value},null,{enabled:true,ignore:true})}));normalizedMod=registry[normalizedMap.id];if(normalizedMod){this.depMaps.push(normalizedMap);if(this.events.error){normalizedMod.on("error",bind(this,function(err){this.emit("error",err)}))}normalizedMod.enable()}return}load=bind(this,function(value){this.init([],function(){return value},null,{enabled:true})});load.error=bind(this,function(err){this.inited=true;this.error=err;err.requireModules=[id];eachProp(registry,function(mod){if(mod.map.id.indexOf(id+"_unnormalized")===0){cleanRegistry(mod.map.id)}});onError(err)});load.fromText=bind(this,function(text,textAlt){var moduleName=map.name,moduleMap=makeModuleMap(moduleName),hasInteractive=useInteractive;if(textAlt){text=textAlt}if(hasInteractive){useInteractive=false}getModule(moduleMap);try{req.exec(text)}catch(e){throw new Error("fromText eval for "+moduleName+" failed: "+e)}if(hasInteractive){useInteractive=true}this.depMaps.push(moduleMap);context.completeLoad(moduleName);localRequire([moduleName],load)});plugin.load(map.name,localRequire,load,config)}));context.enable(pluginMap,this);this.pluginMaps[pluginMap.id]=pluginMap},enable:function(){this.enabled=true;this.enabling=true;each(this.depMaps,bind(this,function(depMap,i){var id,mod,handler;if(typeof depMap==="string"){depMap=makeModuleMap(depMap,this.map.isDefine?this.map:this.map.parentMap,false,!this.skipMap);this.depMaps[i]=depMap;handler=handlers[depMap.id];if(handler){this.depExports[i]=handler(this);return}this.depCount+=1;on(depMap,"defined",bind(this,function(depExports){this.defineDep(i,depExports);this.check()}));if(this.errback){on(depMap,"error",this.errback)}}id=depMap.id;mod=registry[id];if(!handlers[id]&&mod&&!mod.enabled){context.enable(depMap,this)}}));eachProp(this.pluginMaps,bind(this,function(pluginMap){var mod=registry[pluginMap.id];if(mod&&!mod.enabled){context.enable(pluginMap,this)}}));this.enabling=false;this.check()},on:function(name,cb){var cbs=this.events[name];if(!cbs){cbs=this.events[name]=[]}cbs.push(cb)},emit:function(name,evt){each(this.events[name],function(cb){cb(evt)});if(name==="error"){delete this.events[name]}}};function callGetModule(args){getModule(makeModuleMap(args[0],null,true)).init(args[1],args[2])}function removeListener(node,func,name,ieName){if(node.detachEvent&&!isOpera){if(ieName){node.detachEvent(ieName,func)}}else{node.removeEventListener(name,func,false)}}function getScriptData(evt){var node=evt.currentTarget||evt.srcElement;removeListener(node,context.onScriptLoad,"load","onreadystatechange");removeListener(node,context.onScriptError,"error");return{node:node,id:node&&node.getAttribute("data-requiremodule")}}function intakeDefines(){var args;takeGlobalQueue();while(defQueue.length){args=defQueue.shift();if(args[0]===null){return onError(makeError("mismatch","Mismatched anonymous define() module: "+args[args.length-1]))}else{callGetModule(args)}}}context={config:config,contextName:contextName,registry:registry,defined:defined,urlFetched:urlFetched,defQueue:defQueue,Module:Module,makeModuleMap:makeModuleMap,nextTick:req.nextTick,configure:function(cfg){if(cfg.baseUrl){if(cfg.baseUrl.charAt(cfg.baseUrl.length-1)!=="/"){cfg.baseUrl+="/"}}var pkgs=config.pkgs,shim=config.shim,objs={paths:true,config:true,map:true};eachProp(cfg,function(value,prop){if(objs[prop]){if(prop==="map"){mixin(config[prop],value,true,true)}else{mixin(config[prop],value,true)}}else{config[prop]=value}});if(cfg.shim){eachProp(cfg.shim,function(value,id){if(isArray(value)){value={deps:value}}if(value.exports&&!value.exportsFn){value.exportsFn=context.makeShimExports(value)}shim[id]=value});config.shim=shim}if(cfg.packages){each(cfg.packages,function(pkgObj){var location;pkgObj=typeof pkgObj==="string"?{name:pkgObj}:pkgObj;location=pkgObj.location;pkgs[pkgObj.name]={name:pkgObj.name,location:location||pkgObj.name,main:(pkgObj.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}});config.pkgs=pkgs}eachProp(registry,function(mod,id){if(!mod.inited&&!mod.map.unnormalized){mod.map=makeModuleMap(id)}});if(cfg.deps||cfg.callback){context.require(cfg.deps||[],cfg.callback)}},makeShimExports:function(value){function fn(){var ret;if(value.init){ret=value.init.apply(global,arguments)}return ret||getGlobal(value.exports)}return fn},makeRequire:function(relMap,options){options=options||{};function localRequire(deps,callback,errback){var id,map,requireMod;if(options.enableBuildCallback&&callback&&isFunction(callback)){callback.__requireJsBuild=true}if(typeof deps==="string"){if(isFunction(callback)){return onError(makeError("requireargs","Invalid require call"),errback)}if(relMap&&handlers[deps]){return handlers[deps](registry[relMap.id])}if(req.get){return req.get(context,deps,relMap)}map=makeModuleMap(deps,relMap,false,true);id=map.id;if(!hasProp(defined,id)){return onError(makeError("notloaded",'Module name "'+id+'" has not been loaded yet for context: '+contextName+(relMap?"":". Use require([])")))}return defined[id]}intakeDefines();context.nextTick(function(){intakeDefines();requireMod=getModule(makeModuleMap(null,relMap));requireMod.skipMap=options.skipMap;requireMod.init(deps,callback,errback,{enabled:true});checkLoaded()});return localRequire}mixin(localRequire,{isBrowser:isBrowser,toUrl:function(moduleNamePlusExt){var index=moduleNamePlusExt.lastIndexOf("."),ext=null;if(index!==-1){ext=moduleNamePlusExt.substring(index,moduleNamePlusExt.length);moduleNamePlusExt=moduleNamePlusExt.substring(0,index)}return context.nameToUrl(normalize(moduleNamePlusExt,relMap&&relMap.id,true),ext)},defined:function(id){return hasProp(defined,makeModuleMap(id,relMap,false,true).id)},specified:function(id){id=makeModuleMap(id,relMap,false,true).id;return hasProp(defined,id)||hasProp(registry,id)}});if(!relMap){localRequire.undef=function(id){takeGlobalQueue();var map=makeModuleMap(id,relMap,true),mod=registry[id];delete defined[id];delete urlFetched[map.url];delete undefEvents[id];if(mod){if(mod.events.defined){undefEvents[id]=mod.events}cleanRegistry(id)}}}return localRequire},enable:function(depMap,parent){var mod=registry[depMap.id];if(mod){getModule(depMap).enable()}},completeLoad:function(moduleName){var found,args,mod,shim=config.shim[moduleName]||{},shExports=shim.exports;takeGlobalQueue();while(defQueue.length){args=defQueue.shift();if(args[0]===null){args[0]=moduleName;if(found){break}found=true}else if(args[0]===moduleName){found=true}callGetModule(args)}mod=registry[moduleName];if(!found&&!defined[moduleName]&&mod&&!mod.inited){if(config.enforceDefine&&(!shExports||!getGlobal(shExports))){if(hasPathFallback(moduleName)){return}else{return onError(makeError("nodefine","No define call for "+moduleName,null,[moduleName]))}}else{callGetModule([moduleName,shim.deps||[],shim.exportsFn])}}checkLoaded()},nameToUrl:function(moduleName,ext){var paths,pkgs,pkg,pkgPath,syms,i,parentModule,url,parentPath;if(req.jsExtRegExp.test(moduleName)){url=moduleName+(ext||"")}else{paths=config.paths;pkgs=config.pkgs;syms=moduleName.split("/");for(i=syms.length;i>0;i-=1){parentModule=syms.slice(0,i).join("/");pkg=pkgs[parentModule];parentPath=paths[parentModule];if(parentPath){if(isArray(parentPath)){parentPath=parentPath[0]}syms.splice(0,i,parentPath);break}else if(pkg){if(moduleName===pkg.name){pkgPath=pkg.location+"/"+pkg.main}else{pkgPath=pkg.location}syms.splice(0,i,pkgPath);break}}url=syms.join("/");url+=ext||(/\?/.test(url)?"":".js");url=(url.charAt(0)==="/"||url.match(/^[\w\+\.\-]+:/)?"":config.baseUrl)+url}return config.urlArgs?url+((url.indexOf("?")===-1?"?":"&")+config.urlArgs):url},load:function(id,url){req.load(context,id,url)},execCb:function(name,callback,args,exports){return callback.apply(exports,args)},onScriptLoad:function(evt){if(evt.type==="load"||readyRegExp.test((evt.currentTarget||evt.srcElement).readyState)){interactiveScript=null;var data=getScriptData(evt);context.completeLoad(data.id)}},onScriptError:function(evt){var data=getScriptData(evt);if(!hasPathFallback(data.id)){return onError(makeError("scripterror","Script error",evt,[data.id]))}}};context.require=context.makeRequire();return context}req=requirejs=function(deps,callback,errback,optional){var context,config,contextName=defContextName;if(!isArray(deps)&&typeof deps!=="string"){config=deps;if(isArray(callback)){deps=callback;callback=errback;errback=optional}else{deps=[]}}if(config&&config.context){contextName=config.context}context=contexts[contextName];if(!context){context=contexts[contextName]=req.s.newContext(contextName)}if(config){context.configure(config)}return context.require(deps,callback,errback)};req.config=function(config){return req(config)};req.nextTick=typeof setTimeout!=="undefined"?function(fn){setTimeout(fn,4)}:function(fn){fn()};if(!require){require=req}req.version=version;req.jsExtRegExp=/^\/|:|\?|\.js$/;req.isBrowser=isBrowser;s=req.s={contexts:contexts,newContext:newContext};req({});each(["toUrl","undef","defined","specified"],function(prop){req[prop]=function(){var ctx=contexts[defContextName];return ctx.require[prop].apply(ctx,arguments)}});if(isBrowser){head=s.head=document.getElementsByTagName("head")[0];baseElement=document.getElementsByTagName("base")[0];if(baseElement){head=s.head=baseElement.parentNode}}req.onError=function(err){throw err};req.load=function(context,moduleName,url){var config=context&&context.config||{},node;if(isBrowser){node=config.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");node.type=config.scriptType||"text/javascript";node.charset="utf-8";node.async=true;node.setAttribute("data-requirecontext",context.contextName);node.setAttribute("data-requiremodule",moduleName);if(node.attachEvent&&!(node.attachEvent.toString&&node.attachEvent.toString().indexOf("[native code")<0)&&!isOpera){useInteractive=true;node.attachEvent("onreadystatechange",context.onScriptLoad)}else{node.addEventListener("load",context.onScriptLoad,false);node.addEventListener("error",context.onScriptError,false)}node.src=url;currentlyAddingScript=node;if(baseElement){head.insertBefore(node,baseElement)}else{head.appendChild(node)}currentlyAddingScript=null;return node}else if(isWebWorker){importScripts(url);context.completeLoad(moduleName)}};function getInteractiveScript(){if(interactiveScript&&interactiveScript.readyState==="interactive"){return interactiveScript}eachReverse(scripts(),function(script){if(script.readyState==="interactive"){return interactiveScript=script}});return interactiveScript}if(isBrowser){eachReverse(scripts(),function(script){if(!head){head=script.parentNode}dataMain=script.getAttribute("data-main");if(dataMain){if(!cfg.baseUrl){src=dataMain.split("/");mainScript=src.pop();subPath=src.length?src.join("/")+"/":"./";cfg.baseUrl=subPath;dataMain=mainScript}dataMain=dataMain.replace(jsSuffixRegExp,"");cfg.deps=cfg.deps?cfg.deps.concat(dataMain):[dataMain];return true}})}define=function(name,deps,callback){var node,context;if(typeof name!=="string"){callback=deps;deps=name;name=null}if(!isArray(deps)){callback=deps;deps=[]}if(!deps.length&&isFunction(callback)){if(callback.length){callback.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(match,dep){deps.push(dep)});deps=(callback.length===1?["require"]:["require","exports","module"]).concat(deps)}}if(useInteractive){node=currentlyAddingScript||getInteractiveScript();if(node){if(!name){name=node.getAttribute("data-requiremodule")}context=contexts[node.getAttribute("data-requirecontext")]}}(context?context.defQueue:globalDefQueue).push([name,deps,callback])};define.amd={jQuery:true};req.exec=function(text){return eval(text)};req(cfg)})(this);+function($){"use strict";var dismiss='[data-dismiss="alert"]';var Alert=function(el){$(el).on("click",dismiss,this.close)};Alert.prototype.close=function(e){var $this=$(this);var selector=$this.attr("data-target");if(!selector){selector=$this.attr("href");selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,"")}var $parent=$(selector);if(e)e.preventDefault();if(!$parent.length){$parent=$this.hasClass("alert")?$this:$this.parent()}$parent.trigger(e=$.Event("close.bs.alert"));if(e.isDefaultPrevented())return;$parent.removeClass("in");function removeElement(){$parent.trigger("closed.bs.alert").remove()}$.support.transition&&$parent.hasClass("fade")?$parent.one($.support.transition.end,removeElement).emulateTransitionEnd(150):removeElement()};var old=$.fn.alert;$.fn.alert=function(option){return this.each(function(){var $this=$(this);var data=$this.data("bs.alert");if(!data)$this.data("bs.alert",data=new Alert(this));if(typeof option=="string")data[option].call($this)})};$.fn.alert.Constructor=Alert;$.fn.alert.noConflict=function(){$.fn.alert=old;return this};$(document).on("click.bs.alert.data-api",dismiss,Alert.prototype.close)}(window.jQuery);+function($){"use strict";var Button=function(element,options){this.$element=$(element);this.options=$.extend({},Button.DEFAULTS,options)};Button.DEFAULTS={loadingText:"loading..."};Button.prototype.setState=function(state){var d="disabled";var $el=this.$element;var val=$el.is("input")?"val":"html";var data=$el.data();state=state+"Text";if(!data.resetText)$el.data("resetText",$el[val]());$el[val](data[state]||this.options[state]);setTimeout(function(){state=="loadingText"?$el.addClass(d).attr(d,d):$el.removeClass(d).removeAttr(d)},0)};Button.prototype.toggle=function(){var $parent=this.$element.closest('[data-toggle="buttons"]');if($parent.length){var $input=this.$element.find("input").prop("checked",!this.$element.hasClass("active")).trigger("change");if($input.prop("type")==="radio")$parent.find(".active").removeClass("active")}this.$element.toggleClass("active")};var old=$.fn.button;$.fn.button=function(option){return this.each(function(){var $this=$(this);var data=$this.data("bs.button");var options=typeof option=="object"&&option;if(!data)$this.data("bs.button",data=new Button(this,options));if(option=="toggle")data.toggle();
else if(option)data.setState(option)})};$.fn.button.Constructor=Button;$.fn.button.noConflict=function(){$.fn.button=old;return this};$(document).on("click.bs.button.data-api","[data-toggle^=button]",function(e){var $btn=$(e.target);if(!$btn.hasClass("btn"))$btn=$btn.closest(".btn");$btn.button("toggle");e.preventDefault()})}(window.jQuery);+function($){"use strict";var Carousel=function(element,options){this.$element=$(element);this.$indicators=this.$element.find(".carousel-indicators");this.options=options;this.paused=this.sliding=this.interval=this.$active=this.$items=null;this.options.pause=="hover"&&this.$element.on("mouseenter",$.proxy(this.pause,this)).on("mouseleave",$.proxy(this.cycle,this))};Carousel.DEFAULTS={interval:5e3,pause:"hover",wrap:true};Carousel.prototype.cycle=function(e){e||(this.paused=false);this.interval&&clearInterval(this.interval);this.options.interval&&!this.paused&&(this.interval=setInterval($.proxy(this.next,this),this.options.interval));return this};Carousel.prototype.getActiveIndex=function(){this.$active=this.$element.find(".item.active");this.$items=this.$active.parent().children();return this.$items.index(this.$active)};Carousel.prototype.to=function(pos){var that=this;var activeIndex=this.getActiveIndex();if(pos>this.$items.length-1||pos<0)return;if(this.sliding)return this.$element.one("slid",function(){that.to(pos)});if(activeIndex==pos)return this.pause().cycle();return this.slide(pos>activeIndex?"next":"prev",$(this.$items[pos]))};Carousel.prototype.pause=function(e){e||(this.paused=true);if(this.$element.find(".next, .prev").length&&$.support.transition.end){this.$element.trigger($.support.transition.end);this.cycle(true)}this.interval=clearInterval(this.interval);return this};Carousel.prototype.next=function(){if(this.sliding)return;return this.slide("next")};Carousel.prototype.prev=function(){if(this.sliding)return;return this.slide("prev")};Carousel.prototype.slide=function(type,next){var $active=this.$element.find(".item.active");var $next=next||$active[type]();var isCycling=this.interval;var direction=type=="next"?"left":"right";var fallback=type=="next"?"first":"last";var that=this;if(!$next.length){if(!this.options.wrap)return;$next=this.$element.find(".item")[fallback]()}this.sliding=true;isCycling&&this.pause();var e=$.Event("slide.bs.carousel",{relatedTarget:$next[0],direction:direction});if($next.hasClass("active"))return;if(this.$indicators.length){this.$indicators.find(".active").removeClass("active");this.$element.one("slid",function(){var $nextIndicator=$(that.$indicators.children()[that.getActiveIndex()]);$nextIndicator&&$nextIndicator.addClass("active")})}if($.support.transition&&this.$element.hasClass("slide")){this.$element.trigger(e);if(e.isDefaultPrevented())return;$next.addClass(type);$next[0].offsetWidth;$active.addClass(direction);$next.addClass(direction);$active.one($.support.transition.end,function(){$next.removeClass([type,direction].join(" ")).addClass("active");$active.removeClass(["active",direction].join(" "));that.sliding=false;setTimeout(function(){that.$element.trigger("slid")},0)}).emulateTransitionEnd(600)}else{this.$element.trigger(e);if(e.isDefaultPrevented())return;$active.removeClass("active");$next.addClass("active");this.sliding=false;this.$element.trigger("slid")}isCycling&&this.cycle();return this};var old=$.fn.carousel;$.fn.carousel=function(option){return this.each(function(){var $this=$(this);var data=$this.data("bs.carousel");var options=$.extend({},Carousel.DEFAULTS,$this.data(),typeof option=="object"&&option);var action=typeof option=="string"?option:options.slide;if(!data)$this.data("bs.carousel",data=new Carousel(this,options));if(typeof option=="number")data.to(option);else if(action)data[action]();else if(options.interval)data.pause().cycle()})};$.fn.carousel.Constructor=Carousel;$.fn.carousel.noConflict=function(){$.fn.carousel=old;return this};$(document).on("click.bs.carousel.data-api","[data-slide], [data-slide-to]",function(e){var $this=$(this),href;var $target=$($this.attr("data-target")||(href=$this.attr("href"))&&href.replace(/.*(?=#[^\s]+$)/,""));var options=$.extend({},$target.data(),$this.data());var slideIndex=$this.attr("data-slide-to");if(slideIndex)options.interval=false;$target.carousel(options);if(slideIndex=$this.attr("data-slide-to")){$target.data("bs.carousel").to(slideIndex)}e.preventDefault()});$(window).on("load",function(){$('[data-ride="carousel"]').each(function(){var $carousel=$(this);$carousel.carousel($carousel.data())})})}(window.jQuery);+function($){"use strict";var backdrop=".dropdown-backdrop";var toggle="[data-toggle=dropdown]";var Dropdown=function(element){var $el=$(element).on("click.bs.dropdown",this.toggle)};Dropdown.prototype.toggle=function(e){var $this=$(this);if($this.is(".disabled, :disabled"))return;var $parent=getParent($this);var isActive=$parent.hasClass("open");clearMenus();if(!isActive){if("ontouchstart"in document.documentElement&&!$parent.closest(".navbar-nav").length){$('<div class="dropdown-backdrop"/>').insertAfter($(this)).on("click",clearMenus)}$parent.trigger(e=$.Event("show.bs.dropdown"));if(e.isDefaultPrevented())return;$parent.toggleClass("open").trigger("shown.bs.dropdown");$this.focus()}return false};Dropdown.prototype.keydown=function(e){if(!/(38|40|27)/.test(e.keyCode))return;var $this=$(this);e.preventDefault();e.stopPropagation();if($this.is(".disabled, :disabled"))return;var $parent=getParent($this);var isActive=$parent.hasClass("open");if(!isActive||isActive&&e.keyCode==27){if(e.which==27)$parent.find(toggle).focus();return $this.click()}var $items=$("[role=menu] li:not(.divider):visible a",$parent);if(!$items.length)return;var index=$items.index($items.filter(":focus"));if(e.keyCode==38&&index>0)index--;if(e.keyCode==40&&index<$items.length-1)index++;if(!~index)index=0;$items.eq(index).focus()};function clearMenus(){$(backdrop).remove();$(toggle).each(function(e){var $parent=getParent($(this));if(!$parent.hasClass("open"))return;$parent.trigger(e=$.Event("hide.bs.dropdown"));if(e.isDefaultPrevented())return;$parent.removeClass("open").trigger("hidden.bs.dropdown")})}function getParent($this){var selector=$this.attr("data-target");if(!selector){selector=$this.attr("href");selector=selector&&/#/.test(selector)&&selector.replace(/.*(?=#[^\s]*$)/,"")}var $parent=selector&&$(selector);return $parent&&$parent.length?$parent:$this.parent()}var old=$.fn.dropdown;$.fn.dropdown=function(option){return this.each(function(){var $this=$(this);var data=$this.data("dropdown");if(!data)$this.data("dropdown",data=new Dropdown(this));if(typeof option=="string")data[option].call($this)})};$.fn.dropdown.Constructor=Dropdown;$.fn.dropdown.noConflict=function(){$.fn.dropdown=old;return this};$(document).on("click.bs.dropdown.data-api",clearMenus).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",toggle,Dropdown.prototype.toggle).on("keydown.bs.dropdown.data-api",toggle+", [role=menu]",Dropdown.prototype.keydown)}(window.jQuery);+function($){"use strict";var Modal=function(element,options){this.options=options;this.$element=$(element);this.$backdrop=this.isShown=null;if(this.options.remote)this.$element.load(this.options.remote)};Modal.DEFAULTS={backdrop:true,keyboard:true,show:true};Modal.prototype.toggle=function(_relatedTarget){return this[!this.isShown?"show":"hide"](_relatedTarget)};Modal.prototype.show=function(_relatedTarget){var that=this;var e=$.Event("show.bs.modal",{relatedTarget:_relatedTarget});this.$element.trigger(e);if(this.isShown||e.isDefaultPrevented())return;this.isShown=true;this.escape();this.$element.on("click.dismiss.modal",'[data-dismiss="modal"]',$.proxy(this.hide,this));this.backdrop(function(){var transition=$.support.transition&&that.$element.hasClass("fade");if(!that.$element.parent().length){that.$element.appendTo(document.body)}that.$element.show();if(transition){that.$element[0].offsetWidth}that.$element.addClass("in").attr("aria-hidden",false);that.enforceFocus();var e=$.Event("shown.bs.modal",{relatedTarget:_relatedTarget});transition?that.$element.find(".modal-dialog").one($.support.transition.end,function(){that.$element.focus().trigger(e)}).emulateTransitionEnd(300):that.$element.focus().trigger(e)})};Modal.prototype.hide=function(e){if(e)e.preventDefault();e=$.Event("hide.bs.modal");this.$element.trigger(e);if(!this.isShown||e.isDefaultPrevented())return;this.isShown=false;this.escape();$(document).off("focusin.bs.modal");this.$element.removeClass("in").attr("aria-hidden",true).off("click.dismiss.modal");$.support.transition&&this.$element.hasClass("fade")?this.$element.one($.support.transition.end,$.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal()};Modal.prototype.enforceFocus=function(){$(document).off("focusin.bs.modal").on("focusin.bs.modal",$.proxy(function(e){if(this.$element[0]!==e.target&&!this.$element.has(e.target).length){this.$element.focus()}},this))};Modal.prototype.escape=function(){if(this.isShown&&this.options.keyboard){this.$element.on("keyup.dismiss.bs.modal",$.proxy(function(e){e.which==27&&this.hide()},this))}else if(!this.isShown){this.$element.off("keyup.dismiss.bs.modal")}};Modal.prototype.hideModal=function(){var that=this;this.$element.hide();this.backdrop(function(){that.removeBackdrop();that.$element.trigger("hidden.bs.modal")})};Modal.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove();this.$backdrop=null};Modal.prototype.backdrop=function(callback){var that=this;var animate=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var doAnimate=$.support.transition&&animate;this.$backdrop=$('<div class="modal-backdrop '+animate+'" />').appendTo(document.body);this.$element.on("click.dismiss.modal",$.proxy(function(e){if(e.target!==e.currentTarget)return;this.options.backdrop=="static"?this.$element[0].focus.call(this.$element[0]):this.hide.call(this)},this));if(doAnimate)this.$backdrop[0].offsetWidth;this.$backdrop.addClass("in");if(!callback)return;doAnimate?this.$backdrop.one($.support.transition.end,callback).emulateTransitionEnd(150):callback()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");$.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one($.support.transition.end,callback).emulateTransitionEnd(150):callback()}else if(callback){callback()}};var old=$.fn.modal;$.fn.modal=function(option,_relatedTarget){return this.each(function(){var $this=$(this);var data=$this.data("bs.modal");var options=$.extend({},Modal.DEFAULTS,$this.data(),typeof option=="object"&&option);if(!data)$this.data("bs.modal",data=new Modal(this,options));if(typeof option=="string")data[option](_relatedTarget);else if(options.show)data.show(_relatedTarget)})};$.fn.modal.Constructor=Modal;$.fn.modal.noConflict=function(){$.fn.modal=old;return this};$(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(e){var $this=$(this);var href=$this.attr("href");var $target=$($this.attr("data-target")||href&&href.replace(/.*(?=#[^\s]+$)/,""));var option=$target.data("modal")?"toggle":$.extend({remote:!/#/.test(href)&&href},$target.data(),$this.data());e.preventDefault();$target.modal(option,this).one("hide",function(){$this.is(":visible")&&$this.focus()})});$(document).on("show.bs.modal",".modal",function(){$(document.body).addClass("modal-open")}).on("hidden.bs.modal",".modal",function(){$(document.body).removeClass("modal-open")})}(window.jQuery);+function($){"use strict";var Tooltip=function(element,options){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null;this.init("tooltip",element,options)};Tooltip.DEFAULTS={animation:true,placement:"top",selector:false,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:false,container:false};Tooltip.prototype.init=function(type,element,options){this.enabled=true;this.type=type;this.$element=$(element);this.options=this.getOptions(options);var triggers=this.options.trigger.split(" ");for(var i=triggers.length;i--;){var trigger=triggers[i];if(trigger=="click"){this.$element.on("click."+this.type,this.options.selector,$.proxy(this.toggle,this))}else if(trigger!="manual"){var eventIn=trigger=="hover"?"mouseenter":"focus";var eventOut=trigger=="hover"?"mouseleave":"blur";this.$element.on(eventIn+"."+this.type,this.options.selector,$.proxy(this.enter,this));this.$element.on(eventOut+"."+this.type,this.options.selector,$.proxy(this.leave,this))}}this.options.selector?this._options=$.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()};Tooltip.prototype.getDefaults=function(){return Tooltip.DEFAULTS};Tooltip.prototype.getOptions=function(options){options=$.extend({},this.getDefaults(),this.$element.data(),options);if(options.delay&&typeof options.delay=="number"){options.delay={show:options.delay,hide:options.delay}}return options};Tooltip.prototype.getDelegateOptions=function(){var options={};var defaults=this.getDefaults();this._options&&$.each(this._options,function(key,value){if(defaults[key]!=value)options[key]=value});return options};Tooltip.prototype.enter=function(obj){var self=obj instanceof this.constructor?obj:$(obj.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);clearTimeout(self.timeout);self.hoverState="in";if(!self.options.delay||!self.options.delay.show)return self.show();self.timeout=setTimeout(function(){if(self.hoverState=="in")self.show()},self.options.delay.show)};Tooltip.prototype.leave=function(obj){var self=obj instanceof this.constructor?obj:$(obj.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);clearTimeout(self.timeout);self.hoverState="out";if(!self.options.delay||!self.options.delay.hide)return self.hide();self.timeout=setTimeout(function(){if(self.hoverState=="out")self.hide()},self.options.delay.hide)};Tooltip.prototype.show=function(){var e=$.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(e);if(e.isDefaultPrevented())return;var $tip=this.tip();this.setContent();if(this.options.animation)$tip.addClass("fade");var placement=typeof this.options.placement=="function"?this.options.placement.call(this,$tip[0],this.$element[0]):this.options.placement;var autoToken=/\s?auto?\s?/i;var autoPlace=autoToken.test(placement);if(autoPlace)placement=placement.replace(autoToken,"")||"top";$tip.detach().css({top:0,left:0,display:"block"}).addClass(placement);this.options.container?$tip.appendTo(this.options.container):$tip.insertAfter(this.$element);var pos=this.getPosition();var actualWidth=$tip[0].offsetWidth;var actualHeight=$tip[0].offsetHeight;if(autoPlace){var $parent=this.$element.parent();var orgPlacement=placement;var docScroll=document.documentElement.scrollTop||document.body.scrollTop;var parentWidth=this.options.container=="body"?window.innerWidth:$parent.outerWidth();var parentHeight=this.options.container=="body"?window.innerHeight:$parent.outerHeight();var parentLeft=this.options.container=="body"?0:$parent.offset().left;placement=placement=="bottom"&&pos.top+pos.height+actualHeight-docScroll>parentHeight?"top":placement=="top"&&pos.top-docScroll-actualHeight<0?"bottom":placement=="right"&&pos.right+actualWidth>parentWidth?"left":placement=="left"&&pos.left-actualWidth<parentLeft?"right":placement;$tip.removeClass(orgPlacement).addClass(placement)}var calculatedOffset=this.getCalculatedOffset(placement,pos,actualWidth,actualHeight);this.applyPlacement(calculatedOffset,placement);this.$element.trigger("shown.bs."+this.type)}};Tooltip.prototype.applyPlacement=function(offset,placement){var replace;var $tip=this.tip();var width=$tip[0].offsetWidth;var height=$tip[0].offsetHeight;var marginTop=parseInt($tip.css("margin-top"),10);var marginLeft=parseInt($tip.css("margin-left"),10);if(isNaN(marginTop))marginTop=0;if(isNaN(marginLeft))marginLeft=0;offset.top=offset.top+marginTop;offset.left=offset.left+marginLeft;$tip.offset(offset).addClass("in");var actualWidth=$tip[0].offsetWidth;var actualHeight=$tip[0].offsetHeight;if(placement=="top"&&actualHeight!=height){replace=true;offset.top=offset.top+height-actualHeight}if(/bottom|top/.test(placement)){var delta=0;if(offset.left<0){delta=offset.left*-2;offset.left=0;$tip.offset(offset);actualWidth=$tip[0].offsetWidth;actualHeight=$tip[0].offsetHeight}this.replaceArrow(delta-width+actualWidth,actualWidth,"left")}else{this.replaceArrow(actualHeight-height,actualHeight,"top")}if(replace)$tip.offset(offset)};Tooltip.prototype.replaceArrow=function(delta,dimension,position){this.arrow().css(position,delta?50*(1-delta/dimension)+"%":"")};Tooltip.prototype.setContent=function(){var $tip=this.tip();var title=this.getTitle();$tip.find(".tooltip-inner")[this.options.html?"html":"text"](title);$tip.removeClass("fade in top bottom left right")};Tooltip.prototype.hide=function(){var that=this;var $tip=this.tip();var e=$.Event("hide.bs."+this.type);function complete(){if(that.hoverState!="in")$tip.detach()}this.$element.trigger(e);if(e.isDefaultPrevented())return;$tip.removeClass("in");$.support.transition&&this.$tip.hasClass("fade")?$tip.one($.support.transition.end,complete).emulateTransitionEnd(150):complete();this.$element.trigger("hidden.bs."+this.type);return this};Tooltip.prototype.fixTitle=function(){var $e=this.$element;if($e.attr("title")||typeof $e.attr("data-original-title")!="string"){$e.attr("data-original-title",$e.attr("title")||"").attr("title","")}};Tooltip.prototype.hasContent=function(){return this.getTitle()};Tooltip.prototype.getPosition=function(){var el=this.$element[0];return $.extend({},typeof el.getBoundingClientRect=="function"?el.getBoundingClientRect():{width:el.offsetWidth,height:el.offsetHeight},this.$element.offset())};Tooltip.prototype.getCalculatedOffset=function(placement,pos,actualWidth,actualHeight){return placement=="bottom"?{top:pos.top+pos.height,left:pos.left+pos.width/2-actualWidth/2}:placement=="top"?{top:pos.top-actualHeight,left:pos.left+pos.width/2-actualWidth/2}:placement=="left"?{top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth}:{top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width}};Tooltip.prototype.getTitle=function(){var title;var $e=this.$element;var o=this.options;title=$e.attr("data-original-title")||(typeof o.title=="function"?o.title.call($e[0]):o.title);return title};Tooltip.prototype.tip=function(){return this.$tip=this.$tip||$(this.options.template)};Tooltip.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")};Tooltip.prototype.validate=function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}};Tooltip.prototype.enable=function(){this.enabled=true};Tooltip.prototype.disable=function(){this.enabled=false};Tooltip.prototype.toggleEnabled=function(){this.enabled=!this.enabled};Tooltip.prototype.toggle=function(e){var self=e?$(e.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type):this;self.tip().hasClass("in")?self.leave(self):self.enter(self)};Tooltip.prototype.destroy=function(){this.hide().$element.off("."+this.type).removeData("bs."+this.type)};var old=$.fn.tooltip;$.fn.tooltip=function(option){return this.each(function(){var $this=$(this);var data=$this.data("bs.tooltip");var options=typeof option=="object"&&option;if(!data)$this.data("bs.tooltip",data=new Tooltip(this,options));if(typeof option=="string")data[option]()})};$.fn.tooltip.Constructor=Tooltip;$.fn.tooltip.noConflict=function(){$.fn.tooltip=old;return this}}(window.jQuery);+function($){"use strict";var Popover=function(element,options){this.init("popover",element,options)};if(!$.fn.tooltip)throw new Error("Popover requires tooltip.js");Popover.DEFAULTS=$.extend({},$.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'});Popover.prototype=$.extend({},$.fn.tooltip.Constructor.prototype);Popover.prototype.constructor=Popover;Popover.prototype.getDefaults=function(){return Popover.DEFAULTS};Popover.prototype.setContent=function(){var $tip=this.tip();var title=this.getTitle();var content=this.getContent();$tip.find(".popover-title")[this.options.html?"html":"text"](title);$tip.find(".popover-content")[this.options.html?"html":"text"](content);$tip.removeClass("fade top bottom left right in");if(!$tip.find(".popover-title").html())$tip.find(".popover-title").hide()};Popover.prototype.hasContent=function(){return this.getTitle()||this.getContent()};Popover.prototype.getContent=function(){var $e=this.$element;var o=this.options;return $e.attr("data-content")||(typeof o.content=="function"?o.content.call($e[0]):o.content)};Popover.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};Popover.prototype.tip=function(){if(!this.$tip)this.$tip=$(this.options.template);return this.$tip};var old=$.fn.popover;$.fn.popover=function(option){return this.each(function(){var $this=$(this);var data=$this.data("bs.popover");var options=typeof option=="object"&&option;if(!data)$this.data("bs.popover",data=new Popover(this,options));if(typeof option=="string")data[option]()})};$.fn.popover.Constructor=Popover;$.fn.popover.noConflict=function(){$.fn.popover=old;return this}}(window.jQuery);+function($){"use strict";var Tab=function(element){this.element=$(element)};Tab.prototype.show=function(){var $this=this.element;var $ul=$this.closest("ul:not(.dropdown-menu)");var selector=$this.attr("data-target");if(!selector){selector=$this.attr("href");selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,"")}if($this.parent("li").hasClass("active"))return;var previous=$ul.find(".active:last a")[0];var e=$.Event("show.bs.tab",{relatedTarget:previous});$this.trigger(e);if(e.isDefaultPrevented())return;var $target=$(selector);this.activate($this.parent("li"),$ul);this.activate($target,$target.parent(),function(){$this.trigger({type:"shown.bs.tab",relatedTarget:previous})})};Tab.prototype.activate=function(element,container,callback){var $active=container.find("> .active");var transition=callback&&$.support.transition&&$active.hasClass("fade");function next(){$active.removeClass("active").find("> .dropdown-menu > .active").removeClass("active");element.addClass("active");if(transition){element[0].offsetWidth;element.addClass("in")}else{element.removeClass("fade")}if(element.parent(".dropdown-menu")){element.closest("li.dropdown").addClass("active")}callback&&callback()}transition?$active.one($.support.transition.end,next).emulateTransitionEnd(150):next();$active.removeClass("in")};var old=$.fn.tab;$.fn.tab=function(option){return this.each(function(){var $this=$(this);var data=$this.data("bs.tab");if(!data)$this.data("bs.tab",data=new Tab(this));if(typeof option=="string")data[option]()})};$.fn.tab.Constructor=Tab;$.fn.tab.noConflict=function(){$.fn.tab=old;return this};$(document).on("click.bs.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(e){e.preventDefault();$(this).tab("show")})}(window.jQuery);+function($){"use strict";var Affix=function(element,options){this.options=$.extend({},Affix.DEFAULTS,options);this.$window=$(window).on("scroll.bs.affix.data-api",$.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",$.proxy(this.checkPositionWithEventLoop,this));this.$element=$(element);this.affixed=this.unpin=null;this.checkPosition()};Affix.RESET="affix affix-top affix-bottom";Affix.DEFAULTS={offset:0};Affix.prototype.checkPositionWithEventLoop=function(){setTimeout($.proxy(this.checkPosition,this),1)};Affix.prototype.checkPosition=function(){if(!this.$element.is(":visible"))return;var scrollHeight=$(document).height();var scrollTop=this.$window.scrollTop();var position=this.$element.offset();var offset=this.options.offset;var offsetTop=offset.top;var offsetBottom=offset.bottom;if(typeof offset!="object")offsetBottom=offsetTop=offset;if(typeof offsetTop=="function")offsetTop=offset.top();if(typeof offsetBottom=="function")offsetBottom=offset.bottom();var affix=this.unpin!=null&&scrollTop+this.unpin<=position.top?false:offsetBottom!=null&&position.top+this.$element.height()>=scrollHeight-offsetBottom?"bottom":offsetTop!=null&&scrollTop<=offsetTop?"top":false;if(this.affixed===affix)return;if(this.unpin)this.$element.css("top","");this.affixed=affix;this.unpin=affix=="bottom"?position.top-scrollTop:null;this.$element.removeClass(Affix.RESET).addClass("affix"+(affix?"-"+affix:""));if(affix=="bottom"){this.$element.offset({top:document.body.offsetHeight-offsetBottom-this.$element.height()})}};var old=$.fn.affix;$.fn.affix=function(option){return this.each(function(){var $this=$(this);var data=$this.data("bs.affix");var options=typeof option=="object"&&option;if(!data)$this.data("bs.affix",data=new Affix(this,options));if(typeof option=="string")data[option]()})};$.fn.affix.Constructor=Affix;$.fn.affix.noConflict=function(){$.fn.affix=old;return this};$(window).on("load",function(){$('[data-spy="affix"]').each(function(){var $spy=$(this);var data=$spy.data();data.offset=data.offset||{};if(data.offsetBottom)data.offset.bottom=data.offsetBottom;if(data.offsetTop)data.offset.top=data.offsetTop;$spy.affix(data)})})}(window.jQuery);+function($){"use strict";var Collapse=function(element,options){this.$element=$(element);this.options=$.extend({},Collapse.DEFAULTS,options);this.transitioning=null;if(this.options.parent)this.$parent=$(this.options.parent);if(this.options.toggle)this.toggle()};Collapse.DEFAULTS={toggle:true};Collapse.prototype.dimension=function(){var hasWidth=this.$element.hasClass("width");return hasWidth?"width":"height"};Collapse.prototype.show=function(){if(this.transitioning||this.$element.hasClass("in"))return;var startEvent=$.Event("show.bs.collapse");this.$element.trigger(startEvent);if(startEvent.isDefaultPrevented())return;var actives=this.$parent&&this.$parent.find("> .panel > .in");if(actives&&actives.length){var hasData=actives.data("bs.collapse");if(hasData&&hasData.transitioning)return;actives.collapse("hide");hasData||actives.data("bs.collapse",null)}var dimension=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[dimension](0);this.transitioning=1;var complete=function(){this.$element.removeClass("collapsing").addClass("in")[dimension]("auto");this.transitioning=0;this.$element.trigger("shown.bs.collapse")};if(!$.support.transition)return complete.call(this);var scrollSize=$.camelCase(["scroll",dimension].join("-"));this.$element.one($.support.transition.end,$.proxy(complete,this)).emulateTransitionEnd(350)[dimension](this.$element[0][scrollSize])};Collapse.prototype.hide=function(){if(this.transitioning||!this.$element.hasClass("in"))return;var startEvent=$.Event("hide.bs.collapse");this.$element.trigger(startEvent);if(startEvent.isDefaultPrevented())return;var dimension=this.dimension();this.$element[dimension](this.$element[dimension]())[0].offsetHeight;this.$element.addClass("collapsing").removeClass("collapse").removeClass("in");this.transitioning=1;var complete=function(){this.transitioning=0;this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse")};if(!$.support.transition)return complete.call(this);this.$element[dimension](0).one($.support.transition.end,$.proxy(complete,this)).emulateTransitionEnd(350)};Collapse.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};var old=$.fn.collapse;$.fn.collapse=function(option){return this.each(function(){var $this=$(this);var data=$this.data("bs.collapse");var options=$.extend({},Collapse.DEFAULTS,$this.data(),typeof option=="object"&&option);if(!data)$this.data("bs.collapse",data=new Collapse(this,options));if(typeof option=="string")data[option]()})};$.fn.collapse.Constructor=Collapse;$.fn.collapse.noConflict=function(){$.fn.collapse=old;return this};$(document).on("click.bs.collapse.data-api","[data-toggle=collapse]",function(e){var $this=$(this),href;var target=$this.attr("data-target")||e.preventDefault()||(href=$this.attr("href"))&&href.replace(/.*(?=#[^\s]+$)/,"");var $target=$(target);var data=$target.data("bs.collapse");var option=data?"toggle":$this.data();var parent=$this.attr("data-parent");var $parent=parent&&$(parent);if(!data||!data.transitioning){if($parent)$parent.find('[data-toggle=collapse][data-parent="'+parent+'"]').not($this).addClass("collapsed");$this[$target.hasClass("in")?"addClass":"removeClass"]("collapsed")}$target.collapse(option)})}(window.jQuery);+function($){"use strict";function ScrollSpy(element,options){var href;var process=$.proxy(this.process,this);this.$element=$(element).is("body")?$(window):$(element);this.$body=$("body");this.$scrollElement=this.$element.on("scroll.bs.scroll-spy.data-api",process);this.options=$.extend({},ScrollSpy.DEFAULTS,options);this.selector=(this.options.target||(href=$(element).attr("href"))&&href.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a";this.offsets=$([]);this.targets=$([]);this.activeTarget=null;this.refresh();this.process()}ScrollSpy.DEFAULTS={offset:10};ScrollSpy.prototype.refresh=function(){var offsetMethod=this.$element[0]==window?"offset":"position";this.offsets=$([]);this.targets=$([]);var self=this;var $targets=this.$body.find(this.selector).map(function(){var $el=$(this);var href=$el.data("target")||$el.attr("href");var $href=/^#\w/.test(href)&&$(href);return $href&&$href.length&&[[$href[offsetMethod]().top+(!$.isWindow(self.$scrollElement.get(0))&&self.$scrollElement.scrollTop()),href]]||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){self.offsets.push(this[0]);self.targets.push(this[1])})};ScrollSpy.prototype.process=function(){var scrollTop=this.$scrollElement.scrollTop()+this.options.offset;var scrollHeight=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight;var maxScroll=scrollHeight-this.$scrollElement.height();var offsets=this.offsets;var targets=this.targets;var activeTarget=this.activeTarget;var i;if(scrollTop>=maxScroll){return activeTarget!=(i=targets.last()[0])&&this.activate(i)}for(i=offsets.length;i--;){activeTarget!=targets[i]&&scrollTop>=offsets[i]&&(!offsets[i+1]||scrollTop<=offsets[i+1])&&this.activate(targets[i])}};ScrollSpy.prototype.activate=function(target){this.activeTarget=target;$(this.selector).parents(".active").removeClass("active");var selector=this.selector+'[data-target="'+target+'"],'+this.selector+'[href="'+target+'"]';var active=$(selector).parents("li").addClass("active");if(active.parent(".dropdown-menu").length){active=active.closest("li.dropdown").addClass("active")}active.trigger("activate")};var old=$.fn.scrollspy;$.fn.scrollspy=function(option){return this.each(function(){var $this=$(this);var data=$this.data("bs.scrollspy");var options=typeof option=="object"&&option;if(!data)$this.data("bs.scrollspy",data=new ScrollSpy(this,options));if(typeof option=="string")data[option]()})};$.fn.scrollspy.Constructor=ScrollSpy;$.fn.scrollspy.noConflict=function(){$.fn.scrollspy=old;return this};$(window).on("load",function(){$('[data-spy="scroll"]').each(function(){var $spy=$(this);$spy.scrollspy($spy.data())})})}(window.jQuery);+function($){"use strict";function transitionEnd(){var el=document.createElement("bootstrap");var transEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var name in transEndEventNames){if(el.style[name]!==undefined){return{end:transEndEventNames[name]}}}}$.fn.emulateTransitionEnd=function(duration){var called=false,$el=this;$(this).one($.support.transition.end,function(){called=true});var callback=function(){if(!called)$($el).trigger($.support.transition.end)};setTimeout(callback,duration);return this};$(function(){$.support.transition=transitionEnd()
})}(window.jQuery);!function($){"use strict";var Tab=function(element){this.element=$(element)};Tab.prototype={constructor:Tab,show:function(){var $this=this.element,$ul=$this.closest("ul:not(.dropdown-menu)"),selector=$this.attr("data-target"),previous,$target,e;if(!selector){selector=$this.attr("href");selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,"")}if($this.parent("li").hasClass("active"))return;previous=$ul.find(".active:last a")[0];e=$.Event("show",{relatedTarget:previous});$this.trigger(e);if(e.isDefaultPrevented())return;$target=$(selector);this.activate($this.parent("li"),$ul);this.activate($target,$target.parent(),function(){$this.trigger({type:"shown",relatedTarget:previous})})},activate:function(element,container,callback){var $active=container.find("> .active"),transition=callback&&$.support.transition&&$active.hasClass("fade");function next(){$active.removeClass("active").find("> .dropdown-menu > .active").removeClass("active");element.addClass("active");if(transition){element[0].offsetWidth;element.addClass("in")}else{element.removeClass("fade")}if(element.parent(".dropdown-menu")){element.closest("li.dropdown").addClass("active")}callback&&callback()}transition?$active.one($.support.transition.end,next):next();$active.removeClass("in")}};var old=$.fn.tab;$.fn.tab=function(option){return this.each(function(){var $this=$(this),data=$this.data("tab");if(!data)$this.data("tab",data=new Tab(this));if(typeof option=="string")data[option]()})};$.fn.tab.Constructor=Tab;$.fn.tab.noConflict=function(){$.fn.tab=old;return this};$(document).on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(e){e.preventDefault();$(this).tab("show")})}(window.jQuery);window.bootbox=window.bootbox||function a(b,c){"use strict";function d(a){var b=s[q.locale];return b?b[a]:s.en[a]}function e(a,c,d){a.preventDefault();var e=b.isFunction(d)&&d(a)===!1;e||c.modal("hide")}function f(a){var b,c=0;for(b in a)c++;return c}function g(a,c){var d=0;b.each(a,function(a,b){c(a,b,d++)})}function h(a){var c,d;if("object"!=typeof a)throw new Error("Please supply an object of options");if(!a.message)throw new Error("Please specify a message");return a=b.extend({},q,a),a.buttons||(a.buttons={}),a.backdrop=a.backdrop?"static":!1,c=a.buttons,d=f(c),g(c,function(a,e,f){if(b.isFunction(e)&&(e=c[a]={callback:e}),"object"!==b.type(e))throw new Error("button with key "+a+" must be an object");e.label||(e.label=a),e.className||(e.className=2>=d&&f===d-1?"btn-primary":"btn-default")}),a}function i(a,b){var c=a.length,d={};if(1>c||c>2)throw new Error("Invalid argument length");return 2===c||"string"==typeof a[0]?(d[b[0]]=a[0],d[b[1]]=a[1]):d=a[0],d}function j(a,c,d){return b.extend(!0,{},a,i(c,d))}function k(a,b,c){return n(j(m.apply(null,a),b,c),a)}function l(){for(var a={},b=0,c=arguments.length;c>b;b++){var e=arguments[b],f=e.toLowerCase(),g=e.toUpperCase();a[f]={label:d(g)}}return a}function m(){return{buttons:l.apply(null,arguments)}}function n(a,b){var d={};return g(b,function(a,b){d[b]=!0}),g(a.buttons,function(a){if(d[a]===c)throw new Error("button key "+a+" is not allowed (options are "+b.join("\n")+")")}),a}var o={dialog:"<div class='bootbox modal' tabindex='-1' role='dialog'><div class='modal-dialog'><div class='modal-content'><div class='modal-body'><div class='bootbox-body'></div></div></div></div></div>",header:"<div class='modal-header'><h4 class='modal-title'></h4></div>",footer:"<div class='modal-footer'></div>",closeButton:"<button type='button' class='bootbox-close-button close'>&times;</button>",form:"<form class='bootbox-form'></form>",inputs:{text:"<input class='bootbox-input form-control' autocomplete=off type=text />"}},p=b("body"),q={locale:"en",backdrop:!0,animate:!0,className:null,closeButton:!0,show:!0},r={};r.alert=function(){var a;if(a=k(["ok"],arguments,["message","callback"]),a.callback&&!b.isFunction(a.callback))throw new Error("alert requires callback property to be a function when provided");return a.buttons.ok.callback=a.onEscape=function(){return b.isFunction(a.callback)?a.callback():!0},r.dialog(a)},r.confirm=function(){var a;if(a=k(["cancel","confirm"],arguments,["message","callback"]),a.buttons.cancel.callback=a.onEscape=function(){return a.callback(!1)},a.buttons.confirm.callback=function(){return a.callback(!0)},!b.isFunction(a.callback))throw new Error("confirm requires a callback");return r.dialog(a)},r.prompt=function(){var a,d,e,f,g,h;if(f=b(o.form),d={buttons:l("cancel","confirm"),value:""},a=n(j(d,arguments,["title","callback"]),["cancel","confirm"]),h=a.show===c?!0:a.show,a.message=f,a.buttons.cancel.callback=a.onEscape=function(){return a.callback(null)},a.buttons.confirm.callback=function(){return a.callback(g.val())},a.show=!1,!a.title)throw new Error("prompt requires a title");if(!b.isFunction(a.callback))throw new Error("prompt requires a callback");return g=b(o.inputs.text),g.val(a.value),f.append(g),f.on("submit",function(a){a.preventDefault(),e.find(".btn-primary").click()}),e=r.dialog(a),e.off("shown.bs.modal"),e.on("shown.bs.modal",function(){g.focus()}),h===!0&&e.modal("show"),e},r.dialog=function(a){a=h(a);var c=b(o.dialog),d=c.find(".modal-body"),f=a.buttons,i="",j={onEscape:a.onEscape};if(g(f,function(a,b){i+="<button data-bb-handler='"+a+"' type='button' class='btn "+b.className+"'>"+b.label+"</button>",j[a]=b.callback}),d.find(".bootbox-body").html(a.message),a.animate===!0&&c.addClass("fade"),a.className&&c.addClass(a.className),a.title&&d.before(o.header),a.closeButton){var k=b(o.closeButton);a.title?c.find(".modal-header").prepend(k):k.css("margin-top","-10px").prependTo(d)}return a.title&&c.find(".modal-title").html(a.title),i.length&&(d.after(o.footer),c.find(".modal-footer").html(i)),c.on("hidden.bs.modal",function(a){a.target===this&&c.remove()}),c.on("shown.bs.modal",function(){c.find(".btn-primary:first").focus()}),c.on("escape.close.bb",function(a){j.onEscape&&e(a,c,j.onEscape)}),c.on("click",".modal-footer button",function(a){var d=b(this).data("bb-handler");e(a,c,j[d])}),c.on("click",".bootbox-close-button",function(a){e(a,c,j.onEscape)}),c.on("keyup",function(a){27===a.which&&c.trigger("escape.close.bb")}),p.append(c),c.modal({backdrop:a.backdrop,keyboard:!1,show:!1}),a.show&&c.modal("show"),c},r.setDefaults=function(a){b.extend(q,a)},r.hideAll=function(){b(".bootbox").modal("hide")};var s={br:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Sim"},da:{OK:"OK",CANCEL:"Annuller",CONFIRM:"Accepter"},de:{OK:"OK",CANCEL:"Abbrechen",CONFIRM:"Akzeptieren"},en:{OK:"OK",CANCEL:"Cancel",CONFIRM:"OK"},es:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Aceptar"},fi:{OK:"OK",CANCEL:"Peruuta",CONFIRM:"OK"},fr:{OK:"OK",CANCEL:"Annuler",CONFIRM:"D'accord"},it:{OK:"OK",CANCEL:"Annulla",CONFIRM:"Conferma"},nl:{OK:"OK",CANCEL:"Annuleren",CONFIRM:"Accepteren"},pl:{OK:"OK",CANCEL:"Anuluj",CONFIRM:"Potwierdź"},ru:{OK:"OK",CANCEL:"Отмена",CONFIRM:"Применить"},zh_CN:{OK:"OK",CANCEL:"取消",CONFIRM:"确认"},zh_TW:{OK:"OK",CANCEL:"取消",CONFIRM:"確認"}};return r.init=function(c){window.bootbox=a(c||b)},r}(window.jQuery);var wysihtml5={version:"0.3.0",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"﻿",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,DELETE_KEY:46};window["rangy"]=function(){var OBJECT="object",FUNCTION="function",UNDEFINED="undefined";var domRangeProperties=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"];var domRangeMethods=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"];var textRangeProperties=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"];var textRangeMethods=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"];function isHostMethod(o,p){var t=typeof o[p];return t==FUNCTION||!!(t==OBJECT&&o[p])||t=="unknown"}function isHostObject(o,p){return!!(typeof o[p]==OBJECT&&o[p])}function isHostProperty(o,p){return typeof o[p]!=UNDEFINED}function createMultiplePropertyTest(testFunc){return function(o,props){var i=props.length;while(i--){if(!testFunc(o,props[i])){return false}}return true}}var areHostMethods=createMultiplePropertyTest(isHostMethod);var areHostObjects=createMultiplePropertyTest(isHostObject);var areHostProperties=createMultiplePropertyTest(isHostProperty);function isTextRange(range){return range&&areHostMethods(range,textRangeMethods)&&areHostProperties(range,textRangeProperties)}var api={version:"1.2.2",initialized:false,supported:true,util:{isHostMethod:isHostMethod,isHostObject:isHostObject,isHostProperty:isHostProperty,areHostMethods:areHostMethods,areHostObjects:areHostObjects,areHostProperties:areHostProperties,isTextRange:isTextRange},features:{},modules:{},config:{alertOnWarn:false,preferTextRange:false}};function fail(reason){window.alert("Rangy not supported in your browser. Reason: "+reason);api.initialized=true;api.supported=false}api.fail=fail;function warn(msg){var warningMessage="Rangy warning: "+msg;if(api.config.alertOnWarn){window.alert(warningMessage)}else if(typeof window.console!=UNDEFINED&&typeof window.console.log!=UNDEFINED){window.console.log(warningMessage)}}api.warn=warn;if({}.hasOwnProperty){api.util.extend=function(o,props){for(var i in props){if(props.hasOwnProperty(i)){o[i]=props[i]}}}}else{fail("hasOwnProperty not supported")}var initListeners=[];var moduleInitializers=[];function init(){if(api.initialized){return}var testRange;var implementsDomRange=false,implementsTextRange=false;if(isHostMethod(document,"createRange")){testRange=document.createRange();if(areHostMethods(testRange,domRangeMethods)&&areHostProperties(testRange,domRangeProperties)){implementsDomRange=true}testRange.detach()}var body=isHostObject(document,"body")?document.body:document.getElementsByTagName("body")[0];if(body&&isHostMethod(body,"createTextRange")){testRange=body.createTextRange();if(isTextRange(testRange)){implementsTextRange=true}}if(!implementsDomRange&&!implementsTextRange){fail("Neither Range nor TextRange are implemented")}api.initialized=true;api.features={implementsDomRange:implementsDomRange,implementsTextRange:implementsTextRange};var allListeners=moduleInitializers.concat(initListeners);for(var i=0,len=allListeners.length;i<len;++i){try{allListeners[i](api)}catch(ex){if(isHostObject(window,"console")&&isHostMethod(window.console,"log")){window.console.log("Init listener threw an exception. Continuing.",ex)}}}}api.init=init;api.addInitListener=function(listener){if(api.initialized){listener(api)}else{initListeners.push(listener)}};var createMissingNativeApiListeners=[];api.addCreateMissingNativeApiListener=function(listener){createMissingNativeApiListeners.push(listener)};function createMissingNativeApi(win){win=win||window;init();for(var i=0,len=createMissingNativeApiListeners.length;i<len;++i){createMissingNativeApiListeners[i](win)}}api.createMissingNativeApi=createMissingNativeApi;function Module(name){this.name=name;this.initialized=false;this.supported=false}Module.prototype.fail=function(reason){this.initialized=true;this.supported=false;throw new Error("Module '"+this.name+"' failed to load: "+reason)};Module.prototype.warn=function(msg){api.warn("Module "+this.name+": "+msg)};Module.prototype.createError=function(msg){return new Error("Error in Rangy "+this.name+" module: "+msg)};api.createModule=function(name,initFunc){var module=new Module(name);api.modules[name]=module;moduleInitializers.push(function(api){initFunc(api,module);module.initialized=true;module.supported=true})};api.requireModules=function(modules){for(var i=0,len=modules.length,module,moduleName;i<len;++i){moduleName=modules[i];module=api.modules[moduleName];if(!module||!(module instanceof Module)){throw new Error("Module '"+moduleName+"' not found")}if(!module.supported){throw new Error("Module '"+moduleName+"' not supported")}}};var docReady=false;var loadHandler=function(e){if(!docReady){docReady=true;if(!api.initialized){init()}}};if(typeof window==UNDEFINED){fail("No window found");return}if(typeof document==UNDEFINED){fail("No document found");return}if(isHostMethod(document,"addEventListener")){document.addEventListener("DOMContentLoaded",loadHandler,false)}if(isHostMethod(window,"addEventListener")){window.addEventListener("load",loadHandler,false)}else if(isHostMethod(window,"attachEvent")){window.attachEvent("onload",loadHandler)}else{fail("Window does not have required addEventListener or attachEvent method")}return api}();rangy.createModule("DomUtil",function(api,module){var UNDEF="undefined";var util=api.util;if(!util.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])){module.fail("document missing a Node creation method")}if(!util.isHostMethod(document,"getElementsByTagName")){module.fail("document missing getElementsByTagName method")}var el=document.createElement("div");if(!util.areHostMethods(el,["insertBefore","appendChild","cloneNode"]||!util.areHostObjects(el,["previousSibling","nextSibling","childNodes","parentNode"]))){module.fail("Incomplete Element implementation")}if(!util.isHostProperty(el,"innerHTML")){module.fail("Element is missing innerHTML property")}var textNode=document.createTextNode("test");if(!util.areHostMethods(textNode,["splitText","deleteData","insertData","appendData","cloneNode"]||!util.areHostObjects(el,["previousSibling","nextSibling","childNodes","parentNode"])||!util.areHostProperties(textNode,["data"]))){module.fail("Incomplete Text Node implementation")}var arrayContains=function(arr,val){var i=arr.length;while(i--){if(arr[i]===val){return true}}return false};function isHtmlNamespace(node){var ns;return typeof node.namespaceURI==UNDEF||(ns=node.namespaceURI)===null||ns=="http://www.w3.org/1999/xhtml"}function parentElement(node){var parent=node.parentNode;return parent.nodeType==1?parent:null}function getNodeIndex(node){var i=0;while(node=node.previousSibling){i++}return i}function getNodeLength(node){var childNodes;return isCharacterDataNode(node)?node.length:(childNodes=node.childNodes)?childNodes.length:0}function getCommonAncestor(node1,node2){var ancestors=[],n;for(n=node1;n;n=n.parentNode){ancestors.push(n)}for(n=node2;n;n=n.parentNode){if(arrayContains(ancestors,n)){return n}}return null}function isAncestorOf(ancestor,descendant,selfIsAncestor){var n=selfIsAncestor?descendant:descendant.parentNode;while(n){if(n===ancestor){return true}else{n=n.parentNode}}return false}function getClosestAncestorIn(node,ancestor,selfIsAncestor){var p,n=selfIsAncestor?node:node.parentNode;while(n){p=n.parentNode;if(p===ancestor){return n}n=p}return null}function isCharacterDataNode(node){var t=node.nodeType;return t==3||t==4||t==8}function insertAfter(node,precedingNode){var nextNode=precedingNode.nextSibling,parent=precedingNode.parentNode;if(nextNode){parent.insertBefore(node,nextNode)}else{parent.appendChild(node)}return node}function splitDataNode(node,index){var newNode=node.cloneNode(false);newNode.deleteData(0,index);node.deleteData(index,node.length-index);insertAfter(newNode,node);return newNode}function getDocument(node){if(node.nodeType==9){return node}else if(typeof node.ownerDocument!=UNDEF){return node.ownerDocument}else if(typeof node.document!=UNDEF){return node.document}else if(node.parentNode){return getDocument(node.parentNode)}else{throw new Error("getDocument: no document found for node")}}function getWindow(node){var doc=getDocument(node);if(typeof doc.defaultView!=UNDEF){return doc.defaultView}else if(typeof doc.parentWindow!=UNDEF){return doc.parentWindow}else{throw new Error("Cannot get a window object for node")}}function getIframeDocument(iframeEl){if(typeof iframeEl.contentDocument!=UNDEF){return iframeEl.contentDocument}else if(typeof iframeEl.contentWindow!=UNDEF){return iframeEl.contentWindow.document}else{throw new Error("getIframeWindow: No Document object found for iframe element")}}function getIframeWindow(iframeEl){if(typeof iframeEl.contentWindow!=UNDEF){return iframeEl.contentWindow}else if(typeof iframeEl.contentDocument!=UNDEF){return iframeEl.contentDocument.defaultView}else{throw new Error("getIframeWindow: No Window object found for iframe element")}}function getBody(doc){return util.isHostObject(doc,"body")?doc.body:doc.getElementsByTagName("body")[0]}function getRootContainer(node){var parent;while(parent=node.parentNode){node=parent}return node}function comparePoints(nodeA,offsetA,nodeB,offsetB){var nodeC,root,childA,childB,n;if(nodeA==nodeB){return offsetA===offsetB?0:offsetA<offsetB?-1:1}else if(nodeC=getClosestAncestorIn(nodeB,nodeA,true)){return offsetA<=getNodeIndex(nodeC)?-1:1}else if(nodeC=getClosestAncestorIn(nodeA,nodeB,true)){return getNodeIndex(nodeC)<offsetB?-1:1}else{root=getCommonAncestor(nodeA,nodeB);childA=nodeA===root?root:getClosestAncestorIn(nodeA,root,true);childB=nodeB===root?root:getClosestAncestorIn(nodeB,root,true);if(childA===childB){throw new Error("comparePoints got to case 4 and childA and childB are the same!")}else{n=root.firstChild;while(n){if(n===childA){return-1}else if(n===childB){return 1}n=n.nextSibling}throw new Error("Should not be here!")}}}function fragmentFromNodeChildren(node){var fragment=getDocument(node).createDocumentFragment(),child;while(child=node.firstChild){fragment.appendChild(child)}return fragment}function inspectNode(node){if(!node){return"[No node]"}if(isCharacterDataNode(node)){return'"'+node.data+'"'}else if(node.nodeType==1){var idAttr=node.id?' id="'+node.id+'"':"";return"<"+node.nodeName+idAttr+">["+node.childNodes.length+"]"}else{return node.nodeName}}function NodeIterator(root){this.root=root;this._next=root}NodeIterator.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var n=this._current=this._next;var child,next;if(this._current){child=n.firstChild;if(child){this._next=child}else{next=null;while(n!==this.root&&!(next=n.nextSibling)){n=n.parentNode}this._next=next}}return this._current},detach:function(){this._current=this._next=this.root=null}};function createIterator(root){return new NodeIterator(root)}function DomPosition(node,offset){this.node=node;this.offset=offset}DomPosition.prototype={equals:function(pos){return this.node===pos.node&this.offset==pos.offset},inspect:function(){return"[DomPosition("+inspectNode(this.node)+":"+this.offset+")]"}};function DOMException(codeName){this.code=this[codeName];this.codeName=codeName;this.message="DOMException: "+this.codeName}DOMException.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};DOMException.prototype.toString=function(){return this.message};api.dom={arrayContains:arrayContains,isHtmlNamespace:isHtmlNamespace,parentElement:parentElement,getNodeIndex:getNodeIndex,getNodeLength:getNodeLength,getCommonAncestor:getCommonAncestor,isAncestorOf:isAncestorOf,getClosestAncestorIn:getClosestAncestorIn,isCharacterDataNode:isCharacterDataNode,insertAfter:insertAfter,splitDataNode:splitDataNode,getDocument:getDocument,getWindow:getWindow,getIframeWindow:getIframeWindow,getIframeDocument:getIframeDocument,getBody:getBody,getRootContainer:getRootContainer,comparePoints:comparePoints,inspectNode:inspectNode,fragmentFromNodeChildren:fragmentFromNodeChildren,createIterator:createIterator,DomPosition:DomPosition};api.DOMException=DOMException});rangy.createModule("DomRange",function(api,module){api.requireModules(["DomUtil"]);var dom=api.dom;var DomPosition=dom.DomPosition;var DOMException=api.DOMException;function isNonTextPartiallySelected(node,range){return node.nodeType!=3&&(dom.isAncestorOf(node,range.startContainer,true)||dom.isAncestorOf(node,range.endContainer,true))}function getRangeDocument(range){return dom.getDocument(range.startContainer)}function dispatchEvent(range,type,args){var listeners=range._listeners[type];if(listeners){for(var i=0,len=listeners.length;i<len;++i){listeners[i].call(range,{target:range,args:args})}}}function getBoundaryBeforeNode(node){return new DomPosition(node.parentNode,dom.getNodeIndex(node))}function getBoundaryAfterNode(node){return new DomPosition(node.parentNode,dom.getNodeIndex(node)+1)}function insertNodeAtPosition(node,n,o){var firstNodeInserted=node.nodeType==11?node.firstChild:node;if(dom.isCharacterDataNode(n)){if(o==n.length){dom.insertAfter(node,n)}else{n.parentNode.insertBefore(node,o==0?n:dom.splitDataNode(n,o))}}else if(o>=n.childNodes.length){n.appendChild(node)}else{n.insertBefore(node,n.childNodes[o])}return firstNodeInserted}function cloneSubtree(iterator){var partiallySelected;for(var node,frag=getRangeDocument(iterator.range).createDocumentFragment(),subIterator;node=iterator.next();){partiallySelected=iterator.isPartiallySelectedSubtree();node=node.cloneNode(!partiallySelected);if(partiallySelected){subIterator=iterator.getSubtreeIterator();node.appendChild(cloneSubtree(subIterator));subIterator.detach(true)}if(node.nodeType==10){throw new DOMException("HIERARCHY_REQUEST_ERR")}frag.appendChild(node)}return frag}function iterateSubtree(rangeIterator,func,iteratorState){var it,n;iteratorState=iteratorState||{stop:false};for(var node,subRangeIterator;node=rangeIterator.next();){if(rangeIterator.isPartiallySelectedSubtree()){if(func(node)===false){iteratorState.stop=true;return}else{subRangeIterator=rangeIterator.getSubtreeIterator();iterateSubtree(subRangeIterator,func,iteratorState);subRangeIterator.detach(true);if(iteratorState.stop){return}}}else{it=dom.createIterator(node);while(n=it.next()){if(func(n)===false){iteratorState.stop=true;return}}}}}function deleteSubtree(iterator){var subIterator;while(iterator.next()){if(iterator.isPartiallySelectedSubtree()){subIterator=iterator.getSubtreeIterator();deleteSubtree(subIterator);subIterator.detach(true)}else{iterator.remove()}}}function extractSubtree(iterator){for(var node,frag=getRangeDocument(iterator.range).createDocumentFragment(),subIterator;node=iterator.next();){if(iterator.isPartiallySelectedSubtree()){node=node.cloneNode(false);subIterator=iterator.getSubtreeIterator();node.appendChild(extractSubtree(subIterator));subIterator.detach(true)}else{iterator.remove()}if(node.nodeType==10){throw new DOMException("HIERARCHY_REQUEST_ERR")}frag.appendChild(node)}return frag}function getNodesInRange(range,nodeTypes,filter){var filterNodeTypes=!!(nodeTypes&&nodeTypes.length),regex;var filterExists=!!filter;if(filterNodeTypes){regex=new RegExp("^("+nodeTypes.join("|")+")$")}var nodes=[];iterateSubtree(new RangeIterator(range,false),function(node){if((!filterNodeTypes||regex.test(node.nodeType))&&(!filterExists||filter(node))){nodes.push(node)}});return nodes}function inspect(range){var name=typeof range.getName=="undefined"?"Range":range.getName();return"["+name+"("+dom.inspectNode(range.startContainer)+":"+range.startOffset+", "+dom.inspectNode(range.endContainer)+":"+range.endOffset+")]"}function RangeIterator(range,clonePartiallySelectedTextNodes){this.range=range;this.clonePartiallySelectedTextNodes=clonePartiallySelectedTextNodes;if(!range.collapsed){this.sc=range.startContainer;this.so=range.startOffset;this.ec=range.endContainer;this.eo=range.endOffset;var root=range.commonAncestorContainer;if(this.sc===this.ec&&dom.isCharacterDataNode(this.sc)){this.isSingleCharacterDataNode=true;this._first=this._last=this._next=this.sc}else{this._first=this._next=this.sc===root&&!dom.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:dom.getClosestAncestorIn(this.sc,root,true);this._last=this.ec===root&&!dom.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:dom.getClosestAncestorIn(this.ec,root,true)}}}RangeIterator.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:false,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var current=this._current=this._next;if(current){this._next=current!==this._last?current.nextSibling:null;if(dom.isCharacterDataNode(current)&&this.clonePartiallySelectedTextNodes){if(current===this.ec){(current=current.cloneNode(true)).deleteData(this.eo,current.length-this.eo)}if(this._current===this.sc){(current=current.cloneNode(true)).deleteData(0,this.so)}}}return current},remove:function(){var current=this._current,start,end;if(dom.isCharacterDataNode(current)&&(current===this.sc||current===this.ec)){start=current===this.sc?this.so:0;end=current===this.ec?this.eo:current.length;if(start!=end){current.deleteData(start,end-start)}}else{if(current.parentNode){current.parentNode.removeChild(current)}else{}}},isPartiallySelectedSubtree:function(){var current=this._current;return isNonTextPartiallySelected(current,this.range)},getSubtreeIterator:function(){var subRange;if(this.isSingleCharacterDataNode){subRange=this.range.cloneRange();subRange.collapse()}else{subRange=new Range(getRangeDocument(this.range));var current=this._current;var startContainer=current,startOffset=0,endContainer=current,endOffset=dom.getNodeLength(current);if(dom.isAncestorOf(current,this.sc,true)){startContainer=this.sc;startOffset=this.so}if(dom.isAncestorOf(current,this.ec,true)){endContainer=this.ec;endOffset=this.eo}updateBoundaries(subRange,startContainer,startOffset,endContainer,endOffset)}return new RangeIterator(subRange,this.clonePartiallySelectedTextNodes)},detach:function(detachRange){if(detachRange){this.range.detach()}this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};function RangeException(codeName){this.code=this[codeName];this.codeName=codeName;this.message="RangeException: "+this.codeName}RangeException.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};RangeException.prototype.toString=function(){return this.message};function RangeNodeIterator(range,nodeTypes,filter){this.nodes=getNodesInRange(range,nodeTypes,filter);this._next=this.nodes[0];this._position=0}RangeNodeIterator.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current},detach:function(){this._current=this._next=this.nodes=null}};var beforeAfterNodeTypes=[1,3,4,5,7,8,10];var rootContainerNodeTypes=[2,9,11];var readonlyNodeTypes=[5,6,10,12];var insertableNodeTypes=[1,3,4,5,7,8,10,11];var surroundNodeTypes=[1,3,4,5,7,8];function createAncestorFinder(nodeTypes){return function(node,selfIsAncestor){var t,n=selfIsAncestor?node:node.parentNode;while(n){t=n.nodeType;if(dom.arrayContains(nodeTypes,t)){return n}n=n.parentNode}return null}}var getRootContainer=dom.getRootContainer;var getDocumentOrFragmentContainer=createAncestorFinder([9,11]);var getReadonlyAncestor=createAncestorFinder(readonlyNodeTypes);var getDocTypeNotationEntityAncestor=createAncestorFinder([6,10,12]);function assertNoDocTypeNotationEntityAncestor(node,allowSelf){if(getDocTypeNotationEntityAncestor(node,allowSelf)){throw new RangeException("INVALID_NODE_TYPE_ERR")}}function assertNotDetached(range){if(!range.startContainer){throw new DOMException("INVALID_STATE_ERR")}}function assertValidNodeType(node,invalidTypes){if(!dom.arrayContains(invalidTypes,node.nodeType)){throw new RangeException("INVALID_NODE_TYPE_ERR")}}function assertValidOffset(node,offset){if(offset<0||offset>(dom.isCharacterDataNode(node)?node.length:node.childNodes.length)){throw new DOMException("INDEX_SIZE_ERR")}}function assertSameDocumentOrFragment(node1,node2){if(getDocumentOrFragmentContainer(node1,true)!==getDocumentOrFragmentContainer(node2,true)){throw new DOMException("WRONG_DOCUMENT_ERR")}}function assertNodeNotReadOnly(node){if(getReadonlyAncestor(node,true)){throw new DOMException("NO_MODIFICATION_ALLOWED_ERR")}}function assertNode(node,codeName){if(!node){throw new DOMException(codeName)}}function isOrphan(node){return!dom.arrayContains(rootContainerNodeTypes,node.nodeType)&&!getDocumentOrFragmentContainer(node,true)}function isValidOffset(node,offset){return offset<=(dom.isCharacterDataNode(node)?node.length:node.childNodes.length)}function assertRangeValid(range){assertNotDetached(range);if(isOrphan(range.startContainer)||isOrphan(range.endContainer)||!isValidOffset(range.startContainer,range.startOffset)||!isValidOffset(range.endContainer,range.endOffset)){throw new Error("Range error: Range is no longer valid after DOM mutation ("+range.inspect()+")")}}var styleEl=document.createElement("style");var htmlParsingConforms=false;try{styleEl.innerHTML="<b>x</b>";htmlParsingConforms=styleEl.firstChild.nodeType==3}catch(e){}api.features.htmlParsingConforms=htmlParsingConforms;var createContextualFragment=htmlParsingConforms?function(fragmentStr){var node=this.startContainer;var doc=dom.getDocument(node);if(!node){throw new DOMException("INVALID_STATE_ERR")}var el=null;if(node.nodeType==1){el=node}else if(dom.isCharacterDataNode(node)){el=dom.parentElement(node)}if(el===null||el.nodeName=="HTML"&&dom.isHtmlNamespace(dom.getDocument(el).documentElement)&&dom.isHtmlNamespace(el)){el=doc.createElement("body")}else{el=el.cloneNode(false)}el.innerHTML=fragmentStr;return dom.fragmentFromNodeChildren(el)}:function(fragmentStr){assertNotDetached(this);var doc=getRangeDocument(this);var el=doc.createElement("body");el.innerHTML=fragmentStr;return dom.fragmentFromNodeChildren(el)};var rangeProperties=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"];var s2s=0,s2e=1,e2e=2,e2s=3;var n_b=0,n_a=1,n_b_a=2,n_i=3;function RangePrototype(){}RangePrototype.prototype={attachListener:function(type,listener){this._listeners[type].push(listener)},compareBoundaryPoints:function(how,range){assertRangeValid(this);assertSameDocumentOrFragment(this.startContainer,range.startContainer);var nodeA,offsetA,nodeB,offsetB;var prefixA=how==e2s||how==s2s?"start":"end";var prefixB=how==s2e||how==s2s?"start":"end";nodeA=this[prefixA+"Container"];offsetA=this[prefixA+"Offset"];nodeB=range[prefixB+"Container"];offsetB=range[prefixB+"Offset"];return dom.comparePoints(nodeA,offsetA,nodeB,offsetB)},insertNode:function(node){assertRangeValid(this);assertValidNodeType(node,insertableNodeTypes);assertNodeNotReadOnly(this.startContainer);if(dom.isAncestorOf(node,this.startContainer,true)){throw new DOMException("HIERARCHY_REQUEST_ERR")}var firstNodeInserted=insertNodeAtPosition(node,this.startContainer,this.startOffset);this.setStartBefore(firstNodeInserted)},cloneContents:function(){assertRangeValid(this);var clone,frag;if(this.collapsed){return getRangeDocument(this).createDocumentFragment()}else{if(this.startContainer===this.endContainer&&dom.isCharacterDataNode(this.startContainer)){clone=this.startContainer.cloneNode(true);clone.data=clone.data.slice(this.startOffset,this.endOffset);frag=getRangeDocument(this).createDocumentFragment();frag.appendChild(clone);return frag}else{var iterator=new RangeIterator(this,true);clone=cloneSubtree(iterator);iterator.detach()}return clone}},canSurroundContents:function(){assertRangeValid(this);assertNodeNotReadOnly(this.startContainer);assertNodeNotReadOnly(this.endContainer);var iterator=new RangeIterator(this,true);var boundariesInvalid=iterator._first&&isNonTextPartiallySelected(iterator._first,this)||iterator._last&&isNonTextPartiallySelected(iterator._last,this);iterator.detach();return!boundariesInvalid},surroundContents:function(node){assertValidNodeType(node,surroundNodeTypes);if(!this.canSurroundContents()){throw new RangeException("BAD_BOUNDARYPOINTS_ERR")}var content=this.extractContents();if(node.hasChildNodes()){while(node.lastChild){node.removeChild(node.lastChild)}}insertNodeAtPosition(node,this.startContainer,this.startOffset);
node.appendChild(content);this.selectNode(node)},cloneRange:function(){assertRangeValid(this);var range=new Range(getRangeDocument(this));var i=rangeProperties.length,prop;while(i--){prop=rangeProperties[i];range[prop]=this[prop]}return range},toString:function(){assertRangeValid(this);var sc=this.startContainer;if(sc===this.endContainer&&dom.isCharacterDataNode(sc)){return sc.nodeType==3||sc.nodeType==4?sc.data.slice(this.startOffset,this.endOffset):""}else{var textBits=[],iterator=new RangeIterator(this,true);iterateSubtree(iterator,function(node){if(node.nodeType==3||node.nodeType==4){textBits.push(node.data)}});iterator.detach();return textBits.join("")}},compareNode:function(node){assertRangeValid(this);var parent=node.parentNode;var nodeIndex=dom.getNodeIndex(node);if(!parent){throw new DOMException("NOT_FOUND_ERR")}var startComparison=this.comparePoint(parent,nodeIndex),endComparison=this.comparePoint(parent,nodeIndex+1);if(startComparison<0){return endComparison>0?n_b_a:n_b}else{return endComparison>0?n_a:n_i}},comparePoint:function(node,offset){assertRangeValid(this);assertNode(node,"HIERARCHY_REQUEST_ERR");assertSameDocumentOrFragment(node,this.startContainer);if(dom.comparePoints(node,offset,this.startContainer,this.startOffset)<0){return-1}else if(dom.comparePoints(node,offset,this.endContainer,this.endOffset)>0){return 1}return 0},createContextualFragment:createContextualFragment,toHtml:function(){assertRangeValid(this);var container=getRangeDocument(this).createElement("div");container.appendChild(this.cloneContents());return container.innerHTML},intersectsNode:function(node,touchingIsIntersecting){assertRangeValid(this);assertNode(node,"NOT_FOUND_ERR");if(dom.getDocument(node)!==getRangeDocument(this)){return false}var parent=node.parentNode,offset=dom.getNodeIndex(node);assertNode(parent,"NOT_FOUND_ERR");var startComparison=dom.comparePoints(parent,offset,this.endContainer,this.endOffset),endComparison=dom.comparePoints(parent,offset+1,this.startContainer,this.startOffset);return touchingIsIntersecting?startComparison<=0&&endComparison>=0:startComparison<0&&endComparison>0},isPointInRange:function(node,offset){assertRangeValid(this);assertNode(node,"HIERARCHY_REQUEST_ERR");assertSameDocumentOrFragment(node,this.startContainer);return dom.comparePoints(node,offset,this.startContainer,this.startOffset)>=0&&dom.comparePoints(node,offset,this.endContainer,this.endOffset)<=0},intersectsRange:function(range,touchingIsIntersecting){assertRangeValid(this);if(getRangeDocument(range)!=getRangeDocument(this)){throw new DOMException("WRONG_DOCUMENT_ERR")}var startComparison=dom.comparePoints(this.startContainer,this.startOffset,range.endContainer,range.endOffset),endComparison=dom.comparePoints(this.endContainer,this.endOffset,range.startContainer,range.startOffset);return touchingIsIntersecting?startComparison<=0&&endComparison>=0:startComparison<0&&endComparison>0},intersection:function(range){if(this.intersectsRange(range)){var startComparison=dom.comparePoints(this.startContainer,this.startOffset,range.startContainer,range.startOffset),endComparison=dom.comparePoints(this.endContainer,this.endOffset,range.endContainer,range.endOffset);var intersectionRange=this.cloneRange();if(startComparison==-1){intersectionRange.setStart(range.startContainer,range.startOffset)}if(endComparison==1){intersectionRange.setEnd(range.endContainer,range.endOffset)}return intersectionRange}return null},union:function(range){if(this.intersectsRange(range,true)){var unionRange=this.cloneRange();if(dom.comparePoints(range.startContainer,range.startOffset,this.startContainer,this.startOffset)==-1){unionRange.setStart(range.startContainer,range.startOffset)}if(dom.comparePoints(range.endContainer,range.endOffset,this.endContainer,this.endOffset)==1){unionRange.setEnd(range.endContainer,range.endOffset)}return unionRange}else{throw new RangeException("Ranges do not intersect")}},containsNode:function(node,allowPartial){if(allowPartial){return this.intersectsNode(node,false)}else{return this.compareNode(node)==n_i}},containsNodeContents:function(node){return this.comparePoint(node,0)>=0&&this.comparePoint(node,dom.getNodeLength(node))<=0},containsRange:function(range){return this.intersection(range).equals(range)},containsNodeText:function(node){var nodeRange=this.cloneRange();nodeRange.selectNode(node);var textNodes=nodeRange.getNodes([3]);if(textNodes.length>0){nodeRange.setStart(textNodes[0],0);var lastTextNode=textNodes.pop();nodeRange.setEnd(lastTextNode,lastTextNode.length);var contains=this.containsRange(nodeRange);nodeRange.detach();return contains}else{return this.containsNodeContents(node)}},createNodeIterator:function(nodeTypes,filter){assertRangeValid(this);return new RangeNodeIterator(this,nodeTypes,filter)},getNodes:function(nodeTypes,filter){assertRangeValid(this);return getNodesInRange(this,nodeTypes,filter)},getDocument:function(){return getRangeDocument(this)},collapseBefore:function(node){assertNotDetached(this);this.setEndBefore(node);this.collapse(false)},collapseAfter:function(node){assertNotDetached(this);this.setStartAfter(node);this.collapse(true)},getName:function(){return"DomRange"},equals:function(range){return Range.rangesEqual(this,range)},inspect:function(){return inspect(this)}};function copyComparisonConstantsToObject(obj){obj.START_TO_START=s2s;obj.START_TO_END=s2e;obj.END_TO_END=e2e;obj.END_TO_START=e2s;obj.NODE_BEFORE=n_b;obj.NODE_AFTER=n_a;obj.NODE_BEFORE_AND_AFTER=n_b_a;obj.NODE_INSIDE=n_i}function copyComparisonConstants(constructor){copyComparisonConstantsToObject(constructor);copyComparisonConstantsToObject(constructor.prototype)}function createRangeContentRemover(remover,boundaryUpdater){return function(){assertRangeValid(this);var sc=this.startContainer,so=this.startOffset,root=this.commonAncestorContainer;var iterator=new RangeIterator(this,true);var node,boundary;if(sc!==root){node=dom.getClosestAncestorIn(sc,root,true);boundary=getBoundaryAfterNode(node);sc=boundary.node;so=boundary.offset}iterateSubtree(iterator,assertNodeNotReadOnly);iterator.reset();var returnValue=remover(iterator);iterator.detach();boundaryUpdater(this,sc,so,sc,so);return returnValue}}function createPrototypeRange(constructor,boundaryUpdater,detacher){function createBeforeAfterNodeSetter(isBefore,isStart){return function(node){assertNotDetached(this);assertValidNodeType(node,beforeAfterNodeTypes);assertValidNodeType(getRootContainer(node),rootContainerNodeTypes);var boundary=(isBefore?getBoundaryBeforeNode:getBoundaryAfterNode)(node);(isStart?setRangeStart:setRangeEnd)(this,boundary.node,boundary.offset)}}function setRangeStart(range,node,offset){var ec=range.endContainer,eo=range.endOffset;if(node!==range.startContainer||offset!==range.startOffset){if(getRootContainer(node)!=getRootContainer(ec)||dom.comparePoints(node,offset,ec,eo)==1){ec=node;eo=offset}boundaryUpdater(range,node,offset,ec,eo)}}function setRangeEnd(range,node,offset){var sc=range.startContainer,so=range.startOffset;if(node!==range.endContainer||offset!==range.endOffset){if(getRootContainer(node)!=getRootContainer(sc)||dom.comparePoints(node,offset,sc,so)==-1){sc=node;so=offset}boundaryUpdater(range,sc,so,node,offset)}}function setRangeStartAndEnd(range,node,offset){if(node!==range.startContainer||offset!==range.startOffset||node!==range.endContainer||offset!==range.endOffset){boundaryUpdater(range,node,offset,node,offset)}}constructor.prototype=new RangePrototype;api.util.extend(constructor.prototype,{setStart:function(node,offset){assertNotDetached(this);assertNoDocTypeNotationEntityAncestor(node,true);assertValidOffset(node,offset);setRangeStart(this,node,offset)},setEnd:function(node,offset){assertNotDetached(this);assertNoDocTypeNotationEntityAncestor(node,true);assertValidOffset(node,offset);setRangeEnd(this,node,offset)},setStartBefore:createBeforeAfterNodeSetter(true,true),setStartAfter:createBeforeAfterNodeSetter(false,true),setEndBefore:createBeforeAfterNodeSetter(true,false),setEndAfter:createBeforeAfterNodeSetter(false,false),collapse:function(isStart){assertRangeValid(this);if(isStart){boundaryUpdater(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset)}else{boundaryUpdater(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)}},selectNodeContents:function(node){assertNotDetached(this);assertNoDocTypeNotationEntityAncestor(node,true);boundaryUpdater(this,node,0,node,dom.getNodeLength(node))},selectNode:function(node){assertNotDetached(this);assertNoDocTypeNotationEntityAncestor(node,false);assertValidNodeType(node,beforeAfterNodeTypes);var start=getBoundaryBeforeNode(node),end=getBoundaryAfterNode(node);boundaryUpdater(this,start.node,start.offset,end.node,end.offset)},extractContents:createRangeContentRemover(extractSubtree,boundaryUpdater),deleteContents:createRangeContentRemover(deleteSubtree,boundaryUpdater),canSurroundContents:function(){assertRangeValid(this);assertNodeNotReadOnly(this.startContainer);assertNodeNotReadOnly(this.endContainer);var iterator=new RangeIterator(this,true);var boundariesInvalid=iterator._first&&isNonTextPartiallySelected(iterator._first,this)||iterator._last&&isNonTextPartiallySelected(iterator._last,this);iterator.detach();return!boundariesInvalid},detach:function(){detacher(this)},splitBoundaries:function(){assertRangeValid(this);var sc=this.startContainer,so=this.startOffset,ec=this.endContainer,eo=this.endOffset;var startEndSame=sc===ec;if(dom.isCharacterDataNode(ec)&&eo>0&&eo<ec.length){dom.splitDataNode(ec,eo)}if(dom.isCharacterDataNode(sc)&&so>0&&so<sc.length){sc=dom.splitDataNode(sc,so);if(startEndSame){eo-=so;ec=sc}else if(ec==sc.parentNode&&eo>=dom.getNodeIndex(sc)){eo++}so=0}boundaryUpdater(this,sc,so,ec,eo)},normalizeBoundaries:function(){assertRangeValid(this);var sc=this.startContainer,so=this.startOffset,ec=this.endContainer,eo=this.endOffset;var mergeForward=function(node){var sibling=node.nextSibling;if(sibling&&sibling.nodeType==node.nodeType){ec=node;eo=node.length;node.appendData(sibling.data);sibling.parentNode.removeChild(sibling)}};var mergeBackward=function(node){var sibling=node.previousSibling;if(sibling&&sibling.nodeType==node.nodeType){sc=node;var nodeLength=node.length;so=sibling.length;node.insertData(0,sibling.data);sibling.parentNode.removeChild(sibling);if(sc==ec){eo+=so;ec=sc}else if(ec==node.parentNode){var nodeIndex=dom.getNodeIndex(node);if(eo==nodeIndex){ec=node;eo=nodeLength}else if(eo>nodeIndex){eo--}}}};var normalizeStart=true;if(dom.isCharacterDataNode(ec)){if(ec.length==eo){mergeForward(ec)}}else{if(eo>0){var endNode=ec.childNodes[eo-1];if(endNode&&dom.isCharacterDataNode(endNode)){mergeForward(endNode)}}normalizeStart=!this.collapsed}if(normalizeStart){if(dom.isCharacterDataNode(sc)){if(so==0){mergeBackward(sc)}}else{if(so<sc.childNodes.length){var startNode=sc.childNodes[so];if(startNode&&dom.isCharacterDataNode(startNode)){mergeBackward(startNode)}}}}else{sc=ec;so=eo}boundaryUpdater(this,sc,so,ec,eo)},collapseToPoint:function(node,offset){assertNotDetached(this);assertNoDocTypeNotationEntityAncestor(node,true);assertValidOffset(node,offset);setRangeStartAndEnd(this,node,offset)}});copyComparisonConstants(constructor)}function updateCollapsedAndCommonAncestor(range){range.collapsed=range.startContainer===range.endContainer&&range.startOffset===range.endOffset;range.commonAncestorContainer=range.collapsed?range.startContainer:dom.getCommonAncestor(range.startContainer,range.endContainer)}function updateBoundaries(range,startContainer,startOffset,endContainer,endOffset){var startMoved=range.startContainer!==startContainer||range.startOffset!==startOffset;var endMoved=range.endContainer!==endContainer||range.endOffset!==endOffset;range.startContainer=startContainer;range.startOffset=startOffset;range.endContainer=endContainer;range.endOffset=endOffset;updateCollapsedAndCommonAncestor(range);dispatchEvent(range,"boundarychange",{startMoved:startMoved,endMoved:endMoved})}function detach(range){assertNotDetached(range);range.startContainer=range.startOffset=range.endContainer=range.endOffset=null;range.collapsed=range.commonAncestorContainer=null;dispatchEvent(range,"detach",null);range._listeners=null}function Range(doc){this.startContainer=doc;this.startOffset=0;this.endContainer=doc;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};updateCollapsedAndCommonAncestor(this)}createPrototypeRange(Range,updateBoundaries,detach);api.rangePrototype=RangePrototype.prototype;Range.rangeProperties=rangeProperties;Range.RangeIterator=RangeIterator;Range.copyComparisonConstants=copyComparisonConstants;Range.createPrototypeRange=createPrototypeRange;Range.inspect=inspect;Range.getRangeDocument=getRangeDocument;Range.rangesEqual=function(r1,r2){return r1.startContainer===r2.startContainer&&r1.startOffset===r2.startOffset&&r1.endContainer===r2.endContainer&&r1.endOffset===r2.endOffset};api.DomRange=Range;api.RangeException=RangeException});rangy.createModule("WrappedRange",function(api,module){api.requireModules(["DomUtil","DomRange"]);var WrappedRange;var dom=api.dom;var DomPosition=dom.DomPosition;var DomRange=api.DomRange;function getTextRangeContainerElement(textRange){var parentEl=textRange.parentElement();var range=textRange.duplicate();range.collapse(true);var startEl=range.parentElement();range=textRange.duplicate();range.collapse(false);var endEl=range.parentElement();var startEndContainer=startEl==endEl?startEl:dom.getCommonAncestor(startEl,endEl);return startEndContainer==parentEl?startEndContainer:dom.getCommonAncestor(parentEl,startEndContainer)}function textRangeIsCollapsed(textRange){return textRange.compareEndPoints("StartToEnd",textRange)==0}function getTextRangeBoundaryPosition(textRange,wholeRangeContainerElement,isStart,isCollapsed){var workingRange=textRange.duplicate();workingRange.collapse(isStart);var containerElement=workingRange.parentElement();if(!dom.isAncestorOf(wholeRangeContainerElement,containerElement,true)){containerElement=wholeRangeContainerElement}if(!containerElement.canHaveHTML){return new DomPosition(containerElement.parentNode,dom.getNodeIndex(containerElement))}var workingNode=dom.getDocument(containerElement).createElement("span");var comparison,workingComparisonType=isStart?"StartToStart":"StartToEnd";var previousNode,nextNode,boundaryPosition,boundaryNode;do{containerElement.insertBefore(workingNode,workingNode.previousSibling);workingRange.moveToElementText(workingNode)}while((comparison=workingRange.compareEndPoints(workingComparisonType,textRange))>0&&workingNode.previousSibling);boundaryNode=workingNode.nextSibling;if(comparison==-1&&boundaryNode&&dom.isCharacterDataNode(boundaryNode)){workingRange.setEndPoint(isStart?"EndToStart":"EndToEnd",textRange);var offset;if(/[\r\n]/.test(boundaryNode.data)){var tempRange=workingRange.duplicate();var rangeLength=tempRange.text.replace(/\r\n/g,"\r").length;offset=tempRange.moveStart("character",rangeLength);while((comparison=tempRange.compareEndPoints("StartToEnd",tempRange))==-1){offset++;tempRange.moveStart("character",1)}}else{offset=workingRange.text.length}boundaryPosition=new DomPosition(boundaryNode,offset)}else{previousNode=(isCollapsed||!isStart)&&workingNode.previousSibling;nextNode=(isCollapsed||isStart)&&workingNode.nextSibling;if(nextNode&&dom.isCharacterDataNode(nextNode)){boundaryPosition=new DomPosition(nextNode,0)}else if(previousNode&&dom.isCharacterDataNode(previousNode)){boundaryPosition=new DomPosition(previousNode,previousNode.length)}else{boundaryPosition=new DomPosition(containerElement,dom.getNodeIndex(workingNode))}}workingNode.parentNode.removeChild(workingNode);return boundaryPosition}function createBoundaryTextRange(boundaryPosition,isStart){var boundaryNode,boundaryParent,boundaryOffset=boundaryPosition.offset;var doc=dom.getDocument(boundaryPosition.node);var workingNode,childNodes,workingRange=doc.body.createTextRange();var nodeIsDataNode=dom.isCharacterDataNode(boundaryPosition.node);if(nodeIsDataNode){boundaryNode=boundaryPosition.node;boundaryParent=boundaryNode.parentNode}else{childNodes=boundaryPosition.node.childNodes;boundaryNode=boundaryOffset<childNodes.length?childNodes[boundaryOffset]:null;boundaryParent=boundaryPosition.node}workingNode=doc.createElement("span");workingNode.innerHTML="&#feff;";if(boundaryNode){boundaryParent.insertBefore(workingNode,boundaryNode)}else{boundaryParent.appendChild(workingNode)}workingRange.moveToElementText(workingNode);workingRange.collapse(!isStart);boundaryParent.removeChild(workingNode);if(nodeIsDataNode){workingRange[isStart?"moveStart":"moveEnd"]("character",boundaryOffset)}return workingRange}if(api.features.implementsDomRange&&(!api.features.implementsTextRange||!api.config.preferTextRange)){(function(){var rangeProto;var rangeProperties=DomRange.rangeProperties;var canSetRangeStartAfterEnd;function updateRangeProperties(range){var i=rangeProperties.length,prop;while(i--){prop=rangeProperties[i];range[prop]=range.nativeRange[prop]}}function updateNativeRange(range,startContainer,startOffset,endContainer,endOffset){var startMoved=range.startContainer!==startContainer||range.startOffset!=startOffset;var endMoved=range.endContainer!==endContainer||range.endOffset!=endOffset;if(startMoved||endMoved){range.setEnd(endContainer,endOffset);range.setStart(startContainer,startOffset)}}function detach(range){range.nativeRange.detach();range.detached=true;var i=rangeProperties.length,prop;while(i--){prop=rangeProperties[i];range[prop]=null}}var createBeforeAfterNodeSetter;WrappedRange=function(range){if(!range){throw new Error("Range must be specified")}this.nativeRange=range;updateRangeProperties(this)};DomRange.createPrototypeRange(WrappedRange,updateNativeRange,detach);rangeProto=WrappedRange.prototype;rangeProto.selectNode=function(node){this.nativeRange.selectNode(node);updateRangeProperties(this)};rangeProto.deleteContents=function(){this.nativeRange.deleteContents();updateRangeProperties(this)};rangeProto.extractContents=function(){var frag=this.nativeRange.extractContents();updateRangeProperties(this);return frag};rangeProto.cloneContents=function(){return this.nativeRange.cloneContents()};rangeProto.surroundContents=function(node){this.nativeRange.surroundContents(node);updateRangeProperties(this)};rangeProto.collapse=function(isStart){this.nativeRange.collapse(isStart);updateRangeProperties(this)};rangeProto.cloneRange=function(){return new WrappedRange(this.nativeRange.cloneRange())};rangeProto.refresh=function(){updateRangeProperties(this)};rangeProto.toString=function(){return this.nativeRange.toString()};var testTextNode=document.createTextNode("test");dom.getBody(document).appendChild(testTextNode);var range=document.createRange();range.setStart(testTextNode,0);range.setEnd(testTextNode,0);try{range.setStart(testTextNode,1);canSetRangeStartAfterEnd=true;rangeProto.setStart=function(node,offset){this.nativeRange.setStart(node,offset);updateRangeProperties(this)};rangeProto.setEnd=function(node,offset){this.nativeRange.setEnd(node,offset);updateRangeProperties(this)};createBeforeAfterNodeSetter=function(name){return function(node){this.nativeRange[name](node);updateRangeProperties(this)}}}catch(ex){canSetRangeStartAfterEnd=false;rangeProto.setStart=function(node,offset){try{this.nativeRange.setStart(node,offset)}catch(ex){this.nativeRange.setEnd(node,offset);this.nativeRange.setStart(node,offset)}updateRangeProperties(this)};rangeProto.setEnd=function(node,offset){try{this.nativeRange.setEnd(node,offset)}catch(ex){this.nativeRange.setStart(node,offset);this.nativeRange.setEnd(node,offset)}updateRangeProperties(this)};createBeforeAfterNodeSetter=function(name,oppositeName){return function(node){try{this.nativeRange[name](node)}catch(ex){this.nativeRange[oppositeName](node);this.nativeRange[name](node)}updateRangeProperties(this)}}}rangeProto.setStartBefore=createBeforeAfterNodeSetter("setStartBefore","setEndBefore");rangeProto.setStartAfter=createBeforeAfterNodeSetter("setStartAfter","setEndAfter");rangeProto.setEndBefore=createBeforeAfterNodeSetter("setEndBefore","setStartBefore");rangeProto.setEndAfter=createBeforeAfterNodeSetter("setEndAfter","setStartAfter");range.selectNodeContents(testTextNode);if(range.startContainer==testTextNode&&range.endContainer==testTextNode&&range.startOffset==0&&range.endOffset==testTextNode.length){rangeProto.selectNodeContents=function(node){this.nativeRange.selectNodeContents(node);updateRangeProperties(this)}}else{rangeProto.selectNodeContents=function(node){this.setStart(node,0);this.setEnd(node,DomRange.getEndOffset(node))}}range.selectNodeContents(testTextNode);range.setEnd(testTextNode,3);var range2=document.createRange();range2.selectNodeContents(testTextNode);range2.setEnd(testTextNode,4);range2.setStart(testTextNode,2);if(range.compareBoundaryPoints(range.START_TO_END,range2)==-1&range.compareBoundaryPoints(range.END_TO_START,range2)==1){rangeProto.compareBoundaryPoints=function(type,range){range=range.nativeRange||range;if(type==range.START_TO_END){type=range.END_TO_START}else if(type==range.END_TO_START){type=range.START_TO_END}return this.nativeRange.compareBoundaryPoints(type,range)}}else{rangeProto.compareBoundaryPoints=function(type,range){return this.nativeRange.compareBoundaryPoints(type,range.nativeRange||range)}}if(api.util.isHostMethod(range,"createContextualFragment")){rangeProto.createContextualFragment=function(fragmentStr){return this.nativeRange.createContextualFragment(fragmentStr)}}dom.getBody(document).removeChild(testTextNode);range.detach();range2.detach()})();api.createNativeRange=function(doc){doc=doc||document;return doc.createRange()}}else if(api.features.implementsTextRange){WrappedRange=function(textRange){this.textRange=textRange;this.refresh()};WrappedRange.prototype=new DomRange(document);WrappedRange.prototype.refresh=function(){var start,end;var rangeContainerElement=getTextRangeContainerElement(this.textRange);if(textRangeIsCollapsed(this.textRange)){end=start=getTextRangeBoundaryPosition(this.textRange,rangeContainerElement,true,true)}else{start=getTextRangeBoundaryPosition(this.textRange,rangeContainerElement,true,false);end=getTextRangeBoundaryPosition(this.textRange,rangeContainerElement,false,false)}this.setStart(start.node,start.offset);this.setEnd(end.node,end.offset)};DomRange.copyComparisonConstants(WrappedRange);var globalObj=function(){return this}();if(typeof globalObj.Range=="undefined"){globalObj.Range=WrappedRange}api.createNativeRange=function(doc){doc=doc||document;return doc.body.createTextRange()}}if(api.features.implementsTextRange){WrappedRange.rangeToTextRange=function(range){if(range.collapsed){var tr=createBoundaryTextRange(new DomPosition(range.startContainer,range.startOffset),true);return tr}else{var startRange=createBoundaryTextRange(new DomPosition(range.startContainer,range.startOffset),true);var endRange=createBoundaryTextRange(new DomPosition(range.endContainer,range.endOffset),false);var textRange=dom.getDocument(range.startContainer).body.createTextRange();textRange.setEndPoint("StartToStart",startRange);textRange.setEndPoint("EndToEnd",endRange);return textRange}}}WrappedRange.prototype.getName=function(){return"WrappedRange"};api.WrappedRange=WrappedRange;api.createRange=function(doc){doc=doc||document;return new WrappedRange(api.createNativeRange(doc))};api.createRangyRange=function(doc){doc=doc||document;return new DomRange(doc)};api.createIframeRange=function(iframeEl){return api.createRange(dom.getIframeDocument(iframeEl))};api.createIframeRangyRange=function(iframeEl){return api.createRangyRange(dom.getIframeDocument(iframeEl))};api.addCreateMissingNativeApiListener(function(win){var doc=win.document;if(typeof doc.createRange=="undefined"){doc.createRange=function(){return api.createRange(this)}}doc=win=null})});rangy.createModule("WrappedSelection",function(api,module){api.requireModules(["DomUtil","DomRange","WrappedRange"]);api.config.checkSelectionRanges=true;var BOOLEAN="boolean",windowPropertyName="_rangySelection",dom=api.dom,util=api.util,DomRange=api.DomRange,WrappedRange=api.WrappedRange,DOMException=api.DOMException,DomPosition=dom.DomPosition,getSelection,selectionIsCollapsed,CONTROL="Control";function getWinSelection(winParam){return(winParam||window).getSelection()}function getDocSelection(winParam){return(winParam||window).document.selection}var implementsWinGetSelection=api.util.isHostMethod(window,"getSelection"),implementsDocSelection=api.util.isHostObject(document,"selection");var useDocumentSelection=implementsDocSelection&&(!implementsWinGetSelection||api.config.preferTextRange);if(useDocumentSelection){getSelection=getDocSelection;api.isSelectionValid=function(winParam){var doc=(winParam||window).document,nativeSel=doc.selection;return nativeSel.type!="None"||dom.getDocument(nativeSel.createRange().parentElement())==doc}}else if(implementsWinGetSelection){getSelection=getWinSelection;api.isSelectionValid=function(){return true}}else{module.fail("Neither document.selection or window.getSelection() detected.")}api.getNativeSelection=getSelection;var testSelection=getSelection();var testRange=api.createNativeRange(document);var body=dom.getBody(document);var selectionHasAnchorAndFocus=util.areHostObjects(testSelection,["anchorNode","focusNode"]&&util.areHostProperties(testSelection,["anchorOffset","focusOffset"]));api.features.selectionHasAnchorAndFocus=selectionHasAnchorAndFocus;var selectionHasExtend=util.isHostMethod(testSelection,"extend");api.features.selectionHasExtend=selectionHasExtend;var selectionHasRangeCount=typeof testSelection.rangeCount=="number";api.features.selectionHasRangeCount=selectionHasRangeCount;var selectionSupportsMultipleRanges=false;var collapsedNonEditableSelectionsSupported=true;if(util.areHostMethods(testSelection,["addRange","getRangeAt","removeAllRanges"])&&typeof testSelection.rangeCount=="number"&&api.features.implementsDomRange){(function(){var iframe=document.createElement("iframe");body.appendChild(iframe);var iframeDoc=dom.getIframeDocument(iframe);iframeDoc.open();iframeDoc.write("<html><head></head><body>12</body></html>");iframeDoc.close();var sel=dom.getIframeWindow(iframe).getSelection();var docEl=iframeDoc.documentElement;var iframeBody=docEl.lastChild,textNode=iframeBody.firstChild;var r1=iframeDoc.createRange();r1.setStart(textNode,1);r1.collapse(true);sel.addRange(r1);collapsedNonEditableSelectionsSupported=sel.rangeCount==1;sel.removeAllRanges();var r2=r1.cloneRange();r1.setStart(textNode,0);r2.setEnd(textNode,2);sel.addRange(r1);sel.addRange(r2);selectionSupportsMultipleRanges=sel.rangeCount==2;r1.detach();r2.detach();body.removeChild(iframe)})()}api.features.selectionSupportsMultipleRanges=selectionSupportsMultipleRanges;api.features.collapsedNonEditableSelectionsSupported=collapsedNonEditableSelectionsSupported;var implementsControlRange=false,testControlRange;if(body&&util.isHostMethod(body,"createControlRange")){testControlRange=body.createControlRange();if(util.areHostProperties(testControlRange,["item","add"])){implementsControlRange=true}}api.features.implementsControlRange=implementsControlRange;if(selectionHasAnchorAndFocus){selectionIsCollapsed=function(sel){return sel.anchorNode===sel.focusNode&&sel.anchorOffset===sel.focusOffset}}else{selectionIsCollapsed=function(sel){return sel.rangeCount?sel.getRangeAt(sel.rangeCount-1).collapsed:false}}function updateAnchorAndFocusFromRange(sel,range,backwards){var anchorPrefix=backwards?"end":"start",focusPrefix=backwards?"start":"end";sel.anchorNode=range[anchorPrefix+"Container"];sel.anchorOffset=range[anchorPrefix+"Offset"];sel.focusNode=range[focusPrefix+"Container"];sel.focusOffset=range[focusPrefix+"Offset"]}function updateAnchorAndFocusFromNativeSelection(sel){var nativeSel=sel.nativeSelection;sel.anchorNode=nativeSel.anchorNode;sel.anchorOffset=nativeSel.anchorOffset;sel.focusNode=nativeSel.focusNode;sel.focusOffset=nativeSel.focusOffset}function updateEmptySelection(sel){sel.anchorNode=sel.focusNode=null;sel.anchorOffset=sel.focusOffset=0;sel.rangeCount=0;sel.isCollapsed=true;sel._ranges.length=0}function getNativeRange(range){var nativeRange;if(range instanceof DomRange){nativeRange=range._selectionNativeRange;if(!nativeRange){nativeRange=api.createNativeRange(dom.getDocument(range.startContainer));nativeRange.setEnd(range.endContainer,range.endOffset);nativeRange.setStart(range.startContainer,range.startOffset);range._selectionNativeRange=nativeRange;range.attachListener("detach",function(){this._selectionNativeRange=null})}}else if(range instanceof WrappedRange){nativeRange=range.nativeRange}else if(api.features.implementsDomRange&&range instanceof dom.getWindow(range.startContainer).Range){nativeRange=range}return nativeRange}function rangeContainsSingleElement(rangeNodes){if(!rangeNodes.length||rangeNodes[0].nodeType!=1){return false}for(var i=1,len=rangeNodes.length;i<len;++i){if(!dom.isAncestorOf(rangeNodes[0],rangeNodes[i])){return false}}return true}function getSingleElementFromRange(range){var nodes=range.getNodes();if(!rangeContainsSingleElement(nodes)){throw new Error("getSingleElementFromRange: range "+range.inspect()+" did not consist of a single element")}return nodes[0]}function isTextRange(range){return!!range&&typeof range.text!="undefined"}function updateFromTextRange(sel,range){var wrappedRange=new WrappedRange(range);sel._ranges=[wrappedRange];updateAnchorAndFocusFromRange(sel,wrappedRange,false);sel.rangeCount=1;sel.isCollapsed=wrappedRange.collapsed}function updateControlSelection(sel){sel._ranges.length=0;if(sel.docSelection.type=="None"){updateEmptySelection(sel)}else{var controlRange=sel.docSelection.createRange();if(isTextRange(controlRange)){updateFromTextRange(sel,controlRange)}else{sel.rangeCount=controlRange.length;var range,doc=dom.getDocument(controlRange.item(0));for(var i=0;i<sel.rangeCount;++i){range=api.createRange(doc);range.selectNode(controlRange.item(i));sel._ranges.push(range)}sel.isCollapsed=sel.rangeCount==1&&sel._ranges[0].collapsed;updateAnchorAndFocusFromRange(sel,sel._ranges[sel.rangeCount-1],false)}}}function addRangeToControlSelection(sel,range){var controlRange=sel.docSelection.createRange();var rangeElement=getSingleElementFromRange(range);var doc=dom.getDocument(controlRange.item(0));var newControlRange=dom.getBody(doc).createControlRange();for(var i=0,len=controlRange.length;i<len;++i){newControlRange.add(controlRange.item(i))}try{newControlRange.add(rangeElement)}catch(ex){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}newControlRange.select();updateControlSelection(sel)}var getSelectionRangeAt;if(util.isHostMethod(testSelection,"getRangeAt")){getSelectionRangeAt=function(sel,index){try{return sel.getRangeAt(index)}catch(ex){return null}}}else if(selectionHasAnchorAndFocus){getSelectionRangeAt=function(sel){var doc=dom.getDocument(sel.anchorNode);var range=api.createRange(doc);range.setStart(sel.anchorNode,sel.anchorOffset);range.setEnd(sel.focusNode,sel.focusOffset);if(range.collapsed!==this.isCollapsed){range.setStart(sel.focusNode,sel.focusOffset);range.setEnd(sel.anchorNode,sel.anchorOffset)}return range}}function WrappedSelection(selection,docSelection,win){this.nativeSelection=selection;this.docSelection=docSelection;this._ranges=[];this.win=win;this.refresh()}api.getSelection=function(win){win=win||window;var sel=win[windowPropertyName];var nativeSel=getSelection(win),docSel=implementsDocSelection?getDocSelection(win):null;if(sel){sel.nativeSelection=nativeSel;sel.docSelection=docSel;sel.refresh(win)}else{sel=new WrappedSelection(nativeSel,docSel,win);win[windowPropertyName]=sel}return sel};api.getIframeSelection=function(iframeEl){return api.getSelection(dom.getIframeWindow(iframeEl))};var selProto=WrappedSelection.prototype;function createControlSelection(sel,ranges){var doc=dom.getDocument(ranges[0].startContainer);var controlRange=dom.getBody(doc).createControlRange();
for(var i=0,el;i<rangeCount;++i){el=getSingleElementFromRange(ranges[i]);try{controlRange.add(el)}catch(ex){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}controlRange.select();updateControlSelection(sel)}if(!useDocumentSelection&&selectionHasAnchorAndFocus&&util.areHostMethods(testSelection,["removeAllRanges","addRange"])){selProto.removeAllRanges=function(){this.nativeSelection.removeAllRanges();updateEmptySelection(this)};var addRangeBackwards=function(sel,range){var doc=DomRange.getRangeDocument(range);var endRange=api.createRange(doc);endRange.collapseToPoint(range.endContainer,range.endOffset);sel.nativeSelection.addRange(getNativeRange(endRange));sel.nativeSelection.extend(range.startContainer,range.startOffset);sel.refresh()};if(selectionHasRangeCount){selProto.addRange=function(range,backwards){if(implementsControlRange&&implementsDocSelection&&this.docSelection.type==CONTROL){addRangeToControlSelection(this,range)}else{if(backwards&&selectionHasExtend){addRangeBackwards(this,range)}else{var previousRangeCount;if(selectionSupportsMultipleRanges){previousRangeCount=this.rangeCount}else{this.removeAllRanges();previousRangeCount=0}this.nativeSelection.addRange(getNativeRange(range));this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==previousRangeCount+1){if(api.config.checkSelectionRanges){var nativeRange=getSelectionRangeAt(this.nativeSelection,this.rangeCount-1);if(nativeRange&&!DomRange.rangesEqual(nativeRange,range)){range=new WrappedRange(nativeRange)}}this._ranges[this.rangeCount-1]=range;updateAnchorAndFocusFromRange(this,range,selectionIsBackwards(this.nativeSelection));this.isCollapsed=selectionIsCollapsed(this)}else{this.refresh()}}}}}else{selProto.addRange=function(range,backwards){if(backwards&&selectionHasExtend){addRangeBackwards(this,range)}else{this.nativeSelection.addRange(getNativeRange(range));this.refresh()}}}selProto.setRanges=function(ranges){if(implementsControlRange&&ranges.length>1){createControlSelection(this,ranges)}else{this.removeAllRanges();for(var i=0,len=ranges.length;i<len;++i){this.addRange(ranges[i])}}}}else if(util.isHostMethod(testSelection,"empty")&&util.isHostMethod(testRange,"select")&&implementsControlRange&&useDocumentSelection){selProto.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var doc;if(this.anchorNode){doc=dom.getDocument(this.anchorNode)}else if(this.docSelection.type==CONTROL){var controlRange=this.docSelection.createRange();if(controlRange.length){doc=dom.getDocument(controlRange.item(0)).body.createTextRange()}}if(doc){var textRange=doc.body.createTextRange();textRange.select();this.docSelection.empty()}}}catch(ex){}updateEmptySelection(this)};selProto.addRange=function(range){if(this.docSelection.type==CONTROL){addRangeToControlSelection(this,range)}else{WrappedRange.rangeToTextRange(range).select();this._ranges[0]=range;this.rangeCount=1;this.isCollapsed=this._ranges[0].collapsed;updateAnchorAndFocusFromRange(this,range,false)}};selProto.setRanges=function(ranges){this.removeAllRanges();var rangeCount=ranges.length;if(rangeCount>1){createControlSelection(this,ranges)}else if(rangeCount){this.addRange(ranges[0])}}}else{module.fail("No means of selecting a Range or TextRange was found");return false}selProto.getRangeAt=function(index){if(index<0||index>=this.rangeCount){throw new DOMException("INDEX_SIZE_ERR")}else{return this._ranges[index]}};var refreshSelection;if(useDocumentSelection){refreshSelection=function(sel){var range;if(api.isSelectionValid(sel.win)){range=sel.docSelection.createRange()}else{range=dom.getBody(sel.win.document).createTextRange();range.collapse(true)}if(sel.docSelection.type==CONTROL){updateControlSelection(sel)}else if(isTextRange(range)){updateFromTextRange(sel,range)}else{updateEmptySelection(sel)}}}else if(util.isHostMethod(testSelection,"getRangeAt")&&typeof testSelection.rangeCount=="number"){refreshSelection=function(sel){if(implementsControlRange&&implementsDocSelection&&sel.docSelection.type==CONTROL){updateControlSelection(sel)}else{sel._ranges.length=sel.rangeCount=sel.nativeSelection.rangeCount;if(sel.rangeCount){for(var i=0,len=sel.rangeCount;i<len;++i){sel._ranges[i]=new api.WrappedRange(sel.nativeSelection.getRangeAt(i))}updateAnchorAndFocusFromRange(sel,sel._ranges[sel.rangeCount-1],selectionIsBackwards(sel.nativeSelection));sel.isCollapsed=selectionIsCollapsed(sel)}else{updateEmptySelection(sel)}}}}else if(selectionHasAnchorAndFocus&&typeof testSelection.isCollapsed==BOOLEAN&&typeof testRange.collapsed==BOOLEAN&&api.features.implementsDomRange){refreshSelection=function(sel){var range,nativeSel=sel.nativeSelection;if(nativeSel.anchorNode){range=getSelectionRangeAt(nativeSel,0);sel._ranges=[range];sel.rangeCount=1;updateAnchorAndFocusFromNativeSelection(sel);sel.isCollapsed=selectionIsCollapsed(sel)}else{updateEmptySelection(sel)}}}else{module.fail("No means of obtaining a Range or TextRange from the user's selection was found");return false}selProto.refresh=function(checkForChanges){var oldRanges=checkForChanges?this._ranges.slice(0):null;refreshSelection(this);if(checkForChanges){var i=oldRanges.length;if(i!=this._ranges.length){return false}while(i--){if(!DomRange.rangesEqual(oldRanges[i],this._ranges[i])){return false}}return true}};var removeRangeManually=function(sel,range){var ranges=sel.getAllRanges(),removed=false;sel.removeAllRanges();for(var i=0,len=ranges.length;i<len;++i){if(removed||range!==ranges[i]){sel.addRange(ranges[i])}else{removed=true}}if(!sel.rangeCount){updateEmptySelection(sel)}};if(implementsControlRange){selProto.removeRange=function(range){if(this.docSelection.type==CONTROL){var controlRange=this.docSelection.createRange();var rangeElement=getSingleElementFromRange(range);var doc=dom.getDocument(controlRange.item(0));var newControlRange=dom.getBody(doc).createControlRange();var el,removed=false;for(var i=0,len=controlRange.length;i<len;++i){el=controlRange.item(i);if(el!==rangeElement||removed){newControlRange.add(controlRange.item(i))}else{removed=true}}newControlRange.select();updateControlSelection(this)}else{removeRangeManually(this,range)}}}else{selProto.removeRange=function(range){removeRangeManually(this,range)}}var selectionIsBackwards;if(!useDocumentSelection&&selectionHasAnchorAndFocus&&api.features.implementsDomRange){selectionIsBackwards=function(sel){var backwards=false;if(sel.anchorNode){backwards=dom.comparePoints(sel.anchorNode,sel.anchorOffset,sel.focusNode,sel.focusOffset)==1}return backwards};selProto.isBackwards=function(){return selectionIsBackwards(this)}}else{selectionIsBackwards=selProto.isBackwards=function(){return false}}selProto.toString=function(){var rangeTexts=[];for(var i=0,len=this.rangeCount;i<len;++i){rangeTexts[i]=""+this._ranges[i]}return rangeTexts.join("")};function assertNodeInSameDocument(sel,node){if(sel.anchorNode&&dom.getDocument(sel.anchorNode)!==dom.getDocument(node)){throw new DOMException("WRONG_DOCUMENT_ERR")}}selProto.collapse=function(node,offset){assertNodeInSameDocument(this,node);var range=api.createRange(dom.getDocument(node));range.collapseToPoint(node,offset);this.removeAllRanges();this.addRange(range);this.isCollapsed=true};selProto.collapseToStart=function(){if(this.rangeCount){var range=this._ranges[0];this.collapse(range.startContainer,range.startOffset)}else{throw new DOMException("INVALID_STATE_ERR")}};selProto.collapseToEnd=function(){if(this.rangeCount){var range=this._ranges[this.rangeCount-1];this.collapse(range.endContainer,range.endOffset)}else{throw new DOMException("INVALID_STATE_ERR")}};selProto.selectAllChildren=function(node){assertNodeInSameDocument(this,node);var range=api.createRange(dom.getDocument(node));range.selectNodeContents(node);this.removeAllRanges();this.addRange(range)};selProto.deleteFromDocument=function(){if(implementsControlRange&&implementsDocSelection&&this.docSelection.type==CONTROL){var controlRange=this.docSelection.createRange();var element;while(controlRange.length){element=controlRange.item(0);controlRange.remove(element);element.parentNode.removeChild(element)}this.refresh()}else if(this.rangeCount){var ranges=this.getAllRanges();this.removeAllRanges();for(var i=0,len=ranges.length;i<len;++i){ranges[i].deleteContents()}this.addRange(ranges[len-1])}};selProto.getAllRanges=function(){return this._ranges.slice(0)};selProto.setSingleRange=function(range){this.setRanges([range])};selProto.containsNode=function(node,allowPartial){for(var i=0,len=this._ranges.length;i<len;++i){if(this._ranges[i].containsNode(node,allowPartial)){return true}}return false};selProto.toHtml=function(){var html="";if(this.rangeCount){var container=DomRange.getRangeDocument(this._ranges[0]).createElement("div");for(var i=0,len=this._ranges.length;i<len;++i){container.appendChild(this._ranges[i].cloneContents())}html=container.innerHTML}return html};function inspect(sel){var rangeInspects=[];var anchor=new DomPosition(sel.anchorNode,sel.anchorOffset);var focus=new DomPosition(sel.focusNode,sel.focusOffset);var name=typeof sel.getName=="function"?sel.getName():"Selection";if(typeof sel.rangeCount!="undefined"){for(var i=0,len=sel.rangeCount;i<len;++i){rangeInspects[i]=DomRange.inspect(sel.getRangeAt(i))}}return"["+name+"(Ranges: "+rangeInspects.join(", ")+")(anchor: "+anchor.inspect()+", focus: "+focus.inspect()+"]"}selProto.getName=function(){return"WrappedSelection"};selProto.inspect=function(){return inspect(this)};selProto.detach=function(){this.win[windowPropertyName]=null;this.win=this.anchorNode=this.focusNode=null};WrappedSelection.inspect=inspect;api.Selection=WrappedSelection;api.selectionPrototype=selProto;api.addCreateMissingNativeApiListener(function(win){if(typeof win.getSelection=="undefined"){win.getSelection=function(){return api.getSelection(this)}}win=null})});var Base=function(){};Base.extend=function(_instance,_static){var extend=Base.prototype.extend;Base._prototyping=true;var proto=new this;extend.call(proto,_instance);proto.base=function(){};delete Base._prototyping;var constructor=proto.constructor;var klass=proto.constructor=function(){if(!Base._prototyping){if(this._constructing||this.constructor==klass){this._constructing=true;constructor.apply(this,arguments);delete this._constructing}else if(arguments[0]!=null){return(arguments[0].extend||extend).call(arguments[0],proto)}}};klass.ancestor=this;klass.extend=this.extend;klass.forEach=this.forEach;klass.implement=this.implement;klass.prototype=proto;klass.toString=this.toString;klass.valueOf=function(type){return type=="object"?klass:constructor.valueOf()};extend.call(klass,_static);if(typeof klass.init=="function")klass.init();return klass};Base.prototype={extend:function(source,value){if(arguments.length>1){var ancestor=this[source];if(ancestor&&typeof value=="function"&&(!ancestor.valueOf||ancestor.valueOf()!=value.valueOf())&&/\bbase\b/.test(value)){var method=value.valueOf();value=function(){var previous=this.base||Base.prototype.base;this.base=ancestor;var returnValue=method.apply(this,arguments);this.base=previous;return returnValue};value.valueOf=function(type){return type=="object"?value:method};value.toString=Base.toString}this[source]=value}else if(source){var extend=Base.prototype.extend;if(!Base._prototyping&&typeof this!="function"){extend=this.extend||extend}var proto={toSource:null};var hidden=["constructor","toString","valueOf"];var i=Base._prototyping?0:1;while(key=hidden[i++]){if(source[key]!=proto[key]){extend.call(this,key,source[key])}}for(var key in source){if(!proto[key])extend.call(this,key,source[key])}}return this}};Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(object,block,context){for(var key in object){if(this.prototype[key]===undefined){block.call(context,object[key],key,object)}}},implement:function(){for(var i=0;i<arguments.length;i++){if(typeof arguments[i]=="function"){arguments[i](this.prototype)}else{this.prototype.extend(arguments[i])}}return this},toString:function(){return String(this.valueOf())}});wysihtml5.browser=function(){var userAgent=navigator.userAgent,testElement=document.createElement("div"),isIE=userAgent.indexOf("MSIE")!==-1&&userAgent.indexOf("Opera")===-1,isGecko=userAgent.indexOf("Gecko")!==-1&&userAgent.indexOf("KHTML")===-1,isWebKit=userAgent.indexOf("AppleWebKit/")!==-1,isChrome=userAgent.indexOf("Chrome/")!==-1,isOpera=userAgent.indexOf("Opera/")!==-1;function iosVersion(userAgent){return(/ipad|iphone|ipod/.test(userAgent)&&userAgent.match(/ os (\d+).+? like mac os x/)||[,0])[1]}return{USER_AGENT:userAgent,supported:function(){var userAgent=this.USER_AGENT.toLowerCase(),hasContentEditableSupport="contentEditable"in testElement,hasEditingApiSupport=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,hasQuerySelectorSupport=document.querySelector&&document.querySelectorAll,isIncompatibleMobileBrowser=this.isIos()&&iosVersion(userAgent)<5||userAgent.indexOf("opera mobi")!==-1||userAgent.indexOf("hpwos/")!==-1;return hasContentEditableSupport&&hasEditingApiSupport&&hasQuerySelectorSupport&&!isIncompatibleMobileBrowser},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){var userAgent=this.USER_AGENT.toLowerCase();return userAgent.indexOf("webkit")!==-1&&userAgent.indexOf("mobile")!==-1},supportsSandboxedIframes:function(){return isIE},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return!isGecko},hasCurrentStyleProperty:function(){return"currentStyle"in testElement},insertsLineBreaksOnReturn:function(){return isGecko},supportsPlaceholderAttributeOn:function(element){return"placeholder"in element},supportsEvent:function(eventName){return"on"+eventName in testElement||function(){testElement.setAttribute("on"+eventName,"return;");return typeof testElement["on"+eventName]==="function"}()},supportsEventsInIframeCorrectly:function(){return!isOpera},firesOnDropOnlyWhenOnDragOverIsCancelled:function(){return isWebKit||isGecko},supportsDataTransfer:function(){try{return isWebKit&&(window.Clipboard||window.DataTransfer).prototype.getData}catch(e){return false}},supportsHTML5Tags:function(context){var element=context.createElement("div"),html5="<article>foo</article>";element.innerHTML=html5;return element.innerHTML.toLowerCase()===html5},supportsCommand:function(){var buggyCommands={formatBlock:isIE,insertUnorderedList:isIE||isOpera||isWebKit,insertOrderedList:isIE||isOpera||isWebKit};var supported={insertHTML:isGecko};return function(doc,command){var isBuggy=buggyCommands[command];if(!isBuggy){try{return doc.queryCommandSupported(command)}catch(e1){}try{return doc.queryCommandEnabled(command)}catch(e2){return!!supported[command]}}return false}}(),doesAutoLinkingInContentEditable:function(){return isIE},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return isGecko||isOpera||isWebKit},supportsGetAttributeCorrectly:function(){var td=document.createElement("td");return td.getAttribute("rowspan")!="1"},canSelectImagesInContentEditable:function(){return isGecko||isIE||isOpera},clearsListsInContentEditableCorrectly:function(){return isGecko||isIE||isWebKit},autoScrollsToCaret:function(){return!isWebKit},autoClosesUnclosedTags:function(){var clonedTestElement=testElement.cloneNode(false),returnValue,innerHTML;clonedTestElement.innerHTML="<p><div></div>";innerHTML=clonedTestElement.innerHTML.toLowerCase();returnValue=innerHTML==="<p></p><div></div>"||innerHTML==="<p><div></div></p>";this.autoClosesUnclosedTags=function(){return returnValue};return returnValue},supportsNativeGetElementsByClassName:function(){return String(document.getElementsByClassName).indexOf("[native code]")!==-1},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},supportsClassList:function(){return"classList"in testElement},needsSpaceAfterLineBreak:function(){return isOpera},supportsSpeechApiOn:function(input){var chromeVersion=userAgent.match(/Chrome\/(\d+)/)||[,0];return chromeVersion[1]>=11&&("onwebkitspeechchange"in input||"speech"in input)},crashesWhenDefineProperty:function(property){return isIE&&(property==="XMLHttpRequest"||property==="XDomainRequest")},doesAsyncFocus:function(){return isIE},hasProblemsSettingCaretAfterImg:function(){return isIE},hasUndoInContextMenu:function(){return isGecko||isChrome||isOpera}}}();wysihtml5.lang.array=function(arr){return{contains:function(needle){if(arr.indexOf){return arr.indexOf(needle)!==-1}else{for(var i=0,length=arr.length;i<length;i++){if(arr[i]===needle){return true}}return false}},without:function(arrayToSubstract){arrayToSubstract=wysihtml5.lang.array(arrayToSubstract);var newArr=[],i=0,length=arr.length;for(;i<length;i++){if(!arrayToSubstract.contains(arr[i])){newArr.push(arr[i])}}return newArr},get:function(){var i=0,length=arr.length,newArray=[];for(;i<length;i++){newArray.push(arr[i])}return newArray}}};wysihtml5.lang.Dispatcher=Base.extend({observe:function(eventName,handler){this.events=this.events||{};this.events[eventName]=this.events[eventName]||[];this.events[eventName].push(handler);return this},on:function(){return this.observe.apply(this,wysihtml5.lang.array(arguments).get())},fire:function(eventName,payload){this.events=this.events||{};var handlers=this.events[eventName]||[],i=0;for(;i<handlers.length;i++){handlers[i].call(this,payload)}return this},stopObserving:function(eventName,handler){this.events=this.events||{};var i=0,handlers,newHandlers;if(eventName){handlers=this.events[eventName]||[],newHandlers=[];for(;i<handlers.length;i++){if(handlers[i]!==handler&&handler){newHandlers.push(handlers[i])}}this.events[eventName]=newHandlers}else{this.events={}}return this}});wysihtml5.lang.object=function(obj){return{merge:function(otherObj){for(var i in otherObj){obj[i]=otherObj[i]}return this},get:function(){return obj},clone:function(){var newObj={},i;for(i in obj){newObj[i]=obj[i]}return newObj},isArray:function(){return Object.prototype.toString.call(obj)==="[object Array]"}}};(function(){var WHITE_SPACE_START=/^\s+/,WHITE_SPACE_END=/\s+$/;wysihtml5.lang.string=function(str){str=String(str);return{trim:function(){return str.replace(WHITE_SPACE_START,"").replace(WHITE_SPACE_END,"")},interpolate:function(vars){for(var i in vars){str=this.replace("#{"+i+"}").by(vars[i])}return str},replace:function(search){return{by:function(replace){return str.split(search).join(replace)}}}}}})();(function(wysihtml5){var IGNORE_URLS_IN=wysihtml5.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),URL_REG_EXP=/((https?:\/\/|www\.)[^\s<]{3,})/gi,TRAILING_CHAR_REG_EXP=/([^\w\/\-](,?))$/i,MAX_DISPLAY_LENGTH=100,BRACKETS={")":"(","]":"[","}":"{"};function autoLink(element){if(_hasParentThatShouldBeIgnored(element)){return element}if(element===element.ownerDocument.documentElement){element=element.ownerDocument.body}return _parseNode(element)}function _convertUrlsToLinks(str){return str.replace(URL_REG_EXP,function(match,url){var punctuation=(url.match(TRAILING_CHAR_REG_EXP)||[])[1]||"",opening=BRACKETS[punctuation];url=url.replace(TRAILING_CHAR_REG_EXP,"");if(url.split(opening).length>url.split(punctuation).length){url=url+punctuation;punctuation=""}var realUrl=url,displayUrl=url;if(url.length>MAX_DISPLAY_LENGTH){displayUrl=displayUrl.substr(0,MAX_DISPLAY_LENGTH)+"..."}if(realUrl.substr(0,4)==="www."){realUrl="http://"+realUrl}return'<a href="'+realUrl+'">'+displayUrl+"</a>"+punctuation})}function _getTempElement(context){var tempElement=context._wysihtml5_tempElement;if(!tempElement){tempElement=context._wysihtml5_tempElement=context.createElement("div")}return tempElement}function _wrapMatchesInNode(textNode){var parentNode=textNode.parentNode,tempElement=_getTempElement(parentNode.ownerDocument);tempElement.innerHTML="<span></span>"+_convertUrlsToLinks(textNode.data);tempElement.removeChild(tempElement.firstChild);while(tempElement.firstChild){parentNode.insertBefore(tempElement.firstChild,textNode)}parentNode.removeChild(textNode)}function _hasParentThatShouldBeIgnored(node){var nodeName;while(node.parentNode){node=node.parentNode;nodeName=node.nodeName;if(IGNORE_URLS_IN.contains(nodeName)){return true}else if(nodeName==="body"){return false}}return false}function _parseNode(element){if(IGNORE_URLS_IN.contains(element.nodeName)){return}if(element.nodeType===wysihtml5.TEXT_NODE&&element.data.match(URL_REG_EXP)){_wrapMatchesInNode(element);return}var childNodes=wysihtml5.lang.array(element.childNodes).get(),childNodesLength=childNodes.length,i=0;for(;i<childNodesLength;i++){_parseNode(childNodes[i])}return element}wysihtml5.dom.autoLink=autoLink;wysihtml5.dom.autoLink.URL_REG_EXP=URL_REG_EXP})(wysihtml5);(function(wysihtml5){var supportsClassList=wysihtml5.browser.supportsClassList(),api=wysihtml5.dom;api.addClass=function(element,className){if(supportsClassList){return element.classList.add(className)}if(api.hasClass(element,className)){return}element.className+=" "+className};api.removeClass=function(element,className){if(supportsClassList){return element.classList.remove(className)}element.className=element.className.replace(new RegExp("(^|\\s+)"+className+"(\\s+|$)")," ")};api.hasClass=function(element,className){if(supportsClassList){return element.classList.contains(className)}var elementClassName=element.className;return elementClassName.length>0&&(elementClassName==className||new RegExp("(^|\\s)"+className+"(\\s|$)").test(elementClassName))}})(wysihtml5);wysihtml5.dom.contains=function(){var documentElement=document.documentElement;if(documentElement.contains){return function(container,element){if(element.nodeType!==wysihtml5.ELEMENT_NODE){element=element.parentNode}return container!==element&&container.contains(element)}}else if(documentElement.compareDocumentPosition){return function(container,element){return!!(container.compareDocumentPosition(element)&16)}}}();wysihtml5.dom.convertToList=function(){function _createListItem(doc,list){var listItem=doc.createElement("li");list.appendChild(listItem);return listItem}function _createList(doc,type){return doc.createElement(type)}function convertToList(element,listType){if(element.nodeName==="UL"||element.nodeName==="OL"||element.nodeName==="MENU"){return element}var doc=element.ownerDocument,list=_createList(doc,listType),lineBreaks=element.querySelectorAll("br"),lineBreaksLength=lineBreaks.length,childNodes,childNodesLength,childNode,lineBreak,parentNode,isBlockElement,isLineBreak,currentListItem,i;for(i=0;i<lineBreaksLength;i++){lineBreak=lineBreaks[i];while((parentNode=lineBreak.parentNode)&&parentNode!==element&&parentNode.lastChild===lineBreak){if(wysihtml5.dom.getStyle("display").from(parentNode)==="block"){parentNode.removeChild(lineBreak);break}wysihtml5.dom.insert(lineBreak).after(lineBreak.parentNode)}}childNodes=wysihtml5.lang.array(element.childNodes).get();childNodesLength=childNodes.length;for(i=0;i<childNodesLength;i++){currentListItem=currentListItem||_createListItem(doc,list);childNode=childNodes[i];isBlockElement=wysihtml5.dom.getStyle("display").from(childNode)==="block";isLineBreak=childNode.nodeName==="BR";if(isBlockElement){currentListItem=currentListItem.firstChild?_createListItem(doc,list):currentListItem;currentListItem.appendChild(childNode);currentListItem=null;continue}if(isLineBreak){currentListItem=currentListItem.firstChild?null:currentListItem;continue}currentListItem.appendChild(childNode)}element.parentNode.replaceChild(list,element);return list}return convertToList}();wysihtml5.dom.copyAttributes=function(attributesToCopy){return{from:function(elementToCopyFrom){return{to:function(elementToCopyTo){var attribute,i=0,length=attributesToCopy.length;for(;i<length;i++){attribute=attributesToCopy[i];if(typeof elementToCopyFrom[attribute]!=="undefined"&&elementToCopyFrom[attribute]!==""){elementToCopyTo[attribute]=elementToCopyFrom[attribute]}}return{andTo:arguments.callee}}}}}};(function(dom){var BOX_SIZING_PROPERTIES=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"];var shouldIgnoreBoxSizingBorderBox=function(element){if(hasBoxSizingBorderBox(element)){return parseInt(dom.getStyle("width").from(element),10)<element.offsetWidth}return false};var hasBoxSizingBorderBox=function(element){var i=0,length=BOX_SIZING_PROPERTIES.length;for(;i<length;i++){if(dom.getStyle(BOX_SIZING_PROPERTIES[i]).from(element)==="border-box"){return BOX_SIZING_PROPERTIES[i]}}};dom.copyStyles=function(stylesToCopy){return{from:function(element){if(shouldIgnoreBoxSizingBorderBox(element)){stylesToCopy=wysihtml5.lang.array(stylesToCopy).without(BOX_SIZING_PROPERTIES)}var cssText="",length=stylesToCopy.length,i=0,property;for(;i<length;i++){property=stylesToCopy[i];cssText+=property+":"+dom.getStyle(property).from(element)+";"}return{to:function(element){dom.setStyles(cssText).on(element);return{andTo:arguments.callee}}}}}}})(wysihtml5.dom);(function(wysihtml5){wysihtml5.dom.delegate=function(container,selector,eventName,handler){return wysihtml5.dom.observe(container,eventName,function(event){var target=event.target,match=wysihtml5.lang.array(container.querySelectorAll(selector));while(target&&target!==container){if(match.contains(target)){handler.call(target,event);break}target=target.parentNode}})}})(wysihtml5);wysihtml5.dom.getAsDom=function(){var _innerHTMLShiv=function(html,context){var tempElement=context.createElement("div");tempElement.style.display="none";context.body.appendChild(tempElement);try{tempElement.innerHTML=html}catch(e){}context.body.removeChild(tempElement);return tempElement};var _ensureHTML5Compatibility=function(context){if(context._wysihtml5_supportsHTML5Tags){return}for(var i=0,length=HTML5_ELEMENTS.length;i<length;i++){context.createElement(HTML5_ELEMENTS[i])}context._wysihtml5_supportsHTML5Tags=true};var HTML5_ELEMENTS=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"];return function(html,context){context=context||document;var tempElement;if(typeof html==="object"&&html.nodeType){tempElement=context.createElement("div");tempElement.appendChild(html)}else if(wysihtml5.browser.supportsHTML5Tags(context)){tempElement=context.createElement("div");tempElement.innerHTML=html}else{_ensureHTML5Compatibility(context);tempElement=_innerHTMLShiv(html,context)}return tempElement}}();wysihtml5.dom.getParentElement=function(){function _isSameNodeName(nodeName,desiredNodeNames){if(!desiredNodeNames||!desiredNodeNames.length){return true}if(typeof desiredNodeNames==="string"){return nodeName===desiredNodeNames}else{return wysihtml5.lang.array(desiredNodeNames).contains(nodeName)}}function _isElement(node){return node.nodeType===wysihtml5.ELEMENT_NODE}function _hasClassName(element,className,classRegExp){var classNames=(element.className||"").match(classRegExp)||[];if(!className){return!!classNames.length}return classNames[classNames.length-1]===className}function _getParentElementWithNodeName(node,nodeName,levels){while(levels--&&node&&node.nodeName!=="BODY"){if(_isSameNodeName(node.nodeName,nodeName)){return node}node=node.parentNode}return null}function _getParentElementWithNodeNameAndClassName(node,nodeName,className,classRegExp,levels){while(levels--&&node&&node.nodeName!=="BODY"){if(_isElement(node)&&_isSameNodeName(node.nodeName,nodeName)&&_hasClassName(node,className,classRegExp)){return node}node=node.parentNode}return null}return function(node,matchingSet,levels){levels=levels||50;if(matchingSet.className||matchingSet.classRegExp){return _getParentElementWithNodeNameAndClassName(node,matchingSet.nodeName,matchingSet.className,matchingSet.classRegExp,levels)}else{return _getParentElementWithNodeName(node,matchingSet.nodeName,levels)}}}();wysihtml5.dom.getStyle=function(){var stylePropertyMapping={"float":"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},REG_EXP_CAMELIZE=/\-[a-z]/g;function camelize(str){return str.replace(REG_EXP_CAMELIZE,function(match){return match.charAt(1).toUpperCase()})}return function(property){return{from:function(element){if(element.nodeType!==wysihtml5.ELEMENT_NODE){return}var doc=element.ownerDocument,camelizedProperty=stylePropertyMapping[property]||camelize(property),style=element.style,currentStyle=element.currentStyle,styleValue=style[camelizedProperty];if(styleValue){return styleValue}if(currentStyle){try{return currentStyle[camelizedProperty]}catch(e){}}var win=doc.defaultView||doc.parentWindow,needsOverflowReset=(property==="height"||property==="width")&&element.nodeName==="TEXTAREA",originalOverflow,returnValue;if(win.getComputedStyle){if(needsOverflowReset){originalOverflow=style.overflow;style.overflow="hidden"}returnValue=win.getComputedStyle(element,null).getPropertyValue(property);if(needsOverflowReset){style.overflow=originalOverflow||""}return returnValue}}}}}();wysihtml5.dom.hasElementWithTagName=function(){var LIVE_CACHE={},DOCUMENT_IDENTIFIER=1;function _getDocumentIdentifier(doc){return doc._wysihtml5_identifier||(doc._wysihtml5_identifier=DOCUMENT_IDENTIFIER++)}return function(doc,tagName){var key=_getDocumentIdentifier(doc)+":"+tagName,cacheEntry=LIVE_CACHE[key];if(!cacheEntry){cacheEntry=LIVE_CACHE[key]=doc.getElementsByTagName(tagName)}return cacheEntry.length>0}}();(function(wysihtml5){var LIVE_CACHE={},DOCUMENT_IDENTIFIER=1;function _getDocumentIdentifier(doc){return doc._wysihtml5_identifier||(doc._wysihtml5_identifier=DOCUMENT_IDENTIFIER++)}wysihtml5.dom.hasElementWithClassName=function(doc,className){if(!wysihtml5.browser.supportsNativeGetElementsByClassName()){return!!doc.querySelector("."+className)}var key=_getDocumentIdentifier(doc)+":"+className,cacheEntry=LIVE_CACHE[key];if(!cacheEntry){cacheEntry=LIVE_CACHE[key]=doc.getElementsByClassName(className)}return cacheEntry.length>0}})(wysihtml5);wysihtml5.dom.insert=function(elementToInsert){return{after:function(element){element.parentNode.insertBefore(elementToInsert,element.nextSibling)},before:function(element){element.parentNode.insertBefore(elementToInsert,element)},into:function(element){element.appendChild(elementToInsert)}}};wysihtml5.dom.insertCSS=function(rules){rules=rules.join("\n");return{into:function(doc){var head=doc.head||doc.getElementsByTagName("head")[0],styleElement=doc.createElement("style");styleElement.type="text/css";if(styleElement.styleSheet){styleElement.styleSheet.cssText=rules}else{styleElement.appendChild(doc.createTextNode(rules))}if(head){head.appendChild(styleElement)}}}};wysihtml5.dom.observe=function(element,eventNames,handler){eventNames=typeof eventNames==="string"?[eventNames]:eventNames;var handlerWrapper,eventName,i=0,length=eventNames.length;for(;i<length;i++){eventName=eventNames[i];if(element.addEventListener){element.addEventListener(eventName,handler,false)}else{handlerWrapper=function(event){if(!("target"in event)){event.target=event.srcElement}event.preventDefault=event.preventDefault||function(){this.returnValue=false};event.stopPropagation=event.stopPropagation||function(){this.cancelBubble=true};handler.call(element,event)};element.attachEvent("on"+eventName,handlerWrapper)}}return{stop:function(){var eventName,i=0,length=eventNames.length;for(;i<length;i++){eventName=eventNames[i];if(element.removeEventListener){element.removeEventListener(eventName,handler,false)}else{element.detachEvent("on"+eventName,handlerWrapper)}}}}};wysihtml5.dom.parse=function(){var NODE_TYPE_MAPPING={1:_handleElement,3:_handleText},DEFAULT_NODE_NAME="span",WHITE_SPACE_REG_EXP=/\s+/,defaultRules={tags:{},classes:{}},currentRules={};function parse(elementOrHtml,rules,context,cleanUp){wysihtml5.lang.object(currentRules).merge(defaultRules).merge(rules).get();
context=context||elementOrHtml.ownerDocument||document;var fragment=context.createDocumentFragment(),isString=typeof elementOrHtml==="string",element,newNode,firstChild;if(isString){element=wysihtml5.dom.getAsDom(elementOrHtml,context)}else{element=elementOrHtml}while(element.firstChild){firstChild=element.firstChild;element.removeChild(firstChild);if(firstChild.innerHTML&&firstChild.innerHTML.indexOf("<img")!==-1){fragment.appendChild(firstChild)}else{newNode=_convert(firstChild,cleanUp);if(newNode){fragment.appendChild(newNode)}}}element.appendChild(fragment);return isString?wysihtml5.quirks.getCorrectInnerHTML(element):element}function _convert(oldNode,cleanUp){var oldNodeType=oldNode.nodeType,oldChilds=oldNode.childNodes,oldChildsLength=oldChilds.length,newNode,method=NODE_TYPE_MAPPING[oldNodeType],i=0;newNode=method&&method(oldNode);if(!newNode){return null}for(i=0;i<oldChildsLength;i++){newChild=_convert(oldChilds[i],cleanUp);if(newChild){newNode.appendChild(newChild)}}if(cleanUp&&newNode.childNodes.length<=1&&newNode.nodeName.toLowerCase()===DEFAULT_NODE_NAME&&!newNode.attributes.length){return newNode.firstChild}return newNode}function _handleElement(oldNode){var rule,newNode,endTag,tagRules=currentRules.tags,nodeName=oldNode.nodeName.toLowerCase(),scopeName=oldNode.scopeName;if(oldNode._wysihtml5){return null}oldNode._wysihtml5=1;if(oldNode.className==="wysihtml5-temp"){return null}if(scopeName&&scopeName!="HTML"){nodeName=scopeName+":"+nodeName}if("outerHTML"in oldNode){if(!wysihtml5.browser.autoClosesUnclosedTags()&&oldNode.nodeName==="P"&&oldNode.outerHTML.slice(-4).toLowerCase()!=="</p>"){nodeName="div"}}if(nodeName in tagRules){rule=tagRules[nodeName];if(!rule||rule.remove){return null}rule=typeof rule==="string"?{rename_tag:rule}:rule}else if(oldNode.firstChild){rule={rename_tag:DEFAULT_NODE_NAME}}else{return null}newNode=oldNode.ownerDocument.createElement(rule.rename_tag||nodeName);_handleAttributes(oldNode,newNode,rule);oldNode=null;return newNode}function _handleAttributes(oldNode,newNode,rule){var attributes={},setClass=rule.set_class,addClass=rule.add_class,setAttributes=rule.set_attributes,checkAttributes=rule.check_attributes,allowedClasses=currentRules.classes,i=0,classes=[],newClasses=[],newUniqueClasses=[],oldClasses=[],classesLength,newClassesLength,currentClass,newClass,attributeName,newAttributeValue,method;if(setAttributes){attributes=wysihtml5.lang.object(setAttributes).clone()}if(checkAttributes){for(attributeName in checkAttributes){method=attributeCheckMethods[checkAttributes[attributeName]];if(!method){continue}newAttributeValue=method(_getAttribute(oldNode,attributeName));if(typeof newAttributeValue==="string"){attributes[attributeName]=newAttributeValue}}}if(setClass){classes.push(setClass)}if(addClass){for(attributeName in addClass){method=addClassMethods[addClass[attributeName]];if(!method){continue}newClass=method(_getAttribute(oldNode,attributeName));if(typeof newClass==="string"){classes.push(newClass)}}}allowedClasses["_wysihtml5-temp-placeholder"]=1;oldClasses=oldNode.getAttribute("class");if(oldClasses){classes=classes.concat(oldClasses.split(WHITE_SPACE_REG_EXP))}classesLength=classes.length;for(;i<classesLength;i++){currentClass=classes[i];if(allowedClasses[currentClass]){newClasses.push(currentClass)}}newClassesLength=newClasses.length;while(newClassesLength--){currentClass=newClasses[newClassesLength];if(!wysihtml5.lang.array(newUniqueClasses).contains(currentClass)){newUniqueClasses.unshift(currentClass)}}if(newUniqueClasses.length){attributes["class"]=newUniqueClasses.join(" ")}for(attributeName in attributes){try{newNode.setAttribute(attributeName,attributes[attributeName])}catch(e){}}if(attributes.src){if(typeof attributes.width!=="undefined"){newNode.setAttribute("width",attributes.width)}if(typeof attributes.height!=="undefined"){newNode.setAttribute("height",attributes.height)}}}var HAS_GET_ATTRIBUTE_BUG=!wysihtml5.browser.supportsGetAttributeCorrectly();function _getAttribute(node,attributeName){attributeName=attributeName.toLowerCase();var nodeName=node.nodeName;if(nodeName=="IMG"&&attributeName=="src"&&_isLoadedImage(node)===true){return node.src}else if(HAS_GET_ATTRIBUTE_BUG&&"outerHTML"in node){var outerHTML=node.outerHTML.toLowerCase(),hasAttribute=outerHTML.indexOf(" "+attributeName+"=")!=-1;return hasAttribute?node.getAttribute(attributeName):null}else{return node.getAttribute(attributeName)}}function _isLoadedImage(node){try{return node.complete&&!node.mozMatchesSelector(":-moz-broken")}catch(e){if(node.complete&&node.readyState==="complete"){return true}}}function _handleText(oldNode){return oldNode.ownerDocument.createTextNode(oldNode.data)}var attributeCheckMethods={url:function(){var REG_EXP=/^https?:\/\//i;return function(attributeValue){if(!attributeValue||!attributeValue.match(REG_EXP)){return null}return attributeValue.replace(REG_EXP,function(match){return match.toLowerCase()})}}(),alt:function(){var REG_EXP=/[^ a-z0-9_\-]/gi;return function(attributeValue){if(!attributeValue){return""}return attributeValue.replace(REG_EXP,"")}}(),numbers:function(){var REG_EXP=/\D/g;return function(attributeValue){attributeValue=(attributeValue||"").replace(REG_EXP,"");return attributeValue||null}}()};var addClassMethods={align_img:function(){var mapping={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(attributeValue){return mapping[String(attributeValue).toLowerCase()]}}(),align_text:function(){var mapping={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(attributeValue){return mapping[String(attributeValue).toLowerCase()]}}(),clear_br:function(){var mapping={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(attributeValue){return mapping[String(attributeValue).toLowerCase()]}}(),size_font:function(){var mapping={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(attributeValue){return mapping[String(attributeValue).charAt(0)]}}()};return parse}();wysihtml5.dom.removeEmptyTextNodes=function(node){var childNode,childNodes=wysihtml5.lang.array(node.childNodes).get(),childNodesLength=childNodes.length,i=0;for(;i<childNodesLength;i++){childNode=childNodes[i];if(childNode.nodeType===wysihtml5.TEXT_NODE&&childNode.data===""){childNode.parentNode.removeChild(childNode)}}};wysihtml5.dom.renameElement=function(element,newNodeName){var newElement=element.ownerDocument.createElement(newNodeName),firstChild;while(firstChild=element.firstChild){newElement.appendChild(firstChild)}wysihtml5.dom.copyAttributes(["align","className"]).from(element).to(newElement);element.parentNode.replaceChild(newElement,element);return newElement};wysihtml5.dom.replaceWithChildNodes=function(node){if(!node.parentNode){return}if(!node.firstChild){node.parentNode.removeChild(node);return}var fragment=node.ownerDocument.createDocumentFragment();while(node.firstChild){fragment.appendChild(node.firstChild)}node.parentNode.replaceChild(fragment,node);node=fragment=null};(function(dom){function _isBlockElement(node){return dom.getStyle("display").from(node)==="block"}function _isLineBreak(node){return node.nodeName==="BR"}function _appendLineBreak(element){var lineBreak=element.ownerDocument.createElement("br");element.appendChild(lineBreak)}function resolveList(list){if(list.nodeName!=="MENU"&&list.nodeName!=="UL"&&list.nodeName!=="OL"){return}var doc=list.ownerDocument,fragment=doc.createDocumentFragment(),previousSibling=list.previousElementSibling||list.previousSibling,firstChild,lastChild,isLastChild,shouldAppendLineBreak,listItem;if(previousSibling&&!_isBlockElement(previousSibling)){_appendLineBreak(fragment)}while(listItem=list.firstChild){lastChild=listItem.lastChild;while(firstChild=listItem.firstChild){isLastChild=firstChild===lastChild;shouldAppendLineBreak=isLastChild&&!_isBlockElement(firstChild)&&!_isLineBreak(firstChild);fragment.appendChild(firstChild);if(shouldAppendLineBreak){_appendLineBreak(fragment)}}listItem.parentNode.removeChild(listItem)}list.parentNode.replaceChild(fragment,list)}dom.resolveList=resolveList})(wysihtml5.dom);(function(wysihtml5){var doc=document,windowProperties=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],windowProperties2=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],documentProperties=["referrer","write","open","close"];wysihtml5.dom.Sandbox=Base.extend({constructor:function(readyCallback,config){this.callback=readyCallback||wysihtml5.EMPTY_FUNCTION;this.config=wysihtml5.lang.object({}).merge(config).get();this.iframe=this._createIframe()},insertInto:function(element){if(typeof element==="string"){element=doc.getElementById(element)}element.appendChild(this.iframe)},getIframe:function(){return this.iframe},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var iframe=this.getIframe();iframe.parentNode.removeChild(iframe)},_readyError:function(){throw new Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var that=this,iframe=doc.createElement("iframe");iframe.className="wysihtml5-sandbox";wysihtml5.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(iframe);if(wysihtml5.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()){iframe.src="javascript:'<html></html>'"}iframe.onload=function(){iframe.onreadystatechange=iframe.onload=null;that._onLoadIframe(iframe)};iframe.onreadystatechange=function(){if(/loaded|complete/.test(iframe.readyState)){iframe.onreadystatechange=iframe.onload=null;that._onLoadIframe(iframe)}};return iframe},_onLoadIframe:function(iframe){if(!wysihtml5.dom.contains(doc.documentElement,iframe)){return}var that=this,iframeWindow=iframe.contentWindow,iframeDocument=iframe.contentWindow.document,charset=doc.characterSet||doc.charset||"utf-8",sandboxHtml=this._getHtml({charset:charset,stylesheets:this.config.stylesheets});iframeDocument.open("text/html","replace");iframeDocument.write(sandboxHtml);iframeDocument.close();this.getWindow=function(){return iframe.contentWindow};this.getDocument=function(){return iframe.contentWindow.document};iframeWindow.onerror=function(errorMessage,fileName,lineNumber){throw new Error("wysihtml5.Sandbox: "+errorMessage,fileName,lineNumber)};if(!wysihtml5.browser.supportsSandboxedIframes()){var i,length;for(i=0,length=windowProperties.length;i<length;i++){this._unset(iframeWindow,windowProperties[i])}for(i=0,length=windowProperties2.length;i<length;i++){this._unset(iframeWindow,windowProperties2[i],wysihtml5.EMPTY_FUNCTION)}for(i=0,length=documentProperties.length;i<length;i++){this._unset(iframeDocument,documentProperties[i])}this._unset(iframeDocument,"cookie","",true)}this.loaded=true;setTimeout(function(){that.callback(that)},0)},_getHtml:function(templateVars){var stylesheets=templateVars.stylesheets,html="",i=0,length;stylesheets=typeof stylesheets==="string"?[stylesheets]:stylesheets;if(stylesheets){length=stylesheets.length;for(;i<length;i++){html+='<link rel="stylesheet" href="'+stylesheets[i]+'">'}}templateVars.stylesheets=html;return wysihtml5.lang.string("<!DOCTYPE html><html><head>"+'<meta charset="#{charset}">#{stylesheets}</head>'+"<body></body></html>").interpolate(templateVars)},_unset:function(object,property,value,setter){try{object[property]=value}catch(e){}try{object.__defineGetter__(property,function(){return value})}catch(e){}if(setter){try{object.__defineSetter__(property,function(){})}catch(e){}}if(!wysihtml5.browser.crashesWhenDefineProperty(property)){try{var config={get:function(){return value}};if(setter){config.set=function(){}}Object.defineProperty(object,property,config)}catch(e){}}}})})(wysihtml5);(function(){var mapping={className:"class"};wysihtml5.dom.setAttributes=function(attributes){return{on:function(element){for(var i in attributes){element.setAttribute(mapping[i]||i,attributes[i])}}}}})();wysihtml5.dom.setStyles=function(styles){return{on:function(element){var style=element.style;if(typeof styles==="string"){style.cssText+=";"+styles;return}for(var i in styles){if(i==="float"){style.cssFloat=styles[i];style.styleFloat=styles[i]}else{style[i]=styles[i]}}}}};(function(dom){dom.simulatePlaceholder=function(editor,view,placeholderText){var CLASS_NAME="placeholder",unset=function(){if(view.hasPlaceholderSet()){view.clear()}dom.removeClass(view.element,CLASS_NAME)},set=function(){if(view.isEmpty()){view.setValue(placeholderText);dom.addClass(view.element,CLASS_NAME)}};editor.observe("set_placeholder",set).observe("unset_placeholder",unset).observe("focus:composer",unset).observe("paste:composer",unset).observe("blur:composer",set);set()}})(wysihtml5.dom);(function(dom){var documentElement=document.documentElement;if("textContent"in documentElement){dom.setTextContent=function(element,text){element.textContent=text};dom.getTextContent=function(element){return element.textContent}}else if("innerText"in documentElement){dom.setTextContent=function(element,text){element.innerText=text};dom.getTextContent=function(element){return element.innerText}}else{dom.setTextContent=function(element,text){element.nodeValue=text};dom.getTextContent=function(element){return element.nodeValue}}})(wysihtml5.dom);wysihtml5.quirks.cleanPastedHTML=function(){var defaultRules={"a u":wysihtml5.dom.replaceWithChildNodes};function cleanPastedHTML(elementOrHtml,rules,context){rules=rules||defaultRules;context=context||elementOrHtml.ownerDocument||document;var element,isString=typeof elementOrHtml==="string",method,matches,matchesLength,i,j=0;if(isString){element=wysihtml5.dom.getAsDom(elementOrHtml,context)}else{element=elementOrHtml}for(i in rules){matches=element.querySelectorAll(i);method=rules[i];matchesLength=matches.length;for(;j<matchesLength;j++){method(matches[j])}}matches=elementOrHtml=rules=null;return isString?element.innerHTML:element}return cleanPastedHTML}();(function(wysihtml5){var dom=wysihtml5.dom;wysihtml5.quirks.ensureProperClearing=function(){var clearIfNecessary=function(event){var element=this;setTimeout(function(){var innerHTML=element.innerHTML.toLowerCase();if(innerHTML=="<p>&nbsp;</p>"||innerHTML=="<p>&nbsp;</p><p>&nbsp;</p>"){element.innerHTML=""}},0)};return function(composer){dom.observe(composer.element,["cut","keydown"],clearIfNecessary)}}();wysihtml5.quirks.ensureProperClearingOfLists=function(){var ELEMENTS_THAT_CONTAIN_LI=["OL","UL","MENU"];var clearIfNecessary=function(element,contentEditableElement){if(!contentEditableElement.firstChild||!wysihtml5.lang.array(ELEMENTS_THAT_CONTAIN_LI).contains(contentEditableElement.firstChild.nodeName)){return}var list=dom.getParentElement(element,{nodeName:ELEMENTS_THAT_CONTAIN_LI});if(!list){return}var listIsFirstChildOfContentEditable=list==contentEditableElement.firstChild;if(!listIsFirstChildOfContentEditable){return}var hasOnlyOneListItem=list.childNodes.length<=1;if(!hasOnlyOneListItem){return}var onlyListItemIsEmpty=list.firstChild?list.firstChild.innerHTML==="":true;if(!onlyListItemIsEmpty){return}list.parentNode.removeChild(list)};return function(composer){dom.observe(composer.element,"keydown",function(event){if(event.keyCode!==wysihtml5.BACKSPACE_KEY){return}var element=composer.selection.getSelectedNode();clearIfNecessary(element,composer.element)})}}()})(wysihtml5);(function(wysihtml5){var TILDE_ESCAPED="%7E";wysihtml5.quirks.getCorrectInnerHTML=function(element){var innerHTML=element.innerHTML;if(innerHTML.indexOf(TILDE_ESCAPED)===-1){return innerHTML}var elementsWithTilde=element.querySelectorAll("[href*='~'], [src*='~']"),url,urlToSearch,length,i;for(i=0,length=elementsWithTilde.length;i<length;i++){url=elementsWithTilde[i].href||elementsWithTilde[i].src;urlToSearch=wysihtml5.lang.string(url).replace("~").by(TILDE_ESCAPED);innerHTML=wysihtml5.lang.string(innerHTML).replace(urlToSearch).by(url)}return innerHTML}})(wysihtml5);(function(wysihtml5){var dom=wysihtml5.dom,USE_NATIVE_LINE_BREAK_WHEN_CARET_INSIDE_TAGS=["LI","P","H1","H2","H3","H4","H5","H6"],LIST_TAGS=["UL","OL","MENU"];wysihtml5.quirks.insertLineBreakOnReturn=function(composer){function unwrap(selectedNode){var parentElement=dom.getParentElement(selectedNode,{nodeName:["P","DIV"]},2);if(!parentElement){return}var invisibleSpace=document.createTextNode(wysihtml5.INVISIBLE_SPACE);dom.insert(invisibleSpace).before(parentElement);dom.replaceWithChildNodes(parentElement);composer.selection.selectNode(invisibleSpace)}function keyDown(event){var keyCode=event.keyCode;if(event.shiftKey||keyCode!==wysihtml5.ENTER_KEY&&keyCode!==wysihtml5.BACKSPACE_KEY){return}var element=event.target,selectedNode=composer.selection.getSelectedNode(),blockElement=dom.getParentElement(selectedNode,{nodeName:USE_NATIVE_LINE_BREAK_WHEN_CARET_INSIDE_TAGS},4);if(blockElement){if(blockElement.nodeName==="LI"&&(keyCode===wysihtml5.ENTER_KEY||keyCode===wysihtml5.BACKSPACE_KEY)){setTimeout(function(){var selectedNode=composer.selection.getSelectedNode(),list,div;if(!selectedNode){return}list=dom.getParentElement(selectedNode,{nodeName:LIST_TAGS},2);if(list){return}unwrap(selectedNode)},0)}else if(blockElement.nodeName.match(/H[1-6]/)&&keyCode===wysihtml5.ENTER_KEY){setTimeout(function(){unwrap(composer.selection.getSelectedNode())},0)}return}if(keyCode===wysihtml5.ENTER_KEY&&!wysihtml5.browser.insertsLineBreaksOnReturn()){composer.commands.exec("insertLineBreak");event.preventDefault()}}dom.observe(composer.element.ownerDocument,"keydown",keyDown)}})(wysihtml5);(function(wysihtml5){var CLASS_NAME="wysihtml5-quirks-redraw";wysihtml5.quirks.redraw=function(element){wysihtml5.dom.addClass(element,CLASS_NAME);wysihtml5.dom.removeClass(element,CLASS_NAME);try{var doc=element.ownerDocument;doc.execCommand("italic",false,null);doc.execCommand("italic",false,null)}catch(e){}}})(wysihtml5);(function(wysihtml5){var dom=wysihtml5.dom;function _getCumulativeOffsetTop(element){var top=0;if(element.parentNode){do{top+=element.offsetTop||0;element=element.offsetParent}while(element)}return top}wysihtml5.Selection=Base.extend({constructor:function(editor){window.rangy.init();this.editor=editor;this.composer=editor.composer;this.doc=this.composer.doc},getBookmark:function(){var range=this.getRange();return range&&range.cloneRange()},setBookmark:function(bookmark){if(!bookmark){return}this.setSelection(bookmark)},setBefore:function(node){var range=rangy.createRange(this.doc);range.setStartBefore(node);range.setEndBefore(node);return this.setSelection(range)},setAfter:function(node){var range=rangy.createRange(this.doc);range.setStartAfter(node);range.setEndAfter(node);return this.setSelection(range)},selectNode:function(node){var range=rangy.createRange(this.doc),isElement=node.nodeType===wysihtml5.ELEMENT_NODE,canHaveHTML="canHaveHTML"in node?node.canHaveHTML:node.nodeName!=="IMG",content=isElement?node.innerHTML:node.data,isEmpty=content===""||content===wysihtml5.INVISIBLE_SPACE,displayStyle=dom.getStyle("display").from(node),isBlockElement=displayStyle==="block"||displayStyle==="list-item";if(isEmpty&&isElement&&canHaveHTML){try{node.innerHTML=wysihtml5.INVISIBLE_SPACE}catch(e){}}if(canHaveHTML){range.selectNodeContents(node)}else{range.selectNode(node)}if(canHaveHTML&&isEmpty&&isElement){range.collapse(isBlockElement)}else if(canHaveHTML&&isEmpty){range.setStartAfter(node);range.setEndAfter(node)}this.setSelection(range)},getSelectedNode:function(controlRange){var selection,range;if(controlRange&&this.doc.selection&&this.doc.selection.type==="Control"){range=this.doc.selection.createRange();if(range&&range.length){return range.item(0)}}selection=this.getSelection(this.doc);if(selection.focusNode===selection.anchorNode){return selection.focusNode}else{range=this.getRange(this.doc);return range?range.commonAncestorContainer:this.doc.body}},executeAndRestore:function(method,restoreScrollPosition){var body=this.doc.body,oldScrollTop=restoreScrollPosition&&body.scrollTop,oldScrollLeft=restoreScrollPosition&&body.scrollLeft,className="_wysihtml5-temp-placeholder",placeholderHTML='<span class="'+className+'">'+wysihtml5.INVISIBLE_SPACE+"</span>",range=this.getRange(this.doc),newRange;if(!range){method(body,body);return}var node=range.createContextualFragment(placeholderHTML);range.insertNode(node);try{method(range.startContainer,range.endContainer)}catch(e3){setTimeout(function(){throw e3},0)}caretPlaceholder=this.doc.querySelector("."+className);if(caretPlaceholder){newRange=rangy.createRange(this.doc);newRange.selectNode(caretPlaceholder);newRange.deleteContents();this.setSelection(newRange)}else{body.focus()}if(restoreScrollPosition){body.scrollTop=oldScrollTop;body.scrollLeft=oldScrollLeft}try{caretPlaceholder.parentNode.removeChild(caretPlaceholder)}catch(e4){}},executeAndRestoreSimple:function(method){var range=this.getRange(),body=this.doc.body,newRange,firstNode,lastNode,textNodes,rangeBackup;if(!range){method(body,body);return}textNodes=range.getNodes([3]);firstNode=textNodes[0]||range.startContainer;lastNode=textNodes[textNodes.length-1]||range.endContainer;rangeBackup={collapsed:range.collapsed,startContainer:firstNode,startOffset:firstNode===range.startContainer?range.startOffset:0,endContainer:lastNode,endOffset:lastNode===range.endContainer?range.endOffset:lastNode.length};try{method(range.startContainer,range.endContainer)}catch(e){setTimeout(function(){throw e},0)}newRange=rangy.createRange(this.doc);try{newRange.setStart(rangeBackup.startContainer,rangeBackup.startOffset)}catch(e1){}try{newRange.setEnd(rangeBackup.endContainer,rangeBackup.endOffset)}catch(e2){}try{this.setSelection(newRange)}catch(e3){}},insertHTML:function(html){var range=rangy.createRange(this.doc),node=range.createContextualFragment(html),lastChild=node.lastChild;this.insertNode(node);if(lastChild){this.setAfter(lastChild)}},insertNode:function(node){var range=this.getRange();if(range){range.insertNode(node)}},surround:function(node){var range=this.getRange();if(!range){return}try{range.surroundContents(node);this.selectNode(node)}catch(e){node.appendChild(range.extractContents());range.insertNode(node)}},scrollIntoView:function(){var doc=this.doc,hasScrollBars=doc.documentElement.scrollHeight>doc.documentElement.offsetHeight,tempElement=doc._wysihtml5ScrollIntoViewElement=doc._wysihtml5ScrollIntoViewElement||function(){var element=doc.createElement("span");element.innerHTML=wysihtml5.INVISIBLE_SPACE;return element}(),offsetTop;if(hasScrollBars){this.insertNode(tempElement);offsetTop=_getCumulativeOffsetTop(tempElement);tempElement.parentNode.removeChild(tempElement);if(offsetTop>doc.body.scrollTop){doc.body.scrollTop=offsetTop}}},selectLine:function(){if(wysihtml5.browser.supportsSelectionModify()){this._selectLine_W3C()}else if(this.doc.selection){this._selectLine_MSIE()}},_selectLine_W3C:function(){var win=this.doc.defaultView,selection=win.getSelection();selection.modify("extend","left","lineboundary");selection.modify("extend","right","lineboundary")},_selectLine_MSIE:function(){var range=this.doc.selection.createRange(),rangeTop=range.boundingTop,rangeHeight=range.boundingHeight,scrollWidth=this.doc.body.scrollWidth,rangeBottom,rangeEnd,measureNode,i,j;if(!range.moveToPoint){return}if(rangeTop===0){measureNode=this.doc.createElement("span");this.insertNode(measureNode);rangeTop=measureNode.offsetTop;measureNode.parentNode.removeChild(measureNode)}rangeTop+=1;for(i=-10;i<scrollWidth;i+=2){try{range.moveToPoint(i,rangeTop);break}catch(e1){}}rangeBottom=rangeTop;rangeEnd=this.doc.selection.createRange();for(j=scrollWidth;j>=0;j--){try{rangeEnd.moveToPoint(j,rangeBottom);break}catch(e2){}}range.setEndPoint("EndToEnd",rangeEnd);range.select()},getText:function(){var selection=this.getSelection();return selection?selection.toString():""},getNodes:function(nodeType,filter){var range=this.getRange();if(range){return range.getNodes([nodeType],filter)}else{return[]}},getRange:function(){var selection=this.getSelection();return selection&&selection.rangeCount&&selection.getRangeAt(0)},getSelection:function(){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow)},setSelection:function(range){var win=this.doc.defaultView||this.doc.parentWindow,selection=rangy.getSelection(win);return selection.setSingleRange(range)}})})(wysihtml5);(function(wysihtml5,rangy){var defaultTagName="span";var REG_EXP_WHITE_SPACE=/\s+/g;function hasClass(el,cssClass,regExp){if(!el.className){return false}var matchingClassNames=el.className.match(regExp)||[];return matchingClassNames[matchingClassNames.length-1]===cssClass}function addClass(el,cssClass,regExp){if(el.className){removeClass(el,regExp);el.className+=" "+cssClass}else{el.className=cssClass}}function removeClass(el,regExp){if(el.className){el.className=el.className.replace(regExp,"")}}function hasSameClasses(el1,el2){return el1.className.replace(REG_EXP_WHITE_SPACE," ")==el2.className.replace(REG_EXP_WHITE_SPACE," ")}function replaceWithOwnChildren(el){var parent=el.parentNode;while(el.firstChild){parent.insertBefore(el.firstChild,el)}parent.removeChild(el)}function elementsHaveSameNonClassAttributes(el1,el2){if(el1.attributes.length!=el2.attributes.length){return false}for(var i=0,len=el1.attributes.length,attr1,attr2,name;i<len;++i){attr1=el1.attributes[i];name=attr1.name;if(name!="class"){attr2=el2.attributes.getNamedItem(name);if(attr1.specified!=attr2.specified){return false}if(attr1.specified&&attr1.nodeValue!==attr2.nodeValue){return false}}}return true}function isSplitPoint(node,offset){if(rangy.dom.isCharacterDataNode(node)){if(offset==0){return!!node.previousSibling}else if(offset==node.length){return!!node.nextSibling}else{return true}}return offset>0&&offset<node.childNodes.length}function splitNodeAt(node,descendantNode,descendantOffset){var newNode;if(rangy.dom.isCharacterDataNode(descendantNode)){if(descendantOffset==0){descendantOffset=rangy.dom.getNodeIndex(descendantNode);descendantNode=descendantNode.parentNode}else if(descendantOffset==descendantNode.length){descendantOffset=rangy.dom.getNodeIndex(descendantNode)+1;descendantNode=descendantNode.parentNode}else{newNode=rangy.dom.splitDataNode(descendantNode,descendantOffset)}}if(!newNode){newNode=descendantNode.cloneNode(false);if(newNode.id){newNode.removeAttribute("id")}var child;while(child=descendantNode.childNodes[descendantOffset]){newNode.appendChild(child)}rangy.dom.insertAfter(newNode,descendantNode)}return descendantNode==node?newNode:splitNodeAt(node,newNode.parentNode,rangy.dom.getNodeIndex(newNode))}function Merge(firstNode){this.isElementMerge=firstNode.nodeType==wysihtml5.ELEMENT_NODE;this.firstTextNode=this.isElementMerge?firstNode.lastChild:firstNode;this.textNodes=[this.firstTextNode]}Merge.prototype={doMerge:function(){var textBits=[],textNode,parent,text;for(var i=0,len=this.textNodes.length;i<len;++i){textNode=this.textNodes[i];parent=textNode.parentNode;textBits[i]=textNode.data;if(i){parent.removeChild(textNode);if(!parent.hasChildNodes()){parent.parentNode.removeChild(parent)}}}this.firstTextNode.data=text=textBits.join("");return text},getLength:function(){var i=this.textNodes.length,len=0;while(i--){len+=this.textNodes[i].length}return len},toString:function(){var textBits=[];for(var i=0,len=this.textNodes.length;i<len;++i){textBits[i]="'"+this.textNodes[i].data+"'"}return"[Merge("+textBits.join(",")+")]"}};function HTMLApplier(tagNames,cssClass,similarClassRegExp,normalize){this.tagNames=tagNames||[defaultTagName];this.cssClass=cssClass||"";this.similarClassRegExp=similarClassRegExp;this.normalize=normalize;this.applyToAnyTagName=false}HTMLApplier.prototype={getAncestorWithClass:function(node){var cssClassMatch;while(node){cssClassMatch=this.cssClass?hasClass(node,this.cssClass,this.similarClassRegExp):true;if(node.nodeType==wysihtml5.ELEMENT_NODE&&rangy.dom.arrayContains(this.tagNames,node.tagName.toLowerCase())&&cssClassMatch){return node}node=node.parentNode}return false},postApply:function(textNodes,range){var firstNode=textNodes[0],lastNode=textNodes[textNodes.length-1];var merges=[],currentMerge;var rangeStartNode=firstNode,rangeEndNode=lastNode;var rangeStartOffset=0,rangeEndOffset=lastNode.length;var textNode,precedingTextNode;for(var i=0,len=textNodes.length;i<len;++i){textNode=textNodes[i];precedingTextNode=this.getAdjacentMergeableTextNode(textNode.parentNode,false);if(precedingTextNode){if(!currentMerge){currentMerge=new Merge(precedingTextNode);merges.push(currentMerge)}currentMerge.textNodes.push(textNode);if(textNode===firstNode){rangeStartNode=currentMerge.firstTextNode;rangeStartOffset=rangeStartNode.length}if(textNode===lastNode){rangeEndNode=currentMerge.firstTextNode;rangeEndOffset=currentMerge.getLength()}}else{currentMerge=null}}var nextTextNode=this.getAdjacentMergeableTextNode(lastNode.parentNode,true);if(nextTextNode){if(!currentMerge){currentMerge=new Merge(lastNode);merges.push(currentMerge)}currentMerge.textNodes.push(nextTextNode)}if(merges.length){for(i=0,len=merges.length;i<len;++i){merges[i].doMerge()}range.setStart(rangeStartNode,rangeStartOffset);range.setEnd(rangeEndNode,rangeEndOffset)}},getAdjacentMergeableTextNode:function(node,forward){var isTextNode=node.nodeType==wysihtml5.TEXT_NODE;var el=isTextNode?node.parentNode:node;var adjacentNode;var propName=forward?"nextSibling":"previousSibling";if(isTextNode){adjacentNode=node[propName];if(adjacentNode&&adjacentNode.nodeType==wysihtml5.TEXT_NODE){return adjacentNode}}else{adjacentNode=el[propName];if(adjacentNode&&this.areElementsMergeable(node,adjacentNode)){return adjacentNode[forward?"firstChild":"lastChild"]}}return null},areElementsMergeable:function(el1,el2){return rangy.dom.arrayContains(this.tagNames,(el1.tagName||"").toLowerCase())&&rangy.dom.arrayContains(this.tagNames,(el2.tagName||"").toLowerCase())&&hasSameClasses(el1,el2)&&elementsHaveSameNonClassAttributes(el1,el2)},createContainer:function(doc){var el=doc.createElement(this.tagNames[0]);if(this.cssClass){el.className=this.cssClass}return el},applyToTextNode:function(textNode){var parent=textNode.parentNode;if(parent.childNodes.length==1&&rangy.dom.arrayContains(this.tagNames,parent.tagName.toLowerCase())){if(this.cssClass){addClass(parent,this.cssClass,this.similarClassRegExp)}}else{var el=this.createContainer(rangy.dom.getDocument(textNode));textNode.parentNode.insertBefore(el,textNode);el.appendChild(textNode)}},isRemovable:function(el){return rangy.dom.arrayContains(this.tagNames,el.tagName.toLowerCase())&&wysihtml5.lang.string(el.className).trim()==this.cssClass},undoToTextNode:function(textNode,range,ancestorWithClass){if(!range.containsNode(ancestorWithClass)){var ancestorRange=range.cloneRange();ancestorRange.selectNode(ancestorWithClass);if(ancestorRange.isPointInRange(range.endContainer,range.endOffset)&&isSplitPoint(range.endContainer,range.endOffset)){splitNodeAt(ancestorWithClass,range.endContainer,range.endOffset);range.setEndAfter(ancestorWithClass)}if(ancestorRange.isPointInRange(range.startContainer,range.startOffset)&&isSplitPoint(range.startContainer,range.startOffset)){ancestorWithClass=splitNodeAt(ancestorWithClass,range.startContainer,range.startOffset)}}if(this.similarClassRegExp){removeClass(ancestorWithClass,this.similarClassRegExp)}if(this.isRemovable(ancestorWithClass)){replaceWithOwnChildren(ancestorWithClass)}},applyToRange:function(range){var textNodes=range.getNodes([wysihtml5.TEXT_NODE]);if(!textNodes.length){try{var node=this.createContainer(range.endContainer.ownerDocument);range.surroundContents(node);this.selectNode(range,node);
return}catch(e){}}range.splitBoundaries();textNodes=range.getNodes([wysihtml5.TEXT_NODE]);if(textNodes.length){var textNode;for(var i=0,len=textNodes.length;i<len;++i){textNode=textNodes[i];if(!this.getAncestorWithClass(textNode)){this.applyToTextNode(textNode)}}range.setStart(textNodes[0],0);textNode=textNodes[textNodes.length-1];range.setEnd(textNode,textNode.length);if(this.normalize){this.postApply(textNodes,range)}}},undoToRange:function(range){var textNodes=range.getNodes([wysihtml5.TEXT_NODE]),textNode,ancestorWithClass;if(textNodes.length){range.splitBoundaries();textNodes=range.getNodes([wysihtml5.TEXT_NODE])}else{var doc=range.endContainer.ownerDocument,node=doc.createTextNode(wysihtml5.INVISIBLE_SPACE);range.insertNode(node);range.selectNode(node);textNodes=[node]}for(var i=0,len=textNodes.length;i<len;++i){textNode=textNodes[i];ancestorWithClass=this.getAncestorWithClass(textNode);if(ancestorWithClass){this.undoToTextNode(textNode,range,ancestorWithClass)}}if(len==1){this.selectNode(range,textNodes[0])}else{range.setStart(textNodes[0],0);textNode=textNodes[textNodes.length-1];range.setEnd(textNode,textNode.length);if(this.normalize){this.postApply(textNodes,range)}}},selectNode:function(range,node){var isElement=node.nodeType===wysihtml5.ELEMENT_NODE,canHaveHTML="canHaveHTML"in node?node.canHaveHTML:true,content=isElement?node.innerHTML:node.data,isEmpty=content===""||content===wysihtml5.INVISIBLE_SPACE;if(isEmpty&&isElement&&canHaveHTML){try{node.innerHTML=wysihtml5.INVISIBLE_SPACE}catch(e){}}range.selectNodeContents(node);if(isEmpty&&isElement){range.collapse(false)}else if(isEmpty){range.setStartAfter(node);range.setEndAfter(node)}},getTextSelectedByRange:function(textNode,range){var textRange=range.cloneRange();textRange.selectNodeContents(textNode);var intersectionRange=textRange.intersection(range);var text=intersectionRange?intersectionRange.toString():"";textRange.detach();return text},isAppliedToRange:function(range){var ancestors=[],ancestor,textNodes=range.getNodes([wysihtml5.TEXT_NODE]);if(!textNodes.length){ancestor=this.getAncestorWithClass(range.startContainer);return ancestor?[ancestor]:false}for(var i=0,len=textNodes.length,selectedText;i<len;++i){selectedText=this.getTextSelectedByRange(textNodes[i],range);ancestor=this.getAncestorWithClass(textNodes[i]);if(selectedText!=""&&!ancestor){return false}else{ancestors.push(ancestor)}}return ancestors},toggleRange:function(range){if(this.isAppliedToRange(range)){this.undoToRange(range)}else{this.applyToRange(range)}}};wysihtml5.selection.HTMLApplier=HTMLApplier})(wysihtml5,rangy);wysihtml5.Commands=Base.extend({constructor:function(editor){this.editor=editor;this.composer=editor.composer;this.doc=this.composer.doc},support:function(command){return wysihtml5.browser.supportsCommand(this.doc,command)},exec:function(command,value){var obj=wysihtml5.commands[command],args=wysihtml5.lang.array(arguments).get(),method=obj&&obj.exec,result=null;this.editor.fire("beforecommand:composer");if(method){args.unshift(this.composer);result=method.apply(obj,args)}else{try{result=this.doc.execCommand(command,false,value)}catch(e){}}this.editor.fire("aftercommand:composer");return result},state:function(command,commandValue){var obj=wysihtml5.commands[command],args=wysihtml5.lang.array(arguments).get(),method=obj&&obj.state;if(method){args.unshift(this.composer);return method.apply(obj,args)}else{try{return this.doc.queryCommandState(command)}catch(e){return false}}},value:function(command){var obj=wysihtml5.commands[command],method=obj&&obj.value;if(method){return method.call(obj,this.composer,command)}else{try{return this.doc.queryCommandValue(command)}catch(e){return null}}}});(function(wysihtml5){var undef;wysihtml5.commands.bold={exec:function(composer,command){return wysihtml5.commands.formatInline.exec(composer,command,"b")},state:function(composer,command,color){return wysihtml5.commands.formatInline.state(composer,command,"b")},value:function(){return undef}}})(wysihtml5);(function(wysihtml5){var undef,NODE_NAME="A",dom=wysihtml5.dom;function _removeFormat(composer,anchors){var length=anchors.length,i=0,anchor,codeElement,textContent;for(;i<length;i++){anchor=anchors[i];codeElement=dom.getParentElement(anchor,{nodeName:"code"});textContent=dom.getTextContent(anchor);if(textContent.match(dom.autoLink.URL_REG_EXP)&&!codeElement){codeElement=dom.renameElement(anchor,"code")}else{dom.replaceWithChildNodes(anchor)}}}function _format(composer,attributes){var doc=composer.doc,tempClass="_wysihtml5-temp-"+ +new Date,tempClassRegExp=/non-matching-class/g,i=0,length,anchors,anchor,hasElementChild,isEmpty,elementToSetCaretAfter,textContent,whiteSpace,j;wysihtml5.commands.formatInline.exec(composer,undef,NODE_NAME,tempClass,tempClassRegExp);anchors=doc.querySelectorAll(NODE_NAME+"."+tempClass);length=anchors.length;for(;i<length;i++){anchor=anchors[i];anchor.removeAttribute("class");for(j in attributes){anchor.setAttribute(j,attributes[j])}}elementToSetCaretAfter=anchor;if(length===1){textContent=dom.getTextContent(anchor);hasElementChild=!!anchor.querySelector("*");isEmpty=textContent===""||textContent===wysihtml5.INVISIBLE_SPACE;if(!hasElementChild&&isEmpty){dom.setTextContent(anchor,attributes.text||anchor.href);whiteSpace=doc.createTextNode(" ");composer.selection.setAfter(anchor);composer.selection.insertNode(whiteSpace);elementToSetCaretAfter=whiteSpace}}composer.selection.setAfter(elementToSetCaretAfter)}wysihtml5.commands.createLink={exec:function(composer,command,value){var anchors=this.state(composer,command);if(anchors){composer.selection.executeAndRestore(function(){_removeFormat(composer,anchors)})}else{value=typeof value==="object"?value:{href:value};_format(composer,value)}},state:function(composer,command){return wysihtml5.commands.formatInline.state(composer,command,"A")},value:function(){return undef}}})(wysihtml5);(function(wysihtml5){var undef,REG_EXP=/wysiwyg-font-size-[a-z\-]+/g;wysihtml5.commands.fontSize={exec:function(composer,command,size){return wysihtml5.commands.formatInline.exec(composer,command,"span","wysiwyg-font-size-"+size,REG_EXP)},state:function(composer,command,size){return wysihtml5.commands.formatInline.state(composer,command,"span","wysiwyg-font-size-"+size,REG_EXP)},value:function(){return undef}}})(wysihtml5);(function(wysihtml5){var undef,REG_EXP=/wysiwyg-color-[a-z]+/g;wysihtml5.commands.foreColor={exec:function(composer,command,color){return wysihtml5.commands.formatInline.exec(composer,command,"span","wysiwyg-color-"+color,REG_EXP)},state:function(composer,command,color){return wysihtml5.commands.formatInline.state(composer,command,"span","wysiwyg-color-"+color,REG_EXP)},value:function(){return undef}}})(wysihtml5);(function(wysihtml5){var undef,dom=wysihtml5.dom,DEFAULT_NODE_NAME="DIV",BLOCK_ELEMENTS_GROUP=["H1","H2","H3","H4","H5","H6","P","BLOCKQUOTE",DEFAULT_NODE_NAME];function _addClass(element,className,classRegExp){if(element.className){_removeClass(element,classRegExp);element.className+=" "+className}else{element.className=className}}function _removeClass(element,classRegExp){element.className=element.className.replace(classRegExp,"")}function _isBlankTextNode(node){return node.nodeType===wysihtml5.TEXT_NODE&&!wysihtml5.lang.string(node.data).trim()}function _getPreviousSiblingThatIsNotBlank(node){var previousSibling=node.previousSibling;while(previousSibling&&_isBlankTextNode(previousSibling)){previousSibling=previousSibling.previousSibling}return previousSibling}function _getNextSiblingThatIsNotBlank(node){var nextSibling=node.nextSibling;while(nextSibling&&_isBlankTextNode(nextSibling)){nextSibling=nextSibling.nextSibling}return nextSibling}function _addLineBreakBeforeAndAfter(node){var doc=node.ownerDocument,nextSibling=_getNextSiblingThatIsNotBlank(node),previousSibling=_getPreviousSiblingThatIsNotBlank(node);if(nextSibling&&!_isLineBreakOrBlockElement(nextSibling)){node.parentNode.insertBefore(doc.createElement("br"),nextSibling)}if(previousSibling&&!_isLineBreakOrBlockElement(previousSibling)){node.parentNode.insertBefore(doc.createElement("br"),node)}}function _removeLineBreakBeforeAndAfter(node){var nextSibling=_getNextSiblingThatIsNotBlank(node),previousSibling=_getPreviousSiblingThatIsNotBlank(node);if(nextSibling&&_isLineBreak(nextSibling)){nextSibling.parentNode.removeChild(nextSibling)}if(previousSibling&&_isLineBreak(previousSibling)){previousSibling.parentNode.removeChild(previousSibling)}}function _removeLastChildIfLineBreak(node){var lastChild=node.lastChild;if(lastChild&&_isLineBreak(lastChild)){lastChild.parentNode.removeChild(lastChild)}}function _isLineBreak(node){return node.nodeName==="BR"}function _isLineBreakOrBlockElement(element){if(_isLineBreak(element)){return true}if(dom.getStyle("display").from(element)==="block"){return true}return false}function _execCommand(doc,command,nodeName,className){if(className){var eventListener=dom.observe(doc,"DOMNodeInserted",function(event){var target=event.target,displayStyle;if(target.nodeType!==wysihtml5.ELEMENT_NODE){return}displayStyle=dom.getStyle("display").from(target);if(displayStyle.substr(0,6)!=="inline"){target.className+=" "+className}})}doc.execCommand(command,false,nodeName);if(eventListener){eventListener.stop()}}function _selectLineAndWrap(composer,element){composer.selection.selectLine();composer.selection.surround(element);_removeLineBreakBeforeAndAfter(element);_removeLastChildIfLineBreak(element);composer.selection.selectNode(element)}function _hasClasses(element){return!!wysihtml5.lang.string(element.className).trim()}wysihtml5.commands.formatBlock={exec:function(composer,command,nodeName,className,classRegExp){var doc=composer.doc,blockElement=this.state(composer,command,nodeName,className,classRegExp),selectedNode;nodeName=typeof nodeName==="string"?nodeName.toUpperCase():nodeName;if(blockElement){composer.selection.executeAndRestoreSimple(function(){if(classRegExp){_removeClass(blockElement,classRegExp)}var hasClasses=_hasClasses(blockElement);if(!hasClasses&&blockElement.nodeName===(nodeName||DEFAULT_NODE_NAME)){_addLineBreakBeforeAndAfter(blockElement);dom.replaceWithChildNodes(blockElement)}else if(hasClasses){dom.renameElement(blockElement,DEFAULT_NODE_NAME)}});return}if(nodeName===null||wysihtml5.lang.array(BLOCK_ELEMENTS_GROUP).contains(nodeName)){selectedNode=composer.selection.getSelectedNode();blockElement=dom.getParentElement(selectedNode,{nodeName:BLOCK_ELEMENTS_GROUP});if(blockElement){composer.selection.executeAndRestoreSimple(function(){if(nodeName){blockElement=dom.renameElement(blockElement,nodeName)}if(className){_addClass(blockElement,className,classRegExp)}});return}}if(composer.commands.support(command)){_execCommand(doc,command,nodeName||DEFAULT_NODE_NAME,className);return}blockElement=doc.createElement(nodeName||DEFAULT_NODE_NAME);if(className){blockElement.className=className}_selectLineAndWrap(composer,blockElement)},state:function(composer,command,nodeName,className,classRegExp){nodeName=typeof nodeName==="string"?nodeName.toUpperCase():nodeName;var selectedNode=composer.selection.getSelectedNode();return dom.getParentElement(selectedNode,{nodeName:nodeName,className:className,classRegExp:classRegExp})},value:function(){return undef}}})(wysihtml5);(function(wysihtml5){var undef,ALIAS_MAPPING={strong:"b",em:"i",b:"strong",i:"em"},htmlApplier={};function _getTagNames(tagName){var alias=ALIAS_MAPPING[tagName];return alias?[tagName.toLowerCase(),alias.toLowerCase()]:[tagName.toLowerCase()]}function _getApplier(tagName,className,classRegExp){var identifier=tagName+":"+className;if(!htmlApplier[identifier]){htmlApplier[identifier]=new wysihtml5.selection.HTMLApplier(_getTagNames(tagName),className,classRegExp,true)}return htmlApplier[identifier]}wysihtml5.commands.formatInline={exec:function(composer,command,tagName,className,classRegExp){var range=composer.selection.getRange();if(!range){return false}_getApplier(tagName,className,classRegExp).toggleRange(range);composer.selection.setSelection(range)},state:function(composer,command,tagName,className,classRegExp){var doc=composer.doc,aliasTagName=ALIAS_MAPPING[tagName]||tagName,range;if(!wysihtml5.dom.hasElementWithTagName(doc,tagName)&&!wysihtml5.dom.hasElementWithTagName(doc,aliasTagName)){return false}if(className&&!wysihtml5.dom.hasElementWithClassName(doc,className)){return false}range=composer.selection.getRange();if(!range){return false}return _getApplier(tagName,className,classRegExp).isAppliedToRange(range)},value:function(){return undef}}})(wysihtml5);(function(wysihtml5){var undef;wysihtml5.commands.insertHTML={exec:function(composer,command,html){if(composer.commands.support(command)){composer.doc.execCommand(command,false,html)}else{composer.selection.insertHTML(html)}},state:function(){return false},value:function(){return undef}}})(wysihtml5);(function(wysihtml5){var NODE_NAME="IMG";wysihtml5.commands.insertImage={exec:function(composer,command,value){value=typeof value==="object"?value:{src:value};var doc=composer.doc,image=this.state(composer),textNode,i,parent;if(image){composer.selection.setBefore(image);parent=image.parentNode;parent.removeChild(image);wysihtml5.dom.removeEmptyTextNodes(parent);if(parent.nodeName==="A"&&!parent.firstChild){composer.selection.setAfter(parent);parent.parentNode.removeChild(parent)}wysihtml5.quirks.redraw(composer.element);return}image=doc.createElement(NODE_NAME);for(i in value){image[i]=value[i]}composer.selection.insertNode(image);if(wysihtml5.browser.hasProblemsSettingCaretAfterImg()){textNode=doc.createTextNode(wysihtml5.INVISIBLE_SPACE);composer.selection.insertNode(textNode);composer.selection.setAfter(textNode)}else{composer.selection.setAfter(image)}},state:function(composer){var doc=composer.doc,selectedNode,text,imagesInSelection;if(!wysihtml5.dom.hasElementWithTagName(doc,NODE_NAME)){return false}selectedNode=composer.selection.getSelectedNode();if(!selectedNode){return false}if(selectedNode.nodeName===NODE_NAME){return selectedNode}if(selectedNode.nodeType!==wysihtml5.ELEMENT_NODE){return false}text=composer.selection.getText();text=wysihtml5.lang.string(text).trim();if(text){return false}imagesInSelection=composer.selection.getNodes(wysihtml5.ELEMENT_NODE,function(node){return node.nodeName==="IMG"});if(imagesInSelection.length!==1){return false}return imagesInSelection[0]},value:function(composer){var image=this.state(composer);return image&&image.src}}})(wysihtml5);(function(wysihtml5){var undef,LINE_BREAK="<br>"+(wysihtml5.browser.needsSpaceAfterLineBreak()?" ":"");wysihtml5.commands.insertLineBreak={exec:function(composer,command){if(composer.commands.support(command)){composer.doc.execCommand(command,false,null);if(!wysihtml5.browser.autoScrollsToCaret()){composer.selection.scrollIntoView()}}else{composer.commands.exec("insertHTML",LINE_BREAK)}},state:function(){return false},value:function(){return undef}}})(wysihtml5);(function(wysihtml5){var undef;wysihtml5.commands.insertOrderedList={exec:function(composer,command){var doc=composer.doc,selectedNode=composer.selection.getSelectedNode(),list=wysihtml5.dom.getParentElement(selectedNode,{nodeName:"OL"}),otherList=wysihtml5.dom.getParentElement(selectedNode,{nodeName:"UL"}),tempClassName="_wysihtml5-temp-"+(new Date).getTime(),isEmpty,tempElement;if(composer.commands.support(command)){doc.execCommand(command,false,null);return}if(list){composer.selection.executeAndRestoreSimple(function(){wysihtml5.dom.resolveList(list)})}else if(otherList){composer.selection.executeAndRestoreSimple(function(){wysihtml5.dom.renameElement(otherList,"ol")})}else{composer.commands.exec("formatBlock","div",tempClassName);tempElement=doc.querySelector("."+tempClassName);isEmpty=tempElement.innerHTML===""||tempElement.innerHTML===wysihtml5.INVISIBLE_SPACE;composer.selection.executeAndRestoreSimple(function(){list=wysihtml5.dom.convertToList(tempElement,"ol")});if(isEmpty){composer.selection.selectNode(list.querySelector("li"))}}},state:function(composer){var selectedNode=composer.selection.getSelectedNode();return wysihtml5.dom.getParentElement(selectedNode,{nodeName:"OL"})},value:function(){return undef}}})(wysihtml5);(function(wysihtml5){var undef;wysihtml5.commands.insertUnorderedList={exec:function(composer,command){var doc=composer.doc,selectedNode=composer.selection.getSelectedNode(),list=wysihtml5.dom.getParentElement(selectedNode,{nodeName:"UL"}),otherList=wysihtml5.dom.getParentElement(selectedNode,{nodeName:"OL"}),tempClassName="_wysihtml5-temp-"+(new Date).getTime(),isEmpty,tempElement;if(composer.commands.support(command)){doc.execCommand(command,false,null);return}if(list){composer.selection.executeAndRestoreSimple(function(){wysihtml5.dom.resolveList(list)})}else if(otherList){composer.selection.executeAndRestoreSimple(function(){wysihtml5.dom.renameElement(otherList,"ul")})}else{composer.commands.exec("formatBlock","div",tempClassName);tempElement=doc.querySelector("."+tempClassName);isEmpty=tempElement.innerHTML===""||tempElement.innerHTML===wysihtml5.INVISIBLE_SPACE;composer.selection.executeAndRestoreSimple(function(){list=wysihtml5.dom.convertToList(tempElement,"ul")});if(isEmpty){composer.selection.selectNode(list.querySelector("li"))}}},state:function(composer){var selectedNode=composer.selection.getSelectedNode();return wysihtml5.dom.getParentElement(selectedNode,{nodeName:"UL"})},value:function(){return undef}}})(wysihtml5);(function(wysihtml5){var undef;wysihtml5.commands.italic={exec:function(composer,command){return wysihtml5.commands.formatInline.exec(composer,command,"i")},state:function(composer,command,color){return wysihtml5.commands.formatInline.state(composer,command,"i")},value:function(){return undef}}})(wysihtml5);(function(wysihtml5){var undef,CLASS_NAME="wysiwyg-text-align-center",REG_EXP=/wysiwyg-text-align-[a-z]+/g;wysihtml5.commands.justifyCenter={exec:function(composer,command){return wysihtml5.commands.formatBlock.exec(composer,"formatBlock",null,CLASS_NAME,REG_EXP)},state:function(composer,command){return wysihtml5.commands.formatBlock.state(composer,"formatBlock",null,CLASS_NAME,REG_EXP)},value:function(){return undef}}})(wysihtml5);(function(wysihtml5){var undef,CLASS_NAME="wysiwyg-text-align-left",REG_EXP=/wysiwyg-text-align-[a-z]+/g;wysihtml5.commands.justifyLeft={exec:function(composer,command){return wysihtml5.commands.formatBlock.exec(composer,"formatBlock",null,CLASS_NAME,REG_EXP)},state:function(composer,command){return wysihtml5.commands.formatBlock.state(composer,"formatBlock",null,CLASS_NAME,REG_EXP)},value:function(){return undef}}})(wysihtml5);(function(wysihtml5){var undef,CLASS_NAME="wysiwyg-text-align-right",REG_EXP=/wysiwyg-text-align-[a-z]+/g;wysihtml5.commands.justifyRight={exec:function(composer,command){return wysihtml5.commands.formatBlock.exec(composer,"formatBlock",null,CLASS_NAME,REG_EXP)},state:function(composer,command){return wysihtml5.commands.formatBlock.state(composer,"formatBlock",null,CLASS_NAME,REG_EXP)},value:function(){return undef}}})(wysihtml5);(function(wysihtml5){var undef;wysihtml5.commands.underline={exec:function(composer,command){return wysihtml5.commands.formatInline.exec(composer,command,"u")},state:function(composer,command){return wysihtml5.commands.formatInline.state(composer,command,"u")},value:function(){return undef}}})(wysihtml5);(function(wysihtml5){var Z_KEY=90,Y_KEY=89,BACKSPACE_KEY=8,DELETE_KEY=46,MAX_HISTORY_ENTRIES=40,UNDO_HTML='<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+wysihtml5.INVISIBLE_SPACE+"</span>",REDO_HTML='<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+wysihtml5.INVISIBLE_SPACE+"</span>",dom=wysihtml5.dom;function cleanTempElements(doc){var tempElement;while(tempElement=doc.querySelector("._wysihtml5-temp")){tempElement.parentNode.removeChild(tempElement)}}wysihtml5.UndoManager=wysihtml5.lang.Dispatcher.extend({constructor:function(editor){this.editor=editor;this.composer=editor.composer;this.element=this.composer.element;this.history=[this.composer.getValue()];this.position=1;var tthat=this;this.composer.setHistory=function(history){tthat.history=history;tthat.position=1};this.composer.getHistory=function(){return tthat.history};if(this.composer.commands.support("insertHTML")){this._observe()}},_observe:function(){var that=this,doc=this.composer.sandbox.getDocument(),lastKey;dom.observe(this.element,"keydown",function(event){if(event.altKey||!event.ctrlKey&&!event.metaKey){return}var keyCode=event.keyCode,isUndo=keyCode===Z_KEY&&!event.shiftKey,isRedo=keyCode===Z_KEY&&event.shiftKey||keyCode===Y_KEY;if(isUndo){that.undo();event.preventDefault()}else if(isRedo){that.redo();event.preventDefault()}});dom.observe(this.element,"keydown",function(event){var keyCode=event.keyCode;if(keyCode===lastKey){return}lastKey=keyCode;if(keyCode===BACKSPACE_KEY||keyCode===DELETE_KEY){that.transact()}});if(wysihtml5.browser.hasUndoInContextMenu()){var interval,observed,cleanUp=function(){cleanTempElements(doc);clearInterval(interval)};dom.observe(this.element,"contextmenu",function(){cleanUp();that.composer.selection.executeAndRestoreSimple(function(){if(that.element.lastChild){that.composer.selection.setAfter(that.element.lastChild)}doc.execCommand("insertHTML",false,UNDO_HTML);doc.execCommand("insertHTML",false,REDO_HTML);doc.execCommand("undo",false,null)});interval=setInterval(function(){if(doc.getElementById("_wysihtml5-redo")){cleanUp();that.redo()}else if(!doc.getElementById("_wysihtml5-undo")){cleanUp();that.undo()}},400);if(!observed){observed=true;dom.observe(document,"mousedown",cleanUp);dom.observe(doc,["mousedown","paste","cut","copy"],cleanUp)}})}this.editor.observe("newword:composer",function(){that.transact()}).observe("beforecommand:composer",function(){that.transact()})},transact:function(){var previousHtml=this.history[this.position-1],currentHtml=this.composer.getValue();if(currentHtml==previousHtml){return}var length=this.history.length=this.position;if(length>MAX_HISTORY_ENTRIES){this.history.shift();this.position--}this.position++;this.history.push(currentHtml)},undo:function(){this.transact();if(this.position<=1){return}this.set(this.history[--this.position-1]);this.editor.fire("undo:composer")},redo:function(){if(this.position>=this.history.length){return}this.set(this.history[++this.position-1]);this.editor.fire("redo:composer")},set:function(html){var originImgs=this.element.querySelectorAll("img");var originImgMap={};var loopLength;loopLength=originImgs.length;for(var i=0;i<loopLength;i++){originImgMap[originImgs[i].src]=originImgs[i]}var ctn=document.createElement("div");ctn.setAttribute("id","verysafe");this.element.appendChild(ctn);ctn.innerHTML=html;var targetImgs=ctn.querySelectorAll("img");var targetImgsArray=[].map.call(targetImgs,function(element){return element});loopLength=targetImgs.length;for(var i=0;i<loopLength;i++){var targetImg=targetImgsArray[i];var originImg=originImgMap[targetImg.src];if(originImg){targetImg.parentNode.replaceChild(originImg,targetImg)}}while(this.element.firstChild.id!=="verysafe"){this.element.removeChild(this.element.firstChild)}var nodesToInsert=ctn.childNodes;var nodesToInsertArray=[].map.call(nodesToInsert,function(element){return element});var loopLength=nodesToInsertArray.length;for(var i=0;i<loopLength;i++){this.element.appendChild(nodesToInsertArray[i])}this.element.removeChild(this.element.firstChild);this.editor.focus(true)}})})(wysihtml5);wysihtml5.views.View=Base.extend({constructor:function(parent,textareaElement,config){this.parent=parent;this.element=textareaElement;this.config=config;this._observeViewChange()},_observeViewChange:function(){var that=this;this.parent.observe("beforeload",function(){that.parent.observe("change_view",function(view){if(view===that.name){that.parent.currentView=that;that.show();setTimeout(function(){that.focus()},0)}else{that.hide()}})})},focus:function(){if(this.element.ownerDocument.querySelector(":focus")===this.element){return}try{this.element.focus()}catch(e){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}});(function(wysihtml5){var dom=wysihtml5.dom,browser=wysihtml5.browser;wysihtml5.views.Composer=wysihtml5.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(parent,textareaElement,config){this.base(parent,textareaElement,config);this.textarea=this.parent.textarea;this._initSandbox()},clear:function(){this.element.innerHTML=browser.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(parse){var value=this.isEmpty()?"":wysihtml5.quirks.getCorrectInnerHTML(this.element);if(parse){value=this.parent.parse(value)}value=wysihtml5.lang.string(value).replace(wysihtml5.INVISIBLE_SPACE).by("");return value},setValue:function(html,parse){if(parse){html=this.parent.parse(html)}this.element.innerHTML=html},show:function(){this.iframe.style.display=this._displayStyle||"";this.disable();this.enable()},hide:function(){this._displayStyle=dom.getStyle("display").from(this.iframe);if(this._displayStyle==="none"){this._displayStyle=null}this.iframe.style.display="none"},disable:function(){this.element.removeAttribute("contentEditable");this.base()},enable:function(){this.element.setAttribute("contentEditable","true");this.base()},focus:function(setToEnd){if(wysihtml5.browser.doesAsyncFocus()&&this.hasPlaceholderSet()){this.clear()}this.base();var lastChild=this.element.lastChild;if(setToEnd&&lastChild){if(lastChild.nodeName==="BR"){this.selection.setBefore(this.element.lastChild)}else{this.selection.setAfter(this.element.lastChild)}}},getTextContent:function(){return dom.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==this.textarea.element.getAttribute("placeholder")},isEmpty:function(){var innerHTML=this.element.innerHTML,elementsWithVisualValue="blockquote, ul, ol, img, embed, object, table, iframe, svg, video, audio, button, input, select, textarea";return innerHTML===""||innerHTML===this.CARET_HACK||this.hasPlaceholderSet()||this.getTextContent()===""&&!this.element.querySelector(elementsWithVisualValue)},_initSandbox:function(){var that=this;this.sandbox=new dom.Sandbox(function(){that._create()},{stylesheets:this.config.stylesheets});this.iframe=this.sandbox.getIframe();var hiddenField=document.createElement("input");hiddenField.type="hidden";hiddenField.name="_wysihtml5_mode";hiddenField.value=1;var textareaElement=this.textarea.element;dom.insert(this.iframe).after(textareaElement);dom.insert(hiddenField).after(textareaElement)},_create:function(){var that=this;this.doc=this.sandbox.getDocument();this.element=this.doc.body;this.textarea=this.parent.textarea;this.element.innerHTML=this.textarea.getValue(true);this.enable();this.selection=new wysihtml5.Selection(this.parent);this.commands=new wysihtml5.Commands(this.parent);dom.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element);dom.addClass(this.element,this.config.composerClassName);if(this.config.style){this.style()}this.observe();var name=this.config.name;if(name){dom.addClass(this.element,name);dom.addClass(this.iframe,name)}var placeholderText=typeof this.config.placeholder==="string"?this.config.placeholder:this.textarea.element.getAttribute("placeholder");if(placeholderText){dom.simulatePlaceholder(this.parent,this,placeholderText)}this.commands.exec("styleWithCSS",false);this._initAutoLinking();this._initObjectResizing();this._initUndoManager();if(this.textarea.element.hasAttribute("autofocus")||document.querySelector(":focus")==this.textarea.element){setTimeout(function(){that.focus()},100)}wysihtml5.quirks.insertLineBreakOnReturn(this);if(!browser.clearsContentEditableCorrectly()){wysihtml5.quirks.ensureProperClearing(this)}if(!browser.clearsListsInContentEditableCorrectly()){wysihtml5.quirks.ensureProperClearingOfLists(this)}if(this.initSync&&this.config.sync){this.initSync()}this.textarea.hide();this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var that=this,supportsDisablingOfAutoLinking=browser.canDisableAutoLinking(),supportsAutoLinking=browser.doesAutoLinkingInContentEditable();if(supportsDisablingOfAutoLinking){this.commands.exec("autoUrlDetect",false)}if(!this.config.autoLink){return}if(!supportsAutoLinking||supportsAutoLinking&&supportsDisablingOfAutoLinking){this.parent.observe("newword:composer",function(){that.selection.executeAndRestore(function(startContainer,endContainer){dom.autoLink(endContainer.parentNode)})})}var links=this.sandbox.getDocument().getElementsByTagName("a"),urlRegExp=dom.autoLink.URL_REG_EXP,getTextContent=function(element){var textContent=wysihtml5.lang.string(dom.getTextContent(element)).trim();if(textContent.substr(0,4)==="www."){textContent="http://"+textContent}return textContent};dom.observe(this.element,"keydown",function(event){if(!links.length){return}var selectedNode=that.selection.getSelectedNode(event.target.ownerDocument),link=dom.getParentElement(selectedNode,{nodeName:"A"},4),textContent;if(!link){return}textContent=getTextContent(link);setTimeout(function(){var newTextContent=getTextContent(link);if(newTextContent===textContent){return}if(newTextContent.match(urlRegExp)){link.setAttribute("href",newTextContent)}},0)})},_initObjectResizing:function(){var properties=["width","height"],propertiesLength=properties.length,element=this.element;this.commands.exec("enableObjectResizing",this.config.allowObjectResizing);if(this.config.allowObjectResizing){if(browser.supportsEvent("resizeend")){dom.observe(element,"resizeend",function(event){var target=event.target||event.srcElement,style=target.style,i=0,property;for(;i<propertiesLength;i++){property=properties[i];if(style[property]){target.setAttribute(property,parseInt(style[property],10));style[property]=""}}wysihtml5.quirks.redraw(element)})}}else{if(browser.supportsEvent("resizestart")){dom.observe(element,"resizestart",function(event){event.preventDefault()})}}},_initUndoManager:function(){new wysihtml5.UndoManager(this.parent)}})})(wysihtml5);(function(wysihtml5){var dom=wysihtml5.dom,doc=document,win=window,HOST_TEMPLATE=doc.createElement("div"),TEXT_FORMATTING=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],BOX_FORMATTING=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],RESIZE_STYLE=["width","height","top","left","right","bottom"],ADDITIONAL_CSS_RULES=["html             { height: 100%; }","body             { min-height: 100%; padding: 0; margin: 0; margin-top: -1px; padding-top: 1px; }","._wysihtml5-temp { display: none; }",wysihtml5.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","body[disabled]   { background-color: #eee !important; color: #999 !important; cursor: default !important; }","img:-moz-broken  { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"];
var focusWithoutScrolling=function(element){if(element.setActive){try{element.setActive()}catch(e){}}else{var elementStyle=element.style,originalScrollTop=doc.documentElement.scrollTop||doc.body.scrollTop,originalScrollLeft=doc.documentElement.scrollLeft||doc.body.scrollLeft,originalStyles={position:elementStyle.position,top:elementStyle.top,left:elementStyle.left,WebkitUserSelect:elementStyle.WebkitUserSelect};dom.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(element);element.focus();dom.setStyles(originalStyles).on(element);if(win.scrollTo){win.scrollTo(originalScrollLeft,originalScrollTop)}}};wysihtml5.views.Composer.prototype.style=function(){var that=this,originalActiveElement=doc.querySelector(":focus"),textareaElement=this.textarea.element,hasPlaceholder=textareaElement.hasAttribute("placeholder"),originalPlaceholder=hasPlaceholder&&textareaElement.getAttribute("placeholder");this.focusStylesHost=this.focusStylesHost||HOST_TEMPLATE.cloneNode(false);this.blurStylesHost=this.blurStylesHost||HOST_TEMPLATE.cloneNode(false);if(hasPlaceholder){textareaElement.removeAttribute("placeholder")}if(textareaElement===originalActiveElement){textareaElement.blur()}dom.copyStyles(BOX_FORMATTING).from(textareaElement).to(this.iframe).andTo(this.blurStylesHost);dom.copyStyles(TEXT_FORMATTING).from(textareaElement).to(this.element).andTo(this.blurStylesHost);dom.insertCSS(ADDITIONAL_CSS_RULES).into(this.element.ownerDocument);focusWithoutScrolling(textareaElement);dom.copyStyles(BOX_FORMATTING).from(textareaElement).to(this.focusStylesHost);dom.copyStyles(TEXT_FORMATTING).from(textareaElement).to(this.focusStylesHost);var boxFormattingStyles=wysihtml5.lang.array(BOX_FORMATTING).without(["display"]);if(originalActiveElement){originalActiveElement.focus()}else{textareaElement.blur()}if(hasPlaceholder){textareaElement.setAttribute("placeholder",originalPlaceholder)}if(!wysihtml5.browser.hasCurrentStyleProperty()){var winObserver=dom.observe(win,"resize",function(){if(!dom.contains(document.documentElement,that.iframe)){winObserver.stop();return}var originalTextareaDisplayStyle=dom.getStyle("display").from(textareaElement),originalComposerDisplayStyle=dom.getStyle("display").from(that.iframe);textareaElement.style.display="";that.iframe.style.display="none";dom.copyStyles(RESIZE_STYLE).from(textareaElement).to(that.iframe).andTo(that.focusStylesHost).andTo(that.blurStylesHost);that.iframe.style.display=originalComposerDisplayStyle;textareaElement.style.display=originalTextareaDisplayStyle})}this.parent.observe("focus:composer",function(){dom.copyStyles(boxFormattingStyles).from(that.focusStylesHost).to(that.iframe);dom.copyStyles(TEXT_FORMATTING).from(that.focusStylesHost).to(that.element)});this.parent.observe("blur:composer",function(){dom.copyStyles(boxFormattingStyles).from(that.blurStylesHost).to(that.iframe);dom.copyStyles(TEXT_FORMATTING).from(that.blurStylesHost).to(that.element)});return this}})(wysihtml5);(function(wysihtml5){var dom=wysihtml5.dom,browser=wysihtml5.browser,shortcuts={66:"bold",73:"italic",85:"underline"};wysihtml5.views.Composer.prototype.observe=function(){var that=this,state=this.getValue(),iframe=this.sandbox.getIframe(),element=this.element,focusBlurElement=browser.supportsEventsInIframeCorrectly()?element:this.sandbox.getWindow(),pasteEvents=browser.supportsEvent("drop")?["drop","paste"]:["dragdrop","paste"];dom.observe(iframe,"DOMNodeRemoved",function(){clearInterval(domNodeRemovedInterval);that.parent.fire("destroy:composer")});var domNodeRemovedInterval=setInterval(function(){if(!dom.contains(document.documentElement,iframe)){clearInterval(domNodeRemovedInterval);that.parent.fire("destroy:composer")}},250);dom.observe(focusBlurElement,"focus",function(){that.parent.fire("focus").fire("focus:composer");setTimeout(function(){state=that.getValue()},0)});dom.observe(focusBlurElement,"blur",function(){if(state!==that.getValue()){that.parent.fire("change").fire("change:composer")}that.parent.fire("blur").fire("blur:composer")});if(wysihtml5.browser.isIos()){dom.observe(element,"blur",function(){var input=element.ownerDocument.createElement("input"),originalScrollTop=document.documentElement.scrollTop||document.body.scrollTop,originalScrollLeft=document.documentElement.scrollLeft||document.body.scrollLeft;try{that.selection.insertNode(input)}catch(e){element.appendChild(input)}input.focus();input.parentNode.removeChild(input);window.scrollTo(originalScrollLeft,originalScrollTop)})}dom.observe(element,"dragenter",function(){that.parent.fire("unset_placeholder")});if(browser.firesOnDropOnlyWhenOnDragOverIsCancelled()){dom.observe(element,["dragover","dragenter"],function(event){event.preventDefault()})}dom.observe(element,pasteEvents,function(event){var dataTransfer=event.dataTransfer,data;if(dataTransfer&&browser.supportsDataTransfer()){data=dataTransfer.getData("text/html")||dataTransfer.getData("text/plain")}if(data){element.focus();that.commands.exec("insertHTML",data);that.parent.fire("paste").fire("paste:composer");event.stopPropagation();event.preventDefault()}else{setTimeout(function(){that.parent.fire("paste").fire("paste:composer")},0)}});dom.observe(element,"keyup",function(event){var keyCode=event.keyCode;if(keyCode===wysihtml5.SPACE_KEY||keyCode===wysihtml5.ENTER_KEY){that.parent.fire("newword:composer")}});this.parent.observe("paste:composer",function(){setTimeout(function(){that.parent.fire("newword:composer")},0)});if(!browser.canSelectImagesInContentEditable()){dom.observe(element,"mousedown",function(event){var target=event.target;if(target.nodeName==="IMG"){that.selection.selectNode(target);event.preventDefault()}})}dom.observe(element,"keydown",function(event){var keyCode=event.keyCode,command=shortcuts[keyCode];if((event.ctrlKey||event.metaKey)&&!event.altKey&&command){that.commands.exec(command);event.preventDefault()}});dom.observe(element,"keydown",function(event){var target=that.selection.getSelectedNode(true),keyCode=event.keyCode,parent;if(target&&target.nodeName==="IMG"&&(keyCode===wysihtml5.BACKSPACE_KEY||keyCode===wysihtml5.DELETE_KEY)){parent=target.parentNode;parent.removeChild(target);if(parent.nodeName==="A"&&!parent.firstChild){parent.parentNode.removeChild(parent)}setTimeout(function(){wysihtml5.quirks.redraw(element)},0);event.preventDefault()}});var titlePrefixes={IMG:"Image: ",A:"Link: "};dom.observe(element,"mouseover",function(event){var target=event.target,nodeName=target.nodeName,title;if(nodeName!=="A"&&nodeName!=="IMG"){return}var hasTitle=target.hasAttribute("title");if(!hasTitle){title=titlePrefixes[nodeName]+(target.getAttribute("href")||target.getAttribute("src"));target.setAttribute("title",title)}})}})(wysihtml5);(function(wysihtml5){var INTERVAL=400;wysihtml5.views.Synchronizer=Base.extend({constructor:function(editor,textarea,composer){this.editor=editor;this.textarea=textarea;this.composer=composer;this._observe()},fromComposerToTextarea:function(shouldParseHtml){this.textarea.setValue(wysihtml5.lang.string(this.composer.getValue()).trim(),shouldParseHtml)},fromTextareaToComposer:function(shouldParseHtml){var textareaValue=this.textarea.getValue();if(textareaValue){this.composer.setValue(textareaValue,shouldParseHtml)}else{this.composer.clear();this.editor.fire("set_placeholder")}},sync:function(shouldParseHtml){if(this.editor.currentView.name==="textarea"){this.fromTextareaToComposer(shouldParseHtml)}else{this.fromComposerToTextarea(shouldParseHtml)}},_observe:function(){var interval,that=this,form=this.textarea.element.form,startInterval=function(){interval=setInterval(function(){that.fromComposerToTextarea()},INTERVAL)},stopInterval=function(){clearInterval(interval);interval=null};startInterval();if(form){wysihtml5.dom.observe(form,"submit",function(){that.sync(true)});wysihtml5.dom.observe(form,"reset",function(){setTimeout(function(){that.fromTextareaToComposer()},0)})}this.editor.observe("change_view",function(view){if(view==="composer"&&!interval){that.fromTextareaToComposer(true);startInterval()}else if(view==="textarea"){that.fromComposerToTextarea(true);stopInterval()}});this.editor.observe("destroy:composer",stopInterval)}})})(wysihtml5);wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(parent,textareaElement,config){this.base(parent,textareaElement,config);this._observe()},clear:function(){this.element.value=""},getValue:function(parse){var value=this.isEmpty()?"":this.element.value;if(parse){value=this.parent.parse(value)}return value},setValue:function(html,parse){if(parse){html=this.parent.parse(html)}this.element.value=html},hasPlaceholderSet:function(){var supportsPlaceholder=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),placeholderText=this.element.getAttribute("placeholder")||null,value=this.element.value,isEmpty=!value;return supportsPlaceholder&&isEmpty||value===placeholderText},isEmpty:function(){return!wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var element=this.element,parent=this.parent,eventMapping={focusin:"focus",focusout:"blur"},events=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];parent.observe("beforeload",function(){wysihtml5.dom.observe(element,events,function(event){var eventName=eventMapping[event.type]||event.type;parent.fire(eventName).fire(eventName+":textarea")});wysihtml5.dom.observe(element,["paste","drop"],function(){setTimeout(function(){parent.fire("paste").fire("paste:textarea")},0)})})}});(function(wysihtml5){var dom=wysihtml5.dom,CLASS_NAME_OPENED="wysihtml5-command-dialog-opened",SELECTOR_FORM_ELEMENTS="input, select, textarea",SELECTOR_FIELDS="[data-wysihtml5-dialog-field]",ATTRIBUTE_FIELDS="data-wysihtml5-dialog-field";wysihtml5.toolbar.Dialog=wysihtml5.lang.Dispatcher.extend({constructor:function(link,container){this.link=link;this.container=container},_observe:function(){if(this._observed){return}var that=this,callbackWrapper=function(event){var attributes=that._serialize();if(attributes==that.elementToChange){that.fire("edit",attributes)}else{that.fire("save",attributes)}that.hide();event.preventDefault();event.stopPropagation()};dom.observe(that.link,"click",function(event){if(dom.hasClass(that.link,CLASS_NAME_OPENED)){setTimeout(function(){that.hide()},0)}});dom.observe(this.container,"keydown",function(event){var keyCode=event.keyCode;if(keyCode===wysihtml5.ENTER_KEY){callbackWrapper(event)}if(keyCode===wysihtml5.ESCAPE_KEY){that.hide()}});dom.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",callbackWrapper);dom.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(event){that.fire("cancel");that.hide();event.preventDefault();event.stopPropagation()});var formElements=this.container.querySelectorAll(SELECTOR_FORM_ELEMENTS),i=0,length=formElements.length,_clearInterval=function(){clearInterval(that.interval)};for(;i<length;i++){dom.observe(formElements[i],"change",_clearInterval)}this._observed=true},_serialize:function(){var data=this.elementToChange||{},fields=this.container.querySelectorAll(SELECTOR_FIELDS),length=fields.length,i=0;for(;i<length;i++){data[fields[i].getAttribute(ATTRIBUTE_FIELDS)]=fields[i].value}return data},_interpolate:function(avoidHiddenFields){var field,fieldName,newValue,focusedElement=document.querySelector(":focus"),fields=this.container.querySelectorAll(SELECTOR_FIELDS),length=fields.length,i=0;for(;i<length;i++){field=fields[i];if(field===focusedElement){continue}if(avoidHiddenFields&&field.type==="hidden"){continue}fieldName=field.getAttribute(ATTRIBUTE_FIELDS);newValue=this.elementToChange?this.elementToChange[fieldName]||"":field.defaultValue;field.value=newValue}},show:function(elementToChange){var that=this,firstField=this.container.querySelector(SELECTOR_FORM_ELEMENTS);this.elementToChange=elementToChange;this._observe();this._interpolate();if(elementToChange){this.interval=setInterval(function(){that._interpolate(true)},500)}dom.addClass(this.link,CLASS_NAME_OPENED);this.container.style.display="";this.fire("show");if(firstField&&!elementToChange){try{firstField.focus()}catch(e){}}},hide:function(){clearInterval(this.interval);this.elementToChange=null;dom.removeClass(this.link,CLASS_NAME_OPENED);this.container.style.display="none";this.fire("hide")}})})(wysihtml5);(function(wysihtml5){var dom=wysihtml5.dom;var linkStyles={position:"relative"};var wrapperStyles={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1};var inputStyles={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"};var inputAttributes={"x-webkit-speech":"",speech:""};wysihtml5.toolbar.Speech=function(parent,link){var input=document.createElement("input");if(!wysihtml5.browser.supportsSpeechApiOn(input)){link.style.display="none";return}var wrapper=document.createElement("div");wysihtml5.lang.object(wrapperStyles).merge({width:link.offsetWidth+"px",height:link.offsetHeight+"px"});dom.insert(input).into(wrapper);dom.insert(wrapper).into(link);dom.setStyles(inputStyles).on(input);dom.setAttributes(inputAttributes).on(input);dom.setStyles(wrapperStyles).on(wrapper);dom.setStyles(linkStyles).on(link);var eventName="onwebkitspeechchange"in input?"webkitspeechchange":"speechchange";dom.observe(input,eventName,function(){parent.execCommand("insertText",input.value);input.value=""});dom.observe(input,"click",function(event){if(dom.hasClass(link,"wysihtml5-command-disabled")){event.preventDefault()}event.stopPropagation()})}})(wysihtml5);(function(wysihtml5){var CLASS_NAME_COMMAND_DISABLED="wysihtml5-command-disabled",CLASS_NAME_COMMANDS_DISABLED="wysihtml5-commands-disabled",CLASS_NAME_COMMAND_ACTIVE="wysihtml5-command-active",CLASS_NAME_ACTION_ACTIVE="wysihtml5-action-active",dom=wysihtml5.dom;wysihtml5.toolbar.Toolbar=Base.extend({constructor:function(editor,container){this.editor=editor;this.container=typeof container==="string"?document.getElementById(container):container;this.composer=editor.composer;this._getLinks("command");this._getLinks("action");this._observe();this.show();var speechInputLinks=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),length=speechInputLinks.length,i=0;for(;i<length;i++){new wysihtml5.toolbar.Speech(this,speechInputLinks[i])}},_getLinks:function(type){var links=this[type+"Links"]=wysihtml5.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+type+"]")).get(),length=links.length,i=0,mapping=this[type+"Mapping"]={},link,group,name,value,dialog;for(;i<length;i++){link=links[i];name=link.getAttribute("data-wysihtml5-"+type);value=link.getAttribute("data-wysihtml5-"+type+"-value");group=this.container.querySelector("[data-wysihtml5-"+type+"-group='"+name+"']");dialog=this._getDialog(link,name);mapping[name+":"+value]={link:link,group:group,name:name,value:value,dialog:dialog,state:false}}},_getDialog:function(link,command){var that=this,dialogElement=this.container.querySelector("[data-wysihtml5-dialog='"+command+"']"),dialog,caretBookmark;if(dialogElement){dialog=new wysihtml5.toolbar.Dialog(link,dialogElement);dialog.observe("show",function(){caretBookmark=that.composer.selection.getBookmark();that.editor.fire("show:dialog",{command:command,dialogContainer:dialogElement,commandLink:link})});dialog.observe("save",function(attributes){if(caretBookmark){that.composer.selection.setBookmark(caretBookmark)}that._execCommand(command,attributes);that.editor.fire("save:dialog",{command:command,dialogContainer:dialogElement,commandLink:link})});dialog.observe("cancel",function(){that.editor.focus(false);that.editor.fire("cancel:dialog",{command:command,dialogContainer:dialogElement,commandLink:link})})}return dialog},execCommand:function(command,commandValue){if(this.commandsDisabled){return}var commandObj=this.commandMapping[command+":"+commandValue];if(commandObj&&commandObj.dialog&&!commandObj.state){commandObj.dialog.show()}else{this._execCommand(command,commandValue)}},_execCommand:function(command,commandValue){this.editor.focus(false);this.composer.commands.exec(command,commandValue);this._updateLinkStates()},execAction:function(action){var editor=this.editor;switch(action){case"change_view":if(editor.currentView===editor.textarea){editor.fire("change_view","composer")}else{editor.fire("change_view","textarea")}break}},_observe:function(){var that=this,editor=this.editor,container=this.container,links=this.commandLinks.concat(this.actionLinks),length=links.length,i=0;for(;i<length;i++){dom.setAttributes({href:"javascript:;",unselectable:"on"}).on(links[i])}dom.delegate(container,"[data-wysihtml5-command]","mousedown",function(event){event.preventDefault()});dom.delegate(container,"[data-wysihtml5-command]","click",function(event){var link=this,command=link.getAttribute("data-wysihtml5-command"),commandValue=link.getAttribute("data-wysihtml5-command-value");that.execCommand(command,commandValue);event.preventDefault()});dom.delegate(container,"[data-wysihtml5-action]","click",function(event){var action=this.getAttribute("data-wysihtml5-action");that.execAction(action);event.preventDefault()});editor.observe("focus:composer",function(){that.bookmark=null;clearInterval(that.interval);that.interval=setInterval(function(){that._updateLinkStates()},500)});editor.observe("blur:composer",function(){clearInterval(that.interval)});editor.observe("destroy:composer",function(){clearInterval(that.interval)});editor.observe("change_view",function(currentView){setTimeout(function(){that.commandsDisabled=currentView!=="composer";that._updateLinkStates();if(that.commandsDisabled){dom.addClass(container,CLASS_NAME_COMMANDS_DISABLED)}else{dom.removeClass(container,CLASS_NAME_COMMANDS_DISABLED)}},0)})},_updateLinkStates:function(){var element=this.composer.element,commandMapping=this.commandMapping,actionMapping=this.actionMapping,i,state,action,command;for(i in commandMapping){command=commandMapping[i];if(this.commandsDisabled){state=false;dom.removeClass(command.link,CLASS_NAME_COMMAND_ACTIVE);if(command.group){dom.removeClass(command.group,CLASS_NAME_COMMAND_ACTIVE)}if(command.dialog){command.dialog.hide()}}else{state=this.composer.commands.state(command.name,command.value);if(wysihtml5.lang.object(state).isArray()){state=state.length===1?state[0]:true}dom.removeClass(command.link,CLASS_NAME_COMMAND_DISABLED);if(command.group){dom.removeClass(command.group,CLASS_NAME_COMMAND_DISABLED)}}if(command.state===state){continue}command.state=state;if(state){dom.addClass(command.link,CLASS_NAME_COMMAND_ACTIVE);if(command.group){dom.addClass(command.group,CLASS_NAME_COMMAND_ACTIVE)}if(command.dialog){if(typeof state==="object"){command.dialog.show(state)}else{command.dialog.hide()}}}else{dom.removeClass(command.link,CLASS_NAME_COMMAND_ACTIVE);if(command.group){dom.removeClass(command.group,CLASS_NAME_COMMAND_ACTIVE)}if(command.dialog){command.dialog.hide()}}}for(i in actionMapping){action=actionMapping[i];if(action.name==="change_view"){action.state=this.editor.currentView===this.editor.textarea;if(action.state){dom.addClass(action.link,CLASS_NAME_ACTION_ACTIVE)}else{dom.removeClass(action.link,CLASS_NAME_ACTION_ACTIVE)}}}},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})})(wysihtml5);(function(wysihtml5){var undef;var defaultConfig={name:undef,style:true,toolbar:undef,autoLink:true,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},parser:wysihtml5.dom.parse,composerClassName:"wysihtml5-editor",bodyClassName:"wysihtml5-supported",stylesheets:[],placeholderText:undef,allowObjectResizing:true,supportTouchDevices:true};wysihtml5.Editor=wysihtml5.lang.Dispatcher.extend({constructor:function(textareaElement,config){this.textareaElement=typeof textareaElement==="string"?document.getElementById(textareaElement):textareaElement;this.config=wysihtml5.lang.object({}).merge(defaultConfig).merge(config).get();this.textarea=new wysihtml5.views.Textarea(this,this.textareaElement,this.config);this.currentView=this.textarea;this._isCompatible=wysihtml5.browser.supported();if(!this._isCompatible||!this.config.supportTouchDevices&&wysihtml5.browser.isTouchDevice()){var that=this;setTimeout(function(){that.fire("beforeload").fire("load")},0);return}wysihtml5.dom.addClass(document.body,this.config.bodyClassName);this.composer=new wysihtml5.views.Composer(this,this.textareaElement,this.config);this.currentView=this.composer;if(typeof this.config.parser==="function"){this._initParser()}this.observe("beforeload",function(){this.synchronizer=new wysihtml5.views.Synchronizer(this,this.textarea,this.composer);if(this.config.toolbar){this.toolbar=new wysihtml5.toolbar.Toolbar(this,this.config.toolbar)}});try{console.log("Heya! This page is using wysihtml5 for rich text editing. Check out https://github.com/xing/wysihtml5")}catch(e){}},isCompatible:function(){return this._isCompatible},clear:function(){this.currentView.clear();return this},getValue:function(parse){return this.currentView.getValue(parse)},setValue:function(html,parse){if(!html){return this.clear()}this.currentView.setValue(html,parse);return this},focus:function(setToEnd){this.currentView.focus(setToEnd);return this},disable:function(){this.currentView.disable();return this},enable:function(){this.currentView.enable();return this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(htmlOrElement){var returnValue=this.config.parser(htmlOrElement,this.config.parserRules,this.composer.sandbox.getDocument(),true);if(typeof htmlOrElement==="object"){wysihtml5.quirks.redraw(htmlOrElement)}return returnValue},_initParser:function(){this.observe("paste:composer",function(){var keepScrollPosition=true,that=this;that.composer.selection.executeAndRestore(function(){wysihtml5.quirks.cleanPastedHTML(that.composer.element);that.parse(that.composer.element)},keepScrollPosition)});this.observe("paste:textarea",function(){var value=this.textarea.getValue(),newValue;newValue=this.parse(value);this.textarea.setValue(newValue)})}})})(wysihtml5);!function($,wysi){"use strict";var tpl={"font-styles":function(locale,options){var size=options&&options.size?" btn-"+options.size:"";return"<li class='dropdown'>"+"<a class='btn dropdown-toggle"+size+"' data-toggle='dropdown' href='#'>"+"<i class='icon-font'></i>&nbsp;<span class='current-font'>"+locale.font_styles.normal+"</span>&nbsp;<b class='caret'></b>"+"</a>"+"<ul class='dropdown-menu'>"+"<li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='div' tabindex='-1'>"+locale.font_styles.normal+"</a></li>"+"<li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h1' tabindex='-1'>"+locale.font_styles.h1+"</a></li>"+"<li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h2' tabindex='-1'>"+locale.font_styles.h2+"</a></li>"+"<li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h3' tabindex='-1'>"+locale.font_styles.h3+"</a></li>"+"<li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h4'>"+locale.font_styles.h4+"</a></li>"+"<li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h5'>"+locale.font_styles.h5+"</a></li>"+"<li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h6'>"+locale.font_styles.h6+"</a></li>"+"</ul>"+"</li>"},emphasis:function(locale,options){var size=options&&options.size?" btn-"+options.size:"";return"<li>"+"<div class='btn-group'>"+"<a class='btn"+size+"' data-wysihtml5-command='bold' title='CTRL+B' tabindex='-1'>"+locale.emphasis.bold+"</a>"+"<a class='btn"+size+"' data-wysihtml5-command='italic' title='CTRL+I' tabindex='-1'>"+locale.emphasis.italic+"</a>"+"<a class='btn"+size+"' data-wysihtml5-command='underline' title='CTRL+U' tabindex='-1'>"+locale.emphasis.underline+"</a>"+"</div>"+"</li>"},lists:function(locale,options){var size=options&&options.size?" btn-"+options.size:"";return"<li>"+"<div class='btn-group'>"+"<a class='btn"+size+"' data-wysihtml5-command='insertUnorderedList' title='"+locale.lists.unordered+"' tabindex='-1'><i class='icon-list'></i></a>"+"<a class='btn"+size+"' data-wysihtml5-command='insertOrderedList' title='"+locale.lists.ordered+"' tabindex='-1'><i class='icon-th-list'></i></a>"+"<a class='btn"+size+"' data-wysihtml5-command='Outdent' title='"+locale.lists.outdent+"' tabindex='-1'><i class='icon-indent-right'></i></a>"+"<a class='btn"+size+"' data-wysihtml5-command='Indent' title='"+locale.lists.indent+"' tabindex='-1'><i class='icon-indent-left'></i></a>"+"</div>"+"</li>"},link:function(locale,options){var size=options&&options.size?" btn-"+options.size:"";return"<li>"+"<div class='bootstrap-wysihtml5-insert-link-modal modal hide fade'>"+"<div class='modal-header'>"+"<a class='close' data-dismiss='modal'>&times;</a>"+"<h3>"+locale.link.insert+"</h3>"+"</div>"+"<div class='modal-body'>"+"<input value='http://' class='bootstrap-wysihtml5-insert-link-url input-xlarge'>"+"<label class='checkbox'> <input type='checkbox' class='bootstrap-wysihtml5-insert-link-target' checked>"+locale.link.target+"</label>"+"</div>"+"<div class='modal-footer'>"+"<a href='#' class='btn' data-dismiss='modal'>"+locale.link.cancel+"</a>"+"<a href='#' class='btn btn-primary' data-dismiss='modal'>"+locale.link.insert+"</a>"+"</div>"+"</div>"+"<a class='btn"+size+"' data-wysihtml5-command='createLink' title='"+locale.link.insert+"' tabindex='-1'><i class='icon-share'></i></a>"+"</li>"},image:function(locale,options){var size=options&&options.size?" btn-"+options.size:"";return"<li>"+"<div class='bootstrap-wysihtml5-insert-image-modal modal hide fade'>"+"<div class='modal-header'>"+"<a class='close' data-dismiss='modal'>&times;</a>"+"<h3>"+locale.image.insert+"</h3>"+"</div>"+"<div class='modal-body'>"+"<input value='http://' class='bootstrap-wysihtml5-insert-image-url input-xlarge'>"+"</div>"+"<div class='modal-footer'>"+"<a href='#' class='btn' data-dismiss='modal'>"+locale.image.cancel+"</a>"+"<a href='#' class='btn btn-primary' data-dismiss='modal'>"+locale.image.insert+"</a>"+"</div>"+"</div>"+"<a class='btn"+size+"' data-wysihtml5-command='insertImage' title='"+locale.image.insert+"' tabindex='-1'><i class='icon-picture'></i></a>"+"</li>"},html:function(locale,options){var size=options&&options.size?" btn-"+options.size:"";return"<li>"+"<div class='btn-group'>"+"<a class='btn"+size+"' data-wysihtml5-action='change_view' title='"+locale.html.edit+"' tabindex='-1'><i class='icon-pencil'></i></a>"+"</div>"+"</li>"},color:function(locale,options){var size=options&&options.size?" btn-"+options.size:"";return"<li class='dropdown'>"+"<a class='btn dropdown-toggle"+size+"' data-toggle='dropdown' href='#' tabindex='-1'>"+"<span class='current-color'>"+locale.colours.black+"</span>&nbsp;<b class='caret'></b>"+"</a>"+"<ul class='dropdown-menu'>"+"<li><div class='wysihtml5-colors' data-wysihtml5-command-value='black'></div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='black'>"+locale.colours.black+"</a></li>"+"<li><div class='wysihtml5-colors' data-wysihtml5-command-value='silver'></div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='silver'>"+locale.colours.silver+"</a></li>"+"<li><div class='wysihtml5-colors' data-wysihtml5-command-value='gray'></div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='gray'>"+locale.colours.gray+"</a></li>"+"<li><div class='wysihtml5-colors' data-wysihtml5-command-value='maroon'></div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='maroon'>"+locale.colours.maroon+"</a></li>"+"<li><div class='wysihtml5-colors' data-wysihtml5-command-value='red'></div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='red'>"+locale.colours.red+"</a></li>"+"<li><div class='wysihtml5-colors' data-wysihtml5-command-value='purple'></div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='purple'>"+locale.colours.purple+"</a></li>"+"<li><div class='wysihtml5-colors' data-wysihtml5-command-value='green'></div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='green'>"+locale.colours.green+"</a></li>"+"<li><div class='wysihtml5-colors' data-wysihtml5-command-value='olive'></div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='olive'>"+locale.colours.olive+"</a></li>"+"<li><div class='wysihtml5-colors' data-wysihtml5-command-value='navy'></div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='navy'>"+locale.colours.navy+"</a></li>"+"<li><div class='wysihtml5-colors' data-wysihtml5-command-value='blue'></div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='blue'>"+locale.colours.blue+"</a></li>"+"<li><div class='wysihtml5-colors' data-wysihtml5-command-value='orange'></div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='orange'>"+locale.colours.orange+"</a></li>"+"</ul>"+"</li>"}};var templates=function(key,locale,options){return tpl[key](locale,options)};var Wysihtml5=function(el,options){this.el=el;var toolbarOpts=options||defaultOptions;for(var t in toolbarOpts.customTemplates){tpl[t]=toolbarOpts.customTemplates[t]}this.toolbar=this.createToolbar(el,toolbarOpts);this.editor=this.createEditor(options);window.editor=this.editor;$("iframe.wysihtml5-sandbox").each(function(i,el){$(el.contentWindow).off("focus.wysihtml5").on({"focus.wysihtml5":function(){$("li.dropdown").removeClass("open")}})})};Wysihtml5.prototype={constructor:Wysihtml5,createEditor:function(options){options=options||{};options=$.extend(true,{},options);options.toolbar=this.toolbar[0];var editor=new wysi.Editor(this.el[0],options);if(options&&options.events){for(var eventName in options.events){editor.on(eventName,options.events[eventName])}}return editor},createToolbar:function(el,options){var self=this;var toolbar=$("<ul/>",{"class":"wysihtml5-toolbar",style:"display:none"});var culture=options.locale||defaultOptions.locale||"en";for(var key in defaultOptions){var value=false;if(options[key]!==undefined){if(options[key]===true){value=true}}else{value=defaultOptions[key]}if(value===true){toolbar.append(templates(key,locale[culture],options));if(key==="html"){this.initHtml(toolbar)}if(key==="link"){this.initInsertLink(toolbar)}if(key==="image"){this.initInsertImage(toolbar)}}}if(options.toolbar){for(key in options.toolbar){toolbar.append(options.toolbar[key])}}toolbar.find("a[data-wysihtml5-command='formatBlock']").click(function(e){var target=e.target||e.srcElement;var el=$(target);self.toolbar.find(".current-font").text(el.html())});toolbar.find("a[data-wysihtml5-command='foreColor']").click(function(e){var target=e.target||e.srcElement;var el=$(target);self.toolbar.find(".current-color").text(el.html())});this.el.before(toolbar);return toolbar},initHtml:function(toolbar){var changeViewSelector="a[data-wysihtml5-action='change_view']";toolbar.find(changeViewSelector).click(function(e){toolbar.find("a.btn").not(changeViewSelector).toggleClass("disabled")})},initInsertImage:function(toolbar){var self=this;var insertImageModal=toolbar.find(".bootstrap-wysihtml5-insert-image-modal");var urlInput=insertImageModal.find(".bootstrap-wysihtml5-insert-image-url");var insertButton=insertImageModal.find("a.btn-primary");var initialValue=urlInput.val();var caretBookmark;var insertImage=function(){var url=urlInput.val();urlInput.val(initialValue);self.editor.currentView.element.focus();if(caretBookmark){self.editor.composer.selection.setBookmark(caretBookmark);
caretBookmark=null}self.editor.composer.commands.exec("insertImage",url)};urlInput.keypress(function(e){if(e.which==13){insertImage();insertImageModal.modal("hide")}});insertButton.click(insertImage);insertImageModal.on("shown",function(){urlInput.focus()});insertImageModal.on("hide",function(){self.editor.currentView.element.focus()});toolbar.find("a[data-wysihtml5-command=insertImage]").click(function(){var activeButton=$(this).hasClass("wysihtml5-command-active");if(!activeButton){self.editor.currentView.element.focus(false);caretBookmark=self.editor.composer.selection.getBookmark();insertImageModal.appendTo("body").modal("show");insertImageModal.on("click.dismiss.modal",'[data-dismiss="modal"]',function(e){e.stopPropagation()});return false}else{return true}})},initInsertLink:function(toolbar){var self=this;var insertLinkModal=toolbar.find(".bootstrap-wysihtml5-insert-link-modal");var urlInput=insertLinkModal.find(".bootstrap-wysihtml5-insert-link-url");var targetInput=insertLinkModal.find(".bootstrap-wysihtml5-insert-link-target");var insertButton=insertLinkModal.find("a.btn-primary");var initialValue=urlInput.val();var caretBookmark;var insertLink=function(){var url=urlInput.val();urlInput.val(initialValue);self.editor.currentView.element.focus();if(caretBookmark){self.editor.composer.selection.setBookmark(caretBookmark);caretBookmark=null}var newWindow=targetInput.prop("checked");self.editor.composer.commands.exec("createLink",{href:url,target:newWindow?"_blank":"_self",rel:newWindow?"nofollow":""})};var pressedEnter=false;urlInput.keypress(function(e){if(e.which==13){insertLink();insertLinkModal.modal("hide")}});insertButton.click(insertLink);insertLinkModal.on("shown",function(){urlInput.focus()});insertLinkModal.on("hide",function(){self.editor.currentView.element.focus()});toolbar.find("a[data-wysihtml5-command=createLink]").click(function(){var activeButton=$(this).hasClass("wysihtml5-command-active");if(!activeButton){self.editor.currentView.element.focus(false);caretBookmark=self.editor.composer.selection.getBookmark();insertLinkModal.appendTo("body").modal("show");insertLinkModal.on("click.dismiss.modal",'[data-dismiss="modal"]',function(e){e.stopPropagation()});return false}else{return true}})}};var methods={resetDefaults:function(){$.fn.wysihtml5.defaultOptions=$.extend(true,{},$.fn.wysihtml5.defaultOptionsCache)},bypassDefaults:function(options){return this.each(function(){var $this=$(this);$this.data("wysihtml5",new Wysihtml5($this,options))})},shallowExtend:function(options){var settings=$.extend({},$.fn.wysihtml5.defaultOptions,options||{},$(this).data());var that=this;return methods.bypassDefaults.apply(that,[settings])},deepExtend:function(options){var settings=$.extend(true,{},$.fn.wysihtml5.defaultOptions,options||{});var that=this;return methods.bypassDefaults.apply(that,[settings])},init:function(options){var that=this;return methods.deepExtend.apply(that,[options])}};$.fn.wysihtml5=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.wysihtml5")}};$.fn.wysihtml5.Constructor=Wysihtml5;var defaultOptions=$.fn.wysihtml5.defaultOptions={"font-styles":true,color:false,emphasis:true,lists:true,html:false,link:true,image:true,events:{},parserRules:{classes:{"wysiwyg-color-silver":1,"wysiwyg-color-gray":1,"wysiwyg-color-white":1,"wysiwyg-color-maroon":1,"wysiwyg-color-red":1,"wysiwyg-color-purple":1,"wysiwyg-color-fuchsia":1,"wysiwyg-color-green":1,"wysiwyg-color-lime":1,"wysiwyg-color-olive":1,"wysiwyg-color-yellow":1,"wysiwyg-color-navy":1,"wysiwyg-color-blue":1,"wysiwyg-color-teal":1,"wysiwyg-color-aqua":1,"wysiwyg-color-orange":1},tags:{b:{},i:{},br:{},ol:{},ul:{},li:{},h1:{},h2:{},h3:{},h4:{},h5:{},h6:{},blockquote:{},u:1,img:{check_attributes:{width:"numbers",alt:"alt",src:"url",height:"numbers"}},a:{check_attributes:{href:"url",target:"alt",rel:"alt"}},span:1,div:1,code:1,pre:1}},stylesheets:["./lib/css/wysiwyg-color.css"],locale:"en"};if(typeof $.fn.wysihtml5.defaultOptionsCache==="undefined"){$.fn.wysihtml5.defaultOptionsCache=$.extend(true,{},$.fn.wysihtml5.defaultOptions)}var locale=$.fn.wysihtml5.locale={en:{font_styles:{normal:"Normal text",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6"},emphasis:{bold:"B",italic:"I",underline:"U"},lists:{unordered:"Unordered list",ordered:"Ordered list",outdent:"Outdent",indent:"Indent"},link:{insert:"Insert link",cancel:"Cancel",target:"Open link in new window"},image:{insert:"Insert image",cancel:"Cancel"},html:{edit:"Edit HTML"},colours:{black:"Black",silver:"Silver",gray:"Grey",maroon:"Maroon",red:"Red",purple:"Purple",green:"Green",olive:"Olive",navy:"Navy",blue:"Blue",orange:"Orange"}}}}(window.jQuery,window.wysihtml5);var xhrFetchingImages;wysiHelpers={getImageTemplate:function(){var tmpl;var imgEntry="";tmpl=_.template("<div class='image-zoom-container'><img src='<%= url %>' alt='<%= caption %>' style='max-width:99%;'/><div class='mask'></div><b class='zoom-action-button' en-zoom='<%= url %>'><i class='icon icon-zoom-in'></i></b></div>");return tmpl}};bootWysiOverrides={initInsertImage:function(toolbar){var self=this;var insertImageModal=toolbar.find(".bootstrap-wysihtml5-insert-image-modal");var urlInput=insertImageModal.find(".bootstrap-wysihtml5-insert-image-url");var insertButton=insertImageModal.find("button.image-upload-button");var cancelButton=insertImageModal.find("button.image-cancel-button");var fileNameLabel=insertImageModal.find("p.choosed_file_name");var initialValue=urlInput.val();var helpers=wysiHelpers;var insertImage=function(imageData){if(imageData.url){var clz="image_container";var doc=self.editor.composer.doc;var tmpl=helpers.getImageTemplate();var chunk=tmpl(imageData);self.editor.currentView.element.focus();console.log(self.editor.currentView.element);self.editor.composer.commands.exec("insertHTML",chunk)}};insertImageModal.on("hide",function(){self.editor.currentView.element.focus()});toolbar.find("a[data-wysihtml5-command=insertImage]").click(function(){var activeButton=$(this).hasClass("wysihtml5-command-active");var choosed_file=null;if(!activeButton){insertImageModal.modal("show");var file_input=toolbar.find(".bootstrap-wysihtml5-insert-image-modal .insert-image-file-input");file_input.replaceWith(file_input.val("").clone(true));file_input=toolbar.find(".bootstrap-wysihtml5-insert-image-modal .insert-image-file-input");self.editor.currentView.element.focus(false);$(".clear_file_btn").on("click",function(evt){evt.preventDefault();choosed_file=null;fileNameLabel.text("")});function attach_change_event(){file_input.off("change").change(function(evt){console.log("file change triggered...");choosed_file=evt.target.files[0];if(!choosed_file){return false}fileNameLabel.text(choosed_file.name);evt.stopPropagation();return false})}attach_change_event();insertButton.off("click").on("click",function(evt){var url=toolbar.find(".image-url-input").val();toolbar.find(".image-url-input").val("");if(url&&url!="http://"){insertImage({url:url,caption:""});insertImageModal.modal("hide");insertImageModal.parents(".nimbus_form_modal").find(".insert-image-mask").remove();fileNameLabel.text("");clear_file_input()}else if(choosed_file){upload_image(choosed_file)}evt.stopPropagation();return false});$("button.close").on("click",function(){insertImageModal.parents(".nimbus_form_modal").find(".insert-image-mask").remove();choosed_file=null;fileNameLabel.text("");clear_file_input()});function clear_file_input(){file_input.replaceWith(file_input.val("").clone(true));file_input=toolbar.find(".bootstrap-wysihtml5-insert-image-modal .insert-image-file-input");attach_change_event()}cancelButton.on("click",function(){choosed_file=null;fileNameLabel.text("")});var upload_image=function(file){toolbar.find(".uploadresult").html("Uploading File.").addClass("alert alert-info");insertButton.attr("disabled",true);insertButton.attr("disabled",true);Nimbus.Binary.upload_file(file,function(file){if(file){foundry._plugins.document.set(file._file.id,file._file);foundry.set_file_public(file._file.id);$(".uploadresult").html("Upload Complete").removeClass("alert-info").addClass("alert-success");insertImage({url:file.directlink,caption:file.name,id:file._file.id});insertImageModal.modal("hide");insertImageModal.parents(".nimbus_form_modal").find(".insert-image-mask").remove()}else{$(".uploadresult").html("Upload failed").removeClass("alert-info").addClass("alert-error")}insertButton.attr("disabled",false);cancelButton.attr("disabled",false);$(".uploadresult").html("").removeClass().addClass("uploadresult");fileNameLabel.text("");clear_file_input()})};insertImageModal.on("click.dismiss.modal",'[data-dismiss="modal"]',function(e){insertImageModal.parents(".nimbus_form_modal").find(".insert-image-mask").remove();choosed_file=null;fileNameLabel.text("");e.stopPropagation()});insertImageModal.parents(".nimbus_form_modal").prepend('<div class="modal-backdrop fade in insert-image-mask"></div>');return false}else{return true}})}};$.extend($.fn.wysihtml5.Constructor.prototype,bootWysiOverrides);$(function(){var wysiwygOptions={customTags:{em:{},strong:{},hr:{}},customStyles:{shrink_wrap:null,credit:null,tombstone:null,chat:null,caption:null},customTemplates:{image:function(locale){return"<li class='editor-image-upload-modal'>"+"<div class='bootstrap-wysihtml5-insert-image-modal nimbus_confirm_modal modal hide fade'>"+"<div class='modal-header'>"+"<h3>"+locale.image.insert+"</h3>"+"</div>"+"<div class='modal-body'>"+'<ul class="nav nav-tabs" id="myTab">'+'<li class="active" style="width:50%"><a href=".home-tab" data-toggle="tab">From Computer</a></li>'+'<li style="width:50%"><a href=".profile-tab" data-toggle="tab">Image Url</a></li>'+"</ul>"+'<div class="tab-content">'+'<div class="tab-pane active home-tab">'+"<div class='chooser_wrapper'>"+'<span class="btn outline btn-file" style="padding:6px 13px;width: auto;height: auto;cursor: pointer;border-radius: 5px;">'+'<span class="fileupload-new">Choose File</span>'+"<input type='file' class='insert-image-file-input' style='width:100%'>"+"</span>"+'<span class="btn btn-danger clear_file_btn" style="height: 22px;width: auto;margin-left: 10px!important;">Clear</span>'+'<p class="choosed_file_name"></p>'+'<div class="uploadresult"></div>'+"</div>"+"</div>"+'<div class="tab-pane profile-tab">'+"<input value='http://' class='image-url-input' style='width:100%;' class='bootstrap-wysihtml5-insert-image-url input-xlarge'>"+"</div>"+"</div>"+"</div>"+"<div class='modal-footer' style='padding:0'>"+"<button class='btn btn-danger image-cancel-button' data-dismiss='modal'>"+locale.image.cancel+"</button>"+"<button class='btn btn-primary image-upload-button' style='float: left;' title='"+locale.image.insert+"'>"+locale.image.insert+" <i class='icon-picture'></i></button>"+"</div>"+"</div>"+"<a class='btn' data-wysihtml5-command='insertImage' title='"+locale.image.insert+"'><i class='icon-picture'></i></a>"+"</li>"}}};foundry.wysiwygOptions=wysiwygOptions;$(".tip").tooltip();$("textarea.wysi").each(function(){$(this).wysihtml5($.extend(wysiwygOptions,{html:true,color:false,stylesheets:[]}))})});!function(a,b){"use strict";var c=b.module("ngDialog",[]),d=b.element,e=b.isDefined,f=(document.body||document.documentElement).style,g=e(f.animation)||e(f.WebkitAnimation)||e(f.MozAnimation)||e(f.MsAnimation)||e(f.OAnimation),h="animationend webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend";c.provider("ngDialog",function(){var a=this.defaults={className:"ngdialog-theme-default",plain:!1,showClose:!0,closeByDocument:!0,closeByEscape:!0},c=0,e=0;this.$get=["$document","$templateCache","$compile","$q","$http","$rootScope","$timeout",function(f,i,j,k,l,m,n){var o=f.find("body"),p={onDocumentKeyup:function(a){27===a.keyCode&&q.close()},closeDialog:function(a){a.unbind("click"),1===e&&o.unbind("keyup").removeClass("ngdialog-open"),e-=1,g?a.unbind(h).bind(h,function(){a.remove()}).addClass("ngdialog-closing"):a.remove()}},q={open:function(f){function g(a){return a?b.isString(a)&&h.plain?a:i.get(a)||l.get(a,{cache:!0}):"Empty template"}var h=b.copy(a);f=f||{},b.extend(h,f),c+=1;var r,s=b.isObject(h.scope)?h.scope:m.$new();k.when(g(h.template)).then(function(a){return a=b.isString(a)?a:a.data&&b.isString(a.data)?a.data:"",h.showClose&&(a+='<div class="ngdialog-close"></div>'),r=d('<div id="ngdialog'+c+'" class="ngdialog"></div>'),r.html('<div class="ngdialog-overlay"></div><div class="ngdialog-content">'+a+"</div>"),h.controller&&b.isString(h.controller)&&r.attr("ng-controller",h.controller),h.className&&r.addClass(h.className),h.data&&b.isString(h.data)&&(s.ngDialogData="{"===h.data.replace(/^\s*/,"")[0]?b.fromJson(h.data):h.data),n(function(){j(r)(s)}),s.$on("$destroy",function(){r.remove()}),o.addClass("ngdialog-open").append(r),h.closeByEscape&&o.bind("keyup",p.onDocumentKeyup),h.closeByDocument&&r.bind("click",function(a){var b=d(a.target).hasClass("ngdialog-overlay"),c=d(a.target).hasClass("ngdialog-close");(b||c)&&q.close(r.attr("id"))}),e+=1,q})},close:function(a){var b=d(document.getElementById(a));return b.length?p.closeDialog(b):q.closeAll(),q},closeAll:function(){var a=document.querySelectorAll(".ngdialog");b.forEach(a,function(a){p.closeDialog(d(a))})}};return q}]}),c.directive("ngDialog",["ngDialog",function(a){return{restrict:"A",link:function(b,c,d){c.on("click",function(b){b.preventDefault(),a.open({template:d.ngDialog,className:d.ngDialogClass,controller:d.ngDialogController,scope:d.ngDialogScope,data:d.ngDialogData,showClose:"false"===d.ngDialogShowClose?!1:!0,closeByDocument:"false"===d.ngDialogCloseByDocument?!1:!0,closeByEscape:"false"===d.ngDialogCloseByKeyup?!1:!0})})}}}])}(window,window.angular);angular.module("ui.bootstrap",["ui.bootstrap.alert","ui.bootstrap.modal"]),angular.module("ui.bootstrap.alert",[]).controller("AlertController",["$scope","$attrs",function(a,b){a.closeable="close"in b}]).directive("alert",function(){return{restrict:"EA",controller:"AlertController",templateUrl:"template/alert/alert.html",transclude:!0,replace:!0,scope:{type:"=",close:"&"}}}),angular.module("ui.bootstrap.modal",[]).factory("$$stackedMap",function(){return{createNew:function(){var a=[];return{add:function(b,c){a.push({key:b,value:c})},get:function(b){for(var c=0;c<a.length;c++)if(b==a[c].key)return a[c]},keys:function(){for(var b=[],c=0;c<a.length;c++)b.push(a[c].key);return b},top:function(){return a[a.length-1]},remove:function(b){for(var c=-1,d=0;d<a.length;d++)if(b==a[d].key){c=d;break}return a.splice(c,1)[0]},removeTop:function(){return a.splice(a.length-1,1)[0]},length:function(){return a.length}}}}}).directive("modalBackdrop",["$timeout",function(a){return{restrict:"EA",replace:!0,templateUrl:"template/modal/backdrop.html",link:function(b){b.animate=!1,a(function(){b.animate=!0})}}}]).directive("modalWindow",["$modalStack","$timeout",function(a,b){return{restrict:"EA",scope:{index:"@"},replace:!0,transclude:!0,templateUrl:"template/modal/window.html",link:function(c,d,e){c.windowClass=e.windowClass||"",b(function(){c.animate=!0,d[0].focus()}),c.close=function(b){var c=a.getTop();c&&c.value.backdrop&&"static"!=c.value.backdrop&&b.target===b.currentTarget&&(b.preventDefault(),b.stopPropagation(),a.dismiss(c.key,"backdrop click"))}}}}]).factory("$modalStack",["$document","$compile","$rootScope","$$stackedMap",function(a,b,c,d){function e(){for(var a=-1,b=k.keys(),c=0;c<b.length;c++)k.get(b[c]).value.backdrop&&(a=c);return a}function f(b){var c=a.find("body").eq(0),d=k.get(b).value;k.remove(b),d.modalDomEl.remove(),c.toggleClass(i,k.length()>0),h&&-1==e()&&(h.remove(),h=void 0),d.modalScope.$destroy()}var g,h,i="modal-open",j=c.$new(!0),k=d.createNew(),l={};return c.$watch(e,function(a){j.index=a}),a.bind("keydown",function(a){var b;27===a.which&&(b=k.top(),b&&b.value.keyboard&&c.$apply(function(){l.dismiss(b.key)}))}),l.open=function(c,d){k.add(c,{deferred:d.deferred,modalScope:d.scope,backdrop:d.backdrop,keyboard:d.keyboard});var f=a.find("body").eq(0);e()>=0&&!h&&(g=angular.element("<div modal-backdrop></div>"),h=b(g)(j),f.append(h));var l=angular.element("<div modal-window></div>");l.attr("window-class",d.windowClass),l.attr("index",k.length()-1),l.html(d.content);var m=b(l)(d.scope);k.top().value.modalDomEl=m,f.append(m),f.addClass(i)},l.close=function(a,b){var c=k.get(a).value;c&&(c.deferred.resolve(b),f(a))},l.dismiss=function(a,b){var c=k.get(a).value;c&&(c.deferred.reject(b),f(a))},l.getTop=function(){return k.top()},l}]).provider("$modal",function(){var a={options:{backdrop:!0,keyboard:!0},$get:["$injector","$rootScope","$q","$http","$templateCache","$controller","$modalStack",function(b,c,d,e,f,g,h){function i(a){return a.template?d.when(a.template):e.get(a.templateUrl,{cache:f}).then(function(a){return a.data})}function j(a){var c=[];return angular.forEach(a,function(a){(angular.isFunction(a)||angular.isArray(a))&&c.push(d.when(b.invoke(a)))}),c}var k={};return k.open=function(b){var e=d.defer(),f=d.defer(),k={result:e.promise,opened:f.promise,close:function(a){h.close(k,a)},dismiss:function(a){h.dismiss(k,a)}};if(b=angular.extend({},a.options,b),b.resolve=b.resolve||{},!b.template&&!b.templateUrl)throw new Error("One of template or templateUrl options is required.");var l=d.all([i(b)].concat(j(b.resolve)));return l.then(function(a){var d=(b.scope||c).$new();d.$close=k.close,d.$dismiss=k.dismiss;var f,i={},j=1;b.controller&&(i.$scope=d,i.$modalInstance=k,angular.forEach(b.resolve,function(b,c){i[c]=a[j++]}),f=g(b.controller,i)),h.open(k,{scope:d,deferred:e,content:a[0],backdrop:b.backdrop,keyboard:b.keyboard,windowClass:b.windowClass})},function(a){e.reject(a)}),l.then(function(){f.resolve(!0)},function(){f.reject(!1)}),k},k}]};return a});angular.module("ui.bootstrap",["ui.bootstrap.tpls","ui.bootstrap.alert","ui.bootstrap.modal"]),angular.module("ui.bootstrap.tpls",["template/alert/alert.html","template/modal/backdrop.html","template/modal/window.html"]),angular.module("ui.bootstrap.alert",[]).controller("AlertController",["$scope","$attrs",function(a,b){a.closeable="close"in b}]).directive("alert",function(){return{restrict:"EA",controller:"AlertController",templateUrl:"template/alert/alert.html",transclude:!0,replace:!0,scope:{type:"=",close:"&"}}}),angular.module("ui.bootstrap.modal",[]).factory("$$stackedMap",function(){return{createNew:function(){var a=[];return{add:function(b,c){a.push({key:b,value:c})},get:function(b){for(var c=0;c<a.length;c++)if(b==a[c].key)return a[c]},keys:function(){for(var b=[],c=0;c<a.length;c++)b.push(a[c].key);return b},top:function(){return a[a.length-1]},remove:function(b){for(var c=-1,d=0;d<a.length;d++)if(b==a[d].key){c=d;break}return a.splice(c,1)[0]},removeTop:function(){return a.splice(a.length-1,1)[0]},length:function(){return a.length}}}}}).directive("modalBackdrop",["$timeout",function(a){return{restrict:"EA",replace:!0,templateUrl:"template/modal/backdrop.html",link:function(b){b.animate=!1,a(function(){b.animate=!0})}}}]).directive("modalWindow",["$modalStack","$timeout",function(a,b){return{restrict:"EA",scope:{index:"@"},replace:!0,transclude:!0,templateUrl:"template/modal/window.html",link:function(c,d,e){c.windowClass=e.windowClass||"",b(function(){c.animate=!0,d[0].focus()}),c.close=function(b){var c=a.getTop();c&&c.value.backdrop&&"static"!=c.value.backdrop&&b.target===b.currentTarget&&(b.preventDefault(),b.stopPropagation(),a.dismiss(c.key,"backdrop click"))}}}}]).factory("$modalStack",["$document","$compile","$rootScope","$$stackedMap",function(a,b,c,d){function e(){for(var a=-1,b=k.keys(),c=0;c<b.length;c++)k.get(b[c]).value.backdrop&&(a=c);return a}function f(b){var c=a.find("body").eq(0),d=k.get(b).value;k.remove(b),d.modalDomEl.remove(),c.toggleClass(i,k.length()>0),h&&-1==e()&&(h.remove(),h=void 0),d.modalScope.$destroy()}var g,h,i="modal-open",j=c.$new(!0),k=d.createNew(),l={};return c.$watch(e,function(a){j.index=a}),a.bind("keydown",function(a){var b;27===a.which&&(b=k.top(),b&&b.value.keyboard&&c.$apply(function(){l.dismiss(b.key)}))}),l.open=function(c,d){k.add(c,{deferred:d.deferred,modalScope:d.scope,backdrop:d.backdrop,keyboard:d.keyboard});var f=a.find("body").eq(0);e()>=0&&!h&&(g=angular.element("<div modal-backdrop></div>"),h=b(g)(j),f.append(h));var l=angular.element("<div modal-window></div>");l.attr("window-class",d.windowClass),l.attr("index",k.length()-1),l.html(d.content);var m=b(l)(d.scope);k.top().value.modalDomEl=m,f.append(m),f.addClass(i)},l.close=function(a,b){var c=k.get(a).value;c&&(c.deferred.resolve(b),f(a))},l.dismiss=function(a,b){var c=k.get(a).value;c&&(c.deferred.reject(b),f(a))},l.getTop=function(){return k.top()},l}]).provider("$modal",function(){var a={options:{backdrop:!0,keyboard:!0},$get:["$injector","$rootScope","$q","$http","$templateCache","$controller","$modalStack",function(b,c,d,e,f,g,h){function i(a){return a.template?d.when(a.template):e.get(a.templateUrl,{cache:f}).then(function(a){return a.data})}function j(a){var c=[];return angular.forEach(a,function(a){(angular.isFunction(a)||angular.isArray(a))&&c.push(d.when(b.invoke(a)))}),c}var k={};return k.open=function(b){var e=d.defer(),f=d.defer(),k={result:e.promise,opened:f.promise,close:function(a){h.close(k,a)},dismiss:function(a){h.dismiss(k,a)}};if(b=angular.extend({},a.options,b),b.resolve=b.resolve||{},!b.template&&!b.templateUrl)throw new Error("One of template or templateUrl options is required.");var l=d.all([i(b)].concat(j(b.resolve)));return l.then(function(a){var d=(b.scope||c).$new();d.$close=k.close,d.$dismiss=k.dismiss;var f,i={},j=1;b.controller&&(i.$scope=d,i.$modalInstance=k,angular.forEach(b.resolve,function(b,c){i[c]=a[j++]}),f=g(b.controller,i)),h.open(k,{scope:d,deferred:e,content:a[0],backdrop:b.backdrop,keyboard:b.keyboard,windowClass:b.windowClass})},function(a){e.reject(a)}),l.then(function(){f.resolve(!0)},function(){f.reject(!1)}),k},k}]};return a}),angular.module("template/alert/alert.html",[]).run(["$templateCache",function(a){a.put("template/alert/alert.html","<div class='alert' ng-class='\"alert-\" + (type || \"warning\")'>\n    <button ng-show='closeable' type='button' class='close' ng-click='close()'>&times;</button>\n    <div ng-transclude></div>\n</div>\n")}]),angular.module("template/modal/backdrop.html",[]).run(["$templateCache",function(a){a.put("template/modal/backdrop.html",'<div class="modal-backdrop fade" ng-class="{in: animate}" ng-style="{\'z-index\': 1040 + index*10}"></div>')}]),angular.module("template/modal/window.html",[]).run(["$templateCache",function(a){a.put("template/modal/window.html",'<div tabindex="-1" class="modal fade {{ windowClass }}" ng-class="{in: animate}" ng-style="{\'z-index\': 1050 + index*10, display: \'block\'}" ng-click="close($event)">\n    <div class="modal-dialog"><div class="modal-content" ng-transclude></div></div>\n</div>')}]);(function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date;a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,"script","//www.google-analytics.com/analytics.js","ga");(function(){var core;core=new Object;core._plugins={};core._workspace={};core._models={};core.angular={dependency:[]};core.loaded=false;core.bootstraped=false;core.default_plugin="";if(Nimbus.Client.GDrive.is_auth_redirected()){$("#login_buttons").addClass("redirect")}core.current_user=function(callback){var self;self=this;return Nimbus.Share.get_me(function(me){console.log(me);self._current_user=me;if(!self._current_user.email){self._current_user.email=Nimbus.Share.get_user_email()}if(callback){callback(me)}$("#user_pic").attr("src",me.pic);return $("#user_pic_large").attr("src",me.pic)})};core.shared_users=function(callback){var self;self=this;return Nimbus.Share.get_shared_users_real(function(users){console.log(users);self._user_list=window.create_object_dictionary(users);if(callback){return callback(users)}})};core.plugins_loaded=false;core.load_plugins=function(){var self;self=this;return require(["core"],function(main){self.plugins_loaded=true;return require(main.plugins,function(){var dependency,plugin,_i,_len;for(_i=0,_len=arguments.length;_i<_len;_i++){plugin=arguments[_i];self._plugins[plugin.name]=plugin}dependency=self.angular.dependency.concat(["enterpise-ui","ngRoute"]);angular.module("foundry",dependency).config(["$routeProvider",function($routeProvider){var path,route,_ref;_ref=main.paths;for(route in _ref){path=_ref[route];$routeProvider.when("/"+route,{templateUrl:path+".html"})}}]).run(["$rootScope","$location",function($rootScope,$location){var inex,_plugin,_ref;$rootScope._plugins=[];_ref=foundry._plugins;for(inex in _ref){_plugin=_ref[inex];$rootScope._plugins.push(_plugin)}$rootScope._active_app_path="";$rootScope._current_global_user=foundry._current_user;$rootScope.$on("$locationChangeSuccess",function(evt,new_path,old_path){var default_path;default_path=localStorage.default_plugin||foundry.default_plugin;if(default_path&&!$location.path()){$location.path(default_path)}else if(!$location.path()){$location.path("/workspace")}$rootScope._active_app_path=$location.path();localStorage.default_plugin=$location.path()})}]);console.log("plugins loaded");return self.plugin_load_completed()})})};define("core",["config"],function(config){var c,key,packages,paths,plugins,value,_ref;console.log(config);paths={};plugins=[];packages=[];_ref=config.plugins;for(key in _ref){value=_ref[key];paths[key]=value+"/index";plugins.push(key);packages.push({name:key,location:value,main:"index"})}requirejs.config({packages:packages});c={plugins:plugins,paths:paths,packages:packages,appName:config.appName};return c});core.plugin_load_completed=function(){return console.log("plugins is loaded")};core.init=function(callback){var cb,plugin_completed,self;self=this;cb=function(){var key,value,_ref;self.init_settings();_ref=self._plugins;for(key in _ref){value=_ref[key];if(typeof value.inited==="function"){value.inited()}}if(!self.bootstraped){angular.bootstrap(document,["foundry"]);self.bootstraped=true}if(callback){callback()}$("#app-loading").addClass("loaded");$("#app-loading #login_buttons").removeClass("redirect")};if(this.plugins_loaded){console.log("plugins loaded, and start the callback");this.reinitialize(cb)}else{console.log("not yet, put the callback into the plugin_callbak");plugin_completed=this.plugin_load_completed;this.plugin_load_completed=function(){plugin_completed();return self.reinitialize(cb)}}};core.module_status={};core.reinitialize=function(callback){var e,k,v,_ref,_ref1;if(callback){this.module_finished=callback}_ref=this._plugins;for(k in _ref){v=_ref[k];if(v.type==="plugin"){this.module_status[v.name]="start"}}_ref1=this._plugins;for(k in _ref1){v=_ref1[k];if(v.type==="plugin"){try{v.init()}catch(_error){e=_error;console.log(e)}}}};core.initialized=function(module){var k,v,_ref;this.module_status[module]="end";console.log(this.module_status);_ref=this._plugins;for(k in _ref){v=_ref[k];if(this.module_status[v.name]==="start"){return}}if(this.module_finished){return this.module_finished()}};core.ready=function(callback){var self;self=this;return Nimbus.Auth.set_app_ready(function(){callback();return self.loaded=true})};core.model=function(name,attributes,callback){var model,self,sync_finished;self=this;if(name&&attributes){model=Nimbus.Model.setup(name,attributes);self._models[name]=model;sync_finished=function(){return callback(model)};model.sync_all(sync_finished);return model}else{throw"Model name and attributes should be specified";return void 0}};core.module=function(name,obj,callback){var name_used;name_used=false;if(!core._plugins[name]){core._plugins[name]=obj}else{name_used=true}callback(!name_used);return console.log("register "+(!name_used?"ok":"failed"))};core.load=function(name){return this._plugins[name]};core.load_model=function(name){return this._models[name]};core.logout=function(){return Nimbus.Auth.logout()};core.parse_open_url=function(){var config,e,m,open_setting,regex,string;config={};string=decodeURIComponent(location.search.substring(1)).replace("/","");regex=/([^&=]+)=([^&]*)/g;while(m=regex.exec(string)){config[m[1]]=m[2]}if(config.state){try{open_setting=JSON.parse(config.state);if(open_setting){localStorage.login_user=open_setting.userId;if(open_setting.ids[0]){localStorage.last_opened_workspace=open_setting.ids[0]}}}catch(_error){e=_error;console.log(e)}}return config};core.parse_open_url();core.init_settings=function(){return core.settings=core.model("Settings",["userid","setting_name","setting_value"],function(model){core.settings=model;return core._my_settings=model.findByAttribute("userid",core._current_user.id)})};core.set_setting=function(key,value){var my_settings,x;my_settings=foundry.settings.select(function(item){return item.userid===foundry._current_user.id&&item.setting_name===key});if(my_settings.length===0){return foundry.settings.create({userid:foundry._current_user.id,setting_name:key,setting_value:value})}else{x=my_settings[0];x.setting_value=value;return x.save()}};core.get_setting=function(key){var setting;setting=foundry.settings.select(function(item){return item.userid===foundry._current_user.id&&item.setting_name===key});if(setting.length>0){return setting[0].setting_value}else{return null}};core.get_setting_all=function(userid,key){var setting;setting=foundry.settings.select(function(item){return item.userid===userid&&item.setting_name===key});if(setting.length>0){return setting[0].setting_value}else{return null}};core.set_file_public=function(id,callback){var param;param={body:{role:"reader",type:"anyone"},path:"/drive/v2/files/"+id+"/permissions",params:{fileId:id},method:"POST",callback:function(data){log(data);if(callback){return callback(data)}}};return gapi.client.request(param)};window.create_object_dictionary=function(all){var dict,obj,_i,_len;dict={};for(_i=0,_len=all.length;_i<_len;_i++){obj=all[_i];dict[obj.id]=obj}return dict};window.foundry=window.foundry=core}).call(this);(function(){var define_controller;define("document",function(require){var doc_plugin;return doc_plugin={type:"plugin",title:"Document",anchor:"#/document",name:"document",version:1,order:10,icon:"icon-file",controller_scope:null,init:function(){var attributes,name,self;self=this;name="Document";attributes=["id","title","timestamp"];foundry.model(name,attributes,function(model){model.onUpdate(function(mode,obj,isLocal){if(mode==="CREATE"&&!isLocal){return self.all_file(function(){if(self.controller_scope){self.controller_scope.load();return self.controller_scope.$apply()}})}});return self.all_file(function(){return foundry.initialized(self.name)})});define_controller()},all_file:function(callback){var self;self=this;if(folder){return Nimbus.Client.GDrive.getMetadataList("'"+folder.binary_files.id+"' in parents",function(data){self._documents=window.create_object_dictionary(data.items);if(callback){callback(data.items)}})}else{return[]}},upload_file:function(file,callback){return Nimbus.Binary.upload_file(file,function(f){if(callback){return callback(f)}})},delete_file:function(doc,callback){Nimbus.Client.GDrive.deleteFile(doc.id);if(callback){return callback()}},get:function(id){return this._documents[id]},set:function(id,data){var doc,model;if(!this._documents[id]){this._documents[id]=data;model=foundry._models.Document;doc=model.create({title:data.title,id:data.id,timestamp:(new Date).getTime()});doc.save()}}}});define_controller=function(){return angular.module("foundry").controller("DocumentController",["$scope","$rootScope","ngDialog","$foundry","$timeout",function($scope,$rootScope,ngDialog,$foundry,$timeout){var file_module;$rootScope.breadcum="Documents";file_module=foundry.load("document");file_module.controller_scope=$scope;$scope.load=function(callback){$scope.files=file_module._documents
};$scope.choosed_file=null;$scope.upload_document=function(){var spinner;spinner=$foundry.spinner({type:"loading",text:"Uploading "});Nimbus.Binary.upload_file($scope.choosed_file,function(file){file_module.set(file._file.id,file._file);$scope.choosed_file=null;$scope.load();$scope.$apply();return spinner.hide()})};$scope.delete_document=function(index){var file,spinner;file=$scope.files[index];spinner=$foundry.spinner({type:"loading",text:"Deleteing..."});return file_module.delete_file(file,function(){console.log("deleting file");return $timeout(function(){return $scope.load(function(){return spinner.hide()})},3e3)})};$scope.load()}])}}).call(this);(function(){var inject_controller;define("user",["require","core/analytic"],function(require,analytic){var user_plugin;return user_plugin={name:"user",_models:{},anchor:"#/user",title:"Users",type:"plugin",order:11,icon:"icon-user",init:function(){var attributes,name,self;self=this;name="User";attributes=["pid","name","role","email","pic","debug","not_first_login","initied","rated","last_login_time"];this._models["user"]={};foundry.model(name,attributes,function(model){self._models["user"]=model;foundry.initialized(self.name)})},inited:function(){var id,self,user,user_model,_ref;analytic.init();this.check_users();self=this;user_model=foundry._models["User"];_ref=foundry._user_list;for(id in _ref){user=_ref[id];if(user.id===c_file.owners[0].permissionId){foundry._current_owner=user}}return inject_controller()},check_users:function(){var data,one,pid,user,user_model,_i,_len,_ref,_ref1;user_model=foundry._models["User"];console.log("user list total :"+keys(foundry._user_list).length+", user model total: "+user_model.all().length);_ref=user_model.all();for(_i=0,_len=_ref.length;_i<_len;_i++){user=_ref[_i];if(!user.email){user.destroy()}}_ref1=foundry._user_list;for(pid in _ref1){user=_ref1[pid];one=user_model.findByAttribute("pid",pid);if(one){if(one.email){user.email=one.email;user.roleName=one.role}}if(one&&!one.pic){one.pic=user.pic;one.save()}else if(!one){data={pid:pid,name:user.name,pic:user.pic};if(user.email){data.email=user.email}if(window.c_file.owners[0].permissionId===pid){data.role="Admin"}else{data.role="Viewer"}if(pid===foundry._current_user.id){data.email=window.user_email}data.debug=user_email+":"+"time: "+new Date+JSON.stringify(foundry._models.User.all());user_model.create(data);user.roleName=data.role}one=user_model.findByAttribute("pid",pid);if(pid===foundry._current_user.id){if(!one.not_first_login){one.not_first_login=1;one.save()}}}},all_user:function(){return this._models["user"].all()},add_user:function(data,callback){var model,user;if(!data.role){data.role="Viewer"}model=this._models["user"];user=model.findByAttribute("email",data.email);if(!user){user=model.create(data)}user.role=data.role;user.save();this.add_share(user,function(data){if(callback){return callback(data)}});return analytic.user({email:foundry._current_user.email,user:data.email,id:foundry._current_user.id})},add_share:function(user,callback){var model;model=this._models["user"];if(user.email){Nimbus.Share.add_share_user_real(user.email,function(u){var t;if(u.name){t=model.findByAttribute("email",user.email);t.name=u.name;t.pid=u.id;t.pic=u.pic;t.save()}foundry._user_list[u.id]={name:u.name,pic:u.pic,roleName:user.role,email:user.email,id:u.id,role:u.role};if(callback){callback(u);return angular.element(document).scope().$apply()}});if(folder&&folder["binary_files"]){return Nimbus.Share.add_share_user_real(user.email,null,folder["binary_files"].id)}}},remove_share:function(user){Nimbus.Share.remove_share_user_real(user.id,function(res){})},save_user:function(id,data){var user;user=foundry._user_list[id];user.roleName=data.role;user=this._models["user"].findByAttribute("pid",id);if(user){user.role=data.role;return user.save()}},del_user:function(user,callback){var id;id=user.id;this.remove_share(user);if(callback){return callback()}},mail_list:function(){var i,id,recipients,user,_ref;recipients="";i=0;_ref=foundry._user_list;for(id in _ref){user=_ref[id];if(user.email===foundry._current_user.email){continue}if(foundry.get_setting_all(id,"email")!=null&&foundry.get_setting_all(id,"email")===false){continue}if(i===0&&user.email){recipients+=user.name+" <"+user.email+">"}else if(user.email){recipients+=","+user.name+" <"+user.email+">"}i++}return recipients},user_plan:null,get_user_plan:function(callback){var self,url;self=this;url="http://192.241.167.76:4000/order/"+foundry._current_owner.id+"/"+foundry._current_owner.email;return $.ajax({url:url,success:function(data){var user;if(data){user=data;self.user_plan=foundry._owner_plan=Number(user.order.type)}else{user=false;self.user_plan=foundry._owner_plan=0}if(callback){return callback(user)}}})},user_limit:function(callback){var can_create_user,plan_limit,self;plan_limit=[10,25,50];self=this;can_create_user=function(current_type){var limit;current_type=Number(current_type);if(current_type===3){return true}else{limit=plan_limit[current_type];return self._models["user"].all().length<limit}};this.get_user_plan(function(user){var order,result;if(user){order=user.order;self.user_plan=order.type;if(order.status===0){self.user_plan=0}}else{self.user_plan=0}result=can_create_user(self.user_plan);if(callback){return callback(result)}})},alert_for_upgrade:function(msg){if(!msg){msg="<div style='padding:20px 10px;'>Your user amount has exceeded the plan your've purchased. You need to upgrade to a higher plan.</div>"}return bootbox.dialog({message:msg,title:"Upgrade Needed",className:"nimbus_confirm_modal",buttons:{success:{label:"Upgrade",className:"btn-success",callback:function(evt){return window.open("http://getforum.us/pricing.html")}},cancel:{className:"btn-danger",callback:function(evt){return console.log("go away")}}}})}}});inject_controller=function(){return angular.module("foundry").controller("UserListController",["$scope","$rootScope","$parse",function($scope,$rootScope,$parse){var current_user,update_current_user_permission,user_model;user_model=foundry.load("user");$scope.users=foundry._user_list;$rootScope.breadcum="Users";$rootScope.shortcut_name="Add User";current_user=foundry._current_user;$scope.user_permission="Viewer";update_current_user_permission=function(){var current_user_in_model;current_user_in_model=foundry._models.User.findByAttribute("pid",current_user.id);if(current_user_in_model){return $scope.user_permission=current_user_in_model.role}};update_current_user_permission();$scope.add_shortcut=function(){$scope.form_mode="create";$(".form").modal()};$scope.form_mode="create";$scope.usermodel={fields:{email:{type:"input",label:"Email"},role:{type:"select",label:"Role",options:{Admin:"Admin",Viewer:"Viewer"}}},create:"submit()",update:"update()"};$scope.userEditModel={fields:{role:{type:"select",label:"Role",options:{Admin:"Admin",Viewer:"Viewer"}}},create:"submit()",update:"update()"};$scope.user_data={name:"",email:""};$scope.edit_user=function(id){$scope.form_mode="edit";$scope.user_data=angular.copy($scope.users[id]);$scope.user_data.role=$scope.user_data.roleName;$(".update_form").modal()};$scope.update=function(){user_model.save_user($scope.user_data.id,$scope.user_data);update_current_user_permission();$(".modal").modal("hide");$scope.user_data={}};$scope.del_user=function(id){user_model.del_user($scope.users[id]);return delete foundry._user_list[id]};$scope.creating_user=false;$scope.submit=function(){var reset;if($scope.creating_user){return}$scope.creating_user=true;reset=function(){$scope.user_data={};$(".form").modal("hide");$(".create_button").removeClass("disabled");return $scope.creating_user=false};user_model.user_limit(function(reuslt){if(reuslt){$(".create_button").addClass("disabled");return user_model.add_user($scope.user_data,function(){return reset()})}else{reset();user_model.alert_for_upgrade()}})};$scope.user_info={};$scope.show_user=function(id){var user;user=$scope.users[id];$scope.user_info={name:user.name,email:user.email};$(".userinfo").modal()};$scope.is_owner=function(user){return user.id===foundry._current_owner.id};$scope.clear=function(){$(".modal").modal("hide");$scope.user_data={}}}])}}).call(this);(function(){var define_controller;define("workspace",["require","core/analytic"],function(require,analytic){var doc_plugin;return doc_plugin={type:"plugin",title:"Workspace",anchor:"#/workspace",name:"workspace",version:1,order:12,icon:"icon-folder-close",_app_files:[],_app_folders:[],init:function(){var self;self=this;if(localStorage["last_opened_workspace"]&&localStorage["last_opened_workspace"]!==c_file.id){this.open({id:localStorage["last_opened_workspace"]})}else{localStorage["last_opened_workspace"]=c_file.id;foundry.shared_users(function(users){var _users;_users=users;return foundry.current_user(function(me){var user,_i,_len;for(_i=0,_len=_users.length;_i<_len;_i++){user=_users[_i];if(user.id===me.id){foundry._current_user.role=user.role}}if(!foundry._current_user.email){foundry._current_user.email=Nimbus.Share.get_user_email()}console.log(_users);return foundry.initialized(self.name)})})}return define_controller()},inited:function(){log("inited");if(this.switch_callback){this.switch_callback()}return console.log(analytic)},switch_callback:null,all_doc:function(){var file,files,folders,_i,_len;files=[];folders=[];for(_i=0,_len=app_files.length;_i<_len;_i++){file=app_files[_i];if(file.mimeType&&file.mimeType==="application/vnd.google-apps.drive-sdk."+Nimbus.Auth.app_id){files.push(file)}else{folders.push(file)}}this._app_files=files;this._app_folders=folders;return this._app_files},open:function(doc,callback){localStorage["last_opened_workspace"]=doc.id;Nimbus.Share.switch_to_app_file_real(doc.id,function(){if(callback){callback()}angular.element(document).scope().$apply();ga("set","dimension2",c_file.title);ga("set","dimension3",c_file.owners[0].emailAddress+":"+c_file.owners[0].displayName);ga("set","dimension4",foundry._models.User.all())})},create:function(name,callback){var self;if(!name){console.log("name required")}self=this;Nimbus.Client.GDrive.insertFile("",name,"application/vnd.google-apps.drive-sdk",null,function(data){window.app_files.push(data);self._app_files.push(data);callback(data);angular.element(document).scope().$apply()});analytic.owner({id:foundry._current_user.id,email:foundry._current_user.email,date:(new Date).getTime(),name:name})},current:function(){return window.c_file},is_current:function(doc){return doc.id===window.c_file.id},rename:function(doc,name,cb){var id,old_name,param,request,self;self=this;id=doc.id;old_name=doc.title;param={path:"/drive/v2/files/"+id,method:"PATCH",params:{key:Nimbus.Auth.key,fileId:id},body:{title:name},callback:function(file){var apply_changes,folder,index,query,rename_folder,_file,_ref;_ref=window.app_files;for(index in _ref){_file=_ref[index];if(doc.id===_file.id){file.title=name}}folder=window.folder.binary_files;apply_changes=function(changed_file){if(cb){cb(changed_file)}return angular.element(document).scope().$apply()};rename_folder=function(target,replace){return self.rename_folder(target,name+" files",function(f){if(replace){window.folder.binary_files=f}return apply_changes(file)})};if(c_file.id!==id){query="mimeType = 'application/vnd.google-apps.folder' and title = '"+old_name+" files' and properties has { key='space' and value='"+id+"' and visibility='PRIVATE' }";Nimbus.Client.GDrive.getMetadataList(query,function(data){if(!data.error){if(data.items.length>=1){folder=data.items[0];return rename_folder(folder)}else{return apply_changes()}}else{return apply_changes()}})}else{rename_folder(folder,true)}}};request=gapi.client.request(param)},rename_folder:function(folder,name,cb){var id,param,request;log("rename the folder");id=folder.id;param={path:"/drive/v2/files/"+id,method:"PATCH",params:{key:Nimbus.Auth.key,fileId:id},body:{title:name},callback:function(file){if(cb){cb(file)}return angular.element(document).scope().$apply()}};request=gapi.client.request(param)},del_doc:function(doc,callback){var file,index,_ref,_ref1;if(doc.id===c_file.id){return}Nimbus.Client.GDrive.deleteFile(doc.id);_ref=this._app_files;for(index in _ref){file=_ref[index];if(doc.id===file.id){this._app_files.splice(index,1)}}_ref1=window.app_files;for(index in _ref1){file=_ref1[index];if(doc.id===file.id){window.app_files.splice(index,1)}}}}});define_controller=function(){return angular.module("foundry").controller("ProjectController",["$scope","$rootScope","ngDialog","$foundry",function($scope,$rootScope,ngDialog,$foundry){var docModule;docModule=foundry.load("workspace");$rootScope.breadcum="Workspace";$scope.filename="";$scope.current_edit=-1;$scope.load=function(){return $scope.projects=docModule.all_doc()};$scope.is_loaded=function(doc){return docModule.is_current(doc)};$scope.add_document=function(){$scope.filename="";ngDialog.open({template:"newfile",controller:this,scope:$scope})};$scope.create_doc=function(){var spinner;ngDialog.close();spinner=$foundry.spinner({type:"loading",text:"Creating "+$scope.filename+"..."});docModule.create($scope.filename,function(file){var index,project,_ref;if(file.title===$scope.filename){$scope.load();spinner.hide();_ref=$scope.projects;for(index in _ref){project=_ref[index];if(file.id===project.id){$scope["switch"](index);return}}}})};$scope.edit=function(index){var doc;doc=$scope.projects[index];$scope.current_edit=index;$scope.newname=doc.title;ngDialog.open({template:"rename",scope:$scope})};$scope["switch"]=function(index){var doc,spinner;$scope.current_doc=doc=$scope.projects[index];spinner=$foundry.spinner({type:"loading",text:"Switching..."});docModule.switch_callback=function(){$scope.load();return spinner.hide()};docModule.open(doc,function(){})};$scope.rename=function(){var doc,spinner;doc=$scope.projects[$scope.current_edit];spinner=$foundry.spinner({type:"loading",text:"Renaming..."});ngDialog.close();docModule.rename(doc,$scope.newname,function(file){console.log(file);$scope.load();return spinner.hide()})};$scope.delet_doc=function(index){var doc;doc=$scope.projects[index];docModule.del_doc(doc)};$scope.load()}])}}).call(this);(function(){define("core/analytic",function(){var api,get_owner_space_count,init,send_login_event,send_owner_event,send_user_event;init=function(){ga("create","UA-46950334-2",{userId:foundry._current_user.email});ga("require","displayfeatures");ga("set","dimension1",foundry._current_user.email);ga("set","dimension2",c_file.title);ga("set","dimension3",c_file.owners[0].emailAddress+":"+c_file.owners[0].displayName);return ga("send","pageview")};get_owner_space_count=function(){var count,space,_i,_len,_ref;count=0;_ref=window.app_files;for(_i=0,_len=_ref.length;_i<_len;_i++){space=_ref[_i];if(space.owners[0].permissionId===foundry._current_user.id){count++}}return count};send_owner_event=function(data){var count;if(!ga){return}count=get_owner_space_count();return ga("send","event","forum_owner_operation:"+data.email,"create_workspace:"+data.name,count)};send_user_event=function(data){var count;if(!ga){return}count=foundry._models.User.all().length;return ga("send","event","forum_owner_operation:"+data.email,"share_workspace:"+data.user,count)};send_login_event=function(data){};return api={init:function(){return init()},owner:function(data){return send_owner_event(data)},user:function(data){return send_user_event(data)},login:function(data){return send_login_event(data)}}})}).call(this);(function(){angular.module("enterpise-ui",["ngDialog"]).directive("enEditor",["$parse","$timeout",function($parse,$timeout){return function(scope,elm,attrs){var composer,editor,iframe,update,value;value=$parse(attrs.ngModel)(scope);update=function(){var getter,setter;getter=$parse(elm.attr("ng-model"));setter=getter.assign;setter(angular.element(elm).scope(),$(elm).val());return $timeout(function(){return angular.element(elm).scope().$apply()},0)};editor=$(elm).wysihtml5($.extend(foundry.wysiwygOptions,{stylesheets:[],events:{change:update,blur:update}}));scope.$watch(attrs.ngModel,function(value){if(!value){value=""}if(value!==$(elm).data("wysihtml5").editor.composer.getValue()){$(elm).data("wysihtml5").editor.composer.setValue(value)}},true);iframe=$(elm).data("wysihtml5").editor.currentView.iframe;composer=$(elm).data("wysihtml5").editor.composer;$(iframe).on("load",function(){$(iframe.contentDocument.body).on("keydown",function(evt){if(evt.keyCode===13){return composer.commands.exec("insertHTML","<br>")}});return $(iframe.contentDocument.body).on("paste",function(evt){console.log("pasted");return evt.stopPropagation()})});if(!value){value=""}$(elm).data("wysihtml5").editor.composer.setValue(value)}}]).directive("modelForm",["$compile","$parse",function($compile,$parse){return{restrict:"E",compile:function(tElement,tAttr){return function(scope,element,attrs){var content,create_method,html,instance,k,key,mode,model,random,update_method,v,value,_ref,_ref1;random=Math.floor(Math.random()*1e9);instance=attrs["instanceName"];model=attrs["modelName"];create_method=scope[model].create;update_method=scope[model].update;html="<form>";mode=attrs["formMode"];_ref=scope[model].fields;for(key in _ref){value=_ref[key];html+='<div class="nimb_form'+(" "+value.type)+'"';if(value.show){html+='ng-show="'+value.show+'"'}if(value.hide){html+='ng-hide="'+value.hide+'"'}html+=">";html+='<label for="'+instance+"."+key+random+'">'+value.label+"</label>";switch(value.type){case"input":html+='<input type="text" id="'+instance+"."+key+random+'" ng-model="'+instance+"."+key+'">';break;case"select":html+='<select ng-model="'+instance+"."+key+'">';_ref1=value.options;for(k in _ref1){v=_ref1[k];html+='<option ng-selected="'+model+"."+key+".value == "+v+'" value="'+v+'">'+k+"</option>"}html+="</select>";break;case"checkbox":html+='<div class="checker"><span><input style="margin-top:0px;margin-right:10px;" type="checkbox" ng-model="'+instance+"."+key+'" >'+value.text+"</span></div><br>";break;case"text":html+='<textarea id="'+instance+"."+key+random+'" ng-model="'+instance+"."+key+'"></textarea>';break;case"editor":html+='<textarea style="" en-editor ng-model="'+instance+"."+key+'">{{'+instance+"[key]}}</textarea>";break;case"list":html+='<span ng-init="'+instance+"."+key+"=[]||"+instance+"."+key+'"></span>';html+='<tags-input custom-class="bootstrap" type="text" ng-model="'+instance+"."+key+'"></tags-input>';break;case"radio":html+='<div><label ng-repeat="(k,v) in '+model+"."+key+'.options">';html+='<input name="'+instance+"."+key+'" style="margin-top: -4px;margin-right: 5px;" type="radio" value="{{v}}" ng-model="'+instance+"."+key+'"> {{k}}<br />';html+="</label></div>";break;case"file":html+='<span class="btn outline btn-file"><input type="file" form-file en-model="'+instance+"."+key+'" class="fileupload">Choose File</span>';html+='<span class="btn btn-danger" ng-show="'+instance+"."+key+'" ng-click="'+instance+"."+key+'=null">Clear</span>';html+='<p class="file_attach">{{'+instance+"."+key+".name}}</p>";break;case"date_time":html+='<input class="datetimepicker" en-date type="text" ng-model="'+instance+"."+key+'">'}html+="</div>"}html+='<button ng-show="'+mode+"=="+"'"+"edit"+"'"+'" class="btn btn-success update_button" ng-click="'+update_method+'">Update</button>';html+='<button ng-show="'+mode+"=="+"'"+"create"+"'"+'" class="btn btn-primary create_button" ng-click="'+create_method+'">Create</button>';html+="</form>";content=$compile(html)(scope);element.replaceWith(content)}}}}]).directive("enList",["$compile","$timeout","$parse",function($compile,$timeout,$parse){return function(scope,elm,attrs){$timeout(function(){return $(elm).simpleTagger()},300);scope.$watch(attrs.ngModel,function(oldValue,newValue){return console.log("new value")});return console.log("list directive")}}]).directive("userInfo",["$compile",function($compile){return{restrict:"E",compile:function(tElement,tAttr){return function(scope,element,attrs){return console.log($compile)}}}}]).directive("fileread",[function(){return{link:function($scope,element,attrs){element.bind("change",function(evt){if(attrs.enModel){$scope[attrs.enModel]=evt.target.files[0];return $scope.$apply()}});element.on("click",function(evt){return evt.stopPropagation()})}}}]).directive("formFile",["$parse",function($parse){return function(scope,elm,attrs){var changed,setter;setter="test";changed=function(evt){var getter;if(attrs.enModel){getter=$parse(attrs.enModel);setter=getter.assign;setter(scope,evt.target.files[0]);return scope.$apply()}};return elm.bind("change",changed)}}]).factory("$foundry",["$http",function($http){var service;service={email:function(){var mailgun;console.log("email");mailgun=function(type,value,content,bcc,cc){var form_data;form_data={from:encodeURIComponent("NimbusBase <me@nimbusbase.com>"),to:encodeURIComponent(value),subject:encodeURIComponent(type),html:encodeURIComponent(content)};if(bcc){form_data["bcc"]=encodeURIComponent(bcc)}if(cc){form_data["cc"]=encodeURIComponent(cc)}return $.ajax({url:"http://192.241.167.76:3000/api.mailgun.net/v2/nimbusbase.com/messages",method:"post",beforeSend:function(request){return request.setRequestHeader("Authorization","Basic  YXBpOmtleS04c3RvbXM1eGwtaHRuZGFoMmZsNGNycG9vaTN0bnllMg==")},data:form_data,success:function(data){return console.log(data)}})};return mailgun.apply(this,arguments)},gmail:function(subject,to,content,cc,bcc){var base64EncodedEmail,data,mailCallback,sendMessage;if(cc==null){cc=""}if(bcc==null){bcc=""}base64EncodedEmail="";sendMessage=function(email,callback){var request;base64EncodedEmail=base64EncArr(strToUTF8Arr(email)).replace(/\//g,"_").replace(/\+/g,"-");request=gapi.client.gmail.users.messages.send({userId:"me",message:{raw:base64EncodedEmail}});return request.execute(callback)};mailCallback=function(error,email){var currentUserEmail;if(error){console.log(error);return}currentUserEmail=foundry._current_user.email;return sendMessage(email,function(){console.log("gmail sent to others");console.log(arguments);if(arguments[0].id){if(to.indexOf(currentUserEmail)>=0||bcc.indexOf(currentUserEmail)>=0||cc.indexOf(currentUserEmail)>=0){return gapi.client.request({path:"gmail/v1/users/me/messages/"+arguments[0].id+"/modify",method:"POST",body:'{"addLabelIds": ["UNREAD","INBOX"]}',callback:function(){console.log("gmail sent to self");return console.log(arguments)}})}}})};data={from:"'me'",to:to,cc:cc,bcc:bcc,subject:subject,html:content};if(window.composeMail){return window.composeMail(data,mailCallback)}else{return window.mailTasks.push(data,mailCallback)}},validate:function(emal,callback){console.log("validation");return Nimbus.Share.add_share_user_real(email,function(user){var is_valid;is_valid=user.name?true:false;Nimbus.Share.remove_share_user_real(user.id,function(res){return callback(is_valid)})})},spinner:function(config){var data,opts,spinner,target;data={text:config.text};switch(config.type){case"loading":opts={lines:13,length:11,width:5,radius:17,corners:1,rotate:0,color:"#FFF",speed:1,trail:60,shadow:false,hwaccel:false,className:"spinner",zIndex:2e9,top:"auto",left:"auto"};target=document.createElement("div");document.body.appendChild(target);spinner=new Spinner(opts).spin(target);data.spinner=spinner;break;case"sucess":data.icon="img/check.png";break;case"error":data.icon="img/cross.png"}return iosOverlay(data)},rss:function(url,callback){var buildUrl,callbackWhenMatch,httpsProxyUrl,matchArticle,proxyUrl,retrieveArticle;proxyUrl=httpsProxyUrl="http://192.241.167.76:9292/";callbackWhenMatch=null;buildUrl=function(str){var https;https=str.indexOf("https://");if(https===-1){str=proxyUrl+str.replace("http://","")}else{str=httpsProxyUrl+str.replace("https://","")}return str};matchArticle=function(options){var article,callbackOrNot,listUrl,title;article=options.rss;listUrl=options.url;callbackOrNot=options.callback;title=options.title;return $.ajax({url:buildUrl(listUrl),dataType:"xml",success:function(data){var error,item,list,obj,_i,_len;list=$(data).find("item");if(list.length===0){list=$(data).find("entry")}obj=null;error=true;for(_i=0,_len=list.length;_i<_len;_i++){item=list[_i];if($(item).find("link").text().indexOf(article)!==-1){obj=item;error=false;break}if(title&&title.indexOf($(item).find("title").text())!==-1){obj=item;error=false;break}}if(error){obj={title:title}}if(callbackOrNot){return callbackWhenMatch(obj,error)}},error:function(req,text){var data,error,item,list,obj,_i,_len;console.log(req,text);data=null;if(text==="parsererror"){data=$(req.responseText)}list=$(data).find("item");if(list.length===0){list=$(data).find("entry")}obj=null;error=true;for(_i=0,_len=list.length;_i<_len;_i++){item=list[_i];if($(item).find("link").text().indexOf(article)!==-1){obj=item;error=false;break}if(title&&title.indexOf($(item).find("title").text())!==-1){obj=item;error=false;break}}if(error){obj={title:title}}if(callbackOrNot){return callbackWhenMatch(obj,error)}}})};retrieveArticle=function(rss,callback){var str;str=buildUrl(rss);callbackWhenMatch=callback;return $.ajax({url:str,async:false,dataType:"html",success:function(data){var listUrl,match,options,titleMatch;titleMatch=/<title>([\s\S]*)<\/title>/.exec(data);match=/application\/rss\+xml.*href=['"](.*)['"]/.exec(data);if(match&&match.length>=2){listUrl=match[1];if(listUrl.indexOf("feedburner.com")!==-1){listUrl=listUrl+"?format=xml"}options={url:listUrl,rss:rss,title:titleMatch[1]||"",callback:true};return matchArticle(options)}else{console.log("error when get this site");data={title:titleMatch[1]||""};return callbackWhenMatch(data,true)}},error:function(data){console.log(data);return callbackWhenMatch(null,true)}})};retrieveArticle(url,callback)}};return service}]).directive("enCalendar",["$parse",function($parse){var link;link=function(scope,elm,attrs){var config;config={};if(attrs["enClick"]){config.action=function(evt){var id;id=evt.target.id.replace("_day","");$(elm).find(".current_date").removeClass("current_date");$("#"+id).addClass("current_date");scope.show_date.call(scope,evt);return scope.$apply()}}$(elm).zabuto_calendar(config);scope.$watch("selected_date",function(n,o){if(!n||n===""){return $(elm).find(".current_date").removeClass("current_date")}})};return{link:link}}]).directive("bindHtmlUnsafe",["$compile",function($compile){return function($scope,$element,$attrs){var compile,htmlName;compile=function(newHTML){if(newHTML){newHTML=newHTML.replace(/\n/g,"<br>")}return $element.html("").append(newHTML)};htmlName=$attrs.bindHtmlUnsafe;return $scope.$watch(htmlName,function(newHTML,oldHTML){return compile(newHTML)})}}]).directive("confirm",["$compile",function($compile){return{link:function($scope,elm,attrs){return elm.bind("click",function(evt){var content,html,onCancel,onConfirm;onConfirm=attrs["onConfirm"];onCancel=attrs["onCancel"]?attrs["onCancel"]:"";html='<div class="wrapper dismiss_containter"><form>';html+='<div class="m-t-lg text-right"><button style="margin-right:5px" en-dismiss ng-click="'+onConfirm+'" class="btn btn-success">Yes</button>';html+='<button class="btn btn-danger bootbox-close-button" en-dismiss ng-click="'+onCancel+'">No</button></div>';html+="</form></div>";content=$compile(html)($scope);bootbox.dialog({title:"Are you sure you want to do this?",className:"nimbus_confirm_modal",message:content})})}}}]).directive("enDismiss",function(){return function(scope,elm,attrs){return elm.bind("click",function(evt){return bootbox.hideAll()})}}).directive("subexternal",function(){return{link:function(scope,elm,attrs){return elm.delegate("a","click",function(evt){var targetURL;if(!this.href||this.href.indexOf("#")===0){return}evt.preventDefault();targetURL=this.href;return window.open(targetURL,"_blank")})}}}).directive("enDate",function(){return function(scope,elm,attrs){return $(elm).datetimepicker()}}).directive("enEditInPlace",["$parse","$compile",function($parse,$compile){return{restrict:"A",require:"?ngModel",link:function(scope,elm,attrs,ngModel){var edit,listener;edit=$("<div contentEditable='true' class='temp tasks-list-desc editable-cell' style='top:0px;text-decoration:none'></div>");listener=function(evt){var editable,value;value=$parse(attrs["ngModel"])(scope);editable=$parse(attrs["enableEdit"])(scope);evt.stopPropagation();if(editable){return}elm.after(edit.html(value)).hide();edit.focus();edit.on("blur",function(evt){return elm.show().next(".temp").remove()});return edit.on("keydown",function(evt){if(evt.keyCode===13){scope.$apply(function(){return elm.controller("ngModel").$setViewValue(edit.text())});return elm.show().next(".temp").remove()}})};elm.on("click",listener)}}}]).directive("enZoom",[function(){return function(scope,elm,attrs){var url;url=attrs["enZoom"];return elm.on("click",function(evt){var html,modal;html='<div class="image-zoomed todo-image-zoomed">';html+="<img src='"+url+"' />";html+='<div class="backdrop"></div>';html+="</div>";modal=$(html);modal.on("click",function(evt){return $(this).fadeOut(function(){return $(this).remove()})});return $("body").append(modal.fadeIn())})}}]).directive("imgZoom",function(){return{link:function(scope,elm,attrs){var show_pop_up;elm.delegate("img","mouseenter",function(evt){var link,url;url=evt.target.src;link="<div class='mask'></div><a class='zoom-action-button' data-src='"+url+"'><i class='icon icon-zoom-in'></i></a>";$(evt.target).wrap('<p class="image-zoom-container"></p>');return $(evt.target).parent().append(link)});elm.delegate("img","mouseleave",function(evt){$(evt.target).children("a,div.mask").remove();$(evt.target).siblings("a,div.mask").remove();return $(evt.target).unwrap()});elm.delegate(".zoom-action-button","click",function(evt){var url;url=$(evt.target).data("src");return show_pop_up(url)});show_pop_up=function(url){var html,modal;html='<div class="image-zoomed todo-image-zoomed">';html+="<img src='"+url+"' />";html+='<div class="backdrop"></div>';html+="</div>";modal=$(html);modal.on("click",function(evt){return $(this).fadeOut(function(){return $(this).remove()})});return $("body").append(modal.fadeIn())};return console.log("in link stage")}}}).directive("subZoom",function(){return function(scope,elm,attrs){var show_pop_up;elm.delegate("img","click",function(evt){var url;url=evt.target.src;return show_pop_up(url)});return show_pop_up=function(url){var html,modal;html='<div class="image-zoomed todo-image-zoomed">';html+="<img src='"+url+"' />";html+='<div class="backdrop"></div>';html+="</div>";modal=$(html);modal.on("click",function(evt){return $(this).fadeOut(function(){return $(this).remove()})});return $("body").append(modal.fadeIn())}}}).directive("rssFeed",function(){return function(scope,elm,attrs){}});angular.module("enterpise-ui").directive("enFile",["$parse",function($parse){return{restrict:"A",link:function(scope,element,attrs){element.on("change",function(evt){var setter;if(attrs.enModel){setter=$parse(attrs.enModel).assign;setter(scope,evt.target.files[0])}return scope.$apply()});element.on("click",function(evt){return evt.stopPropagation()})}}}])}).call(this);angular.module("enterpise-ui").filter("utc_date",function(){return function(input,format){var out;out=new Date(input);out=out.toDateString();return out}});